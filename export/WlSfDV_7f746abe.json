{"ver":"0.1","info":{"id":"WlSfDV","date":"1603040209","viewed":607,"name":"Warping Test","username":"edorobek","description":"Playing with domain warping","likes":22,"published":1,"flags":0,"usePreview":1,"tags":["fbm"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGzn","filepath":"/media/a/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","previewfilepath":"/media/ap/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n// noise and FBM\nfloat noise( in vec2 x )\n{\n    vec2 p = floor(x);\n    vec2 f = fract(x);\n    f = f*f*(3.0-2.0*f);\n    float a = textureLod(iChannel0,(p+vec2(0.5,0.5))/256.0,0.0).x;\n\tfloat b = textureLod(iChannel0,(p+vec2(1.5,0.5))/256.0,0.0).x;\n\tfloat c = textureLod(iChannel0,(p+vec2(0.5,1.5))/256.0,0.0).x;\n\tfloat d = textureLod(iChannel0,(p+vec2(1.5,1.5))/256.0,0.0).x;\n    return mix(mix( a, b,f.x), mix( c, d,f.x),f.y);\n}\n\nconst mat2 mtx = mat2( 0.85,  0.60, -0.60,  0.80 );\n\nfloat fbm3( vec2 p )\n{\n    float f = 0.0;\n\n    f += 0.8000*(-1.0+2.0*noise( p )); p = mtx*p*2.02;\n    f += 0.250000*noise( p ); p = mtx*p*2.03;\n    f += 0.5500*(-1.0+2.0*noise( p )); p = mtx*p*2.03;\n    f += 0.1625*(-1.0+2.0*noise( p ));\n    \n    return f/1.8375;\n}\n\nfloat fbm7( vec2 p )\n{\n    float f = 0.0;\n\n    f += 0.005000*noise( p ); p = mtx*p*2.02;\n    f += 0.250000*noise( p ); p = mtx*p*2.03;\n    f += 0.125000*noise( p ); p = mtx*p*2.01;\n    f += 0.562500*noise( p ); p = mtx*p*2.04;\n    f += 0.831250*noise( p ); p = mtx*p*2.01;\n    f += 0.312500*noise( p ); p = mtx*p*2.02;\n    f += 0.15625*noise( p );\n\n    return f/5.41875;\n}\n\nvec2 fbm3_2( vec2 p )\n{\n    return vec2( fbm3(p+vec2(1.5)), fbm3(p+vec2(3.2)) );\n}\n\nvec2 fbm7_2( vec2 p )\n{\n    return vec2( fbm7(p+vec2(3.2)), fbm7(p+vec2(9.7)) );\n}\n\n\n// Domain Warping\nfloat warp(vec2 q, out vec2 o, out vec2 n)\n{\n    // animate q here\n    q += 0.1*sin(vec2(0.11,0.13)*.16*iTime + length( q )*4.0);\n    q *= 0.8;\n    \n    o = 0.5 + 0.5*fbm3_2( q );\n    \n    o += 0.04*sin(vec2(0.11,0.11)*.1*iTime*length( o ));\n\to *= 1.1;\n    \n    n = fbm7_2(.95*o);\n    \n    vec2 p = q + 2.0*n + 1.0;\n    \n    float f = 0.5 + 0.5*fbm3(2.0*p);\n    \n    f = mix(f, f*f*f*3.5, f*abs(n.x));\n    \n    f *= 1.0-0.5*pow( 0.5+0.5*sin(8.0*p.x)*sin(8.0*p.y), 8.0 );\n\n    return f;\n}\n\nfloat warps( in vec2 q )\n{\n    vec2 t1, t2;\n    return warp(q,t1,t2);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    \n    vec3 tot = vec3(0);\n    for( int mi=0; mi<4; mi++ )\n    for( int ni=0; ni<4; ni++ )\n    {\n    vec2 q = (2.0*fragCoord-iResolution.xy)/iResolution.y;\n    vec2 o, n;\n    \n    float f = warp(q, o, n);\n    \n    vec3 col = vec3(0.2,0.7,0.3);\n        col = mix( col, vec3(0.2,0.25,0.35), f );\n        col = mix( col, vec3(0.9,0.9,0.9), dot(n,n) );\n        col = mix( col, vec3(0.5,0.4,0.1), 0.5*o.y*o.y );\n        col = mix( col, vec3(0.6,0.2,0.4), 0.5*smoothstep(1.2,1.3,abs(n.y)+abs(n.x)) );\n        col *= f*2.0;\n    \n    vec2 ex = vec2( 1.0 / iResolution.x, 0.0 );\n    vec2 ey = vec2( 0.0, 1.0 / iResolution.y );\n    \n    vec3 nor = normalize( vec3( warps(q+ex) - f, ex.x, warps(q+ey) - f ) );\n    \n    vec3 lig = normalize( vec3( 0.9, -0.2, -0.4 ) );\n    float dif = clamp( 0.3+0.7*dot( nor, lig ), 0.0, 1.0 );\n\n    vec3 bdrf;\n    bdrf  = vec3(0.85,0.90,0.95)*(nor.y*0.5+0.5);\n    bdrf += vec3(0.15,0.10,0.55)*dif;\n    bdrf  = vec3(0.85,0.90,0.95)*(nor.y*0.5+0.5);\n    bdrf += vec3(0.15,0.10,0.05)*dif;\n\n    col *= 2.1*bdrf;\n    col = vec3(1.0)-col;\n    col = col*col;\n    col *= vec3(1.1,1.25,1.2);\n        \n    tot += col;\n    }\n    \n    tot /= 16.0;\n    \n    vec2 p = fragCoord / iResolution.xy;\n\ttot *= 0.5 + 0.5 * sqrt(16.0*p.x*p.y*(1.0-p.x)*(1.0-p.y));\n    \n\tfragColor = vec4(tot, 1.0);\n}","name":"Image","description":"","type":"image"}]}