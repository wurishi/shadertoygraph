{"ver":"0.1","info":{"id":"fs33DX","date":"1630695860","viewed":154,"name":"Clustering Color","username":"shiyuugo","description":"clustering specified colors\nmaybe const\n\nhttps://www.shadertoy.com/view/4llBDf\ncolor conversation\nhttps://www.shadertoy.com/view/wt23Rt","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["stylize","clustering","quantize"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sX3Rn","filepath":"/media/a/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv","previewfilepath":"/media/ap/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nconst int ind = 12;\nvec3 colors[ind] = vec3[](\n    vec3( 0.0, 0.0, 0.0), \n    vec3( 1.0, 0.0, 0.0 ),    \n    vec3( 1.0, 1.0, 0.0 ),\n    vec3( 1.0, 0.0, 1.0 ),\n    vec3( 0.0, 1.0, 0.0 ),    \n    vec3( 0.0, 1.0, 1.0 ),\n    vec3( 0.0, 0.0, 1.0 ),    \n    vec3( 1.0, 0.85, 0.6 ),    \n    vec3( 1.0, 0.9, 0.8 ),  \n    vec3( 1.0, 0.75, 0.5 ), \n    vec3( 1.0, 0.6, 0.4 ),\n    vec3( 1.0, 1.0, 1.0 ));\n  \nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\n    vec2 uv = fragCoord/iResolution.xy;\n\n    vec3 src = texture(iChannel0, uv).rgb;\n     \n    vec3 col;\n    float minDist=999.0; // MAX_FLOAT\n    for(int i=0; i<ind; i++){\n        //float d = length(colors[i]-src);\n        float d = length(rgb2lab(colors[i])-rgb2lab(src));\n        col = d < minDist ? colors[i] : col;\n        minDist = d < minDist ? d : minDist;\n    }\n    \n    col = uv.x < iMouse.x/iResolution.x ? src : col;\n    \n    \n    col = uv.x<0.03 ? colors[int(uv.y*float(ind))] : col;\n    \n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"\n//CIE L*a*b* (CIELAB, L* for lightness, a* from green to red, b* from blue to yellow)\n//Source: https://gist.github.com/mattatz/44f081cac87e2f7c8980 (HLSL)\nvec3 rgb2xyz(vec3 c){\n\tvec3 tmp=vec3(\n\t\t(c.r>.04045)?pow((c.r+.055)/1.055,2.4):c.r/12.92,\n\t\t(c.g>.04045)?pow((c.g+.055)/1.055,2.4):c.g/12.92,\n\t\t(c.b>.04045)?pow((c.b+.055)/1.055,2.4):c.b/12.92\n\t);\n\tmat3 mat=mat3(\n\t\t.4124,.3576,.1805,\n\t\t.2126,.7152,.0722,\n\t\t.0193,.1192,.9505\n\t);\n\treturn 100.*(tmp*mat);\n}\nvec3 xyz2lab(vec3 c){\n\tvec3 n=c/vec3(95.047,100.,108.883),\n\t     v=vec3(\n\t\t(n.x>.008856)?pow(n.x,1./3.):(7.787*n.x)+(16./116.),\n\t\t(n.y>.008856)?pow(n.y,1./3.):(7.787*n.y)+(16./116.),\n\t\t(n.z>.008856)?pow(n.z,1./3.):(7.787*n.z)+(16./116.)\n\t);\n\treturn vec3((116.*v.y)-16.,500.*(v.x-v.y),200.*(v.y-v.z));\n}\nvec3 rgb2lab(vec3 c){\n\tvec3 lab=xyz2lab(rgb2xyz(c));\n\treturn vec3(lab.x/100.,.5+.5*(lab.y/127.),.5+.5*(lab.z/127.));\n}\nvec3 lab2xyz(vec3 c){\n\tfloat fy=(c.x+16.)/116.,\n\t      fx=c.y/500.+fy,\n\t      fz=fy-c.z/200.;\n\treturn vec3(\n\t\t 95.047*((fx>.206897)?fx*fx*fx:(fx-16./116.)/7.787),\n\t\t100.   *((fy>.206897)?fy*fy*fy:(fy-16./116.)/7.787),\n\t\t108.883*((fz>.206897)?fz*fz*fz:(fz-16./116.)/7.787)\n\t);\n}\nvec3 xyz2rgb(vec3 c){\n\tmat3 mat=mat3(\n\t\t3.2406,-1.5372,-.4986,\n\t\t-.9689, 1.8758, .0415,\n\t\t .0557, -.2040,1.0570\n\t);\n\tvec3 v=(c/100.0)*mat,\n\t     r=vec3(\n\t\t(v.r>.0031308)?((1.055*pow(v.r,(1./2.4)))-.055):12.92*v.r,\n\t\t(v.g>.0031308)?((1.055*pow(v.g,(1./2.4)))-.055):12.92*v.g,\n\t\t(v.b>.0031308)?((1.055*pow(v.b,(1./2.4)))-.055):12.92*v.b\n\t);\n\treturn r;\n}\nvec3 lab2rgb(vec3 c){return xyz2rgb(lab2xyz(vec3(100.*c.x,2.*127.*(c.y-.5),2.*127.*(c.z-.5))));}\n\n\n\n//XYZ to CIE 1931 Yxy color space (luma (Y) along with x and y chromaticity), I found that Photoshop used this.\nvec3 xyz2yxy(vec3 c){\n\tfloat s=c.x+c.y+c.z;\n\treturn vec3(c.y,c.x/s,c.y/s); //Blue's within s.\n}\nvec3 yxy2xyz(vec3 c){\n\tfloat x=c.x*(c.y/c.z); //Y*(x/y)\n\treturn vec3(x,c.x,(x/c.y)-x-c.x); //(X,Y,(X/x)-X-Y)\n}\nvec3 rgb2yxy(vec3 c){return xyz2yxy(rgb2xyz(c));}\nvec3 yxy2rgb(vec3 c){return xyz2rgb(yxy2xyz(c));}\n","name":"Common","description":"","type":"common"}]}