{"ver":"0.1","info":{"id":"fs2yWc","date":"1644242250","viewed":149,"name":"3D raycasting","username":"Gravechest","description":"epic 3D thingy","likes":6,"published":1,"flags":0,"usePreview":0,"tags":["3d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XdX3Rr","filepath":"/media/a/aea6b99da1d53055107966b59ac5444fc8bc7b3ce2d0bbb6a4a3cbae1d97f3aa.bin","previewfilepath":"/media/ap/aea6b99da1d53055107966b59ac5444fc8bc7b3ce2d0bbb6a4a3cbae1d97f3aa.bin","type":"volume","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 angle = vec2(cos(iTime / 38.0) * 18.0,sin(iTime / 17.3) * 7.3);\n    vec3 pos   = vec3(10.5 + cos(iTime / 10.0) * 10.0,15.5 + cos(iTime / 11.4) * 11.4,15.5 + sin(iTime / 9.2) * 9.2);\n    vec4 dir = vec4(cos(angle.x),sin(angle.x),sin(angle.y),cos(angle.y));\n    vec2 pixelOffset = fragCoord.xy/iResolution.xy*2.0-1.0;\n    pixelOffset.x *= 1.69;\n    vec3 vec;\n    vec.x = (dir.x * dir.w - dir.x * dir.z * pixelOffset.y) - dir.y * pixelOffset.x;\n    vec.y = (dir.y * dir.w - dir.y * dir.z * pixelOffset.y) + dir.x * pixelOffset.x;\n    vec.z = dir.z + dir.w * pixelOffset.y;\n    vec = normalize(vec);\n    vec3 Pos = pos;\n    vec3 delta = abs(1.0 / vec);\n    vec3 Step;\n    vec3 side;\n    if(vec.x < 0.0){\n        Step.x = -1.0;\n        side.x = fract(Pos.x) * delta.x;\n    }\n    else{\n        Step.x = 1.0;\n        side.x = (float(int(Pos.x)) + 1.0 - Pos.x) * delta.x;\n    }\n    if(vec.y < 0.0){\n        Step.y = -1.0;\n        side.y = fract(Pos.y) * delta.y;\n    }\n    else{\n        Step.y = 1.0;\n        side.y = (float(int(Pos.y)) + 1.0 - Pos.y) * delta.y;\n    }\n    if(vec.z < 0.0){\n        Step.z = -1.0;\n        side.z = fract(Pos.z) * delta.z;\n    }\n    else{\n        Step.z = 1.0;\n        side.z = (float(int(Pos.z)) + 1.0 - Pos.z) * delta.z;\n    }\n    Pos = vec3(ivec3(Pos));\n    int Side;\n    for(int i = 0;i < 64;i++){\n       if(side.x < side.y){\n            if(side.x < side.z){\n\t\t\t\tPos.x += Step.x;\n\t\t\t\tside.x += delta.x;\n\t\t\t\tSide = 0;\n            }\n            else{\n\t\t\t\tPos.z += Step.z;\n\t\t\t\tside.z += delta.z;\n\t\t\t\tSide = 2;\n            }\n        }\n        else if(side.y < side.z){\n\t\t\tPos.y += Step.y;\n\t\t\tside.y += delta.y;\n\t\t\tSide = 1;\n        }\n        else{\n\t\t\tPos.z += Step.z;\n\t\t\tside.z += delta.z;\n\t\t\tSide = 2;\n        }\n        vec4 map = texelFetch(iChannel0,ivec3(Pos),0);\n        if(map[0] > 0.9){\n            vec2 wall;\n            vec4 lmap,lmap2,lmap3,lmap4,lmap5;\n            switch(Side){\n            case 0:\n                wall = pos.yz + (side.x - delta.x) * vec.yz;\n                if(vec.x < 0.0){\n                    lmap  = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.yz),0);\n                    lmap2 = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.y-1.0,Pos.z),0);\n                    lmap3 = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.y+1.0,Pos.z),0);\n                    lmap4 = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.y,Pos.z-1.0),0);\n                    lmap5 = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.y,Pos.z+1.0),0);\n                }\n                else{\n                    lmap  = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.yz),0);\n                    lmap2 = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.y-1.0,Pos.z),0);\n                    lmap3 = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.y+1.0,Pos.z),0);\n                    lmap4 = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.y,Pos.z-1.0),0);\n                    lmap5 = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.y,Pos.z+1.0),0);\n                }\n                break;\n            case 1:\n                wall = pos.xz + (side.y - delta.y) * vec.xz;\n                if(vec.y < 0.0){\n                    lmap  = texelFetch(iChannel0,ivec3(Pos.x,Pos.y+1.0,Pos.z),0);\n                    lmap2 = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.y+1.0,Pos.z),0);\n                    lmap3 = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.y+1.0,Pos.z),0);\n                    lmap4 = texelFetch(iChannel0,ivec3(Pos.x,Pos.y+1.0,Pos.z-1.0),0);\n                    lmap5 = texelFetch(iChannel0,ivec3(Pos.x,Pos.y+1.0,Pos.z+1.0),0);\n                }\n                else{\n                    lmap  = texelFetch(iChannel0,ivec3(Pos.x,Pos.y-1.0,Pos.z),0);\n                    lmap2 = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.y-1.0,Pos.z),0);\n                    lmap3 = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.y-1.0,Pos.z),0);\n                    lmap4 = texelFetch(iChannel0,ivec3(Pos.x,Pos.y-1.0,Pos.z-1.0),0);\n                    lmap5 = texelFetch(iChannel0,ivec3(Pos.x,Pos.y-1.0,Pos.z+1.0),0);\n                }\n                break;\n            case 2:\n                wall = pos.xy + (side.z - delta.z) * vec.xy;\n                if(vec.z < 0.0){\n                    lmap  = texelFetch(iChannel0,ivec3(Pos.xy,Pos.z+1.0),0);\n                    lmap2 = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.y,Pos.z+1.01),0);\n                    lmap3 = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.y,Pos.z+1.0),0);\n                    lmap4 = texelFetch(iChannel0,ivec3(Pos.x,Pos.y-1.0,Pos.z+1.0),0);\n                    lmap5 = texelFetch(iChannel0,ivec3(Pos.x,Pos.y+1.0,Pos.z+1.0),0);\n                }\n                else{\n                    lmap  = texelFetch(iChannel0,ivec3(Pos.xy,Pos.z-1.0),0);\n                    lmap2 = texelFetch(iChannel0,ivec3(Pos.x-1.0,Pos.y,Pos.z-1.0),0);\n                    lmap3 = texelFetch(iChannel0,ivec3(Pos.x+1.0,Pos.y,Pos.z-1.0),0);\n                    lmap4 = texelFetch(iChannel0,ivec3(Pos.x,Pos.y-1.0,Pos.z-1.0),0);\n                    lmap5 = texelFetch(iChannel0,ivec3(Pos.x,Pos.y+1.0,Pos.z-1.0),0);\n                }\n                break;\n            }\n            vec3 sl;\n            float dm = 1.0 - abs(0.5 - fract(wall.x)) - abs(0.5 - fract(wall.y));\n            if(fract(wall.x) > 0.5){\n                sl += fract(wall.x * 2.0) / 2.0 * lmap3.gba; \n            }\n            else{\n                sl += (0.5 - fract(wall.x)) * lmap2.gba;\n            }\n            if(fract(wall.y) > 0.5){\n                sl += fract(wall.y * 2.0) / 2.0 * lmap5.gba;\n            }\n            else{\n                sl += (0.5 - fract(wall.y)) * lmap4.gba;\n            }\n            fragColor.rgb = (texelFetch(iChannel1,ivec2(fract(wall) * 1024.0),0).rgb + sl + lmap.gba * dm) / 2.0;\n            return;\n        }\n    }\n    \n    \n    \n    \n    \n    \n    \n    \n    \n}","name":"Image","description":"","type":"image"}]}