{"ver":"0.1","info":{"id":"mtVfWD","date":"1702101013","viewed":66,"name":"穿越钻石 Crossing the Diamond 3","username":"shadertoyjiang","description":"Inside the diamond, the outside is actually spherical? I don't know if the code I wrote is reliable.\n在钻石内看外面居然是球形的？我也不知道我写的代码靠不靠谱","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["zuanshi"],"hasliked":0,"parentid":"mlVBWD","parentname":"钻石 2"},"renderpass":[{"inputs":[{"id":"XsX3zn","filepath":"/media/a/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","previewfilepath":"/media/ap/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","type":"cubemap","channel":0,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n\n// 2023年12月8日19时26分15秒\n// 钻石\n#define N normalize\n#define rot(a) mat2(cos(a),-sin(a),sin(a),cos(a))\n#define D(a,b,c)  d=max(d,dot(p-(a), N(cross(c-(a),b-(a)))));// dot(...)点p到abc所在面的距离\n\n\nfloat m(vec3 p)\n{   //return length(p)-1.;\n    float t=iTime-9.37; p.xy*=rot(t*.7),p.yz*=rot(t*.5); p.zx*=rot(t*2.);\n    float PI =3.1415926535,\n          sz=1.,\n          d=-sz, \n          f8=PI/8.,\n          f4=PI/4.,\n          i,j;\n    for(i=j=1.;i<5.;i++)p.xz*=rot(-PI / j),p.z=abs(p.z),j+=j;\n    vec3 a,b,c,e,f,g,h,s,u,v,w;\n    a.x=e.y=sz;            // vec3(sz,0,0) vec3(0,sz,0)\n    b = a, b.xz *=rot(f8);\n    c = b*.5+e*.5;\n    s = c,s.z=-s.z;\n    f = a*.93-e*.13;\n    g = b*.85-e*.25;\n    h=g, h.z=-h.z;\n    u = a*.5-e*.4;\n    v = u, v.xz*=rot(f4);\n    w.y=u.y;\n    D(a,c,s)\n    D(a,b,c)\n    D(b,a,g)\n    D(h,g,f)\n    D(g,u,v)\n    D(u,w,v)\n    return max(d, length(p.xz)-sz*.98);\n}\n\nvec4 txt(vec3 r)\n{   //return vec4( .5-r.y)*abs(r.z+.5);\n    return texture(iChannel0,r)*.85;\n}\n\n\n\n\n\nvoid mainImage(out vec4 O, vec2 v)\n\n{\n\n        O *= 0.;\n\n        \n\n        vec2 R = iResolution.xy,\n\n             u = (v + v - R) / R.y;\n\n             \n\n        vec3 o, \n\n             r = N(vec3(u, 3)),// 整数\n\n             e,\n\n             sun= .5*N(vec3(-5,8,-5)),\n\n             n, p,   re,ra;\n\n        \n\n        float i,d ,t,df,tf, xi=1.,Fr,Nm,huan=.001, nn=  2.817;//2.417\n\n        e.y = .001;\n\n        o.z = -7.;//\n        \n        //r = N(vec3(u, 2)),o.z=-5.+mod((0.+iTime)*.2,6.);\n\n\n\n\n\n    for(;i<800. && t<8.;i++)\n\n    {\n\n        d=m(o+r*t);\n\n        if(d*df<0.)\n        //if(abs(d)<.01)\n        {\n\n            if(d<0.)// df 在在空气中\n\n            {\n                p=o+r*(tf-df);\n\n                n = N(  vec3(m(p+e.yxx),m(p+e),m(p+e.xxy)) - m(p) );\n\n                re=reflect(r, n); // 反射\n\n                ra = refract(r,n,1./nn);// 折射\n\n                Fr=.17+(1.-.17)*pow(1.-dot(n,re),5.);\n\n                O+=(max(0., dot(re,sun))+huan+txt(re))*Fr*xi;  // 从此外获得光能\n\n                xi=xi*(1.-Fr);\n\n                o=o+r*t;// 内部起点\n\n                r = N(ra);\n                \n                t=0.;\n\n            }\n\n            else\n\n            { // df 在钻石里\n\n                // 用前一点求反射折射\n                p=o+r*(tf-df);               \n                \n                //n 折射要正负区分\n                n = - N(  vec3(m(p+e.yxx),m(p+e),m(p+e.xxy)) - m(p) );\n\n                re = reflect(r, n); // 内反射光\n\n                ra = refract(r, n,  nn);// 折射光\n                \n                if(length(ra)>0.)\n                {// 折射进空气\n                     Fr=.17+(1.-.17)*pow(1.-dot(n,re),5.);\n                \n                     //Fr=1.-Fr;\n\n                     O+=(max(0., dot(ra,sun))+huan+txt(ra))*(1.-Fr)*xi;  // 从此外获得光能\n                }\n                else// 全反射\n                     Fr=1.;\n                     \n                xi=xi*Fr;\n\n                o = o + r*tf;\n\n                r =N(re);\n                \n                t=0.;\n                \n                \n                // d=d ?? \n                // 更真的效果，调了半天才发现这句注销了\n                d=df; // ？？？？？？？？应该加上这句，但却有大块光斑\n\n            }\n\n            if(Nm++>8.){O+=.5*xi;break;}\n\n        }\n\n        df=d;tf=t;\n\n        t += max(abs(d),.001);\n    }\n    if(t>5.)O=txt(r);\n}\n\n\n\n\n\n","name":"Image","description":"","type":"image"}]}