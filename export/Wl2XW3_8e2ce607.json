{"ver":"0.1","info":{"id":"Wl2XW3","date":"1567306002","viewed":141,"name":"NoodlePanic","username":"Hirai_worthless","description":"practice of toon-shading","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nfloat PI = 3.14159265;\nmat2 genRot(float a){\n\treturn mat2(cos(a),-sin(a),sin(a),cos(a));\n}\nvec2 pmod(vec2 p,float count){\n\tp *= genRot(PI/count);\n\tfloat at = atan(p.y/p.x);\n\tfloat r = length(p);\n\tat = mod(at,2. * PI / count);\n\tp = vec2(r * cos(at),r * sin(at));\n\tp *= genRot(-PI/count);\n\treturn p;\n}\nfloat map(vec3 p){\n    p = fract(p + 0.5)-0.5;\n    vec3 q = p;\n    float cube = min(length(q.xz + sin(q.y *2.*PI + iTime) * 0.1) - 0.05,length(q.yz - sin(q.x *2.*PI+ iTime) * 0.1 ) - 0.05);\n    cube = min(cube,length(q.xy + sin(q.z *2.*PI + iTime) * 0.1 )- 0.05);\n    //cube = min(cube,length(p)- 0.1);\n    return cube;\n}\nvec3 getNormal(vec3 p){\n\tvec3 x = dFdx(p);\n\tvec3 y = dFdy(p);\n\treturn normalize(cross(x,y));\n}\nvec4 trace(vec3 o,vec3 r){\n\tfloat t = 0.;\n\tvec3 p;\n\tfor(int i = 0; i < 128; i++){\n\t\tp = o + r * t;\n\t\tfloat d = map(p);\n\t\tt += d * 0.75;\n\t}\n\tvec3 n = getNormal(p);\n\treturn vec4(n,t);\n}\n\nvec3 cam(){\n\tvec3 c = vec3(.5,.5,-1.5 + iTime);\n\treturn c;\n}\nvec3 ray(vec2 uv,float z){\n\tvec3 r = normalize(vec3(uv,z));\n    r.xz *= genRot(PI/6.);\n    r.yz *= genRot(PI/6.);\n\treturn r;\n}\n\nvec3 getColor(vec3 o, vec3 r, vec4 d){\n    vec3 n = d.xyz;\n    float t = d.w;\n    vec3 l = vec3(-1.);\n    float s = dot(l,n);\n    vec3 c;\n    float fog = 1./(1. + t * t * 0.05);\n    c = s < -0.8 ? vec3\t(159,158,137)/255. : \n    (s > 0.8 ? vec3\t(213,211,187)/255. : vec3(185,178,155)/255.);\n    c = mix(vec3(55,15,8)/255.,c,fog);\n    return c;\n    \n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n\n\tvec2 uv = ( fragCoord.xy * 2. - iResolution.xy) / iResolution.y ;\n\tvec3 c = cam();\n\tvec3 r = ray(uv,1.5);\n\tvec4 d = trace(c,r);\n\tvec3 color = getColor(c,r,d);\n\n\tfragColor = vec4( color, 1.0 );\n\n}","name":"Image","description":"","type":"image"}]}