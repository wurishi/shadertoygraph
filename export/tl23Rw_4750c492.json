{"ver":"0.1","info":{"id":"tl23Rw","date":"1558982795","viewed":108,"name":"blobs3d","username":"biki73","description":"the code is a mess","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["blobs"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsfGzn","filepath":"/media/a/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","previewfilepath":"/media/ap/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","type":"cubemap","channel":0,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1},{"id":"4sfGzn","filepath":"/media/a/793a105653fbdadabdc1325ca08675e1ce48ae5f12e37973829c87bea4be3232.png","previewfilepath":"/media/ap/793a105653fbdadabdc1325ca08675e1ce48ae5f12e37973829c87bea4be3232.png","type":"cubemap","channel":1,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"struct ball {\n vec3 pos;\n float rad;\n};\n    \nball balls; \nball act[100];\n\nvec4 Distance(vec3 p,int n) {\nint i;\nfloat f,r,rad,g,lg;\nvec3 grad,bp;\n    f=0.5;\n    grad=vec3(0,0,0);\n    for (i=0;i<n;i++) {\n      bp=p-act[i].pos;\n        \n      rad=act[i].rad;\n      r=length(bp)/rad;\n           \n      if (r<1.0) {\n        f-=2.0*r*r*r-3.0*r*r+1.0; \n        g=(6.0*r*r-6.0*r)/rad;\n        grad+=g*normalize(bp);\n      }\n    }\n    lg=length(grad);\n    if (lg<=1.0) lg=1.0;\n    return vec4(grad,f/lg);\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n  vec3  pos,look,up,dir2,dir,p,n,lp,lv,reflected;\n  vec3  v1,v2,v3;\n  vec2  pix;\n  float diffuse,specular,ht,hc,near;\n  float angle,dist,far,k,dd;\n  vec4  h;\n  int i,nb;\n       \n  pos=vec3(30.0*sin(float(iFrame)*0.031),\n           16.0*sin(float(iFrame)*0.012),\n           30.0*sin(float(iFrame)*0.0234));\n  up=vec3(0,1,0);\n  look=vec3(0,0,0);\n  v1=normalize(look-pos);\n  v2=normalize(cross(v1,up));\n  v3=cross(v2,v1);\n    \n  pix=vec2(fragCoord-iResolution.xy*0.5); \n  dir=v1*iResolution.x+v2*pix.x+v3*pix.y;\n  dir=normalize(dir);\n  nb=0;\n    \n  dist=1e30;\n  far=0.0;\n  for (i=0;i<10;i++) {\n    balls.pos=vec3(7.0*sin(float(i)+iTime*0.1812),\n                      7.0*sin(float(i)*0.7383+iTime*0.111),\n                      7.0*sin(float(i)*0.843+iTime*0.252));\n    balls.rad=5.0+1.0*sin(float(i)*124.31);\n    ht=dot(balls.pos-pos,dir)/dot(dir,dir);\n    hc=distance(pos+dir*ht,balls.pos);\n    if (hc<balls.rad) {                 \n      act[nb++]=balls;\n      dd=sqrt(balls.rad*balls.rad-hc*hc);\n      if (dist>ht-dd) dist=ht-dd;\n      if (far<ht+dd) far=ht+dd;\n    }\n  }\n  if (nb>0) {\n    for (i=0;i<1000;i++) {\n      h=Distance(pos+dist*dir,nb);\n      if (h.w<0.00001) break;\n      dist+=h.w;\n      if (dist>far) { i=1000; break; }\n    }\n    if (i==1000) fragColor=texture(iChannel0,dir);\n    else {\n      n=h.xyz;\n      p=pos+dist*dir;\n      n=normalize(n);    \n      reflected=reflect(dir,n);\n      vec4 envmap=texture(iChannel1,reflected);\n      fragColor=envmap;\n    }      \n  } else fragColor=texture(iChannel0,dir);\n  \n}","name":"Image","description":"","type":"image"}]}