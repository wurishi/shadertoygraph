{"ver":"0.1","info":{"id":"DdsBRr","date":"1688399576","viewed":59,"name":"3d_ball","username":"hbbdmc","description":"this is a shader of ellipse in 3d","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["3d","ellipse"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsX3zn","filepath":"/media/a/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","previewfilepath":"/media/ap/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","type":"cubemap","channel":0,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define wh 1.0 / iResolution.y\nstruct Cam\n{\n    vec3 pos,dir;\n    vec3 r,u;//rightward upward\n}cam;\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n//    vec2 uv = fragCoord/iResolution.xy;\n    vec2 uv = (fragCoord - 0.5 * iResolution.xy) * wh;\n\n    //the model of ellipse\n    vec3 center = vec3(0.0 ,0.0, 0.5);\n    float radius = 0.1;\n    //camera\n    float t=iTime*.5;\n\n    cam.pos = vec3(0.0 ,0.0, 0.0) +vec3(cos(t),0.,0.)*0.5;\n    cam.dir = normalize(center-cam.pos );\n    cam.r = -cross(cam.dir,vec3(0,1,0));\n    cam.u=-cross(cam.r,cam.dir);\n     \n    vec3 o =  cam.pos - center;\n   // vec3 d = vec3(uv, 1.0);\n    vec3 d = normalize(uv.x*cam.r+uv.y*cam.u+1.*cam.dir);\n     \n    float a = dot(d,d);\n    float b = 2.0*dot(o,d);\n    float c = dot(o,o) - radius * radius;\n    float delt = b*b - 4.0*a*c;\n    float k = 0.0;\n    \n    if(delt < 0.0){\n         fragColor=texture(iChannel0,d);\n        //fragColor = vec4(0.0);\n        return;\n    }\n    \n    k = (-1.0*b - sqrt(delt)) / (2.0*a);\n    \n    vec3 p =cam.pos + k * d;//ray of pick ellipse\n    vec3 normal=normalize(p - center );// the normal of ellipse\n    vec3 dirLight=normalize(vec3(-1,-1,.2));//the light\n    vec3 diffuse =vec3(1.0)* \n                pow(\n                max(0.0,\n                    (dot(-dirLight,normal)+10.) / 11.),\n                    12.);\n    \n    vec3 ambient =vec3(.8,.7,.7) * .12;\n    fragColor.xyz =min(ambient + diffuse,1.0);\n}","name":"Image","description":"","type":"image"}]}