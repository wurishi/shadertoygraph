{"ver":"0.1","info":{"id":"Mt3GRN","date":"1468147841","viewed":150,"name":"[SH16A] - giving up at 683","username":"fernlightning","description":"\nhurrah I found a webgl bug (see comments)  - so this golfing exercise was actually of use :-)","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["bug","codegolf","sh16a"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","previewfilepath":"/media/ap/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","type":"texture","channel":0,"sampler":{"filter":"nearest","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n\n#define V vec3\n#define N normalize\n#define D max(abs(p).x, abs(p).z)\n\n// uses r, p - mutates p, c, n, C.x\n// note: only scans for spheres\n#define S for(int j = 0; j < 64; j++) { c = ceil(p - .5); c.y = .4 - .15*mod(C.x = c.x*5. + c.z, 2.); p += r*(length(n = p - c) - c.y);} if(D < 2.5)\n\n\nvoid mainImage(out vec4 F, vec2 C)\n{\n    V q = iResolution,      \n      p = V(3.*cos(5.), 2., 3.*sin(5.)),\n      z = V(0, 1, 0),\n      n = -N(z*.2 + p),\n      c = N(cross(n, z));\n    V\n      r = mat3(c, cross(c, n), n) * N(V(C-q.xy/2.,q.y)),\n      g = p - r*p.y/r.y; // ground plane hit\n    \n    // hit\n    S \n    {\n        // spheres\n        c = z + ceil(5.1+C.x/2.)*V(3, -8, 6)*.01;\n        n = N(n);\n    } else {\n        // ground\n        q = ceil(p = g);\n        c = V(mod(q.x + q.z, 2.) < .5 ? .4 : .5*texture(iChannel0, .1*p.xz).x)\n          * smoothstep(0., .5, D < 1.5 ? length(fract(p+.5)-.5) : 1.);  \n        n = z;\n    } \n \n    // lighitng - ambient, spec+diffuse\n    q = c*(1. + n.y)*V(7, 5, 10)/40.;\n    g = (pow(max(0., dot(reflect(r, n), r = N(V(-6, 7, -5)))),16.) + c*V(1.02, 1.2, .66))*dot(n, r);\n   \n    // shadow\n    p += .01*r;\n    S g *= 0.;\n\n    F.grb = sqrt(q + g);\n}\n\n","name":"Image","description":"","type":"image"}]}