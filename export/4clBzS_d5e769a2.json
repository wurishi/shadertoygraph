{"ver":"0.1","info":{"id":"4clBzS","date":"1723925498","viewed":34,"name":"Yet another Shadows","username":"opezdl","description":"Simple HeightField Shadows","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["penumbra","screenspaceshadows"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xdf3zn","filepath":"/media/a/85a6d68622b36995ccb98a89bbb119edf167c914660e4450d313de049320005c.png","previewfilepath":"/media/ap/85a6d68622b36995ccb98a89bbb119edf167c914660e4450d313de049320005c.png","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define uLightSize 0.2  \n#define uShadowIntensity 20. \n#define uShadowHardness 2.0 \n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord.xy / iChannelResolution[0].xy;\n    vec3 lightPos = vec3(iMouse.xy / iChannelResolution[0].xy, 1.2);\n    float fragHeight = texture(iChannel0, uv).r;\n    vec3 fragPos = vec3(uv, fragHeight);\n    vec3 lightDir = lightPos - fragPos;\n    float lightDistance = 0.5 * length(lightDir);\n    lightDir = normalize(lightDir);\n    float shadowSum = 0.0;\n    int numSteps = int(mix(4.0, 32.0, clamp(lightDistance / 0.25, 0.0, 1.0)));\n    vec2 noiseUV = mod(fragCoord.xy, iChannelResolution[1].xy) / iChannelResolution[1].xy;\n    float noiseValue = texture(iChannel1, noiseUV).r;\n    float firstStepOffset = noiseValue * (1.0 / float(numSteps));\n    for (int i = 1; i < numSteps; ++i) \n    {\n        float step = float(i)  / float(numSteps) + firstStepOffset;\n        vec3 currentPos = fragPos + lightDir * step;\n        float currentHeight = texture(iChannel0, currentPos.xy).r;\n        if (currentHeight > currentPos.z) \n        {\n            float distanceFactor = pow((float(numSteps - i) / float(numSteps)), uShadowHardness);\n            float penumbra = smoothstep(0.0, uLightSize, lightDistance);\n            shadowSum += distanceFactor * penumbra;\n        }\n    }\n    float shadowFactor = clamp(1.0 - shadowSum / float(numSteps), 0.0, 1.0);\n    shadowFactor = mix(1.0, shadowFactor, uShadowIntensity);\n    fragColor = vec4( shadowFactor,shadowFactor,shadowFactor,  1.0);\n}\n","name":"Image","description":"","type":"image"}]}