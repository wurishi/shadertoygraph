{"ver":"0.1","info":{"id":"WtcGzB","date":"1576657106","viewed":111,"name":"Flow With Friction","username":"ligaobo","description":"流动与速度","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["2d","flow","rate"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float flow_rate(vec2 fp, vec3 c);\nbool is_flow_area(vec2 uv, vec2 fp, vec3 c, float realtime, float timestep);\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = (fragCoord.xy * 2.0 - iResolution.xy) / iResolution.y;\n    \n    uv *= 2.0;\n    //2D 球定义\n    vec3 c = vec3(0.0, 0.0, 1.5);\n    \n    float time = mod(iTime, 5.0);\n    \n    //2d sphere field\n    float res = length(uv - c.xy) - c.z;\n    if(res < 0.0)\n    {\n        //速率\n        float rate = -sin(res / c.z * 0.25 * 3.1415926);\n        fragColor = vec4(rate);\n        \n        if(is_flow_area(uv, vec2(0, c.z * 0.65), c, time * 3.0, 0.1))\n            fragColor = vec4(1.0);\n        \n        return;\n    }\n}\n\n/*\n流速与fp到圆心c距离d成-sin（(d-c.z) / c.z * 0.25 * 3.1415926）\n*/\nfloat flow_rate(vec2 fp, vec3 c)\n{\n    return -sin((length(fp - c.xy) - c.z) / c.z * 0.25 * 3.1415926);\n}\n\nbool is_flow_area(vec2 uv, vec2 fp, vec3 c, float realtime, float timestep)\n{\n    float frate = flow_rate(fp, c);\n    vec2 dir = normalize(uv - fp);\n\n    for(float i = 0.0; i < realtime; i += timestep)\n    {\n        float fd = frate * timestep;\n        if(distance(fp, uv) < fd)\n            return true;\n\n        fp += fd * dir;\n        frate = flow_rate(fp, c);\n\n    }\n    return false;\n}","name":"Image","description":"","type":"image"}]}