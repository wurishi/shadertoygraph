{"ver":"0.1","info":{"id":"DdcXDr","date":"1679612692","viewed":113,"name":"Newton fractal using argument","username":"zenzicubic","description":"Needed to post on math SE","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["fractal","simple","newton"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define MAXITER 100\n#define SCALE 4.\n#define EPSILON 1e-5\n\n#define PI 3.141592653979\n#define TAU 2. * PI\n\n// Complex number utilities\nvec2 cmul(vec2 a, vec2 b)\n{\n    return vec2(a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x);\n}\nvec2 cinv(vec2 z) \n{\n    return vec2(z.x, -z.y) / dot(z,z);\n}\nvec2 cdiv(vec2 a, vec2 b)\n{\n    return cmul(a, cinv(b));\n}\n\nvec2 newton_iteration(vec2 z)\n{\n    vec2 t = cmul(z, cmul(z, z));\n    // Calculate the function and derivative and divide them\n    return cdiv(\n        cmul(t, z) - vec2(1., 0.),\n        t * 4.);\n}\n\nvec3 color(vec2 z)\n{\n    // Initialize variables\n    vec2 lastZ, tempZ;\n    int count = 0;\n    \n    // Apply the iteration\n    while (count < MAXITER) {\n        tempZ = z;\n        z -= newton_iteration(z);\n        lastZ = tempZ;\n        \n        // Test for convergence\n        if (length(z - lastZ) <= EPSILON) {\n            break;\n        } \n        count ++;\n    }\n    \n    // Calculate argument\n    float t = atan(z.y, z.x);\n    \n    // Calculate brightness\n    float brt = 1. - (float(count) / float(MAXITER));\n    \n    // This is the color map\n    vec3 col = 0.5 + 0.5 * cos(TAU*(t + vec3(.0, .33, .67)));\n    return col * brt;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 c)\n{\n    // Rescale the coords and output\n    vec2 z = SCALE * (2. * c - iResolution.xy) / iResolution.y;\n    fragColor = vec4(color(z),1.0);\n}","name":"Image","description":"","type":"image"}]}