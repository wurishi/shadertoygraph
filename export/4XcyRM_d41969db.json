{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":1,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":2,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":3,"type":"buffer","id":"XdfGR8","filepath":"/media/previz/buffer03.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"// Fork of \"Slime 3D\" by wyatt. https://shadertoy.com/view/MXtyz8\n// 2024-12-22 00:16:36\n\n// Fork of \"Metal 3D\" by wyatt. https://shadertoy.com/view/4XtcRr\n// 2024-12-20 23:43:06\n\n// Fork of \"Metal 3D test\" by wyatt. https://shadertoy.com/view/X3dczn\n// 2024-12-20 00:33:41\n\nvoid mainImage(out vec4 Q, in vec2 U) {\n    R = iResolution.xy;\n    if (iFrame%4>0) discard;\n    vec3 p = vec3(.5*R3.xy,-3.*R3.x);\n    vec3 d = normalize(vec3(2.*(U-.5*R)/R.y,9));\n    p -= .5*R3;\n    p.yz *= ei(-.08);\n    d.yz *= ei(-.08);\n    if (iMouse.z>0.) {\n    p.yz *= ei(-iMouse.y/R.x);\n    d.yz *= ei(-iMouse.y/R.x);\n    p.xz *= ei(iMouse.x/R.x*6.2);\n    d.xz *= ei(iMouse.x/R.x*6.2);\n    } else {\n    p.xz *= ei(-.5+.2*sin(.2*iTime));\n    d.xz *= ei(-.5+.2*sin(.2*iTime));\n    }\n    p += .5*R3;\n    p += d*1.001*cube(p,d,vec3(0),R3);\n    \n    vec3 no = vec3(0);\n    vec3 nd = vec3(0);\n    Q = vec4(0,0,0,0);\n    float e = 1.;\n    for (float i = 0.; i < 250.; i++) {\n    \n        if (length(p-clamp(p,vec3(0),R3))>0.) break;\n        float k = 1e9;\n        vec3 col = vec3(0);\n        for (float x = -0.; x <= 0.; x++)\n        for (float y = -0.; y <= 0.; y++)\n        for (float z = -0.; z <= 0.; z++)\n        {\n            vec3 w = floor(p)+vec3(x,y,z);\n            if (length(w-clamp(w,vec3(0),R3))>1e-3) continue;\n            vec4 c = C(w);\n            for (int o = 0; o < 4; o++) {\n                if (c[o] < 0.)break;\n                vec4 a = B(d3(c[o]));\n                vec2 s = sphere(p-a.xyz,d,.15);\n                float j = absmin(s.x,s.y);\n                if (j > 0. && j < k) {\n                    k = j;\n                    vec3 no = normalize(p+d*j-a.xyz);\n                    col = .3*e*(.5-.5*no.z)*abs(sin(3.*d3(c[o]).x/R3.x+vec3(1,2,3)));\n                    \n                    nd = reflect(d,no);\n                }\n             }\n        }\n        if (k > 10.) {\n            float c = cube(fract(p),d,vec3(0),vec3(1));\n            c = clamp(c,.01,4.);\n            p += d*1.01*c;\n        } else {\n            Q.xyz += col;\n            p += 1.001*d*k;\n            //d = nd; \n            e *= .8;\n            if (e < .5) break;\n            \n        }\n    }\n    //Q = texture(iChannel0,(U)/R);\n    //Q = .5+.5*A(vec3(U/R*R3.xy,.5*R3.z));\n   \n}","name":"Image","description":"","type":"image"},{"outputs":[],"inputs":[],"code":"// 3D utilities \n#define N 10.\nvec2 R;\nvec3 vel (vec3 v) {return v*inversesqrt(1.+dot(v,v));}\n//  [ [0,R/N]; [0,N*N]  ] < -- > [0,R]\n#define Main void mainImage (out vec4 Q, in vec2 _U) {R = iResolution.xy;vec3 U = d3(floor(_U));\n#define A(U) s3d(iChannel0,U)\n#define B(U) s3d(iChannel1,U)\n#define C(U) s3d(iChannel2,U)\n#define D(U) s3d(iChannel3,U)\n#define R3 vec3(floor(R/N),N*N)\nvec4 hash(vec4 p4) {\n    p4 = fract(p4  * vec4(.1031, .1030, .0973, .1099));\n    p4 += dot(p4, p4.wzxy+33.33);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n#define ei(a) mat2(cos(a),sin(a),-sin(a),cos(a))\nbool building (vec3 U) {\n    vec3 u = 1./vec3(.35,.35,.35)*abs(U-vec3(.5,.5,.5)*R3);\n    return (max(u.x,max(u.y,u.z))<R3.z);\n}\nbool cell (vec3 u) {\n    return u.x>=0.&&u.y>=0.&&u.z>=0.&&u.x<1.&&u.y<1.&&u.z<1.;\n}\nfloat d1 (vec3 U) {\n    U = floor(U);\n    return U.x+U.y*R3.x+U.z*R3.x*R3.y;\n}\nvec3 d3 (float i) {\n    return vec3(mod(i,R3.x) , mod(floor(i/R3.x),R3.y), floor(i/R3.x/R3.y));\n}\nvec2 d2 (vec3 U) {\n    U = clamp(U,vec3(0),R3);\n    float i = d1(U);\n    return vec2(mod(i,R.x),floor(i/R.x));\n}\nvec3 d3 (vec2 u) {\n    u = floor(u);\n    float i = u.x+u.y*R.x;\n\treturn d3(i);\n}\n\nvec4 s3d (sampler2D T,vec3 U) {\n    return texelFetch(T,ivec2(d2(floor(U))),0);\n}\nfloat absmin(float a, float b) {\n    if (a<0.||(b>0.&&b<a)) return b;\n    else return a;\n}\nvec2 sphere (vec3 oc, vec3 direction, float sphereRadius) {\n    float a = dot(direction, direction);\n    float b = 2.0 * dot(oc, direction);\n    float c = dot(oc, oc) - sphereRadius * sphereRadius;\n    float discriminant = b * b - 4.0 * a * c;\n    if (discriminant <= 0.0) return vec2(-1); \n    float t1 = (-b - sqrt(discriminant)) / (2.0 * a);\n    float t2 = (-b + sqrt(discriminant)) / (2.0 * a);\n    return vec2(t1, t2); \n}\n\nfloat cube(vec3 p, vec3 d, vec3 lo, vec3 hi) {\n    vec3 tLo = (lo - p) / d;\n    vec3 tHi = (hi - p) / d;\n    vec3 tMin = min(tLo, tHi);\n    vec3 tMax = max(tLo, tHi);\n    float tEntry = max(tMin.x, max(tMin.y, tMin.z));\n    float tExit = min(tMax.x, min(tMax.y, tMax.z));\n    if (tEntry > tExit || tExit < 0.0) return -1.0; \n    return tEntry > 0.0 ? tEntry : tExit;\n}\nvec4 LN (sampler2D tx, vec3 u) {\n                    vec3 f = floor(u);\n                    vec3 c = ceil(u);\n                    #define G(_) texelFetch(tx,ivec2(d2(_)),0)\n                    vec4 _000 = G(vec3(f));\n                    vec4 _001 = G(vec3(f.xy,c.z));\n                    vec4 _010 = G(vec3(f.x,c.y,f.z));\n                    vec4 _011 = G(vec3(f.x,c.yz));\n                    vec4 _100 = G(vec3(c.x,f.yz));\n                    vec4 _101 = G(vec3(c.x,f.y,c.z));\n                    vec4 _110 = G(vec3(c.xy,f.z));\n                    vec4 _111 = G(vec3(c));\n                    vec4 _00 = mix(_000,_001,fract(u.z));\n                    vec4 _01 = mix(_010,_011,fract(u.z));\n                    vec4 _10 = mix(_100,_101,fract(u.z));\n                    vec4 _11 = mix(_110,_111,fract(u.z));\n                    vec4 _0 = mix(_00,_01,fract(u.y));\n                    vec4 _1 = mix(_10,_11,fract(u.y));\n                    return mix(_0,_1,fract(u.x));\n                }","name":"Common","description":"","type":"common"},{"outputs":[{"channel":0,"id":"4dXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":1,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":2,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":3,"type":"buffer","id":"XdfGR8","filepath":"/media/previz/buffer03.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"vec4 T(vec3 U) {\n    return D(U);\n}\nMain \n    Q = T(U);\n    vec4 px = T(U+vec3(1,0,0));\n    vec4 nx = T(U-vec3(1,0,0));\n    vec4 py = T(U+vec3(0,1,0));\n    vec4 ny = T(U-vec3(0,1,0));\n    vec4 pz = T(U+vec3(0,0,1));\n    vec4 nz = T(U-vec3(0,0,1));\n    \n    //Q.w = 1./6.*(px+nx+py+ny+pz+nz).w;\n    Q.w -= 1./2.*(px.x-nx.x+py.y-ny.y+pz.z-nz.z);\n    //Q.xyz -= 1./6.*vec3(px.w-nx.w,py.w-ny.w,pz.w-nz.w);\n   \n    if (iFrame < 1) {\n        Q = vec4(0);\n    }\n}","name":"Buffer A","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"XsXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":1,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":2,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":3,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"// velocity buffer\nMain \n\n    if (!building(U)) discard;\n    Q = B(U);\n    \n    Q.xyz += .25*A(Q.xyz).xyz;\n    Q.xyz += .25*A(Q.xyz).xyz;\n    \n    if (iFrame < 1) {\n    \n        Q = vec4(floor(U)+.5,1);\n        \n    }\n}","name":"Buffer B","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"4sXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":1,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":2,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"// tracking buffer\nMain \n    Q = vec4(-1);\n    int i = 0;\n    for (int x=-1;x<=1;x++)\n    for (int y=-1;y<=1;y++) \n    for (int z=-1;z<=1;z++) {\n       vec4 c = C(U+vec3(x,y,z));\n       for (int k = 0; k < 4; k++) if (c[k]>0.) {\n           vec3 u = d3(c[k]);\n           vec4 a = B(u);\n           if (cell(a.xyz-U))\n               Q[i++] = c[k];\n           if (i>3) break;\n       }\n       if (i>3) break;\n    }\n    \n    \n    \n        \n    if (iFrame < 1) {\n        Q = vec4(-1);\n        if (building(U)) {\n            Q.x = d1(U);\n        }\n    }\n    \n    \n}","name":"Buffer C","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"XdfGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":1,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":2,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":3,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"vec4 T(vec3 U) {\n    if (iFrame%2==0) {\n        U -= .5*D(U).xyz;\n        U -= .5*D(U).xyz;\n        U -= .5*D(U).xyz;\n        U -= .5*D(U).xyz;\n    }\n    return LN(iChannel0,U);\n}\nMain \n    Q = T(U);\n    vec4 px = T(U+vec3(1,0,0));\n    vec4 nx = T(U-vec3(1,0,0));\n    vec4 py = T(U+vec3(0,1,0));\n    vec4 ny = T(U-vec3(0,1,0));\n    vec4 pz = T(U+vec3(0,0,1));\n    vec4 nz = T(U-vec3(0,0,1));\n    \n    //Q.w = 1./6.*(px+nx+py+ny+pz+nz).w;\n    //Q.w -= 1./6.*(px.x-nx.x+py.y-ny.y+pz.z-nz.z);\n    Q.xyz -= 1./2.*vec3(px.w-nx.w,py.w-ny.w,pz.w-nz.w);\n    float g = 0.;\n    vec4 c = C(U);\n    for (int k = 0; k < 4; k++) if (c[k]>0.) g++;\n    Q.y -= .1*(g-.1)/R3.y;\n    Q.w += .01*max(g-2.,0.);\n    if (length(U-vec3(.5,0,.5)*R3) < .1*R3.y) Q.y = .5;\n    \n    if (U.x<1.||R3.x-U.x<2.) Q *= 0.;\n    if (U.y<1.||R3.y-U.y<2.) Q.y *= 0.;\n    if (U.z<1.||R3.z-U.z<2.) Q.xyz *= 0.;\n    if (iFrame < 1) {\n        Q = vec4(0);\n    }\n}","name":"Buffer D","description":"","type":"buffer"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":true,"mFlagMusicStream":false},"info":{"id":"4XcyRM","date":"1734827507","viewed":220,"name":"3D Particle fluid","username":"wyatt","description":"..","likes":20,"published":3,"flags":32,"usePreview":0,"tags":["3d","fluid","physics","vorticity"],"hasliked":0,"parentid":"","parentname":""}}