{"ver":"0.1","info":{"id":"ll3Gz7","date":"1487992856","viewed":188,"name":"ellipse circle intersection area","username":"wdobbie","description":"Numerical approximation to area of intersection of ellipse and circle","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["intersection","circle","ellipse"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define NSTEPS 16\n#define pi 3.1415926535\n\nfloat computeCoverage(vec2 eo, vec2 es)\n{\n    bool swapped = false;\n    if (es.x * es.y > 1.0 || true) {\n        es = 1.0 / es;\n        eo *= -es;\n        swapped = true;\n    }\n    \n    float area = 0.0;\n    float theta = 0.0;\n    float thetaStep = 2.0*pi/float(NSTEPS);\n\tvec2 prev = vec2(es.x * cos(0.0) + eo.x,\n                     es.y * sin(0.0) + eo.y);\n    float r = length(prev);\n    if (r > 1.0) {\n        prev /= r;\n    }\n    \n    for (int i=0; i<NSTEPS; i++) {\n        theta += thetaStep;\n        float x = es.x * cos(theta) + eo.x;\n        float y = es.y * sin(theta) + eo.y;\n\n        float r = length(vec2(x, y));\n        if (r > 1.0) {\n            x /= r;\n            y /= r;\n        }\n\n        area += prev.x * y;\n        area -= prev.y * x;\n        \n        prev = vec2(x, y);\n    }\n    \n    area *= 0.5;\n\t\n    if (swapped) {\n        return area / (pi * es.x * es.y);\n    }\n    \n    return area / pi;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    \n    vec2 eo = fragCoord - iResolution.xy / 2.0;\n    eo *= 5.0;\n    float osc1 = sin(iTime * 2.0) + 2.0;\n    float osc2 = sin(iTime * 3.0) + 2.0;\n    vec2 es = vec2(200.0, 400.0);\n    \n    vec2 off = iMouse.xy - iResolution.xy * 0.5;\n    off = vec2((sin(iTime) * 0.5 + 0.5) * 200.0);\n    float circleRadius = off.x * 3.0 + 1.0;\n    eo /= circleRadius;\n    es /= circleRadius;\n    \n    float coverage = 1.0 - computeCoverage(eo, es);\n    \n    fragColor = vec4(coverage, coverage, coverage, 1.0);\n}\n    \n\n","name":"Image","description":"","type":"image"}]}