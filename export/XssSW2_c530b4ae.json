{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"\n#define TEMPO 110.0\n\nfloat timeFromBeat(float beat)\n{\n    float bps = TEMPO/60.0;\n    return beat/bps;\n}\n\nfloat beatFromTime(float time) \n{\n    // Convert a timeline to beat number including tempo changes for the piece\n    float bps = TEMPO/60.0;\n    return time*bps;\n}\n\n#define N(B,D) td = mix(td,vec2(timeFromBeat(B),D*bd),step(B,b));\n#define T(BEAT) N(BEAT,0.3333)\n#define Q(BEAT) N(BEAT,0.5)\n#define A(BEAT) N(BEAT,4.333)\n#define B(BEAT) N(BEAT,4.0)\n#define M(BEAT) N(BEAT,2.0)\n#define O(BEAT) N(BEAT,2.5)\n#define C(BEAT) N(BEAT,1.0)\n#define D(BEAT) N(BEAT,1.333)\n#define E(BEAT) N(BEAT,1.5)\n\nfloat mainSound( in int samp,float time, int key)\n{\n    vec2 res = vec2(0.0,0.0);\n    float f = 27.5; // A0\n    //float baseKey = 21.0; // To get to midi note numbers\n    float semi = 1.0594630943592953; // One semitone\n    time = mod(time,50.0);\n    float pan = 0.005;\n    float k = 0.;\n    //float kt = time;\n    float b = beatFromTime(time);\n    float bi = floor(b);\n    float bd = timeFromBeat(bi+1.0)-timeFromBeat(bi);\n    float nt = time;\n    vec2 td;\n\t    td = vec2(1000000.0,0.0);\n        pan -= 0.001;\n        #if 0\n        if (key==69) td=vec2(timeFromBeat(floor(b)),bd);\n        #endif\n#if 1\n        /*E1 */if (key==40) { Q(20.)Q(24.)Q(28.)Q(32.) }\n        /*F#1*/if (key==42) { Q(36.)}\n        /*G#1*/if (key==44) { Q(40.) }\n        /*A2 */if (key==45) { Q(44.)}\n        /*A#2*/if (key==46) { Q(48.)}\n        /*B2 */if (key==47) { T(16.)Q(20.5)Q(23.5)Q(28.5)Q(31.5) }\n        /*C#2*/if (key==49) { M(14.)Q(24.5)Q(27.5)Q(32.5)Q(35.5)Q(36.5)Q(39.5)Q(40.5)Q(43.5)Q(50.) }\n        /*D#2*/if (key==51) { M(12.) }\n        /*E2 */if (key==52) { M(10.)Q(21.)Q(23.)Q(25.)Q(27.)Q(29.)Q(31.)Q(33.)Q(35.)Q(37.)Q(39.)Q(41.)Q(43.)Q(44.5)Q(47.5)Q(48.5)Q(52.) }\n        /*F#2*/if (key==54) { M(8.0)T(16.333)Q(37.5)Q(38.5)Q(45.)Q(47.)Q(50.5)Q(54.) }\n        /*G#2*/if (key==56) { T(7.666)Q(21.5)Q(22.5)Q(25.5)Q(26.5)Q(29.5)Q(30.5)Q(33.5)Q(34.5)Q(41.5)Q(42.5)Q(49.) }\n        /*A3 */if (key==57) { T(4.0)T(8.333)T(10.333)T(12.333)T(14.333)T(16.666)T(36.333)Q(38.)Q(45.5)Q(46.5) }\n        /*A#3*/if (key==58) { Q(51.)Q(52.5)Q(56.)Q(60.) }\n        /*B3 */if (key==59) { T(3.666)T(7.333)Q(22.)Q(28.)Q(30.)T(36.)T(36.666)Q(42.0) }\n        /*C#3*/if (key==61) { T(0.0)T(4.333)D(8.666)D(10.666)D(12.666)T(17.)Q(26.)C(27.)Q(34.)C(35.)E(37.)C(40.)T(44.333)Q(46.)Q(49.5)Q(53.)Q(54.5)Q(58.)Q(62.)\n            \t\t\t\t  T(64.)\n            }\n        /*D#3*/if (key==63) { T(3.333)T(17.333)M(25.)M(33.)Q(39.)T(44.)T(44.666) }\n        /*E3 */if (key==64) { T(.333)T(7.)D(14.666)T(24.333)T(32.333)Q(38.5)Q(39.5)C(43.)E(45.)C(48.)Q(51.5)Q(55.)Q(56.5)Q(60.5)\n            \t\t\t\t  T(64.333)}\n        /*F#3*/if (key==66) { T(4.666)T(9.333)T(11.333)T(13.333)T(17.666)T(23.666)T(31.666)Q(47.)Q(58.5)Q(62.5) }\n        /*G#3*/if (key==68) { T(3.)T(6.666)T(23.)T(24.)T(24.666)T(31.)T(32.)T(32.666)M(41.)Q(46.5)Q(47.5)C(52.)Q(53.5)Q(57.)Q(61.)\n                              T(67.)}\n        /*A3 */if (key==69) { T(.666)T(5.)D(9.666)D(11.666)D(13.666)T(15.333)T(18.)T(19.666)\n            \t\t\t\t  T(64.666)}\n        /*A#3*/if (key==70) { T(51.)T(51.666)Q(55.5)Q(59.)Q(63.) }\n        /*B3 */if (key==71) { T(2.666)T(6.333)T(19.333)T(22.333)T(23.333)T(30.333)T(31.333)T(66.666) }\n        /*C#4*/if (key==73) { T(1.0)T(5.333)C(9.)M(11.)C(13.)T(15.666)T(18.333)T(19.)T(21.666)T(22.666)T(29.666)T(30.666)M(49.)T(51.333)T(55.)T(55.666)Q(57.5)Q(61.5)Q(78.5)\n            \t\t\t\t  T(65.)\t}\n        /*D#4*/if (key==75) { T(2.333)T(5.666)T(18.666)T(66.333)M(72.)O(76.) }\n        /*E4 */if (key==76) { T(1.333)T(6.)T(21.)T(22.)T(29.)T(30.)M(53.)T(55.333)Q(59.5)Q(63.5)\n            \t\t\t\t  T(65.333)M(70.)C(74.)Q(79.) }\n        /*F#4*/if (key==78) { T(1.666)C(10.)C(14.)T(19.666)T(21.333)T(29.333)Q(57.5)Q(59.5)Q(61.5)C(62.5)\n            \t\t\t\t  T(65.666)M(68.) }\n        /*G#4*/if (key==80) { T(2.)T(19.333)D(56.)D(58.)D(60.)Q(62.)Q(63.5)M(66.)Q(75.)Q(79.5) }\n        /*A4 */if (key==81) { A(15.)M(64.) }\n        /*B3 */if (key==83) { Q(75.5)}\n#endif        \n    return td.x;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float time = mod(iTime-1.7,50.0);\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    int key = int(uv.x*(84.0-40.0)+40.0);\n    int samp;\n    float t = clamp(abs(time-mainSound( samp,time,key)),0.0,1.0);\n    float k = step(0.4,uv.y)*step(uv.y,0.6);\n\tfragColor = vec4(vec3(t*k),1.0);\n}","name":"Image","description":"","type":"image"},{"outputs":[],"inputs":[],"code":"float pianoString(float time,float f1)\n{\n    float T = 1000000000.0;\n    float E = 2e11;\n    float r = 0.022;\n    float pi = 3.1415927;\n    float L = 1.0;\n    float A = (pi*pi*pi*r*r*r*r*E)/(8.0*T*L*L);\n    int i = 0;\n    float n = 1.0;\n    float s = 0.0;\n    float pa = 0.05;\n    for(int i=0;i<200;i++) {\n\t    float fb = n*f1*(1.0+(n*n-1.0)*A);\n        float shape = 0.75+0.25*sin(6.282*n/9.-1.5);\n        n += 1.0;\n        s += shape * pa * sin(6.2831*fb*time)*exp(-time*.3*n);\n        pa *= (0.8 - 0.1*sin(n*67.512)) - min(f1/3000.0,0.5);\n    }\n    return s;\n}\n\nvec2 pianoKey(vec2 td, float amp, float f1, float pan) \n{\n    float left = 0.0;\n    float lt = td.x-pan;\n    float right = 0.0;\n    float rt = td.x;\n    float cent = 1.000577789;\n    amp = 0.05*smoothstep(td.y+10.0,td.y+.1,td.x)+0.95*smoothstep(td.y+0.1,td.y,td.x)*smoothstep(.0,.001,td.x);\n    left = amp * (pianoString(lt,f1/(cent*cent)) + pianoString(lt,f1) + pianoString(lt,f1*cent*cent));\n    right = amp * (pianoString(rt,f1/(cent*cent)) + pianoString(rt,f1) + pianoString(rt,f1*cent*cent));\n    return vec2( left,right );\n}\n\n#define TEMPO 110.0\n\nfloat timeFromBeat(float beat)\n{\n    float bps = TEMPO/60.0;\n    return beat/bps;\n}\n\nfloat beatFromTime(float time) \n{\n    // Convert a timeline to beat number including tempo changes for the piece\n    float bps = TEMPO/60.0;\n    return time*bps;\n}\n\n#define N(B,D) td = mix(td,vec2(timeFromBeat(B),D*bd),step(B,b));\n#define T(BEAT) N(BEAT,0.3333)\n#define Q(BEAT) N(BEAT,0.5)\n#define A(BEAT) N(BEAT,4.333)\n#define B(BEAT) N(BEAT,4.0)\n#define M(BEAT) N(BEAT,2.0)\n#define O(BEAT) N(BEAT,2.5)\n#define C(BEAT) N(BEAT,1.0)\n#define D(BEAT) N(BEAT,1.333)\n#define E(BEAT) N(BEAT,1.5)\n\nvec2 mainSound( in int samp,float time)\n{\n    vec2 res = vec2(0.0,0.0);\n    float f = 27.5; // A0\n    //float baseKey = 21.0; // To get to midi note numbers\n    float semi = 1.0594630943592953; // One semitone\n    time = mod(time,50.0);\n    float pan = 0.005;\n    float k = 0.;\n    //float kt = time;\n    float b = beatFromTime(time);\n    float bi = floor(b);\n    float bd = timeFromBeat(bi+1.0)-timeFromBeat(bi);\n    float nt = time;\n    vec2 td;\n    for (int key =21;key<108;key++) {\n\t    td = vec2(-1000000.0,0.0);\n        pan -= 0.001;\n        #if 0\n        if (key==69) td=vec2(timeFromBeat(floor(b)),bd);\n        #endif\n#if 1\n        /*E1 */if (key==40) { Q(20.)Q(24.)Q(28.)Q(32.) }\n        /*F#1*/if (key==42) { Q(36.)}\n        /*G#1*/if (key==44) { Q(40.) }\n        /*A2 */if (key==45) { Q(44.)}\n        /*A#2*/if (key==46) { Q(48.)}\n        /*B2 */if (key==47) { T(16.)Q(20.5)Q(23.5)Q(28.5)Q(31.5) }\n        /*C#2*/if (key==49) { M(14.)Q(24.5)Q(27.5)Q(32.5)Q(35.5)Q(36.5)Q(39.5)Q(40.5)Q(43.5)Q(50.) }\n        /*D#2*/if (key==51) { M(12.) }\n        /*E2 */if (key==52) { M(10.)Q(21.)Q(23.)Q(25.)Q(27.)Q(29.)Q(31.)Q(33.)Q(35.)Q(37.)Q(39.)Q(41.)Q(43.)Q(44.5)Q(47.5)Q(48.5)Q(52.) }\n        /*F#2*/if (key==54) { M(8.0)T(16.333)Q(37.5)Q(38.5)Q(45.)Q(47.)Q(50.5)Q(54.) }\n        /*G#2*/if (key==56) { T(7.666)Q(21.5)Q(22.5)Q(25.5)Q(26.5)Q(29.5)Q(30.5)Q(33.5)Q(34.5)Q(41.5)Q(42.5)Q(49.) }\n        /*A3 */if (key==57) { T(4.0)T(8.333)T(10.333)T(12.333)T(14.333)T(16.666)T(36.333)Q(38.)Q(45.5)Q(46.5) }\n        /*A#3*/if (key==58) { Q(51.)Q(52.5)Q(56.)Q(60.) }\n        /*B3 */if (key==59) { T(3.666)T(7.333)Q(22.)Q(28.)Q(30.)T(36.)T(36.666)Q(42.0) }\n        /*C#3*/if (key==61) { T(0.0)T(4.333)D(8.666)D(10.666)D(12.666)T(17.)Q(26.)C(27.)Q(34.)C(35.)E(37.)C(40.)T(44.333)Q(46.)Q(49.5)Q(53.)Q(54.5)Q(58.)Q(62.)\n            \t\t\t\t  T(64.)\n            }\n        /*D#3*/if (key==63) { T(3.333)T(17.333)M(25.)M(33.)Q(39.)T(44.)T(44.666) }\n        /*E3 */if (key==64) { T(.333)T(7.)D(14.666)T(24.333)T(32.333)Q(38.5)Q(39.5)C(43.)E(45.)C(48.)Q(51.5)Q(55.)Q(56.5)Q(60.5)\n            \t\t\t\t  T(64.333)}\n        /*F#3*/if (key==66) { T(4.666)T(9.333)T(11.333)T(13.333)T(17.666)T(23.666)T(31.666)Q(47.)Q(58.5)Q(62.5) }\n        /*G#3*/if (key==68) { T(3.)T(6.666)T(23.)T(24.)T(24.666)T(31.)T(32.)T(32.666)M(41.)Q(46.5)Q(47.5)C(52.)Q(53.5)Q(57.)Q(61.)\n                              T(67.)}\n        /*A3 */if (key==69) { T(.666)T(5.)D(9.666)D(11.666)D(13.666)T(15.333)T(18.)T(19.666)\n            \t\t\t\t  T(64.666)}\n        /*A#3*/if (key==70) { T(51.)T(51.666)Q(55.5)Q(59.)Q(63.) }\n        /*B3 */if (key==71) { T(2.666)T(6.333)T(19.333)T(22.333)T(23.333)T(30.333)T(31.333)T(66.666) }\n        /*C#4*/if (key==73) { T(1.0)T(5.333)C(9.)M(11.)C(13.)T(15.666)T(18.333)T(19.)T(21.666)T(22.666)T(29.666)T(30.666)M(49.)T(51.333)T(55.)T(55.666)Q(57.5)Q(61.5)Q(78.5)\n            \t\t\t\t  T(65.)\t}\n        /*D#4*/if (key==75) { T(2.333)T(5.666)T(18.666)T(66.333)M(72.)O(76.) }\n        /*E4 */if (key==76) { T(1.333)T(6.)T(21.)T(22.)T(29.)T(30.)M(53.)T(55.333)Q(59.5)Q(63.5)\n            \t\t\t\t  T(65.333)M(70.)C(74.)Q(79.) }\n        /*F#4*/if (key==78) { T(1.666)C(10.)C(14.)T(19.666)T(21.333)T(29.333)Q(57.5)Q(59.5)Q(61.5)C(62.5)\n            \t\t\t\t  T(65.666)M(68.) }\n        /*G#4*/if (key==80) { T(2.)T(19.333)D(56.)D(58.)D(60.)Q(62.)Q(63.5)M(66.)Q(75.)Q(79.5) }\n        /*A4 */if (key==81) { A(15.)M(64.) }\n        /*B3 */if (key==83) { Q(75.5)}\n#endif        \n        if (td.x>=0.0)\n        \tres += pianoKey(vec2(time-td.x,td.y),0.5,f*pow(semi,k),pan);\n        k += 1.0; // Go to next key\n    }\n    return res;\n}","name":"Sound","description":"","type":"sound"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":true,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XssSW2","date":"1408601308","viewed":329,"name":"Piano Practice","username":"baldand","description":"Debussy's Arabesque No.1\n\nAn unfinished sketch","likes":8,"published":1,"flags":0,"usePreview":0,"tags":["procedural","music","piano"],"hasliked":0,"parentid":"","parentname":""}}