{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[],"code":"// Two structs are used. Ray structs represent light rays. In this example\n// a simple ray struct is used with only two fields. More fields are used in\n// more advanced ray tracers.\n\n// Ray represents a ray of light's origin and direction\nstruct Ray {\n\tvec3 origin; // Origin\n\tvec3 direction; // Direction\n};\n\n// Sphere represents of centre and radius of a sphere\nstruct Sphere {\n\tvec3 center;  // Center\n\tfloat radius; // Radius\n};\n\nvec4 diffuse(in vec3 surface, in vec3 center, in vec4 color, in vec3 litePos) {\n\t// Surface normal\n\tvec3 n = normalize(surface - center);\n\t\n\t// Light direction from surface\n\tvec3 l = normalize(litePos - surface);\n\n\t// The diffuse equation\n\treturn color * max(0.0, dot(n, l));\n}\n\n// https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\nfloat intersectSphere(in Ray ray, in Sphere sphere) {\n\t// Sphere center to ray origin\n\tvec3 co = ray.origin - sphere.center;\n\n\t// The discriminant is negative for a miss, or a postive value\n\t// used to calcluate the distance\n\tfloat discriminant = dot(co, ray.direction) * dot(co, ray.direction)\n\t\t\t- (dot(co, co) - sphere.radius * sphere.radius);\n\n\t// If answer is not negative, calculate the origin-surface distance\n\tif (discriminant >= 0.0)\n\t\treturn -dot(ray.direction, co) - sqrt(discriminant); //\n\telse\n\t\treturn -1.; // Any negative number to indicate no intersect\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\t/*\n\t fragCoord represents the centre of a pixel.\n\t For example, a resolution of 800Ã—600, the bottom-left pixel would\n\t be (0.5,0.5) and the top-right pixel would be (799.5, 599.5).\n\t */\n\n\t// Converting all coordinates (x,y) to be in the range [0,1]\n\tfloat x = fragCoord.x / iResolution.x; // iResolution.x is width in pixels\n\tfloat y = fragCoord.y / iResolution.y; // iResolution.y is height in pixels\n\n\t// Now convert from coordinate range [0,1] to [-1,1]\n\t// This moves pixel (0,0) to the middle of the screen\n    // This coordinate system is a common convention\n\tx = x * 2.0 - 1.0;\n\ty = y * 2.0 - 1.0;\n\n    // For raytracing, we need a ray - i.e. a direction and a point of origin\n    // The direction is the pixel position minus the eye postition,\n    // which is normalized.\n    // Normailizing makes rayDir a unit of distance (as well as direction)\n    \n\t// The pixel position in 3D space - i.e. the z value, 0.0, is the plane of the screen.\n\tvec3 pixelPos = vec3(x, y, 0);\n\n    // The eye position in this example is fixed.\n    vec3 eyePos = vec3(0, 0, -4); // Some distance in front of the screen\n    \n\t// The ray for the raytrace - which is just intersectSphere in this tutorial\n\tvec3 rayDir = normalize(pixelPos - eyePos);\n    \n    Sphere sphere = Sphere(vec3(0.0, 0.0, 7.0), 1.0); // Position and size of sphere\n\n\t// Does rayDirUnit ray from ndcEye intersect the sphere?\n\tfloat eyeToSphere = intersectSphere(Ray(eyePos, rayDir), sphere);\n\n\t// If positive, then we draw a pixel of the sphere\n\tif (eyeToSphere >= 0.)\n\t{\n\t\t// Choose a diffuse colour\n\t\tvec4 diffuseColour =  vec4(0.,1.,1.,1);\n\n\t\t// Choose an ambient colour\n\t\tvec4 ambientColour =  vec4(0.2,0.,0.,1);\n\n        // Position of a white light\n        vec3 litePos = vec3(3., 0., 0.);\n        \n\t\tfragColor = ambientColour + diffuse(eyePos + eyeToSphere * rayDir, sphere.center, diffuseColour, litePos);\n\n\t} else\n        // Otherwise we draw the colour of the background\n\t\tfragColor = vec4(0, 0, 0, 1);\n}\n\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"Xdj3zz","date":"1382821942","viewed":4888,"name":"Tutorial: Sphere Raytrace","username":"pix","description":"Contains links to wikipedia for extra understanding","likes":35,"published":1,"flags":0,"usePreview":0,"tags":["ray","tutorial","sphere","intersect"],"hasliked":0,"parentid":"","parentname":""}}