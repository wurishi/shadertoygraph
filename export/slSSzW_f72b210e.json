{"ver":"0.1","info":{"id":"slSSzW","date":"1627377737","viewed":60,"name":"Raytracing - Tom .R","username":"KrankerApfel","description":"\n   author : Tom \"KrankerApfel\" .R \n   date : july 2021\n   purpose : learning raytracing","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["raytracing"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sXGRn","filepath":"/media/a/95b90082f799f48677b4f206d856ad572f1d178c676269eac6347631d4447258.jpg","previewfilepath":"/media/ap/95b90082f799f48677b4f206d856ad572f1d178c676269eac6347631d4447258.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XdfGRn","filepath":"/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","previewfilepath":"/media/ap/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sfGRn","filepath":"/media/a/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg","previewfilepath":"/media/ap/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"/* \n   author : Tom \"KrankerApfel\" .R \n   date : july 2021\n   purpose : learning raytracing\n*/\n#define COUNT 2\n\nstruct Ray\n{\n    vec3 origin;\n    vec3 direction;\n};\n\nstruct Material {\n    vec3 color;\n    float diffuse;\n    float specular;\n};\n\nstruct Sphere\n{\n    vec3 center;\n    float radius;\n    Material mat;\n};\n\n\n\nstruct hit_record\n{\n    float t; // distance from ray origin\n    vec3 normal;\n    vec3 uv;\n    Material mat;\n    \n};\n\nvec3 sky(vec2 uv)\n{\n  \n  \n  return vec3(0,0.5f,.7f)*smoothstep(0.3,-0.2,uv.y) + 0.12;\n}\n\n\n\nbool hit_sphere(Ray r, Sphere s, inout hit_record hit)\n{\n  float a = dot(r.direction, r.direction);\n  float b = dot(r.origin - s.center, r.direction);\n  float c = dot(r.origin - s.center, r.origin - s.center) - s.radius* s.radius;\n  \n  float delta = b*b - a*c;\n  if(delta < 0.0)\n    return false;\n  \n  float t0 = (-b - sqrt(delta)) / a;\n  float t1 = (-b +  sqrt(delta)) / a;\n  float t = min(t0,t1);\n  if(t<0.) return false;\n    \n  hit.t = t;\n  hit.mat = s.mat;\n  hit.normal = (r.origin + t*r.direction) - s.center;\n    \n  return true;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n   vec2 uv = fragCoord.xy / iResolution.xy - vec2(0.5);\n   uv.x *= iResolution.x / iResolution.y;\n   \n   float t = 1./0.;\n   \n   float displace = texture(iChannel2, uv).r / .5;\n   \n   float should = smoothstep(0.05,-0.2,uv.y); \n   \n   float waveLength = uv.y *0.12;\n   \n   uv.x +=displace*(sin(iTime+(3./uv.y))*waveLength)*should;\n   \n\n   \n   Sphere spheres[] = Sphere[COUNT]\n    (\n        Sphere(vec3(0,0,-5.f), 1.f, Material(vec3(1.,0.98,0.80),0.5f, 0.5f) ),\n        Sphere(vec3(cos(iTime)*2.0,0,-5.+sin(iTime)), .5f, Material(vec3(.0,0.25,0.25),0.5f, 0.5f) )\n   \n    );\n\n   \n   Ray ray = Ray(vec3(0), normalize(vec3(uv.x, uv.y, -1.0)));\n   vec4 col = vec4(sky(uv),1.f)*texture(iChannel0, uv);\n\n   hit_record hit = hit_record(0., vec3(0), vec3(0), Material(vec3(0.),0.5f, 0.5f)); \n   \n   vec3 lightDir = vec3(1.,1.,0);\n   vec3 lightColor = vec3(1.0);\n\n   for(int i = 0; i < COUNT; i++)\n   {\n      if( hit_sphere(ray, spheres[i], hit) )\n      {\n           if(hit.t < t)\n       {\n           t = hit.t;\n           float fresnel = clamp(.5+.9*dot(.5-hit.normal, -ray.direction),.5,1.);\n\n         //  col =fresnel*vec4(hit.mat.color*lightColor*dot(lightDir, hit.normal),1.f);\n           col = fresnel*vec4(hit.mat.color,1.);\n           \n       }\n      }\n   }\n   \n    \n    \n\n   \n    // Output to screen\n    fragColor = col;\n}","name":"Image","description":"","type":"image"}]}