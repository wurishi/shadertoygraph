{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"#define PI 3.14159265359\nvec3 lp=vec3(10.0,10.0,10.0);\nvec4 lc=vec4(0.5);\nvec4 la=vec4(0.5);\nvec4 mc=vec4(0.0);\nfloat s;\nfloat t;\nvoid srand(vec2 p){\n\ts=sin(dot(p,vec2(423.62431,321.54323)));\n}\nfloat rand(){\n\ts=fract(s*32322.65432+0.12333);\n\treturn abs(fract(s));\n}\nmat3 rot_x(float a){\n\tfloat c=cos(a);\n\tfloat s=sin(a);\n\treturn mat3(1.0,0.0,0.0,0.0,c,-s,0.0,s,c);\n}\nmat3 rot_y(float a){\n\tfloat c=cos(a);\n\tfloat s=sin(a);\n\treturn mat3(c,0.0,s,0.0,1.0,0.0,-s,0.0,c);\n}\nmat3 rot_z(float a){\n\tfloat c=cos(a);\n\tfloat s=sin(a);\n\treturn mat3(c,-s,0.0,s,c,0.0,0.0,0.0,1.0);\n}\nmat3 rot(vec3 z,float a){\n\tfloat c=cos(a);\n\tfloat s=sin(a);\n\tfloat ic=1.0-c;\n\treturn mat3(\n\t\tic*z.x*z.x+c,ic*z.x*z.y-z.z*s,ic*z.z*z.x+z.y*s,\n\t\tic*z.x*z.y+z.z*s,ic*z.y*z.y+c,ic*z.y*z.z-z.x*s,\n\t\tic*z.z*z.x-z.y*s,ic*z.y*z.z+z.x*s,ic*z.z*z.z+c);\n}\nfloat plane(vec3 p,vec4 n){\n\tfloat d=dot(p,n.xyz)+n.w;\n\tif(d<0.0)mc=vec4(1.0);\n\treturn d;\n}\nfloat sphere(vec3 p,float r){\n\tvec4 c=vec4(1.0);\n\tvec3 tmp;\n\tvec2 rp=vec2(floor(p.x),floor(p.y));\n\tsrand(rp);\n\tc.r=rand()*0.2+0.2*sin(t/4.0+PI/4.0)+0.2;\n\tc.g=rand()*0.2+0.4*sin(t/3.0+PI/3.0)+0.2;\n\tc.b=rand()*0.2+0.2*sin(t/2.0)+0.3;\n\tfloat x=(fract(p.x)-0.5);\n\tfloat y=(fract(p.y)-0.5);\n\tfloat tmp2=rand();\n\tfloat z=rand()*5.0*(sin(t/2.0+tmp2*PI*2.0)+1.0);\n\ttmp=vec3(x,y,p.z-z);\n\tfloat d=length(tmp)-r;\n\tif(d<0.0)mc=c;\n\treturn min(d,0.1);\n}\nfloat dist(vec3 p){\n\tfloat d=100.0;\n\td=min(d,plane(p,vec4(0.0,0.0,1.0,0.5)));\n\td=min(d,sphere(p,0.5));\n\treturn d;\n}\nvec3 normal(vec3 p){\n\tfloat d=dist(p);\n\tvec3 n=vec3(0.01,0.0,0.0);\n\treturn normalize(vec3(dist(p+n.xyy)-d,dist(p+n.yxy)-d,dist(p+n.yyx)-d));\n}\nfloat trace_light(vec3 p,vec3 dv){\n\tfloat d;\n\tfloat a=1.0;\n\tfloat l=0.1;\n\tp+=dv*l;\n\tfor(int i=0;i<32;i++){\n\t\td=dist(p);\n\t\tif(d<0.01){\n\t\t\treturn 0.0;\n\t\t}\n\t\ta=min(a,2.0*d/l);\n\t\tl+=d;\n\t\tp+=dv*d;\n\t}\n\treturn a;\n}\nvec4 trace(vec3 p,vec3 dv){\n\tfloat d;\n\tfloat dt=0.0;\n\tvec3 lv;\n\tvec4 c;\n\tmc=vec4(1.0);\n\tfor(int i=0;i<256;i++){\n\t\td=dist(p);\n\t\tdt+=d;\n\t\tif(d<0.0)break;\n\t\td=max(d,0.01);\n\t\tp+=dv*d;\n\t}\n\tc=mc;\n\tvec3 n=normal(p);\n\tlv=normalize(lp-p);\n\tvec4 df=clamp(c*lc*dot(n,lv),0.0,1.0);\n\tvec4 ab=c*la;\t\n\tfloat sd=trace_light(p-0.01*dv,lv);\n\tfloat sp=max(pow(dot(lv,reflect(dv,n)),length(lp-p)),0.0);\n\treturn min(df,vec4(1.0)*sd)+ab+min(sd,sp);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n\tt=iTime;\n\tfloat r=iResolution.x/iResolution.y;\n\tfloat h=2.0;\n\tfloat fov=0.75;\n\tvec2 m=vec2((iMouse.x-iResolution.x/2.0)/iResolution.x*r,(iMouse.y-iResolution.y/2.0)/iResolution.y);\n\tvec2 sp=vec2((fragCoord.x-iResolution.x/2.0)/iResolution.x*r,(fragCoord.y-iResolution.y/2.0)/iResolution.y);\n\t\n\tvec3 la=vec3(5.0*sin(t/2.0+PI),5.0*cos(t/3.0+PI),sin(t/4.0)+2.0);\n\tvec3 ep=vec3(2.0*sin(t),2.0*cos(t),sin(t)*2.0+6.0);\n\t\n\tsrand(sp);\n\tvec3 rv;\n\tfloat dof=0.2;\n\trv.x=(rand()-0.5)*dof;\n\trv.y=(rand()-0.5)*dof;\n\trv.z=(rand()-0.5)*dof;\n\tep+=rv;\n\t\n\t\n\t/*\n\tvec3 la=vec3(0.0,0.0,h);\n\tvec3 ep=vec3(0.0,-3.0,0.0);\n\tep*=rot_x(PI*m.y/2.0+PI/8.0-PI/4.0);\n\tep*=rot_z(2.0*PI*m.x);\n\tep.z+=h;\n\t*/\n\t\n\tvec3 uv=vec3(0.0,0.0,1.0);\n\tvec3 dv=normalize(la-ep);\n\tvec3 hv=normalize(cross(dv,uv));\n\tvec3 vv=normalize(cross(hv,dv));\n\tdv*=rot(vv,fov*sp.x);\n\tdv*=rot(hv,fov*sp.y);\n\tfragColor=trace(ep,dv);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"MsB3Dc","date":"1394572647","viewed":387,"name":"Infinite Spheres","username":"Justaway","description":"Infinite spheres with depth of field.","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""}}