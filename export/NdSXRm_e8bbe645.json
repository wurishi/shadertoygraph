{"ver":"0.1","info":{"id":"NdSXRm","date":"1619843065","viewed":154,"name":"TextureMapping to Sphere","username":"kithy","description":"basic texture mapping to sphere","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","texturemapping"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define MAX_STEPS 100\n#define MAX_DIST 100.0\n#define EPS 0.001\n#define PI 3.141592\n#define TWO_PI 6.2832\n\nmat2 Rot(float a){\n\tfloat s=sin(a);\n\tfloat c=cos(a);\n\treturn mat2(c,-s,s,c);\n}\n\nfloat sdSphere(vec3 p){\n\treturn length(p)-1.5;\n}\n\nfloat getDist(vec3 p){\n\tfloat d=sdSphere(p);\n\treturn d;\n}\n\nvec3 Transform(vec3 p){\n\tp.yz*=Rot(2.0);\n\t//p.y+=sin(iTime);\n\treturn p;\n}\n\nfloat RayMarch(vec3 ro,vec3 rd){\n\tfloat dO=0.0;\n\n\tfor(int i=0;i<MAX_STEPS;i++){\n\t\tvec3 p=Transform(ro+rd*dO);\n\n\t\tfloat dS=getDist(p);\n\t\tdO+=dS;\n\t\tif(dO>MAX_DIST||abs(dS)<EPS)break;\n\t}\n\treturn dO;\n}\n\n\nvec3 GetRayDir(vec2 uv,vec3 p,vec3 l,float z){\n\tvec3 f=normalize(l-p);\n\tvec3 r=normalize(cross(vec3(0.0,1.0,0.0),f));\n\tvec3 u=cross(f,r);\n\tvec3 c=f*z;\n\tvec3 i=c+uv.x*r+uv.y*u;\n\tvec3 d=normalize(i);\n\treturn d;\n}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\tvec2 uv=(2.0*fragCoord.xy-iResolution.xy)/iResolution.y;\n\n\tvec3 col=vec3(0.0);\n\tvec3 ro=vec3(0.0,3.0,-2.0);\n\tvec3 rd=GetRayDir(uv,ro,vec3(0.0),1.0);\n\n\tfloat d=RayMarch(ro,rd);\n\n\tif(d<MAX_DIST){\n\t\tvec3 p=Transform(ro+rd*d);\n\t\n\t\tuv=vec2(atan(p.x,p.z)/PI,p.y/5.0)+0.5;\n\n\t\tvec3 tex=texture(iChannel0,uv).rgb;\n\n\t\tcol=tex;\n\n\t}\n\tfragColor=vec4(col,1.0);\n}\n","name":"Image","description":"","type":"image"}]}