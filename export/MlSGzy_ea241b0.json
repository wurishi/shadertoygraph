{"ver":"0.1","info":{"id":"MlSGzy","date":"1429979547","viewed":919,"name":"ForestFloor","username":"dila","description":"Forest backdrop and some rocky terrain.","likes":29,"published":1,"flags":0,"usePreview":0,"tags":["terrain","water","forest"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"},"published":1},{"id":"XsX3zn","filepath":"/media/a/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","previewfilepath":"/media/ap/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","type":"cubemap","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"const float pi = 3.14159;\n\nmat3 xrot(float t)\n{\n    return mat3(1.0,0.0,0.0,\n                0.0,cos(t),-sin(t),\n                0.0,sin(t),cos(t));\n}\n\nmat3 yrot(float t)\n{\n    return mat3(cos(t), 0.0, -sin(t),\n                0.0, 1.0, 0.0,\n                sin(t), 0.0, cos(t));\n}\n\nmat3 zrot(float t)\n{\n    return mat3(cos(t), -sin(t), 0.0,\n                sin(t), cos(t), 0.0,\n                0.0, 0.0, 1.0);\n}\n\nfloat height(vec3 p)\n{\n    vec2 sl = p.xz * 0.1;\n    \n\tfloat s = texture(iChannel0, sl).x;\n    \n    float n = s * 2.0 - 1.0;\n    \n    float h = 0.0;\n    h += sin(p.x*0.5) * 0.3;\n    h += sin((p.x+p.z)*0.5) * 0.6;\n    h += sin(p.x) * 0.3 * n;\n    \n    return h;\n}\n\nbool alpha = false;\nconst float wlevel = 1.0;\n\nfloat map(vec3 p)\n{\n\tfloat h = height(p);\n\tfloat r = 1.0 + p.y + h;\n    if (!alpha) {\n        return r;\n    }\n    float w = wlevel + height(p) * 0.02 + p.y;\n    return min(r,w);\n}\n\nfloat material(vec3 p)\n{\n\tfloat h = height(p);\n\tfloat r = 1.0 + p.y + h;\n    float w = wlevel + p.y;\n    if (w < r) {\n        return 1.0; /* water */\n    }\n    return 0.0; /* sand */\n}\n\nvec3 surfaceNormal(vec3 pos)\n{\n \tvec3 delta = vec3(0.01, 0.0, 0.0);\n    vec3 normal;\n    normal.x = map(pos + delta.xyz) - map(pos - delta.xyz);\n    normal.y = map(pos + delta.yxz) - map(pos - delta.yxz);\n    normal.z = map(pos + delta.zyx) - map(pos - delta.zyx);\n    return normalize(normal);\n}\n\nfloat trace(vec3 o, vec3 r)\n{\n\tfloat t = 0.0;\n    for (int i = 0; i < 32; ++i) {\n        vec3 p = o + r * t;\n        float d = map(p);\n        t += d * 0.5;\n    }\n    return t;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    \n    uv = uv * 2.0 - 1.0;\n    uv.x *= iResolution.x / iResolution.y;\n    vec3 r = normalize(vec3(uv, 1.4 - dot(uv,uv)*0.0));   \n    \n    r *= xrot(pi*0.15);\n    if (iMouse.z >= 1.0) {\n        r *= xrot(pi*0.5-iMouse.y*0.01) * yrot(-iMouse.x*0.01);\n    } else {\n        r *= yrot(iTime*0.25);\n    }\n    \n    vec3 o = vec3(0.0, 0.0, -1.0);\n    o.xz += iTime * 0.5;\n    \n    alpha = true;\n    float t = trace(o, r);\n    vec3 wworld = o + r * t;\n    float wfd = map(wworld);\n    vec3 wsn = surfaceNormal(wworld);\n    \n    alpha = false;\n    float at = trace(o, r);\n    vec3 world = o + r * at;\n    float fd = map(world);\n    vec3 sn = surfaceNormal(world);\n    \n    vec3 ldir = normalize(vec3(1.0, 0.5, 0.0));\n    float lp = max(dot(ldir,sn),0.0);\n    float ld = 100.0;\n    vec3 lpos = world + sn * 0.1 + ldir * ld;\n    float lt = trace(lpos, -ldir);\n    float lm = 1.0;\n    if (lt < ld) {\n        lm = 0.0;\n    }\n    \n    float mat = material(world);\n    vec3 water = vec3(0.0,0.0,0.0);\n    \n    float wheight = height(world);\n    \n    vec3 ssc = vec3(190.0, 151.0, 101.0) / 255.0;\n    float gdp = 1.0 - max(dot(r,-sn),0.0);\n    vec3 shg = mix(vec3(0.0,1.0,0.0), vec3(0.0,0.5,0.0), gdp);\n    float gmix = 1.0 / (1.0 + (1.0-abs(sn.y)) * 1.0);\n    gmix = clamp(gmix, 0.0, 1.0);\n    gmix = pow(gmix, 16.0);\n    vec3 scc = mix(shg, ssc, 1.0-gmix * 0.5);\n    vec3 rock = mix(scc*0.3, scc, lm*lp);\n    \n    if (mat == 1.0) {\n\t\tfloat ed = max(dot(r,-wsn),0.0);\n        vec3 wrfl = reflect(ldir, wsn);\n        float wdp = max(dot(r, wrfl),0.0);\n        vec3 srfl = reflect(r, wsn);\n        vec3 refl = texture(iChannel1, srfl).xyz;\n        water = mix(refl, rock, ed);\n        water += pow(wdp, 16.0);\n    }\n    \n    alpha = true;\n    float wdel = clamp(abs(wheight - wlevel), 0.0, 1.0);\n    wdel = pow(wdel, 32.0);\n    float wbl = 1.0 / (1.0 + wdel * 8.0);\n    vec3 fc = rock;\n    \n    if (mat == 1.0) {\n        fc = mix(fc, water, wbl);\n    }\n    \n    float s = 1.0 / (1.0 + t * t * 0.1);\n    vec3 skc = vec3(144.0, 187.0, 223.0) / 255.0;\n    skc = texture(iChannel1, r).xyz;\n    fc = mix(skc, fc, pow(max(s-0.1,0.0),0.01));\n    \n\tfragColor = vec4(fc,1.0);\n}","name":"","description":"","type":"image"}]}