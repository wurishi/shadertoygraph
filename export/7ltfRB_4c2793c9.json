{"ver":"0.1","info":{"id":"7ltfRB","date":"1663306051","viewed":467,"name":"Model Pastel","username":"Kali","description":"Coded while hanging out with friends on the GES Discord channel.","likes":46,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","reflections"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float det=.001;\nvec3 pos;\n\nmat2 rot(float a){\n    float s=sin(a),c=cos(a);\n    return mat2(c,s,-s,c);\n}\n\nfloat de(vec3 p) {\n    p*=1.2-length(sin(p+iTime))*.25;\n    p.xz*=rot(iTime+p.y*.5);\n    p.yz*=rot(iTime+p.x*.5);\n    pos=p;\n    float d=length(p)-3.;\n    d=max(d,-length(p)+2.5);\n    vec3 s=sin(p*3.);\n    d+=length(s*s)*.27;\n    d=min(d,length(p)-1.5);\n    return d*.4;\n}\n\nvec3 normal(vec3 p) {\n    vec2 e=vec2(0.,det*2.);\n    return normalize(vec3(de(p+e.yxx),de(p+e.xyx),de(p+e.xxy))-de(p));\n}\n\nvec3 shade(vec3 p, vec3 dir, vec3 n) {\n    vec3 ldir=normalize(vec3(1.,1.,-1.));\n    float amb=.15;\n    float dif=max(0.,dot(ldir,n))*.9;\n    vec3 col=abs(mix(sin(pos),cos(pos),pos.x*.5));\n    return (amb+dif)*col;\n    \n}\n\nvec3 march(vec3 from, vec3 dir) {\n    float td=0.,d=0.,ref=0.,maxdist=45.;\n    vec3 col=vec3(0.),colref=col,p=from;\n    for(int i=0; i<150; i++){\n        p+=d*dir;\n        d=de(p);\n        if (d<det&&ref>0.||td>maxdist) break;\n        if (d<det&&ref<1.&&(length(fract(pos)-.5)<.6||length(pos)>1.6)) {\n            ref=1.;\n            vec3 n=normal(p);\n            colref+=shade(p,dir,n);\n            dir=reflect(dir,n);\n            p+=dir*.1;\n        }\n        td+=d;\n    }\n    if (d>det) {\n        td=maxdist;\n        p=dir*maxdist;\n        col+=smoothstep(.15,.0,abs(fract(p.y*.1)-.5))*.5;\n        col+=smoothstep(.15,.0,abs(fract(p.x*.1)-.5))*.5;\n    } else {\n        vec3 n=normal(p);\n        col=shade(p,dir,n);\n    }\n    col=mix(col,colref,ref*.7);\n    col=mix(col,vec3(1.),td/maxdist*.3);\n    return col;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord-iResolution.xy*.5)/iResolution.y;\n    vec2 uv2 = fragCoord/iResolution.xy-.5;\n\n    vec3 from=vec3(0.,0.,-8.);\n    vec3 dir=normalize(vec3(uv,1.));\n    from.xz*=rot(iTime*.3-2.);\n    dir.xz*=rot(iTime*.3-2.);\n    \n    vec3 col = march(from,dir);\n    col*=smoothstep(.5,.1,abs(uv2.x));\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}