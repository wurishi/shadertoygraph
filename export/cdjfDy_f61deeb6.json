{"ver":"0.1","info":{"id":"cdjfDy","date":"1690096956","viewed":52,"name":"程安絮2D基础教学_线段_宽度_模糊","username":"Leslie","description":"加了模糊效果。\n为了防止模糊效果在线段平行于X或Y轴时造成的失真，特别为这两种情况去除了模糊效果。\n不过有一个问题还是无法解决，那就是模糊所造成的摩尔纹在线段宽度小于2像素时会特别明显；这个问题是无解的，很多图形库为了规避这个问题会选择干脆让线段宽度最小为2像素，小于2像素会自动设为2像素。","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["2d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float width=100.;\n    if(width==0.) return;\n    float halfWidth=width/2.;\n    vec3 red=vec3(1.,0.,0.);\n    vec3 green=vec3(0.,1.,0.);\n    vec3 blue=vec3(0.,0.,1.);\n    \n    vec2 ptStart=vec2(320.,180.);\n    vec2 ptEnd=vec2(325.,81.);\n    // 这次用线段的中心点而不是起点来当子坐标系原点，是为了方便线段两端的模糊操作\n    vec2 ptMid=(ptStart+ptEnd)/2.;\n    \n    float lenLineHalf=distance(ptStart,ptMid);\n    vec2 uvLine=(ptEnd-ptMid)/lenLineHalf;\n    vec2 uvRt=vec2(-uvLine.y,uvLine.x);\n    vec2 vFrag=fragCoord-ptMid;\n\n    float ptToLine=dot(vFrag,uvRt);\n    float ptToRt=dot(vFrag,uvLine);\n\n    vec3 clr;\n    // 模糊宽度为2*blur=1.5像素，\n    // 模糊宽度不能为整数，一定要有半个像素的零头，不然当线段宽度为单数时会出现失真\n    float blur=0.75;\n    \n    if(ptToLine>=-halfWidth && ptToLine<halfWidth && ptToRt>=-lenLineHalf && ptToRt<lenLineHalf){\n        clr=red;\n    }else{\n        clr=blue;\n    }\n    \n    if(uvLine.x!=0. && uvLine.y!=0.){\n        float hClr=smoothstep(lenLineHalf-blur,lenLineHalf+blur,abs(ptToRt));\n        float vClr=smoothstep(halfWidth-blur,halfWidth+blur,abs(ptToLine));\n        if(hClr!=0. && abs(ptToLine)<=halfWidth) clr=mix(red,blue,hClr);\n        if(vClr!=0. && abs(ptToRt)<=lenLineHalf) clr=mix(red,blue,vClr);\n    }\n    fragColor=vec4(clr,1.);\n}\n","name":"Image","description":"","type":"image"}]}