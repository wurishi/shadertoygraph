{"ver":"0.1","info":{"id":"tsjGRm","date":"1548513772","viewed":623,"name":"test texture load and res change","username":"FabriceNeyret2","description":"line 0 (bottom): show resolution change. red: increase. green: decrease\nline 1: show when texture load (red when just happen, then white). Try reload, change tex (bufA:ch1)...\nline 2: show mouse click","likes":2,"published":3,"flags":32,"usePreview":0,"tags":["mouse","texture","utils","event","trigger","iresolution"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 O, vec2 U )\n{\n    O = U.y < 120. \n        ? T(U)\n        : texelFetch(iChannel1, ivec2(U),0);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"// in order to detect their change, \n// stores the state of window resolution, texture load, and mouse click.\n// O.xy = new value, O.zw = prev value\n\nvoid mainImage( out vec4 O, vec2 U )\n{\n    U -= .5;\n    O = T(U); // restore previous state\n    vec2 R = iResolution.xy;\n    \n    if ( U == vec2(0,0) ) { O = vec4( R, O.xy ); return; }\n    if ( U == vec2(1,0) ) { O = vec4( iChannelResolution[1].xy, O.xy ); return; }\n    if ( U == vec2(2,0) ) { O = vec4( iMouse.zw, O.xy ); return; }\n\n    \n// if doing stuff here, then recent old value is in texture.xy ;-)   \n// for next Buffers + Image, it will be in .zw.\n\n    // --- example of use ------------------------------\n    \n    // --- redisplay texture if resolution change\n    vec4 V = T(vec2(0,0));\n    if ( R != V.xy && U.y > 0. ) O = texture(iChannel1,U/R);\n    \n    // --- (re)display texture once loaded\n    V = T(vec2(1,0));\n    // texture change might not be detecting when switching back to a same-size texture you already loaded\n    if ( V.xy != V.zw )  O = texture(iChannel1,U/R); // black when waiting\n   // texture change might not be detecting when switching back to a texture you already loaded\n //if ( V.x == 0. && iChannelResolution[1].x > 0.) O = texture(iChannel1,U/R); // perfect to get first load\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"#define S(U) texelFetch( iChannel1, ivec2(U), 0 )\n\nvoid mainImage( out vec4 O, vec2 U )\n{\n    O = T(U-vec2(4,0)); if (U.x>4.) return; // scroll display\n    \n    vec4 V; float c;\n    int y = int(U.y/30.);\n    \n    // --- example of use ------------------------------\n    \n    if ( y == 0 ) {        // line 0 (bottom): show resolution change\n        V = S(vec2(0,0));\n        c = V.x - V.z;\n        O = vec4( c, -c, .5,0 );\n    }\n    if ( y == 1 ) {        // line 1: show when texture loaded\n        V = S(vec2(1,0));\n        c = V.x - V.z;\n        O = vec4( V.x, V.z, 1, 0 );\n    }\n    if ( y == 2 ) {        // line 2: show mouse click\n        V = S(vec2(2,0));\n        O = vec4( V.x > 0., V.z > 0. , .5, 0);\n    }\n    if ( y == 3 ) O = vec4 ( iFrame%2 );\n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define T(U) texelFetch( iChannel0, ivec2(U), 0 )","name":"Common","description":"","type":"common"}]}