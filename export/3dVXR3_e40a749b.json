{"ver":"0.1","info":{"id":"3dVXR3","date":"1574609070","viewed":340,"name":"unknown","username":"gaz","description":"3d","likes":27,"published":1,"flags":0,"usePreview":0,"tags":["3d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI acos(-1.0)\n#define TAU PI*2.0\n#define rot(a) mat2(cos(a), sin(a), -sin(a), cos(a))\n#define hue(t) (cos((vec3(0,2,-2)/3.0+t)*TAU)*0.5+0.5)\n#define hsv(h,s,v) mix(vec3(1),hue(h),s)*v\n#define hash(n) fract(sin(n)*5555.0)\n\nvec3 rot3D(vec3 p,vec3 a,float t) \n{\n\ta=normalize(a);\n\tvec3 v=cross(a,p),u=cross(v,a);\n\treturn u*cos(t)+v*sin(t)+a*dot(p, a);   \n}\n\nvec2 billboardUv(vec3 ro,vec3 rd, vec3 a)\n{\n    a-=ro;\n    vec3 g= cross(a, rd);\n    vec3 up=normalize(cross(a,cross(a,vec3(0,1,0))));\n    return vec2(dot(g,up),dot(g,cross(normalize(a),up)));\n}\n\nvec3 randVec(float n)\n{\n\tvec3 v=vec3(1,0,0);\n    v.xy*=rot(asin(hash(n)*2.-1.));\n    v.xz*=rot(hash(n+215.3)*TAU);\n\treturn v;\n}\n\nvec3 randCurve(float t,float n)\n{\n    vec3 p = vec3(0);\n    for (int i=0; i<4; i++)\n    {\n        p += randVec(n+=365.)*sin((t*=1.3)+sin(t*0.6)*0.5);\n    }\n    return p*20.;\n}\n\nfloat map(vec3 p)\n{   \n    vec3 id=floor(p/6.0);\n    p=mod(p,6.0)-3.0;\n    if(hash(dot((id+236.0)*236.,id.xzy+123.0))>0.4)return 2.0;\n    float c=hash(dot((id+1236.0)*236.,id.xzy+123.0));\n    p=rot3D(p,randVec(dot(id*236.,id.xzy+123.0)),iTime*2.0+hash(dot((id+236.0)*236.,id.xzy+123.0))*3.0);\n    p = abs(p)-vec3(0.5);\n    if (p.x < p.z) p.xz = p.zx;\n    if (p.y < p.z) p.yz = p.zy;\n\tp.z = max(0.0,p.z);\n\treturn length(p);\n}\n\nvec3 tetraCoord(int i)\n{\n    i=i&3;\n    return vec3(9>>i&1, i>>1&1, i&1)*2.0-1.0;\n}\n\nfloat castLine(vec3 ro, vec3 rd, vec3 a, in vec3 b)\n{\n    vec3 ab =normalize(b-a),ao = a-ro;\n    float d0 = dot(rd, ab), d1 = dot(rd, ao), d2 = dot(ab, ao);\n    float len = (d0*d1-d2)/(1.0-d0*d0);\n    len= clamp(len,0.0,length(b-a));\n    vec3 p = a+ab*len;\n    return length(cross(p-ro, rd));\n}\n\nint S[26]=int[](7325,53709,35217,53705,36241,3217,39317,7196,49601,39176,11282,35088,6202,14392,39321,3229,47513,11421,37285,16577,39192,2578,14872,8738,16418,33667);\nfloat de16Seg(vec2 p,int n)\n{\n\tfloat e=2.;\n\tmat2 m=mat2(0,-1,1,0);\n    for(int i=0;i<16;i++){\n\t\tint j=i&3;\n\t\tif(j==0)m*=mat2(0,1,-1,0);\n\t\tif((n>>i&1)==1){\n\t\t\tvec2 a=m*vec2(26>>j&1,19>>j&1)*vec2(0.6,1);\n\t\t\tvec2 b=m*vec2(13>>j&1,9>>j&1)*vec2(0.6,1);\n            a.x+=0.2*a.y;\n            b.x+=0.2*b.y;\n            vec2 c=p-a,d=b-a;\n\t\t\te=min(e,length(c-d* clamp(dot(c,d)/dot(d,d), 0.1, 0.9)));\n\t\t}\n\t}\n\treturn e;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 p = (fragCoord*2.0-iResolution.xy)/iResolution.y;\n\tfloat t=-iTime*0.3;\n    float seed=123.0;\n    vec3 ro=randCurve(t+0.3,seed);\n\tvec3 ta=randCurve(t+0.1,seed);\n    vec3 w=normalize(ta-ro);\n    vec3 u=normalize(cross(w,vec3(0,1,0)));\n\tvec3 v=cross(w,u);\n    vec3 rd=normalize(u*p.x+v*p.y+w*2.);\n    vec3 col = vec3(0);\n    #define ZERO min(0.0,iTime)\n    #define SIZE 20.0\n    for(float i=ZERO; i<SIZE*2.0;i+=0.15)\n    {\n        vec3 p=ta+w*(i-SIZE);\n        vec2 uv=billboardUv(ro,rd,p);\n\t\tp+=u*uv.x+v*uv.y; \n        float de=map(p);\n        float z=length(p-ro);\n        col+=hsv(iTime*0.3,0.3,0.6)*exp(-z*z*0.0007)*exp2(-de*20.0);\n    }\n    #define tf(p) rot3D(p,randVec(456.123),iTime)\n    vec3 coord= randCurve(t,seed);\n    float fog=exp(-pow(length(coord-ro),2.0)*0.001);\n    for(int j=0;j<6;j++)\n    {\n        float de= castLine(ro,rd,coord+tf(tetraCoord(j&3)),coord+tf(tetraCoord((j&3)+(j>>2&1)+1)));\n        col+=mix(vec3(1,0.3,0.1),vec3(0),smoothstep(0.01,0.1,de))*fog;\n    }\n    vec2 uv=billboardUv(ro,rd,coord);\n    col+=mix(vec3(1),vec3(0),smoothstep(0.0,0.1,abs(length(uv)-2.5)));\n\n    float r=2.2;\n    vec2 q=vec2(atan(uv.x,uv.y)*r, length(uv)-r);\n    float s = TAU*r/12.0;\n    q.x=mod(q.x,s)-0.5*s;\n    q.x-=clamp(q.x,-0.4,0.4);\n    col+=mix(vec3(1)*step(0.0,sin(iTime*10.0)),vec3(0),smoothstep(0.0,0.1,length(q)));\n    \n    q=uv;\n    q=abs(q);\n    if(q.x<q.y) q=q.yx;\n    q.x-=clamp(q.x,2.0,3.0);\n    col+=mix(vec3(1),vec3(0),smoothstep(0.0,0.1,length(q)));\n\n    q=uv;\n    q-=vec2(1.8);\n    q-=clamp(q.y,0.0,1.0);\n    col+=mix(vec3(1),vec3(0),smoothstep(0.0,0.1,length(q)));\n\n    q=uv;\n    q-=vec2(2.8);\n    q.x-=clamp(q.x,0.0,5.0);\n    col+=mix(vec3(1),vec3(0),smoothstep(0.0,0.1,length(q)));\n\n\t#define A(a) idx=S[a];de=min(de,de16Seg(q,idx));q.x-=2.0;\n    int idx;\n    float de=10.0;\n    q=uv;\n    q*=3.0;\n    q-=vec2(10);\n    A(20)A(13)A(10)A(13)A(14)A(22)A(13)\n    col+=mix(vec3(1),vec3(0),smoothstep(0.0,0.2,de));\n\n    col=min(vec3(1),col);\n    fragColor=vec4(col,1);\n }","name":"Image","description":"","type":"image"}]}