{"ver":"0.1","info":{"id":"llBfWK","date":"1517264922","viewed":306,"name":"cube to equirectangular","username":"gomi","description":"mapping cube faces to equirectangular (latlong) map","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["projection"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI    3.1415926535\n#define PI_2  1.5707963268\n\nvec4 tex(vec2 uv, int face) {\n    float tex_domain = (step(0.0, uv.x)-step(1.0, uv.x))*(step(0.0, uv.y)-step(1.0, uv.y));\n\tfloat u_axis = (step(0.5, uv.y)-step(0.52, uv.y))*(step(0.5, uv.x)-step(1.0, uv.x));\n    float v_axis = (step(0.5, uv.x)-step(0.52, uv.x))*(step(0.5, uv.y)-step(1.0, uv.y));\n    vec2 saw = fract(4.0*uv)-0.5;\n    float checkerboard = step(saw.x*saw.y,0.0);\n    vec4 color = (face==0 ? 1.0 : 0.0) * vec4(1.0, 0.9, 0.3, 1.0)  // front: yellow\n               + (face==1 ? 1.0 : 0.0) * vec4(0.5, 0.7, 1.0, 1.0)  // right: blue\n               + (face==2 ? 1.0 : 0.0) * vec4(0.9, 0.6, 0.1, 1.0)  // left: orange\n               + (face==3 ? 1.0 : 0.0) * vec4(0.7, 0.4, 0.9, 1.0)  // back: purple\n               + (face==4 ? 1.0 : 0.0) * vec4(0.8, 0.5, 0.6, 1.0)  // up: pink\n               + (face==5 ? 1.0 : 0.0) * vec4(0.4, 0.8, 0.3, 1.0); // down: green\n\n    color *= mix(vec4(0.5, 0.5, 0.5, 1.0), vec4(1.0), checkerboard);\n    color = mix(color, vec4(0.0, 0.0, 0.0, 1.0), u_axis);\n    color = mix(color, vec4(1.0), v_axis);\n    color = mix(vec4(0.5, 0.5, 0.5, 1.0), color, tex_domain);\n\treturn color;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    vec2 uv = fragCoord/iResolution.xy*2.0-1.0;\n    float phi = uv.y*PI_2; // phi: -pi/2 to pi/2\n    float theta = uv.x*PI; // theta: -pi to pi\n\n    float cost = cos(theta);\n    float sint = sin(theta);\n    float tant = tan(theta);\n    float tanp = tan(phi);\n    float tanp_cost = tanp/cost;\n    float tanp_sint = tanp/sint;\n    \n    float side = step(abs(tanp), max(abs(cost), abs(sint))); // front/right/left/back faces\n    float front = side*step(abs(sint), cost);\n    float right = side*step(abs(cost), sint);\n    float back = side*step(abs(sint), -cost);\n    float left = side*step(abs(cost), -sint);    \n    float up = (1.0-side)*step(0.0, tanp);\n    float down = (1.0-side)*step(tanp, 0.0);\n\n\tfragColor = front*tex(vec2(tant, tanp_cost)*0.5+0.5, 0)\n              + right*tex(vec2(-1.0/tant, tanp_sint)*0.5+0.5, 1)\n              + left*tex(vec2(-1.0/tant, -tanp_sint)*0.5+0.5, 2)\n              + back*tex(vec2(tant, -tanp_cost)*0.5+0.5, 3)\n              + up*tex(vec2(1.0/tanp_sint,-1.0/tanp_cost)*0.5+0.5, 4)\n              + down*tex(vec2(-1.0/tanp_sint, -1.0/tanp_cost)*0.5+0.5, 5);\n    fragColor *= step(abs(theta), PI)*step(abs(phi), PI_2); // map mask\n}","name":"Image","description":"","type":"image"}]}