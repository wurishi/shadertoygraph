{"ver":"0.1","info":{"id":"ld3yzn","date":"1517726044","viewed":688,"name":"smoke flow","username":"BadBadDog","description":"smoke with flow noise","likes":11,"published":1,"flags":0,"usePreview":0,"tags":["smokeflownoise"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sf3Rn","filepath":"/media/a/0a40562379b63dfb89227e6d172f39fdce9022cba76623f1054a2c83d6c0ba5d.png","previewfilepath":"/media/ap/0a40562379b63dfb89227e6d172f39fdce9022cba76623f1054a2c83d6c0ba5d.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// cd publi http://evasion.imag.fr/~Fabrice.Neyret/flownoise/index.gb.html\n//          http://mrl.nyu.edu/~perlin/flownoise-talk/\n\n// The raw principle is trivial: rotate the gradients in Perlin noise.\n// Complication: checkboard-signed direction, hierarchical rotation speed (many possibilities).\n// Not implemented here: pseudo-advection of one scale by the other.\n\n// --- Perlin noise by inigo quilez - iq/2013   https://www.shadertoy.com/view/XdXGW8\nvec2 hash( vec2 p )\n{\n\tp = vec2( dot(p,vec2(127.1,311.7)),\n\t\t\t  dot(p,vec2(269.5,183.3)) );\n\n\treturn -1.0 + 2.0*fract(sin(p)*43758.5453123);\n}\n\nfloat level=1.;\nfloat noise( in vec2 p )\n{\n    vec2 i = floor( p );\n    vec2 f = fract( p );\n\t\n\tvec2 u = f*f*(3.0-2.0*f);\n    float t = pow(2.,level)* .2*iTime;\n    mat2 R = mat2(cos(t),-sin(t),sin(t),cos(t));\n    if (mod(i.x+i.y,2.)==0.) R=-R;\n\n    return 2.*mix( mix( dot( hash( i + vec2(0,0) ), (f - vec2(0,0))*R ), \n                     dot( hash( i + vec2(1,0) ),-(f - vec2(1,0))*R ), u.x),\n                mix( dot( hash( i + vec2(0,1) ),-(f - vec2(0,1))*R ), \n                     dot( hash( i + vec2(1,1) ), (f - vec2(1,1))*R ), u.x), u.y);\n}\n\nfloat Mnoise(in vec2 uv ) {\n  //return noise(uv);                      // base turbulence\n  //return -1. + 2.* (1.-abs(noise(uv)));  // flame like\n    return -1. + 2.* (abs(noise(uv)));     // cloud like\n}\n\nfloat turb( in vec2 uv )\n{ \tfloat f = 0.0;\n\t\n level=1.;\n    mat2 m = mat2( 1.6,  2.2, -1.2,  1.6 );\n    f  = 0.5000*Mnoise( uv ); uv = m*uv; \n level++;\n\tf += 0.2000*Mnoise( uv ); uv = m*uv; \n level++;\n\tf += 0.0850*Mnoise( uv ); uv = m*uv; \n level++;\n//\tf += 0.0825*Mnoise( uv ); uv = m*uv; \n level++;\n//\tf += 0.0825*Mnoise( uv ); uv = m*uv; level++;\n\treturn f/.9375; \n}\n// -----------------------------------------------\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    \n    vec2 tuv = fragCoord.xy / iResolution.xy;\n\n    vec2 suv = fragCoord.xy / iResolution.xy;\n\n    float pp = texture( iChannel0, vec2( suv.x*0.00, suv.y*0.05 )+iTime*0.002 ).g;\n    \n    suv.x += 0.2*sin(iTime*0.1)*(suv.y)*pp;\n    \n    float vs = texture( iChannel0, vec2( suv.x*0.00, suv.y*0.01 )+iTime*0.002 ).g;\n    float ns = texture( iChannel0, vec2( suv.x*0.00, suv.y*0.01 )+iTime*0.002 ).r;\n    float ps = 0.9 + 0.1*texture( iChannel0, suv*0.01+iTime*0.001 ).g;\n    float ls = smoothstep( 0.7, 1.0, texture( iChannel0, vec2(iTime)*0.1 ).b );\n\n    float line = smoothstep( 0.95-suv.y*0.09, 1.0, 1.0-abs(suv.x-0.5+(vs*0.7+ns)*0.02-0.01) ) *ps;\n    float glow = smoothstep( 0.96-suv.y*0.05, 1.0, 1.0-abs(suv.x-0.5+ns*0.02-0.01) ) *ps;\n\n    \n \tfloat sm = smoothstep(0.0,1.0,line*0.5);\n  \tfloat sg = smoothstep(0.0,1.0,glow*0.5);\n  \n    \n    vec2 uv = fragCoord.xy / iResolution.y,\n         m = iMouse.xy /  iResolution.y;\n    if (length(m)==0.) m = vec2(.5);\n\t\n    uv.y -= iTime*0.03;\n    float f = turb( 5.*uv );\n\tfloat tout = .5 + .4* f;\n    float fout =  smoothstep( 0.0,0.05, sm*tout );\n    float gout =  smoothstep( 0.0,0.1, sg*tout );\n    \n    vec4 bk = vec4( 0.4,0.6,0.9, 1.0 );\n    vec4 ff = vec4( 12.9,3.1,0.0, 1.0 ) * tout;\n    \n\tfragColor = bk * (1.0-vec4(fout*tout*0.8 + gout*tout*0.1 + fout*0.6) * (1.0-exp(-tuv.y*5.0)) );\n\tfragColor += (1.0-fragColor)*(ff*vec4(gout*tout*0.9 + fout*1.9) * exp(-tuv.y*15.0));\n    \n    \n    \n    \n}","name":"Image","description":"","type":"image"}]}