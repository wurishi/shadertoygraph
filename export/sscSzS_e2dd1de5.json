{"ver":"0.1","info":{"id":"sscSzS","date":"1633442234","viewed":89,"name":"Koch Curve~iteration","username":"yunhai","description":"naive coding","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["fractal"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define iR iResolution.xy\n#define iT iTime\n#define PIXW ((1.+sin(iT*1.5)*10.)/iR.y)\n#define SS(a,b,t) smoothstep(a,b,t)\nconst int MAX_QUEUE_CAPACITY=500;\nconst float TIMES=4.;\nstruct Queue\n{\n    vec4 m[MAX_QUEUE_CAPACITY];\n    int top,tail;\n}q;\nfloat dLine(vec2 p,vec2 s,vec2 e)\n{\n    p=p-s;s=e-s;\n    return length(clamp(dot(p,s)/dot(s,s),0.,1.)*s-p);\n}\nfloat mapTimes(float times){return (pow(4.,times)-1.)/3.;}\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    vec2 uv=(I-iR*.5)*PIXW;uv.x+=3.3;\n    float l=.2;\n    \n    \n    q.top=0;\n    q.tail=0;\n    q.m[q.tail++]=vec4(vec2(-5.,0),vec2(5.,0));\n    float r=1e20;\n    float times=mapTimes(TIMES),lTimes=mapTimes(TIMES-1.);\n    if(times*4.+1.>float(MAX_QUEUE_CAPACITY))\n    {\n        O.rgb=vec3(0.);\n        return;\n    }\n    for(float i=0.;i<times;i++)\n    {\n        float isDraw=step(lTimes,i);isDraw+=(1.-isDraw)*1e20;\n        vec4 decode=q.m[q.top++];\n        vec2 s=decode.xy,e=decode.zw,p=uv;\n       \n        float l=length(e-s)/3.;\n        vec2 d=normalize(e-s);\n        \n        decode=vec4(s,s+d*l);\n        q.m[q.tail++]=decode;\n        r=min(r,dLine(p,decode.xy,decode.zw)*isDraw);\n        \n        decode=vec4(e-d*l,e);\n        q.m[q.tail++]=decode;\n        r=min(r,dLine(p,decode.xy,decode.zw)*isDraw);\n        \n        \n        e=.5*(s+e)+vec2(d.y*-1.,d.x)*1.732*.5*l;\n        s+=d*l;\n        \n        decode=vec4(s,e);\n        q.m[q.tail++]=decode;\n        r=min(r,dLine(p,decode.xy,decode.zw)*isDraw);\n        \n        decode=vec4(e,s+d*l);\n        q.m[q.tail++]=decode;\n        r=min(r,dLine(p,decode.xy,decode.zw)*isDraw);\n    }\n    float lw=.01;\n    O.rgb=SS(lw+PIXW,lw-PIXW,r)*vec3(1);\n}","name":"Image","description":"","type":"image"}]}