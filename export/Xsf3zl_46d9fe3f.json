{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"cubemap","id":"XsX3zn","filepath":"/media/a/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}}],"code":"vec3 metaBallPos;\nfloat metaBallRadius = 2.5;\n\nfloat rand1(float x)\n{\n    return fract(sin(x) * 4358.5453123);\n}\n\nfloat noise1(float x)\n{\n\tfloat fl = floor(x);\n\tfloat fc = fract(x);\n\treturn mix(rand1(fl), rand1(fl + 1.0), smoothstep(0.0, 1.0, fc)) * 2.0 - 1.0;\n}\n\nfloat fbm1(float x)\n{\n\treturn noise1(x) * 0.5 + noise1(x * 2.0) * 0.25;\n}\n\n\nfloat df(vec3 p)\n{\n\tvec3 m = p - metaBallPos;\n\tfloat rsqr = (m.x*m.x + m.y*m.y + m.z*m.z);\n\treturn metaBallRadius / rsqr;\n}\n\n\nvoid UpdateMetaBall()\n{\n\tfloat t = iTime;\n\tmetaBallPos = 8.0*vec3(fbm1(t), fbm1(t), 0.0);\n\t\n}\n\nvec3 RayTrace(vec3 org, vec3 dir)\n{\n\t\n\tfloat d=0.0;\n\tfloat t = 0.0;\n\tfloat dt=0.1;\n\tvec3  p=org;\n\tfloat eps = 0.02;\n\tfor(int i=0; i < 50; i++)\n\t{\n\t\tp = org + t * dir;\n\t\td = df(p);\n\t\tif( d > 6.04 )\n   \t\t\tbreak;\n\t\tt += dt;\n\t}\n\tp = org + t * dir;\n\treturn p;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec3 camPos = vec3(0.0, 0.0, 5.0);\n\t\n\tvec3 rayOrigin = camPos;\n\tfloat aspect = iResolution.x / iResolution.y;\n\tvec2 uv = (fragCoord.xy / iResolution.xy * 2.0 - 1.0) * vec2(aspect, 1.0);\n\tvec3 rayDir = normalize(vec3(uv, -1.0));\n\n\tUpdateMetaBall();\n\t\n\tvec3 p = RayTrace(rayOrigin, rayDir);\t\n\tvec3 n = normalize(p - metaBallPos);\n\tvec3 l = normalize(vec3(1.0, 1.0, 1.0));\n\tfloat diffuse = clamp(dot(n, l), 0.0, 1.0);\n\tvec4 t = vec4(diffuse);\n\tvec3 r = reflect(rayDir, n);\n\tvec4 m = texture(iChannel0, r).bgra; \t\n\tfragColor = mix(t, m, 0.75);\n\t\n\t\t\t\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"Xsf3zl","date":"1376386080","viewed":224,"name":"Meta Warp","username":"slammo","description":"Playing with a metaball and reflections","likes":6,"published":1,"flags":0,"usePreview":0,"tags":["reflection","metaball"],"hasliked":0,"parentid":"","parentname":""}}