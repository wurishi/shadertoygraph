{"ver":"0.1","info":{"id":"7slcR2","date":"1642418074","viewed":113,"name":"Fork of Leon's \"kifings tubes\"","username":"Synthesoft","description":"I was blown away by Leon's mind-bending \"kifings tubes with a twist\" and was curious what would happen with other sdfs and time-based dimension/rotation scaling.  ","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["yes"],"hasliked":0,"parentid":"ssfcR2","parentname":"kifings tubes with a twist"},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Original shader by Leon Denise\n// \"kifings tubes with a twist\"\n// https://www.shadertoy.com/view/ssfcR2\n// are we arrived yet?\n// kifings tubes with a twist\n// leon denise 2022 01 16\n\n// Synthesoft fork:\n//   I was blown away by Leon's mind-bending \"kifings tubes\" and was curious what would \n//   happen with other sdfs and time-based dimension/rotation scaling.  \n//\n//   Changes in this fork:\n//     Added torus and box sdfs\n//     Added oscillation to scaling and rotation to increase pattern diversity over time \n//     Amped the color a bit  \n//  \n\n\n#define OSC_RATE_SCALE 0.4   // global scaling of oscillation rate (smaller is slower)  \n\n// repetition domain\n#define repeat(p,r) (mod(p+r/2.,r)-r/2.)\n\n// smooth union by Inigo Quilez\n// https://iquilezles.org/articles/distfunctions\nfloat smin( float d1, float d2, float k ) \n{\n    float h = clamp( 0.5 + 0.5*(d2-d1)/k, 0.0, 1.0 );\n    return mix( d2, d1, h ) - k*h*(1.0-h);\n}\n\nfloat smax(float a, float b, float k)\n{\n    return smin(a, b, -k);\n}\n    \n// rotation matrix\nmat2 rot(float a) { return mat2(cos(a),-sin(a),sin(a),cos(a)); }\n\n\n// https://in4k.github.io/html_articles/hg_sdf.html\nfloat fTorus(vec3 p, float smallRadius, float largeRadius) \n{\n\treturn length(vec2(length(p.xz) - largeRadius, p.y)) - smallRadius;\n}\n\n// https://in4k.github.io/html_articles/hg_sdf.html\nfloat fCylinder(vec3 p, float r, float height) \n{\n\tfloat d = length(p.xz) - r;\n\td = max(d, abs(p.y) - height);\n\treturn d;\n}\n\n// https://in4k.github.io/html_articles/hg_sdf.html\nfloat vmax(vec3 v) {\n\treturn max(max(v.x, v.y), v.z);\n}\n\n// https://in4k.github.io/html_articles/hg_sdf.html\nfloat fBox(vec3 p, vec3 b) {\n\tvec3 d = abs(p) - b;\n\n\treturn length(max(d, vec3(0))) + vmax(min(d, vec3(0)));\n}\n\nfloat fOscillateRange(float fMin, float fMax, float fRate)\n{\n    fRate *= OSC_RATE_SCALE;   \n\treturn mix(fMin, fMax, abs(sin(iTime*fRate)));\n}\n\n\n// geometry\nfloat map(vec3 p)\n{\n    // Synthesoft: Generate the dimensions of the objects.\n    // I picked the oscillation freq scale parms mostly at random with the goal of having \n    // them out of sync to maximize variability\n    // The scale ranges could probably use some adjustment\n\tfloat fTorusInnerScale = fOscillateRange(0.2, 3.0, 0.11);\n\tfloat fTorusOuterScale = fTorusInnerScale + fOscillateRange(0.02, 1.0, 0.12);\n\tfloat fCylinderRadiusScale = fOscillateRange(0.2, 2.0, 0.19);\n\tfloat fCylinderLengthScale = fOscillateRange(2.0, 60.0, 0.13);\n\tvec3 fBoxScale = vec3(fOscillateRange(0.2, 4.0, 0.173), fOscillateRange(0.2, 4.0, 0.197), fOscillateRange(0.2, 4.0, 0.139) );\n    float fs = fOscillateRange(0.1, 0.3, 0.073);      // previously fs was 0.2\n    float count = fOscillateRange(2.5, 9.0, 0.055);   // previously count was 6.0\n    \n    vec3 pp = p;\n    float dist = 100.;\n    p.z += iTime * .1; // translate\n    float cell = .7; // size of repetition\n    float pz = floor(p.z/cell); // index of cell in line\n    p.z = repeat(p.z, cell); // repeat space z\n    p.z *= mix(-1., 1., step(0.5, mod(p.z, 3.))); // mirror z per cell in line\n    float t = iTime * .1; // time rotation\n    float d = length(p);// * abs(sin(t*(length(p)/12.))); // distance from origin\n    float a = 1.; // amplitude of falloff\n\n    for (float i = 0.; i < count; ++i) { // kifing\n        // Synthesoft: I'm trying to produce a billowy effect\n        p.yz *= rot(fOscillateRange(-3.1,3.1,0.05*(i+0.9))); // twist  \n        p.yx *= rot(fOscillateRange(-3.1,3.1,0.06*(i+0.9))); // twist\n        p.xz *= rot(fOscillateRange(-3.1,3.1,0.07*(i+0.9))); // twist\n        p = abs(p)-(.05+d*fs)*a; // fold space\n\n\t\tfloat v = (.01+d*0.01)*a;\n        \n        float d1 = fTorus(p, v*fTorusInnerScale, v*fTorusOuterScale); \n\t\tfloat d2 = fCylinder(p, v*fCylinderRadiusScale, v*fCylinderLengthScale); \n\t\tfloat d3 = fBox(p, v*fBoxScale);\n\n\t\tfloat dMixed = min(min(d2,d1),d3);\n\n        dist = smin(dist, dMixed, (.01+d*.8)*a); // smoothly add shapes\n        a /= 2.; // falloff curve\n    }\n    return abs(dist)-.0001; // shell volume\n}\n\nvoid mainImage( out vec4 color, in vec2 coordinate )\n{\n    // coodinates\n    vec2 pixel = (coordinate - iResolution.xy / 2.) / iResolution.y;\n    vec3 eye = vec3(0,0,-1.);\n    vec3 ray = normalize(vec3(pixel, 1.5));\n    vec3 pos = eye + ray * .5; // start ahead, carve volume\n    \n    // raymarch\n    const float count = 60.;\n    float i = 0.;\n    for (i = count; i > 0.; --i) {\n        float dist = map(pos);\n        if (dist < .0001) break;\n        pos += ray * dist;\n    }\n    \n    // coloring\n    float shade = i/count;\n    // Inigo Quilez color palette (https://iquilezles.org/articles/palettes)\n    vec3 tint = .9 + .1 * cos(vec3(.0, .3, .6) * 6.283 + shade * 6. + pos.z * 18. + 2.);\n    color = vec4(tint * shade,1.0);\n    color *= color;\n}\n","name":"Image","description":"","type":"image"}]}