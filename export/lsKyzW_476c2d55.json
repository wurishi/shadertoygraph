{"ver":"0.1","info":{"id":"lsKyzW","date":"1521493298","viewed":325,"name":"Canals","username":"dila","description":"A scene of nowhere in particular :)\nClick and drag with mouse to rotate!","likes":20,"published":1,"flags":0,"usePreview":0,"tags":["raymarch"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","previewfilepath":"/media/ap/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"Xsf3Rr","filepath":"/media/a/79520a3d3a0f4d3caa440802ef4362e99d54e12b1392973e4ea321840970a88a.jpg","previewfilepath":"/media/ap/79520a3d3a0f4d3caa440802ef4362e99d54e12b1392973e4ea321840970a88a.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float mapw = 0.0;\nfloat mapc = 0.0;\nfloat mapl = 0.0;\nfloat mapv = 0.0;\n\nmat2 rot(float x) {\n    return mat2(cos(x), sin(x), -sin(x), cos(x));\n}\n\nfloat bump(vec3 p) {\n    vec2 uv = (p.xz - vec2(0.0, iTime * 1.2)) * 0.05;\n    uv.y -= cos(p.x * 3.141592 * 0.5) * 0.02;\n    float tex = dot(texture(iChannel1, uv).xyz, vec3(1.0)) / 3.0;\n    return (tex * 2.0 - 1.0) * 0.005;\n}\n\nvec2 wiremap(vec3 p) {\n    return p.xy * rot(0.6 + sin(p.z / 3.141592 * 4.0) * 0.125);\n}\n\nfloat vent(vec3 p) {\n\treturn max(abs(abs(p.x) - 2.0) - 0.02, abs((fract(p.y * 8.0 - 0.3) - 0.5) / 8.0) - 0.02);\n}\n\nfloat map(vec3 p) {\n    p.x += sin(p.z) * 0.5;\n\tfloat t = 2.0 - length(p.xy);\n    float f = p.y + bump(p);\n    float e = max(abs(abs(p.x) - 20.0) - 18.7, abs(p.y) - 0.3);\n    float c = length(vec2(p.y - 0.5, (fract(p.z / 3.0) - 0.5) * 3.0)) - 0.75;\n    vec2 k = wiremap(p);\n    float s = length(vec2(k.y - 1.9, abs(k.x) - 0.025)) - 0.015;\n    float l = length(vec3(k.y - 1.85, k.x, (fract(p.z / 4.0) - 0.5) * 4.0)) - 0.05;\n    float v = min(vent(p), vent(p.xzy));\n    t = max(t, -c);\n    t = min(t, e);\n    mapv = max(sign(t - v), 0.0);\n    t = min(t, v);\n    mapw = max(t - f, 0.0);\n    t = min(t, f);\n    mapc = max(sign(t - s), 0.0);\n    t = min(t, s);\n    mapl = max(sign(t - l), 0.0);\n    return min(t, l);\n}\n\nvec2 mapuv(vec3 p, vec3 sn) {\n    p.x += sin(p.z) * 0.5;\n\tfloat t = 2.0 - length(p.xy);\n    float f = p.y + bump(p);\n    float e = max(abs(abs(p.x) - 20.0) - 18.7, abs(p.y) - 0.3);\n    float c = length(vec2(p.y - 0.5, (fract(p.z / 3.0) - 0.5) * 3.0)) - 0.75;\n    float v = min(vent(p), vent(p.xzy));\n    t = max(t, -c);\n    vec2 bt = mix(p.yz, p.xz, max(sign(sn.y), 0.0));\n    t = min(t, f);\n    bt = mix(p.xz, bt, max(sign(t - e), 0.0));\n    t = min(min(t, f), e);\n    bt = mix(p.yz, bt, max(sign(v - t), 0.0));\n    return bt;\n}\n\nvec3 normal(vec3 p)\n{\n\tvec3 o = vec3(0.01, 0.0, 0.0);\n    return normalize(vec3(map(p+o.xyy) - map(p-o.xyy),\n                          map(p+o.yxy) - map(p-o.yxy),\n                          map(p+o.yyx) - map(p-o.yyx)));\n}\n        \nfloat trace(vec3 o, vec3 r) {\n    float t = 0.0;\n    for (int i = 0; i < 32; ++i) {\n        t += map(o + r * t);\n    }\n    return t;\n}\n\nfloat fog(vec3 w, vec3 sn, float f) {\n    w.x += sin(w.z) * 0.5;\n    float h = max(2.3 - abs(w.x), 0.0);\n    return f * h;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord.xy / iResolution.xy;\n    uv = uv * 2.0 - 1.0;\n    uv.x *= iResolution.x / iResolution.y;\n\n    vec3 r = normalize(vec3(uv, 1.2));\n    vec3 o = vec3(0.0, 1.0, iTime * 0.5);\n    \n    o.x -= sin(o.z) * 0.5;\n    o.y += sin(o.z * 4.0) * 0.02;\n    float ms = (iMouse.x / iResolution.x * 2.0 - 1.0) * sign(iMouse.z);\n    r.xz *= rot(sin(o.z) * 0.5 + ms);\n    r.xy *= rot(-sin(o.z) * 0.1);\n    \n    vec3 lcol = vec3(2.0, 2.0, 2.0);\n    \n    float t = trace(o, r);\n    float tw = mapw;\n    float tc = mapc;\n    float tl = mapl;\n    float tv = mapv;\n    vec3 w = o + r * t;\n    vec3 sn = normal(w);\n    vec3 tex = texture(iChannel0, mapuv(w, sn)).xyz;\n    tex *= tex;\n    tex = mix(tex, tex.xxx * 0.125, tv);\n    tex = mix(tex, vec3(0.7, 0.7, 0.0), tc);\n    tex *= max(dot(-r, sn), 0.0);\n    tex = mix(tex, lcol, tl);\n    float aoc = map(w + sn * 1.1);\n    tex *= 0.5 + aoc;\n    float f = 1.0 / (1.0 + t * t * 0.1);\n    \n\tvec3 rr = reflect(r, sn);\n    float rt = trace(w + rr * 0.01, rr);\n    float rtw = mapw;\n    float rtc = mapc;\n    float rtl = mapl;\n    float rtv = mapv;\n    vec3 rw = w + rr * rt;\n    vec3 rsn = normal(rw);\n    vec3 rtex = texture(iChannel0, mapuv(rw, rsn)).xyz;\n    rtex *= rtex;\n    rtex = mix(rtex, rtex.xxx * 0.125, rtv);\n    rtex = mix(rtex, vec3(0.7, 0.7, 0.0), rtc);\n    rtex = mix(vec3(0.0, 0.0, 0.0), rtex, 1.0-abs(dot(r,sn)));\n    rtex *= max(dot(-rr, rsn), 0.0);\n    rtex = mix(rtex, lcol, rtl);\n    float raoc = map(rw + rsn * 1.1);\n    rtex *= 0.5 + raoc;\n    float rf = 1.0 / (1.0 + rt * rt * 0.1);\n\n\ttex = mix(vec3(0.0), tex, fog(w, sn, f));\n\trtex = mix(vec3(0.0), rtex, fog(rw, rsn, rf * f));\n    \n    float twf = 1.0 / (1.0 + tw * 20.0);\n    vec3 wtex = texture(iChannel1, mapuv(w, sn)).xyz;\n    wtex *= wtex;\n    vec3 rfc = mix(rtex, wtex, pow(abs(dot(-r, sn)), 3.0));\n    vec3 fc = mix(rfc * vec3(0.2, 0.2, 0.1) * 8.0, tex, twf);\n    \n    float lt = 0.0;\n    for (int i = 0; i < 16; ++i) {\n        vec3 p = o + r * lt;\n        p.x += sin(p.z) * 0.5;\n        p.xy = wiremap(p);\n        p.z = (fract(p.z / 4.0) - 0.5) * 4.0;\n        float ld = length(vec3(p.x, p.y - 1.85, p.z)) - 0.0125;\n        lt += ld * 0.4;\n    }\n    fc = mix(fc, lcol, 1.0 / (1.0 + lt * lt * 0.5));\n    \n    fragColor = vec4(sqrt(fc), 1.0);\n}\n","name":"Image","description":"","type":"image"}]}