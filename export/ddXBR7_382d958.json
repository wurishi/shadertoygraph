{"ver":"0.1","info":{"id":"ddXBR7","date":"1688565824","viewed":61,"name":"EGA video filter","username":"kmooney","description":"EGA indexed video","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["video","ega","indexedpalette"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xdf3Rn","filepath":"/media/a/e81e818ac76a8983d746784b423178ee9f6cdcdf7f8e8d719341a6fe2d2ab303.webm","previewfilepath":"/media/ap/e81e818ac76a8983d746784b423178ee9f6cdcdf7f8e8d719341a6fe2d2ab303.webm","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":" // EGA palette colors\nvec4 egaPalette[17] = vec4[](\n    vec4(0.000, 0.000, 0.000, 1.), // black\n    vec4(0.000, 0.000, 0.667, 1.), // dk blue\n    vec4(0.000, 0.667, 0.000, 1.), // dk green\n    vec4(0.000, 0.667, 0.667, 1.), // dk teal\n    vec4(0.667, 0.000, 0.000, 1.), // dk red\n    vec4(0.667, 0.000, 0.667, 1.), // magenta\n    vec4(0.667, 0.333, 0.000, 1.), // brown\n    vec4(0.33, 0.33, 0.33, 1.),    // lt gray\n    vec4(0.333, 0.333, 0.333, 1.), // gray\n    vec4(0.333, 0.333, 1.000, 1.), // lt blue\n    vec4(0.333, 1.000, 0.333, 1.), // lt green\n    vec4(0.333, 1.000, 1.000, 1.), // lt cyan\n    vec4(1.000, 0.333, 0.333, 1.), // lt red (pink?)\n    vec4(1.000, 0.333, 1.000, 1.), // lt magenta\n    vec4(1.000, 1.000, 0.333, 1.), // lt yellow\n    vec4(1.000, 1.000, 1.000, 1.),  // white\n    vec4(0.28, 0.7, 0.2, 1.) // clear index color for green bg\n);\n\nvec4 indexToEGA(vec3 color)\n{\n    // Find the closest color in the EGA palette\n    float minDistance = distance(color, egaPalette[0].rgb);\n    vec4 closestColor = egaPalette[0];\n\n    for (int i = 1; i < 16; i++) {\n        float distanceToColor = distance(color, egaPalette[i].rgb);\n        if (distanceToColor < minDistance) {\n            minDistance = distanceToColor;\n            closestColor = egaPalette[i];\n        }\n    }\n\n    return closestColor;\n}\n\nvec4 background(vec4 indexedColor, vec2 uv) {\n    float threshold = 0.35;\n    if (distance(indexedColor, vec4(0.28, 0.7, 0.2, 1.)) < threshold) {\n        indexedColor = egaPalette[11];\n        if (uv.y < .5) {\n            indexedColor = egaPalette[12];\n        }\n        if (uv.x < .5) {\n           indexedColor = egaPalette[14];\n           if (uv.y < .5) {\n               indexedColor = egaPalette[13];\n           }\n        } \n    }\n    return indexedColor;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    // Normalize fragment coordinates to the range [0, 1]\n    vec2 uv = fragCoord / iResolution.xy;\n\n    // Sample video texture from iChannel0\n    vec4 videoColor = texture(iChannel0, uv);\n\n    // Index each color channel to the EGA palette\n    vec4 indexedColor = indexToEGA(videoColor.rgb);\n    \n    vec4 background = background(indexedColor, uv);\n    \n    // Set the fragment color using the indexed color\n    fragColor = background;\n}","name":"Image","description":"","type":"image"}]}