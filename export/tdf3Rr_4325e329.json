{"ver":"0.1","info":{"id":"tdf3Rr","date":"1549467625","viewed":178,"name":"cielab to rgb and back","username":"snipstruis","description":"roundtrip cielab to rgb","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["color"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sX3Rn","filepath":"/media/a/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv","previewfilepath":"/media/ap/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec2 uv;\n\nconst float eps = 216.f/24389.f;\nconst float kap = 24389.f/27.f;\nconst vec3  d65_2deg = vec3(0.95047,1.00000,1.08883);\nconst mat3 rgb2xyz_mat = \n    mat3(0.4124564,0.3575761,0.1804375,\n         0.2126729,0.7151522,0.0721750,\n         0.0193339,0.1191920,0.9503041);\nconst mat3 xyz2rgb_mat =\n\tmat3( 3.2404542, -1.5371385, -0.4985314,\n\t\t -0.9692660,  1.8760108,  0.0415560,\n\t      0.0556434, -0.2040259,  1.0572252);\n\nfloat compand(float f){\n    return pow(f,2.2f);//>0.04045? pow(((f+0.055f)/1.055f),2.4f): f/12.92f;\n}\nfloat invcompand(float f){\n    return pow(f,1.f/2.2f);\n}\n\n\nvec3 rgb2xyz(vec3 rgb){\n\trgb.r = compand(rgb.r);\n\trgb.g = compand(rgb.g);\n\trgb.b = compand(rgb.b);\n    return rgb*rgb2xyz_mat;\n}\nvec3 xyz2rgb(vec3 xyz){\n    xyz *= xyz2rgb_mat;\n\txyz.x = invcompand(xyz.x);\n\txyz.y = invcompand(xyz.y);\n\txyz.z = invcompand(xyz.z);\n    return xyz;\n}\n\nvec3 xyz2lab(vec3 xyz){\n    vec3 f;\n    f.x = xyz.x>eps? pow(xyz.x,1.f/3.f) : (kap*xyz.x+16.f)/116.f;\n    f.y = xyz.y>eps? pow(xyz.y,1.f/3.f) : (kap*xyz.y+16.f)/116.f;\n    f.z = xyz.z>eps? pow(xyz.z,1.f/3.f) : (kap*xyz.z+16.f)/116.f;\n    return vec3(116.f* f.y-16.f,\n                500.f*(f.x-f.y),\n                200.f*(f.y-f.z))/vec3(100)/d65_2deg;\n}\n\nvec3 lab2xyz(vec3 lab){\n    lab *= 100.f;\n    lab *= d65_2deg;\n    float fy = (lab.x+16.f)/116.f;\n    float fx = lab.y/500.f + fy;\n    float fz = fy - (lab.z/200.f);\n    float fx3 = pow(fx,3.f);\n    float fz3 = pow(fz,3.f);\n    return vec3(\n    \tfx3>eps? fx3: (116.f*fx-16.f)/kap,\n        lab.x > (kap*eps)? pow((lab.x+16.f)/116.f,3.f): lab.x/kap,\n        fz3>eps? fz3: (116.f*fz-16.f)/kap);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord){\n    vec2 half_res = 0.5*iResolution.xy;\n    uv = (fragCoord-half_res)/half_res.yy;\n    \n    vec3 tex = texture(iChannel0,fragCoord/iResolution.xy).xyz;\n\tvec3 lab = xyz2lab(rgb2xyz(tex));\n    lab.yz = lab.zy;\n    vec3 rgb = xyz2rgb(lab2xyz(lab));\n    fragColor = vec4(rgb.xyz,1.0);\n}\n","name":"Image","description":"","type":"image"}]}