{"ver":"0.1","info":{"id":"4lBSzV","date":"1444848692","viewed":232,"name":"Lightning Balls","username":"Roobird","description":"Light the balls","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["balls","lightning"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[],"code":"float distFunc(vec3 p)\n{\n    return length(mod(p+vec3(0,0,mod(-iTime*19.,4.)),4.)-2.)-.4;\n}\n\nfloat quad(float a)\n{\n\treturn a * a;\n}\n\nfloat sphere(vec3 M, vec3 O, vec3 d)\n{\n\tfloat r = 0.2;\n\tvec3 MO = O - M;\n\tfloat root = quad(dot(d, MO))- quad(length(d)) * (quad(length(MO)) - quad(r));\n\tif(root < 0.001)\n\t{\n\t\treturn -1000.0;\n\t}\n\tfloat p = -dot(d, MO);\n\tfloat q = sqrt(root);\n    return (p - q) > 0.0 ? p - q : p + q;\n}\n\nvec3 sphere_color(float t, vec3 mid){\n\t\n    float a = t < 10000.0? 1.0 : 0.0; \n    \n    return abs(normalize( mid * vec3( 1.4, 1.0, 0.2))) * a;\n\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\t\n    vec3 sphereM;\n    \n    float fov = 70.0;\n\tfloat tanFov = tan(fov / 2.0 * 3.14159 / 180.0) / iResolution.x;\n\tvec2 p = tanFov * (fragCoord.xy * 2.0 - iResolution.xy);\n\n\tvec3 camP = vec3(3.0, 3.0, 0.0);\n\tvec3 camDir = normalize(vec3(p.x - 0.3, p.y - 0.2, 1.0));\n\n\tfloat t = 10000.0;\n\tfor(float x = -2.0; x <= 2.0; ++x)\n\t{\n\t\tfor(float y = 1.0; y <= 1.0; ++y)\n\t\t{\n\t\t\tfor(float z = 1.0; z <= 20.0; z+= 0.25)\n\t\t\t{\t\n                vec3 newSphereMid = vec3(x, y + cos(iTime * 2.0 + z), z);\n\t\t\t\tfloat newT = sphere(newSphereMid, camP, camDir);\n\t\t\t\tif (0.0 < newT && newT < t)\n\t\t\t\t{\t\n\t\t\t\t\tt = newT;\n                    sphereM = newSphereMid;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n    \n    vec3 light = normalize(vec3(1.0, 1.0, 1.0));\n    \n    vec3 intersect_pt = camP + t* camDir;\n    \n    vec3 intersec_normal = normalize( intersect_pt - sphereM );\n                                   \n    float lightning = max(0.2, dot(intersec_normal, light));\n\n\tfragColor = lightning * vec4(sphere_color(t, sphereM), 1.0) * 1.5;\n}","name":"","description":"","type":"image"}]}