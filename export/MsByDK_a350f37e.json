{"ver":"0.1","info":{"id":"MsByDK","date":"1493845011","viewed":381,"name":"Gravity Field Experiments #1","username":"Casheera","description":"Gravity field","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["2d","gravityfield"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"struct Planet\n{\n\tint base; // index of parent planet of -1 for root\n\tfloat R;  // Radius\n    float M;  // Mass\n    float H;  // Orbit height over base planet\n    float PH; // Phase\n    float P;  // Period\n    float C;  // Color (hue)\n};\n#define N 7\nPlanet PSys[] = Planet[](\n\tPlanet(-1, .11, 0.434782608695652, .0, .06, .0, .12),\n    Planet(0, .03, 0.217391304347826, .15, .02, .9, .3),\n    Planet(0, .01, 0.130434782608696, .04, .0167, .6, .8),\n    Planet(1, .006, 0.086956521739131, .03, .0267, 2.2, .7),\n    Planet(2, .003, 0.086956521739131, .01, .02, -3.5, .5),\n    Planet(0, .007, 0.043478260869565, .07, .05, 2.0, .6),\n    Planet(3, .003, 0.03, .008, .05, 0.74, .9)\n);\n\nmat2 rot2(float a) {\n\tfloat s = sin(a*6.28);\n\tfloat c = cos(a*6.28);\n\treturn  mat2(c, -s, s, c);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat GF(vec2 p, vec2 c, float r, float m)\n{\n    float d = distance(p,c)-r;\n    float g = .0;\n    if (d>0.0)\n    {\n        g = m/d;\n    }\n    return g;\n}\n\nvec2 rotPos(int j)\n{\n    float cr = 0.0;\n    if (PSys[j].base>-1)\n    {\n        cr = PSys[PSys[j].base].R+PSys[j].H;\n    }\n    float t = (.1*iTime*PSys[j].P + PSys[j].PH)*6.28;\n    return vec2(cr*cos(t), cr*sin(t));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float mx = max(iResolution.x, iResolution.y);\n\tvec2 uv = (fragCoord.xy - iResolution.xy*.5)/mx;\n    float gacc = 1.;\n    vec3 plc = vec3(.0, .0, .0);\n    for (int i = 0; i < N; i++)\n    {\n        vec2 c = vec2(.0, .0);\n        int parentID = i;\n            while (parentID > -1)\n            {        \n                c += rotPos(parentID);\n                parentID = PSys[parentID].base;\n            }\n        float gf = GF(uv, c, PSys[i].R, PSys[i].M);\n        plc = mix(hsv2rgb(vec3(PSys[i].C, 1., 1.)),\n                  plc,\n                  smoothstep(-.001, .0, distance(uv, c)-PSys[i].R));\n        gacc *= gf;\n    }\n    float gnorm = 5.*log2(gacc);\n\tvec3 c = mix(plc ,vec3(1.0),  smoothstep (.8, 1.2, cos(gnorm)));\n    if (iMouse.z>.0)\n    {\n        vec3 fv = reflect(normalize(vec3(uv, -1.)), normalize(vec3(uv, sqrt(gacc))));\n        c = plc+smoothstep(.0, 1.0, fv);\n    }\n\n\tfragColor = vec4(c, 1.0);\n}","name":"Image","description":"","type":"image"}]}