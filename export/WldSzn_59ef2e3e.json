{"ver":"0.1","info":{"id":"WldSzn","date":"1733549513","viewed":78,"name":"Potential energy simulation","username":"Txoka","description":"I had this laying arround for a while, i dont remember any of the code but it looks neat.\nModify potential energy function in Common","likes":5,"published":3,"flags":32,"usePreview":0,"tags":["simulation","potentialenergy"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nvoid mainImage(out vec4 Q,in vec2 U) {\n\tvec2 u = 2.*(U-0.5*R)/R.x;\n\tQ = vec4(1);\n\tfloat f = 0.;\n\tfor (int i = 0; i < N; i++) {\n\t\tvec4 p = texelFetch(iChannel0,ivec2(i,0),0);\n\t\tfloat r = length(p.xy-u);\n\t\tQ *= smoothstep(1.,4.,r*length(R));\n\t\tf += p_(length(p.xy-u));\n\t}\n\tif (mouse.z >0.) {\n\t\tvec2 mo = mouse.xy/R*2.-1.;\n\t\tmo.y *= R.y/R.x;\n\t\tf += 1./length(mo-u);\n\t}\n\tQ *= 0.7+0.3*sin(f/20.+vec4(1,2,3,4));\n\tQ.w = 1.;\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void mainImage(out vec4 Q, in vec2 U) {\n    if(U.x<float(N)||U.y<float(N)){\n        ivec2 K=ivec2(U);\n\t\tvec4 a=texelFetch(iChannel0,ivec2(K.x,0),0);\n\t\tvec4 b=texelFetch(iChannel0,ivec2(K.y,0),0);\n\t\tvec2 u=b.xy-a.xy;\n\t\tfloat l=length(u);\n\t\tif(l>0.0)u=normalize(u);\n\t\tQ.xy = u*f(l);\n    }\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"void mainImage(out vec4 Q, in vec2 U) {\n    if(U.x<float(N)&&U.y==0.5){\n\t\tif (iFrame==0) {\n\t\t\tfloat o=2.*pi*U.x/float(N);\n            vec2 pos=vec2(cos(o),sin(o))*0.5;\n            vec2 vel=vec2(-sin(o),cos(o))*-10.;\n\t\t\tQ=vec4(pos,vel);\n\t\t} else {\n            int id=int(U.x);\n\t\t\tQ=texelFetch(iChannel0,ivec2(id,0),0);\n\t\t\tvec2 u=vec2(0);\n\t\t\tfor (int i = 0; i < N; i++) {\n\t\t\t\tu+=texelFetch(iChannel1,ivec2(id,i),0).xy;\n            }\n            \n\n\t\t\tQ.zw += dt*u;\n\t\t\tQ.xy += dt*Q.zw;\n            \n\t\t\tif (mouse.z>0.) {\n\t\t\t\tvec2 mo = mouse.xy/cR*2.-1.;\n\t\t\t\tmo.y *= cR.y/cR.x;\n\t\t\t\tvec2 v = mo-Q.xy;\n\t\t\t\tfloat l = length(v);\n\t\t\t\tQ.zw *= 0.999;\n\t\t\t\tif (l>0.) Q.zw += 0.5*v/dot(v,v);\n\t\t\t}\n\t\t\tif (Q.x<-1.) {Q.x = -1.; Q.z*=-1.;}\n\t\t\tif (Q.y<-cR.y/cR.x) {Q.y = -cR.y/cR.x; Q.w*=-1.;}\n\t\t\tif (Q.x>1.) {Q.x = 1.; Q.z*=-1.;}\n\t\t\tif (Q.y>cR.y/cR.x) {Q.y = cR.y/cR.x; Q.w*=-1.;}\n\t\t}\n    }\n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define R iResolution.xy\n#define mouse iMouse\n#define cR R\n\nconst int N=450;\n\n\nconst float dt=1e-4;\nconst float pi=4.*atan(1.);\n\n\nconst float eps=1e-4;\nfloat p_(float r) {\n    r*=4.;\n    r+=1e-2;\n    //return exp(3.*r*r);\n    //return (15.*r*r);\n    //return -10.*exp(-r);\n    return (-1./r+0.05/(r*r));\n}\nfloat f(float r){\n\treturn 0.5*(p_(r+eps)-p_(r-eps))/eps;\n}","name":"Common","description":"","type":"common"}]}