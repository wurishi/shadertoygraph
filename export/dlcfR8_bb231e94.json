{"ver":"0.1","info":{"id":"dlcfR8","date":"1700933120","viewed":24,"name":"noisy transparent (no sound)","username":"pik","description":"raymarching, transparent, marble","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["pik"],"hasliked":0,"parentid":"cldBRr","parentname":"trnoise"},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nmat2 rot(float a){\n    return mat2(cos(a),sin(a),-sin(a),cos(a));\n}\nmat3 rotX(float a){\n    return mat3(1.,0.,0.,0.,cos(a),sin(a),0.,-sin(a),cos(a));}\nmat3 rotY(float a){\n    return mat3(cos(a),0.,sin(a),0.,1.,0.,-sin(a),0.,cos(a));}\nfloat sabs(float x){\n    return sqrt(x*x+6.5);}\nfloat smin(float x,float y){\n    return (x+y-sabs(x-y))*0.5;}\nfloat smax(float x,float y){\n    return (x+y+sabs(x-y))*0.5;}\n\nfloat sphere(vec3 p,float r){ return length(p)-r;}\nfloat box(vec3 p,vec3 b){\n    vec3 q=abs(p)-b;\n    return length(max(q,0.))+min(max(max(q.x,q.y),q.z),0.);}\n\nstruct objects{\n    float d1;//sphere\n    float d2;//box\n    float d3;//box\n};\n\nvec3 hash3(float t){\n    return vec3(fract(sin(t*86996.)*8757.55),fract(sin(t*18696.)*8277.95),fract(sin(t*45486.)*7653.73))*2.-1.;}\n    \nvec4 point(float t, vec3 p){\n    vec3 r=hash3(t)*15.;\n    float d21=box(p*rotX(r.x)*rotY(r.y),vec3(25.));\n    float d22=box((p-r.yxz)*rotX(r.z)*rotY(r.x),vec3(25.));\n    float d23=box((p-r.yzx)*rotX(r.y)*rotY(r.z),vec3(25.));\n    float d24=box((p-r.zxy)*rotX(r.y)*rotY(r.y),vec3(25.));\n    float d2=smin(smin(smin(d21,d22),d23),d24);\n    return vec4(r,d2);\n}\n\nvec3 la(float tm,vec3 dr){\n    vec3 r;\n    if(tm<3.) r=mix(vec3(0.),dr.yxz,tm/3.);\n    else if(tm<6.) r=mix(dr.yxz,dr.yzx,(tm-3.)/3.);\n    else if(tm<9.) r=mix(dr.yzx,dr.zxy,(tm-6.)/3.);\n    else r=mix(dr.zxy,vec3(0.),(tm-9.)/3.);\n    return r;}\n    \nobjects ob(vec3 p){\n    vec4 dr=point(floor(iTime/12.),p);\n    float d2=dr.w;\n    float tm=mod(iTime,12.);\n    vec3 r=la(tm,dr.xyz);\n    float d3=(fract(sin(iTime*80.)*40.)>0.46) ? 9999. : box((p-r.zxy)*rotX(-iTime*0.5)*rotY(-iTime*0.2),vec3(1.4));\n    float d32=(fract(sin(iTime*10.)*70.)>0.76) ? 9999. : box((p-r.yzx*2.5)*rotX(-iTime*1.1)*rotY(-iTime*1.2),vec3(1.));\n    d3=smin(abs(d3)-0.01,d32);\n    float d4=box((p-r)*rotX(-iTime*0.1)*rotY(-iTime*0.2),vec3(12.));\n    float d1=sphere(p-r-vec3(sin(tm)*0.02,0.,0.)-sin(p*30.)*0.05,1.);\n    d2=max(-d4,d2);\n    objects ob;\n    ob.d1=d1;\n    ob.d2=d2;\n    ob.d3=abs(d3)-0.01;\n    return ob;\n}\n\nvec2 map(vec3 p){\n    objects o=ob(p);\n    float dmin=smin(o.d1,o.d2);\n    dmin=smin(dmin,o.d3);\n    float m=0.;\n    if(abs(dmin)<0.005){\n        if(o.d1<min(o.d2,o.d3)) m=1.;\n        else if(o.d2<o.d3) m=2.;\n        else m=3.;\n    }\n    return vec2(dmin,m);\n}\n\nvec3 matcol(float m,vec3 p){\n    vec3 col;\n    if(m>2.) col=pow(sin(p)+vec3(0.8,0.1,0.1),vec3(0.9));\n    else if(m>1.) col=pow(vec3(0.1,0.8,0.9),vec3(0.8));\n    else if(m>0.) col=pow(vec3(0.9,0.1,0.2),vec3(0.9));\n    return col;\n}\n\nvec3 bg(vec3 rd){\n    vec2 p=rd.xy;\n    p.x=abs(p.x)-0.3;\n    float l=smoothstep(0.01,0.,abs(p.y+p.x*5.))*smoothstep(0.2,0.,abs(p.y+(fract(iTime*1.5))))*smoothstep(0.5,-0.5,p.y);\n    return vec3(l*l*l+0.02,l*l+0.02,sin(l*10.)+0.02);\n}\n\nvoid transform(inout vec3 p){\n    //\n}\n\n//https://www.shadertoy.com/view/MtX3Ws\nvec2 csqr( vec2 a )  { return vec2( a.x*a.x - a.y*a.y, 2.*a.x*a.y  ); }\nfloat marble(in vec3 p) {\n\t\n\tfloat res = 0.;\n\t\n    vec3 c = p;\n\tfor (int i = 0; i < 10; ++i) {\n        p =.7*abs(p)/dot(p,p) -.7;\n        p.yz= csqr(p.yz);\n        p=p.zxy;\n        res += exp(-19. * abs(dot(p,c)));\n        \n\t}\n\treturn res/2.;\n}\n\nvec4 raymarch(vec3 ro,vec3 rd){\n    vec3 p=ro;\n    float l=0.;\n    vec2 d=vec2(10.,0.);\n    float c=0.;\n    float m=0.;\n    vec3 col=vec3(0.);\n    for(int i=0;i<99;i++){\n        p=ro+rd*l;\n        transform(p);\n        d=map(p);\n        l+=max(abs(d.x),0.001)*0.5;\n        if(abs(d.x)<0.05){\n            m=d.y;\n            c+=(m>2.) ? 0.00001 : 0.001;\n            col+=matcol(m,p)*c;\n        }\n        if(d.x<0.){ float a=marble(p);a=pow(a,0.8);col+=vec3(a*a,a*a*a,a)*0.08;}\n    }\n    transform(p);\n    float mlast=map(p).y;\n    if(mlast<0.5)col=mix(bg(rd),col,c*10.);\n    return vec4(col,l);\n}\n\nvec3 cam(vec2 uv, vec3 ro,vec3 tar){\n    vec3 ff=normalize(tar-ro);\n    vec3 uu=vec3(0.,1.,0.);\n    vec3 rr=normalize(cross(ff,uu));\n    uu=cross(rr,ff);\n    return normalize(uv.x*rr+uv.y*uu+ff);}\n     \nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv=fragCoord/iResolution.xy*2.-1.;\n    uv.x*=iResolution.x/iResolution.y;\n    vec3 col;\n    float z=0.;\n    if(fract(iTime)>0.7){\n        uv+=vec2(sin(iTime*50.)*0.7*step(0.73,fract(sin(iTime*30.)*50.)),sin(iTime*20.)*0.4*step(0.76,fract(sin(iTime*30.)*30.)));\n        z+=sin(iTime*70.)*0.2*step(0.86,fract(sin(iTime*30.)*55.));\n    }\n    vec3 r=la(mod(iTime,12.),hash3(floor(iTime/12.))*8.);\n    vec3 tar=r;\n    vec3 ro=-r+vec3(step(0.8,fract(sin(iTime*0.5)))*(uv.x-uv.y)*20.,4.*cos(iTime*0.1),z+6.*sin(iTime*0.1));//z\n    vec3 rd=cam(uv,ro,tar);\n    vec4 res=raymarch(ro,rd);\n    vec3 p=ro+rd*res.w;\n    col=res.xyz;\n    col=pow(col,vec3(0.4545));\n    fragColor=vec4(col,1.);\n}","name":"Image","description":"","type":"image"}]}