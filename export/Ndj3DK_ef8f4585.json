{"ver":"0.1","info":{"id":"Ndj3DK","date":"1617979146","viewed":173,"name":"Mandelbulb Sphere","username":"kithy","description":"mandelbulb,fractal,mandelbrot set,raymarching","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","fractal","mandelbulb","mandelbrotset"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define EPS 0.001\n#define POWER 8.0\n#define ITR 15\n#define MAX_DIST 64\n#define fov radians(35.0)\n\nfloat mandelbulb(vec3 p){\n\tfloat power=1.0+(POWER-1.0)*(0.5-cos(iTime)*0.5);\n\tvec3 z=p;\n\tfloat dr=1.0;\n\tfloat r=0.0;\n\tfor(int i=0;i<ITR;i++){\n\t\tr=length(z);\n\t\tif(r>3.0)break;\n\n\t\t\n\t\tfloat theta=acos(z.z/r);\n\t\tfloat phi=atan(z.y,z.x);\n\n\t\tdr=pow(r,power-1.0)*power*dr+1.0;\n\n\t\t\n\t\tfloat zr=pow(r,power);\n\t\ttheta*=power;\n\t\tphi*=power;\n\n\t\t\n\t\tz=zr*vec3(sin(theta)*cos(phi),sin(phi)*sin(theta),cos(theta));\n\t\tz+=p;\n\t}\n\treturn 0.5*log(r)*r/dr;\n}\n\nfloat mainDist(vec3 p){\n\treturn mandelbulb(p);\n}\n\nvec3 rayMarch(const vec3 eye,const vec3 ray,out float depth,out float steps){\n\tdepth=0.0;\n\tsteps=0.0;\n\tfloat dist;\n\tvec3 rp;\n\n\t\n\tfor(int i=0;i<MAX_DIST;i++){\n\t\trp = eye + depth*ray;\n\t\tdist = mainDist(rp);\n\t\tdepth += dist;\n\t\tsteps++;\n\t\tif(dist<EPS)break;\n\t}\n\n\t\n\treturn rp;\n}\n\nvec3 genNormal(vec3 p){\n\treturn normalize(vec3(\n\t\tmainDist(vec3(p.x+EPS,p.y,p.z))-mainDist(vec3(p.x-EPS,p.y,p.z)),\n\t\tmainDist(vec3(p.x,p.y+EPS,p.z))-mainDist(vec3(p.x,p.y-EPS,p.z)),\n\t\tmainDist(vec3(p.x,p.y,p.z+EPS))-mainDist(vec3(p.x,p.y,p.z-EPS))\n\t));\n}\n\nfloat color(float val,float offset,float level){\n\treturn clamp((val-level)*(1.0+offset)+level,0.0,1.0);\n}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\tvec2 uv=(2.0*fragCoord.xy-iResolution.xy)/iResolution.y;\n\n\t\n\tvec3 ray=normalize(vec3(uv*tan(fov),1.0));\n\tfloat angle=radians(360.0)*iTime;\n\n\tvec3 camPos=vec3(0.0,0.0,-2.2);\n\t\n\tfloat depth=0.0;\n\tfloat steps=0.0;\n\tvec3 rp=rayMarch(camPos+EPS*ray,ray,depth,steps);\n\n\t\n\tfloat ao=steps*0.01;\n\tao=1.0-ao/(ao+0.5);\n\n\tfloat offset=0.3;\n\tfloat level=0.5;\n\tao=color(ao,offset,level);\n\tvec3 normal=genNormal(rp);\n\tvec3 fColor=ao*(normal*0.5+0.5);\n\tfragColor=vec4(fColor,1.0);\n}","name":"Image","description":"","type":"image"}]}