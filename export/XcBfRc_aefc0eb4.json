{"ver":"0.1","info":{"id":"XcBfRc","date":"1725234758","viewed":17,"name":"basic lighting + normal colors","username":"TomCarbon","description":"cleaned version from another shader to make it more readable\nand added normal colouring, specular and gamma","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","sphere","normal","pdf"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const uint kMaxSteps = 50u;\nconst float kMinSurface = 0.001;\n\n\nfloat sdSphere(vec3 p, vec4 sphere)\n{\n    return length(sphere.xyz - p) - sphere.w;\n}\n\nfloat sdScene(vec3 p)\n{\n    return sdSphere(p, vec4(0, 1, 0, 1));\n}\n\n\nvec3 getNormal(vec3 p)\n{\n    vec2 e = vec2(0, 0.001);\n\n    vec3 n = sdScene(p) - vec3(sdScene(p - e.yxx), sdScene(p - e.xyx), sdScene(p - e.xxy));\n    \n    return normalize(n);\n}\n\n\nfloat rayMarch(vec3 ro, vec3 rd, float min, float max)\n{\n    float d = min;\n    for(uint i = 0u; i < kMaxSteps; ++i)\n    {\n        vec3 p = ro + d * rd;\n\n        float sd = sdScene(p);\n        d += sd;\n        \n        if(sd < kMinSurface || d > max)\n            break;\n    }\n\n    return d;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    float t = iTime * 3.0;\n    vec2 uv = (2.0 * fragCoord - iResolution.xy) / iResolution.x;\n    \n    vec3 light = vec3(0, 1.5, 2);\n    light.xz = 3.0 * vec2(cos(t), sin(t));\n\n    vec3 ro = vec3(0.0, 1.0, 2.5);\n    vec3 rd = normalize(vec3(uv, -1.0));\n\n    vec3 color = vec3(0.1);\n    float d = rayMarch(ro, rd, 0.0, 100.0);\n    if (d < 100.0)\n    {\n        vec3 p = ro + rd * d;\n        vec3 n = getNormal(p);\n        \n        vec3 ln = normalize(light - p);\n\n        float diffuse = clamp(dot(n, ln), 0.0, 1.0);\n        \n        float specular = pow(diffuse, 64.0);\n        color = diffuse * clamp(n, 0.0, 1.0) + specular;\n    }\n\n    // gamma\n    color = pow(color, vec3(1.0 / 1.2));\n\n    fragColor = vec4(color, 1.);\n}\n","name":"Image","description":"","type":"image"}]}