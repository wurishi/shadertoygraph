{"ver":"0.1","info":{"id":"XcVyRV","date":"1732703984","viewed":754,"name":"[â™ª]King of Kings - Field","username":"Catzpaw","description":"\"King of Kings\" is a strategy game for the Family Computer released by Namco only in Japan.","likes":59,"published":3,"flags":40,"usePreview":0,"tags":["music","dof","bokeh","map","tile","chiptune"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//==================================================\n// King of Kings - Field\n// Image:post effects\n\n//TEXTURE\nvec4 tx0(vec2 uv){\n    vec4 c=texture(iChannel0,uv);\n    c.g=texture(iChannel0,.993*(uv-.5)+.5).g;\n    c.r=texture(iChannel0,.986*(uv-.5)+.5).r;\n    return c;\n}\n\n//MAIN\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\n    vec2 uv=fragCoord/iResolution.xy;\n\n    //DOF filter\n    mat2 vel=rot(1.43);\n    vec2 mul=vec2(0,iResolution.x/iResolution.y),ang=vec2(0,1)*mul;\n    vec4 acc=vec4(0,0,0,1),tgt=vec4(1),c=tx0(uv);\n    float fp=1.;\n    fp=min(tx0(vec2(.55,.5)).w,fp);\n    fp=min(tx0(vec2(.55,.45)).w,fp);\n    fp=min(tx0(vec2(.5,.5)).w,fp);\n    fp=min(tx0(vec2(.45,.45)).w,fp);\n    fp=min(tx0(vec2(.44,.5)).w,fp);\n    float foc=min(.3,fp),bok,rad=0.,dis=0.;\n    bok=c.w<foc?1.-c.w/foc:(c.w-foc)/(1.-foc);\n    bok=pow(bok,1.+foc);\n    for(int j=ZERO;j<30;j++){\n        rad+=.006;\n        tgt=tx0(uv+ang*rad*.05);dis=tgt.w;tgt.w=.97;\n        acc+=(((dis<c.w)&&(abs(dis-foc)>=rad))||(bok>=rad))?tgt:vec4(0);\n        ang*=vel;\n    }\n    c.rgb+=acc.rgb;c.rgb/=acc.w;\n    \n    //vignette\n    uv-=.5;\n    c.rgb-=dot(uv,uv)*.8;\n\n    //output\n    c.w=1.;\n    fragColor=c;\n}\n","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"//==================================================\n// King of Kings - Field\n// Common:settings\n\n#define BPM 112.68\n#define FAR 40.\n#define ZERO min(0,iFrame)\nconst float pi=acos(-1.);\nmat2 rot(float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\n","name":"Common","description":"","type":"common"},{"inputs":[],"outputs":[{"id":"4dXGR8","channel":0}],"code":"//==================================================\n// King of Kings - Field\n// Buffer A:map view\n\n//FIELD MAP 56x52\nconst int[364] fm=int[](\n0x88888999,0x99aaaaaa,0xaa888888,0x99888888,0xbccccc44,0x48800000,0x00000088,\n0x88899998,0x899aaaaa,0xaaa98888,0x998b8888,0x8c888449,0x98888000,0x00000888,\n0x88999988,0x888aaaaa,0xaaaa8888,0x99889988,0x8c888499,0x88888800,0x00000008,\n0x88900988,0x8888aaaa,0xaaaa88a9,0x99889998,0x8cb44488,0x88889800,0x00000000,\n0x00000000,0x0b888aaa,0xaaaaaaaa,0x99889988,0x8ba4b888,0x88898800,0x00000000,\n0x00000000,0x00888888,0xaaaaaaaa,0xa99999aa,0xaaa48888,0x88998980,0x00000000,\n0x00000000,0x00888888,0xaaaaaaaa,0xaaaaaaaa,0xaa44aa88,0x88889990,0x00888000,\n0x00000000,0x00008888,0x88aaaaaa,0xaaaaaaaa,0xaa4aaaaa,0xaaa88980,0x09890000,\n0x00000000,0x00088888,0x8888aaaa,0xaaaaaaaa,0xaa4aaaaa,0xaa888844,0x08980000,\n0x00000000,0x00044844,0x488aaaaa,0xaaaaaaaa,0xb444a898,0x88888448,0x99890000,\n0x00000000,0x08884448,0x88888aab,0x4aaaaaaa,0x44844888,0x88000088,0x89980000,\n0x00000888,0x88888888,0x88888a8c,0x44aaaaa4,0x48894488,0x88800089,0x898b0000,\n0x00008898,0x88888888,0x8888cccc,0x844aaa44,0xa8889444,0x44449488,0x88000000,\n0x00008999,0x99888888,0x8cccc88c,0x8844944a,0xaa889999,0x9889b489,0x84000000,\n0x00000899,0x99988888,0x8c88888c,0x8884444b,0xaa888999,0x9888c488,0x89898000,\n0x00000888,0x88888bcc,0xccaaa88c,0x88884444,0xba888899,0x8888c444,0x48880000,\n0x00000008,0x88844488,0xaaa888cc,0x8b884444,0x4aa88988,0x8888c888,0x40000000,\n0x00000000,0x44448888,0xa98888c4,0x49884444,0x4aaa8888,0x8888c888,0x80000000,\n0x00000000,0x99888889,0x988884d4,0x988b4444,0x4aa88988,0x88bcc888,0x80000000,\n0x00000009,0x999a8889,0x888944c8,0x88884444,0x44aaa888,0x88c88888,0x80000000,\n0x00000088,0x99aaa999,0x88994cc8,0x8888b444,0x44888888,0x89c8888a,0xa9800000,\n0x00000088,0x899a9998,0x88444c88,0x89888844,0x44888888,0x88c999aa,0x99800000,\n0x00000008,0x88899884,0x444ccccc,0x98888884,0x44888a88,0x88c84999,0x98000000,\n0x00000000,0x08888844,0xbccc888c,0xcc888888,0x4488888a,0x88c84899,0x88000000,\n0x00000000,0x0000444c,0xc8888999,0x8ccccccc,0xb4988888,0x88c80088,0x80000000,\n0x00000000,0x0000bccc,0x88899998,0x8b88888b,0x8488988a,0x88c80000,0x00000000,\n0x00000000,0x00000888,0x89999998,0x844b888c,0x84889888,0x88c88000,0x00000000,\n0x00000000,0x00088889,0x99999988,0x449b888c,0x84888888,0x88c80000,0x00000000,\n0x00000000,0x00099999,0x99999444,0x4988888c,0x84888888,0x88c00000,0x00000000,\n0x00000000,0x00899999,0x99988489,0x8888888c,0x84889888,0x88cb0000,0x00000000,\n0x00000000,0x08899999,0x88884498,0x8889b98c,0x84888889,0xa8888800,0x00000000,\n0x00000000,0x08999999,0x88894888,0x8888998c,0xc4888889,0xa8888880,0x00000000,\n0x00000000,0x88999999,0x998b4888,0x48888884,0xd488888b,0x9a899880,0x00000000,\n0x00000000,0x09999994,0x444448a8,0x48888894,0xb4888988,0x88889800,0x00000000,\n0x00000000,0x99994444,0xb8848889,0x4bc888cd,0xbdc88889,0x88a88880,0x00000000,\n0x00000008,0x98800998,0x88448a84,0x48ccc9c4,0xb4c88889,0x99aa8888,0x88000000,\n0x00000008,0x80000944,0x44488984,0x8899ccc0,0x00cc8888,0x99aa9888,0x88000000,\n0x00000000,0x00000448,0x88889844,0x899cc000,0x000c8999,0x999a9998,0x88800000,\n0x00000000,0x00000888,0x88998448,0x888c0000,0x000cc999,0x99999999,0x88800000,\n0x00000000,0x00000888,0x9a998489,0x89cc0000,0x0000b889,0x99999999,0x88800000,\n0x00000000,0x0000889a,0x99800099,0x98b00000,0x00000889,0x999aa999,0x88880000,\n0x00000000,0x0000899a,0x99800099,0x88000000,0x00000088,0x9999aa99,0x98800000,\n0x00000000,0x008999a9,0x98800089,0x80000000,0x00000088,0x99999999,0x98800000,\n0x00000000,0x08999999,0x88000088,0x00000000,0x00000088,0x99988999,0x98000000,\n0x00000000,0x08999888,0x00000000,0x00000000,0x00000088,0x89888888,0x88000000,\n0x00000008,0x89989880,0x00000000,0x00000000,0x00000008,0x88808888,0x80000000,\n0x00000088,0x99880000,0x00000000,0x00000000,0x00000000,0x88800088,0x00000000,\n0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000080,0x00000000,\n0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,\n0x00000000,0x00000000,0x00000000,0x09999900,0x00898000,0x00000000,0x00000000,\n0x80000000,0x00000000,0x00889999,0x99999999,0x99999980,0x00000000,0x00000000,\n0x88809999,0x99999000,0x99999999,0x99898899,0x99998900,0x00000000,0x00000000\n);\n\n//TEXTURE\nconst int[169] th=int[](-65536,-65409,-65409,-65409,-65536,-65297,-65297,-65297,-520093945,\n-251658481,-251658481,-117539041,-17293441,-1044481,-1044481,-2095105,14745351,15793935,\n14745351,14714887,-1998585849,-1048561,-2097145,-2097145,0,0,0,0,0,905216,8387840,12582656,\n33554304,33554368,67108800,67108800,100663264,134217696,67108832,134217696,134217696,\n67108832,134217696,100663264,67108800,67108800,33554304,33554304,12582656,8387840,905216,0,\n0,0,0,0,0,0,248,131312,327904,950512,1917176,252,1015808,1015808,623872,2723456,2596160,\n5750432,6389760,5354464,492000,108475584,494369280,1045888296,2104883860,7601498,1062207508,\n863371136,863371196,1062549948,1064647100,1064697788,1064683452,7456640,116608,0,0,0,786680,\n1966320,1966304,4129008,201326840,4129020,1835008,1973248,1457664,43417428,64946108,\n64749624,6127104,1432190634,2130706686,2135739646,2021654256,1040187772,654311244,654311244,\n1056964476,1056964476,1056964476,1056964476,1056866172,1056718716,1056448380,1056448380,\n1056448380,0,0,0,0,16777216,16777216,33554432,69206016,134217728,16777216,33554432,71303168,\n16777216,100663296,136314880,69206016,134217728,16777216,33554432,71303168,16777216,\n100663296,136314880,268959744,16777216,16777216,0,16777216,16777216,16777216,58720256,0,\n29360576,65012704,133171184,131074000,266866664,533995476,535437290,1072971764,2146140139,\n2146729972,-1507352,-655371,-1441815,1610309627,-1342459909,1265847155,1127564085,0);\nconst int[169] tl=int[](524543,4325631,268964032,8388800,2425087,537927935,8519704,35914264,\n-1182264931,2017608222,1008199740,-1085279491,1337982450,389823720,1115168322,-2001101551,\n-542993,-1183229026,-1867382899,-1997275185,-8943378,-4484899,1534179726,-1225523249,\n4193280,1371808650,105128544,170644560,-1842351031,570425220,973078492,1207656418,\n1205349346,-408665657,-1618406151,-2025815583,-275625737,-1088421251,-1903672975,-31451905,\n-28834561,-1904197263,-1088420739,-275642121,-2017443359,-1618406151,-408665657,1204300770,\n1207656418,973078492,570425220,-1842351031,170644560,105128544,1371808650,4193280,256,508,\n131580,328184,688624,1131000,2269692,4186622,1065471,2049792,4147840,6246720,6251168,\n11485520,10452984,11488272,268402576,428854192,586122744,1106182868,-2098330262,-1310043,\n1089470443,2129526911,2129657410,2129657458,2129657458,2129657458,2129657458,2146434686,\n16514624,262080,256,786940,1704444,3211768,3211760,476086776,528450044,478052862,270770175,\n272444160,402477566,402497790,398278722,398196724,-4523521,-21300739,-16777219,-50332679,\n-2013267697,2046820082,2097152250,2035807474,2100296442,2035809522,2104490746,2038430962,\n2105539322,2038428914,2105539322,2038428914,2105539322,2147483646,8388736,25166208,25166208,\n58721152,62915520,242225136,471605244,2146467824,264245184,375398368,262148064,1064845304,\n246419440,467410940,471605244,2146467824,264245184,375398368,262148064,1064845304,246419440,\n467410940,2010611711,-21037058,46138304,130025408,48235488,113248192,46138304,73402336,\n31457760,66061296,133695480,268177404,528359294,521543446,1047215723,2048227861,-468982773,\n-401283052,-1072971765,-2145943529,655370,1441814,-1610309628,1342459908,-1265847156,\n-53805878,841626154);\n\n//PALETTE\nconst vec4[16] tp=vec4[](\n    vec4(.00,.67,0,1),vec4(0,0,0,1),vec4(.13,.23,.93,1),vec4(1.00,1.00,1.00,1),\n    vec4(.00,.67,0,1),vec4(0,0,0,1),vec4(.79,.30,.05,1),vec4(1.00,0.60,0.23,1),\n    vec4(.00,.67,0,1),vec4(0,0,0,1),vec4(.79,.30,.05,1),vec4(0.95,0.74,0.24,1),\n    vec4(1.0,.67,0,1),vec4(0,0,0,1),vec4(.79,.30,.05,1),vec4(0.95,0.74,0.24,1)\n);\n\n//CAMERA POS\nconst int cpn=42;const int[cpn] cp=int[](\n    0x1020431C,0x10284018,//01mountain village\n    0x04143530,0x20203630,//02lake village\n    0x40302138,0x1020183C,//03west castle\n    0x0018143D,0x10201040,//04west coast\n    0x40301266,0x20202060,//05west cape\n    0x2018335E,0x2024345C,//06bay west village    \n    0x20202350,0x2020234F,//07river village\n    0x18203140,0x18203240,//08inland villages\n    0x0010542A,0x282A5430,//09east castle\n    0x20205448,0x2020504C,//10east villages\n    0x50285868,0x20205860,//11east cape\n    0x10284854,0x10284954,//12bay east village\n    0x40284058,0x30204058,//13south bay\n    0x20204052,0x00164250,//14delta castle\n    0x00104240,0x00144230,//15river 2 lake\n    0x10204026,0x18283F25,//16cliff villages\n    0x33332E20,0x081E2E1B,//17upstream castle\n    0x10201E26,0x20241A28,//18west village\n    0x2028101C,0x10201210,//19west bay\n    0x18282414,0x202A3C12,//20north mountain\n    0x202C4210,0x2030450F //21start castle\n);\nvec4 c2v(int n){\n    n=cp[(n+cpn)%cpn];\n    return vec4(float((n>>8)&255)*.5,float((n>>24)&255)*.0625,float((n)&255)*-.5+52.,3.5-float((n>>16)&255)*pi/128.);\n}\n\n//GET TEXTURE COLOR ID\nint ti(int x,int y){x&=31;y%=169;return ((th[y]>>(31-x))&1)*2+((tl[y]>>(31-x))&1); }\n\n//GET MAP TILE ID\nint mt(int mx,int my){mx%=56;my%=52;my=51-my;return (fm[(mx>>3)+my*7]>>(28-(mx&7)*4))&15;}\n\n//SHADOW\nfloat gs(ivec2 p,ivec2 q,int w){\n    return ((q.x-p.x)*(q.x+w-p.x)>0)||((q.y-p.y)*(q.y+16-p.y)>0)?1.:floor(float(p.y-q.y)/4.)/8.+.5;\n}\n\n//GET GROUND PALETTE ID\nint gnd(int x,int y, out float sv){\n    int mx=((x+17920)%1792)>>5,my=((y+16640)%1664)>>5;\n    int tx=((x+4000)&31)>>3,ty=((y+4000)&31)>>3;\n    int cx=(x+4000)&7,cy=7-(y+4000)&7;\n    int tile=mt(mx,my);\n    int tb=(tile>>2)&3;\n    ivec4 t=ivec4(tb*0x01010101);\n    sv=1.;\n    if(tb<2){\n    //water\n        //cape\n        if(mt(mx+ 1,my+51)>7)t[0]=(t[0]&0xffffff00)|0x00000005;\n        if(mt(mx+ 1,my+ 1)>7)t[3]=(t[3]&0xffffff00)|0x00000004;\n        if(mt(mx+55,my+ 1)>7)t[3]=(t[3]&0x00ffffff)|0x07000000;\n        if(mt(mx+55,my+51)>7)t[0]=(t[0]&0x00ffffff)|0x06000000;\n        //beach\n        int e;\n        e=mt(mx,my+51);bool e0=((e>7)&&(e<13));\n        e=mt(mx+ 1,my);bool e1=((e>7)&&(e<13));\n        e=mt(mx,my+ 1);bool e2=((e>7)&&(e<13));\n        e=mt(mx+55,my);bool e3=((e>7)&&(e<13));\n        if(e0){t[0]=0x0a0a0a0a;}\n        if(e1){        \n            t[0]=(t[0]&0xffffff00)|0x00000009;t[1]=(t[1]&0xffffff00)|0x00000009;\n            t[2]=(t[2]&0xffffff00)|0x00000009;t[3]=(t[3]&0xffffff00)|0x00000009;\n        }\n        if(e2){t[3]=0x08080808;}\n        if(e3){\n            t[0]=(t[0]&0x00ffffff)|0x0b000000;t[1]=(t[1]&0x00ffffff)|0x0b000000;\n            t[2]=(t[2]&0x00ffffff)|0x0b000000;t[3]=(t[3]&0x00ffffff)|0x0b000000;\n        }\n        //bay\n        if(e0&&e1){t[0]=(t[0]&0xffff0000)|0x00001a1b;t[1]=(t[1]&0xffffff00)|0x00000017;}\n        if(e1&&e2){t[2]=(t[2]&0xffffff00)|0x00000013;t[3]=(t[3]&0xffff0000)|0x00000e0f;}\n        if(e2&&e3){t[2]=(t[2]&0x00ffffff)|0x10000000;t[3]=(t[3]&0x0000ffff)|0x0c0d0000;}\n        if(e3&&e0){t[0]=(t[0]&0x0000ffff)|0x18190000;t[1]=(t[1]&0x00ffffff)|0x14000000;}\n    }else{\n    //ground\n        t=ivec4(0x02020202);\n        if(tb==3){\n        //bricks\n            t[1]=0x02030302;t[2]=0x02030302;\n            //road\n            if(mt(mx,my+51)>11){t[0]=(t[0]&0xff0000ff)|0x00030300;}\n            if(mt(mx+ 1,my)>11){t[1]=(t[1]&0xffffff00)|0x00000003;t[2]=(t[2]&0xffffff00)|0x00000003;}\n            if(mt(mx,my+ 1)>11){t[3]=(t[3]&0xff0000ff)|0x00030300;}\n            if(mt(mx+55,my)>11){t[1]=(t[1]&0x00ffffff)|0x03000000;t[2]=(t[2]&0x00ffffff)|0x03000000;}\n        }\n    }\n    //shadow\n    ivec2 p=ivec2(x&31,y&31);\n    if(tile==9){\n        sv=min(gs(p,ivec2(5,0),5),gs(p,ivec2(21,0),5));\n        sv=min(gs(p,ivec2(13,16),5),sv);\n    }else if(tile==10){\n        sv=min(gs(p,ivec2(0,0),31),gs(p,ivec2(0,16),31));\n    }else if(tile==11){\n        sv=gs(p,ivec2(1,0),29);\n    }\n    //palette\n    int chr=(t[ty]>>(24-tx*8))&255;\n    int pb=chr==3?4:0;\n    return ti(cx+(chr&3)*8,cy+(chr>>2)*8)+pb;\n}\n\n//COLLISION\nivec2 obj(vec3 p,vec3 oo,vec2 ob){\n    vec3 p1=oo-p,p2=p1+vec3(ob,0);\n    ivec2 r=ivec2(-1);\n    if((p1.x*p2.x>0.)||(p1.y*p2.y>0.))return r;\n    r.x=int(abs(p1.x)*32.);\n    r.y=int(abs(p1.y)*32.);\n    return r;\n}\n\n//WATER\nfloat noise2d(vec2 p){return fract(sin(dot(p,vec2(12.9898,78.233)))*43758.5453123);}\nfloat gl(vec3 p){\n    p.xz-=floor(iTime*.1);\n    p.y+=fract(iTime*.25);\n    p=floor(p*32.);\n    return noise2d(vec2(noise2d(p.xy),p.z));\n}\n\n//MAIN\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec4 c=vec4(1);\n    //camera\n    vec2 uv=(fragCoord-.5*iResolution.xy)/iResolution.y;uv.y=-uv.y;\n    float bt=.5+iTime*BPM/240.;\n    int cn=int(floor(bt))%cpn;\n    vec4 cam=mix(c2v(cn),c2v(cn+1),fract(bt));\n    vec3 ro=cam.xyz+.5,rd=normalize(vec3(uv,-sqrt(max(1.+dot(uv, uv)*(uv.y+.25)*.3,0.))));\n    rd.yz*=rot(cam.w);\n\n    //scenery\n    vec3 p=vec3(0);\n    int x,y,t=0,e=0,g=0,co=0;\n    float d=1.-fract(ro.z),l=0.;//ray length\n    ivec2 ip;\n    vec3 oo;\n    for(int i=ZERO;i<40;i++){\n        l=abs(d/rd.z);d+=.50001;p=ro+rd*l;\n        oo=floor(vec3(p.x,0,p.z));\n        x=int(oo.x),y=int(oo.z);\n        t=mt(x,y);\n        if((t>8)&&((t&12)==8)){\n            if((t&3)==2){\n                //mountain1\n                ip=obj(p,oo,vec2(1,.59));\n                if(ip.y>-1){e=ti(ip.x,168-ip.y);co=4;}\n            }else if((t&3)==1){\n                //forest1\n                ip=obj(p,oo,vec2(1,.937));\n                if(ip.y>-1){e=ti(ip.x&15,149-ip.y)+ti(16+(ip.x&15),149-ip.y)*4;co=4;}\n            }else{\n                //building\n                ip=obj(p,oo,vec2(1,1));\n                if(ip.y>-1){\n                    int v=x+y*56;\n                    if((v==2665)||(v==2291)||(v==2319)||(v==1890)||(v==1468)||(v==984)){\n                        e=ti(ip.x,119-ip.y);co=0;\n                    }else{\n                        e=ti(ip.x,87-ip.y);co=8;\n                    }\n                }\n            }\n        }\n        if((e>0)||(p.y<0.))break;\n        l=abs(d/rd.z);d+=.5;p=ro+rd*l;\n        oo=floor(vec3(p.x,0,p.z));\n        x=int(oo.x),y=int(oo.z);\n        t=mt(x,y);\n        if(t==8)continue;\n        if((t&12)==8){\n            if((t&3)==2){\n                //mountain2\n                oo.z-=.5;\n                ip=obj(p,oo,vec2(1,.59));\n                if(ip.y>-1){e=ti(ip.x,168-ip.y);co=4;}\n            }else if((t&3)==1){\n                //forest2\n                oo.x+=.25;\n                oo.z-=.5;\n                ip=obj(p,oo,vec2(.5,.937));\n                if(ip.y>-1){e=ti(ip.x&15,149-ip.y)+ti(16+(ip.x&15),149-ip.y)*4;co=4;}\n            }\n        }\n        if((e>0)||(p.y<0.))break;\n    }\n    float dp,sv;\n    l=abs(ro.y/rd.y);\n    if(e>0){\n        //objects\n        e+=co;\n        dp=length(p-ro)/FAR;\n        c=clamp(vec4(tp[e].rgb,dp),0.,1.);\n    }else if((rd.y<-.01)&&(l<60.)){\n        //ground\n        l=abs(ro.y/rd.y);\n        p=ro+rd*l;\n        x=int(p.x*32.);\n        y=int(p.z*32.);\n        dp=length(p-ro)/FAR;\n        c=clamp(vec4(tp[gnd(x,y,sv)].rgb,dp),0.,1.);\n        if(c.b>.8){\n            c.rgb=c.g<.5?vec3(.2,.6+rd.y*.5,.8):c.rgb;\n            c.rgb=mix(vec3(.25,.3,.25),c.rgb,clamp((rd.y*2.+1.5),.5,1.));\n            c.rg*=gl(p)+.5;\n        }\n        c.rgb*=sv;\n    }else{\n        //sky\n        dp=0.;\n        c=vec4(.3,.7-rd.y*.5,.9,1);\n    }\n    //fog\n    c.rgb=mix(c.rgb,vec3(.4,.6,.5),clamp(dp*2.-1.1,0.,1.));\n    fragColor=c;\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"//==================================================\n// King of Kings - Field\n// Sound:synthesizer & sequencer\n\nconst float base=440.;//master tuning (Hz)\nconst float bpm=BPM;  //tempo\nconst float start=2.; //start count (beats)\nconst float fade=.15; //fade out time (sec)\nconst float sec=180.; //performance time (includes start and fade)\n\nconst float drive=.45;\nconst float pressure=1.;\nconst int   delayrepeat=2;\nconst float delaywet=.3;\nconst float delayfb=.5;\nconst float delaytime=.155;\n\n//----------------------------------------\n// SCC ROM\n\nconst int[64] wt=int[](\n  //0:Bass 1:Bell 2:Vibe 3:Saw 4:PSGSquare 5:HalfSaw 6:Noise1 7:Noise2\n    0x40404000,0x407F4000,0xC080C000,0x407F4000,0xC0004000,0xE0002000,0xF0001000,0xF8000800,\n    0x0B3A6178,0x7D6F4F23,0xF2C39C85,0x808EAEDA,0x0B48727D,0x6633F2B5,0x8B8097CA,0x0B5DF2B0,\n    0x1C4B563E,0x16FB0024,0x55757047,0x0DE1D5EB,0x10261AEE,0xB48B86A6,0xD7FB00E5,0xBDA5B0DF,\n    0x80889098,0xA1A9B1B9,0xC2CAD2DA,0xE3EBF3FB,0x040C141C,0x252D353D,0x464E565E,0x676F777F,\n    0x7F7F7F7F,0x7F7F7F7F,0x7F7F7F7F,0x7F7F7F7F,0x00000000,0x00000000,0x00000000,0x00000000,\n    0x7F6F5F4F,0x3F2F1F0F,0xFFEFDFCF,0xBFAF9F8F,0x80808080,0x80808080,0x80808080,0x80808080,\n    0xBDC612B7,0x54A92708,0x8E96239B,0x3FD371F9,0xCABC2A4F,0xEB463EA7,0x0688E1DB,0x85DF34C5,\n    0xFF92D8FC,0x0944FC8D,0xA1049D9A,0xF6547236,0xB7B15E45,0xFBE63E46,0x2413B8F7,0xF744F3C2\n);\n\n//----------------------------------------\n// Sequencer ROM\n\n//pattern parameters\n//  instrument(4) 0:Bass 1:Bell 2:Vibe 3:Saw 4:PSGSquare 5:HalfSaw\n//  detune(1)     1:enable(+5cent)\n//  envelope(3)   0:env1 1:env2 2:env3 3:env4 4-7:<reserved>\n//  volume(4)     0:mute ... 15:max\n//  panpot(4)     1:-7 right 8:+0 center 15:+7 left 0:<reserved>\n//  unused(16)\n\nconst int[13] pp=int[](0x00080000,\n    0x41670000, //01 bass1\n    0x52480000, //02 melody1\n    0x5A260000, //03 melody1 delay(3/8)\n    0x11390000, //04 chord1\n    0x11380000, //05 chord2\n    0x113C0000, //06 chord3\n    0x113B0000, //07 chord4\n    0x19480000, //08 melody2(unison)\n    0x113A0000, //09 melody2 delay(2/8)\n    0x21370000, //0A melody3(battle theme)\n    0x21290000, //0B melody3 delay(1/8)\n    0x0B690000  //0C bass2\n);\n\n//note pattern\n//  0:rest  1-F:note\nconst int[107] np=int[](0x00000000,\n  //01 bs v1   02 bs v1   03 bs v1   04 bs v1   05 bs v1   06 bs v2   07 bs v2   08 bs v2\n    0x66666611,0x14455555,0x14455777,0x66660555,0x50555505,0x11111111,0x11888888,0x11222222,\n  //09 bs v2   0A bs v3   0B m1 v1   0C m1 v1   0D m1 v1   0E m1 v1   0F m1 v1   10 m1 v2\n    0x11555555,0x11117777,0x00C1580C,0x158BBBBB,0x158B0EEE,0xC158CC25,0x9CE269EE,0x11111111,\n  //11 m1 v2   12 m1 v2   13 m1 v2   14 m1 v2   15 m1 v3   16 m1 v3   17 m1 v3   18 m1 v3\n    0x66655511,0x33333311,0x33113333,0x33334411,0x88114488,0x11448811,0x44881144,0xCC115588,\n  //19 m1 ed   1A m1 ed   1B c1-4 v1 1C c1-4 v1 1D c1-4 v1 1E c1-4 v1 1F c1-4 v1 20 c1-4 v1\n    0xCC11DD22,0x5588CC11,0x11111111,0x22211111,0x22211333,0x11111222,0x11000000,0x11222222,\n  //21 c1-4 v1 22 c1-4 v2 23 c1-4 v2 24 c1-4 v2 25 c1-4 v2 26 c1-4 v2 27 c1-4 v2 28 c1-4 v2\n    0x22211000,0x22221111,0x11333333,0x22111111,0x00001111,0x33331111,0x11112222,0x11222222,\n  //29 c1-4 v2 2A m3 v3   2B m3 v3   2C m3 v3   2D m3 v3   2E m3 v3   2F m3 v3   30 m3 v3\n    0x11000000,0x11668899,0x00111111,0x1166BB00,0x22001122,0x11669988,0x11222211,0x11444444,\n  //31 m3 ed   32 m3 ed   33 m3 ed   34 d1 v1   35 d1 v1   36 d1 v1   37 d1 v1   38 d1 v1\n    0x11001111,0x00001100,0x11110000,0x00000C15,0x80C158BB,0xBBB00C15,0x80C158C0,0xEEE00C15,\n  //39 d1 v1   3A d1 v1   3B d1 v2   3C d1 v2   3D d1 v2   3E d1 v2   3F d1 v2   40 d1 v2\n    0xBBBC158C,0xB148BD15,0x16644444,0x11111111,0x11122211,0x51155555,0x31111111,0x33333113,\n  //41 d1 v2   42 d1 v3   43 d1 v3   44 d1 v3   45 d1 v3   46 d1 v3   47 d1 v3   48 d1 v3\n    0x11133333,0x55588114,0x48811448,0x81144881,0x14488114,0x6AA88114,0x14499225,0x37788114,\n  //49 d1 v3   4A d1 v3   4B d1 v3   4C d1 v3   4D d1 ed   4E d1 ed   4F d1 ed   50 d2 v3\n    0x8CCCC115,0x588CC115,0x577CC115,0x799CC115,0x355CC115,0x588CC11D,0xC115577C,0x00881144,\n  //51 d2 v3   52 d2 v3   53 d2 v3   54 d2 v3   55 d2 v3   56 d2 v3   57 d2 v3   58 d2 v3\n    0x88114488,0x11448811,0x44881144,0xAA881144,0x33881144,0x77881144,0xCCCC1155,0x88CC1155,\n  //59 d2 v3   5A d2 v3   5B d2 ed   5C d2 ed   5D d2 ed   5E d3 v3   5F d3 v3   60 d3 v3\n    0x77CC1155,0x99CC1155,0x55CC1155,0x88CC11DD,0x115588CC,0x01166889,0x20011111,0x81166BB0,\n  //61 d3 v3   62 d3 v3   63 d3 v3   64 d3 v3   65 d3 v3   66 d3 v3   67 d3 v3   68 d3 ed\n    0x02200112,0x91166889,0x91166998,0x11122221,0x81166998,0x11144444,0xB1166998,0x13300333,\n  //69 d3 ed   6A d3 ed\n    0x10000220,0x01111000\n);\n//gate time pattern\n//  0:note on or rest start  1-F:time from last note on\nconst int[71] gp=int[](0x01234567,\n  //01 bs v1   02 bs v1   03 bs v1   04 bs v1   05 bs v1   06 bs v2   07 bs v2   08 bs v3\n    0x00890100,0x80801234,0x80808012,0x0120F012,0x0F0120F0,0x000089A0,0x89000000,0x00008900,\n  //09 bs v3   0A bs v3   0B bs v3   0C m1 v1   0D m1 v1   0E m1 v1   0F m1 v1   10 m1 v2\n    0x89ABCDEF,0x89AB0000,0x890089AB,0xFF0000F0,0x00001234,0x0000F012,0x00000000,0x01234567,\n  //11 m1 v2   12 m1 v2   13 m1 v2   14 m1 v2   15 m1 v2   16 m1 v3   17 c1-4 v1 18 c1-4 v1\n    0x89ABCDEF,0x01201201,0x01234501,0x89010123,0x01230101,0x01010101,0x00890100,0x80801234,\n  //19 c1-4 v1 1A c1-4 v1 1B c1-4 v1 1C c1-4 v1 1D c1-4 v1 1E c1-4 v2 1F c1-4 v2 20 c1-4 v2\n    0x80808012,0x01208012,0x08012080,0x08FFFFFF,0x80808FFF,0x89AB0120,0x89012345,0xFFFF0120,\n  //21 c1-4 v2 22 m3 v3   23 m3 v3   24 m3 v3   25 m3 v3   26 m3 v3   27 m3 v3   28 m3 v3\n    0x89FFFFFF,0x01010101,0xFF012301,0x010101FF,0x01FF0101,0x23012301,0x23012345,0xFFFF01FF,\n  //29 m3 v3   2A d1 v1   2B d1 v1   2C d1 v1   2D d1 v1   2E d1 v1   2F d1 v1   30 d1 v1\n    0x0101FFFF,0xFFFFF000,0x0F000001,0x234FF000,0x0F00000F,0x012FF000,0x23400000,0x00000000,\n  //31 d1 v2   32 d1 v2   33 d1 v2   34 d1 v2   35 d1 v2   36 d1 v2   37 d1 v2   38 d1 v3\n    0x00001234,0x89ABCDEF,0x01201201,0x20101234,0x50123456,0x89ABC010,0x01201234,0x12301010,\n  //39 d1 v3   3A d2 v3   3B d2 v3   3C d3 v3   3D d3 v3   3E d3 v3   3F d3 v3   40 d3 v3\n    0x10101010,0xFF010101,0x01010101,0xF0101010,0x1FF01230,0x1010101F,0xF01FF010,0x10101010,\n  //41 d3 v3   42 d3 v3   43 d3 v3   44 d3 ed   45 d3 ed   46 d3 ed\n    0x12301230,0x12301234,0x50101010,0x501FF010,0x1FFFF01F,0xF0101FFF\n);\n\n//note sequence\n//  key(8) A4:0x45 C2:0x24 C3:0x30 C4:0x3C C5:0x48 E2:0x28 E3:0x34 E4:0x40 E5:0x4C\n//  note pattern(8)\n//  gate pattern(8)\n//  parameters(8)\n\n//KEY (MIDI Note_Numbers)_    __    __ __    __    __ __    __    __    __ __    __    __ __    __    __    __\n//|C1|__|D1|__|E1|F1|__|G1|__|A1|__|B1|C2|__|D2|__|E2|F2|__|G2|__|A2|__|B2|C3|__|D3|__|E3|F3|__|G3|__|A3|__|B3|\n//|18 19 1A 1B 1C|1D 1E 1F 20 21 22 23|24 25 26 27 28|29 2A 2B 2C 2D 2E 2F|30 31 32 33 34|35 36 37 38 39 3A 3B|\n//|__    __    __ __    __    __    __|__    __    __ __    __    __    __|__    __    __ __    __    __    __|\n//|C4|__|D4|__|E4|F4|__|G4|__|A4|__|B4|C5|__|D5|__|E5|F5|__|G5|__|A5|__|B5|C6|__|D6|__|E6|F6|__|G6|__|A6|__|B6|\n//|3C 3D 3E 3F 40|41 42 43 44 45 46 47|48 49 4A 4B 4C|4D 4E 4F 50 51 52 53|54 55 56 57 58|59 5A 5B 5C 5D 5E 5F|\n\n//BASS1\nconst int sl3=84;const int[sl3] sq3=int[](\n    0x1C010101,0x1C020201,0x1C010101,0x1C030301,0x1C010101,0x1C020201,0x1C010101,0x1C030301,\n    0x1C010101,0x1C020201,0x1C010101,0x1C030301,0x1C010101,0x1C020201,0x1C040401,0x1C050501,\n    0x1C060601,0x1C070701,0x1C060601,0x1C080701,0x1C060601,0x1C070701,0x1C060601,0x1C090701,\n    0x1C060601,0x1C070701,0x1C060601,0x1C080701,0x1C060601,0x1C070701,0x1C060601,0x1C090701,\n    0x1C060601,0x1C070701,0x1C060601,0x1C080701,0x1C060601,0x1C070701,0x1C060601,0x1C090701,\n    0x1C060601,0x1C070701,0x1C060601,0x1C080701,0x1C060601,0x1C070701,0x1C060601,0x1C090701,\n    0x20060801,0x20060901,0x20060801,0x20060901,0x1E060801,0x1E060901,0x1F060801,0x1F060901,\n    0x20060801,0x20060901,0x20060801,0x20060901,0x1E060801,0x1E060901,0x1F060801,0x1F060901,\n    0x1C060801,0x1C060901,0x1C060801,0x1C060901,0x21060801,0x21060901,0x21060801,0x21060901,\n    0x1A060801,0x1A060901,0x1A060801,0x1A060901,0x1F060801,0x1F060901,0x1F060801,0x1F060901,\n    0x1C060801,0x1C0A0A01,0x22060B01,0x00000000\n);\n//MELODY1\nconst int sl4=84;const int[sl4] sq4=int[](\n    0x430B0C02,0x430C0D02,0x430B0C02,0x430D0E02,0x430B0C02,0x430C0D02,0x430B0C02,0x430D0E02,\n    0x430B0C02,0x430C0D02,0x430B0C02,0x430D0E02,0x430B0C02,0x430C0D02,0x430E0F02,0x430F0F02,\n    0x4E101002,0x4E101102,0x4E101102,0x4A111202,0x4C121302,0x4C101102,0x4C101102,0x4A131402,\n    0x4E101002,0x4E101102,0x4E101102,0x4A111202,0x4C141502,0x4C101102,0x4C101102,0x4A131402,\n    0x4E101002,0x4E101102,0x4E101102,0x4A111202,0x4C121302,0x4C101102,0x4C101102,0x4A131402,\n    0x4E101002,0x4E101102,0x4E101102,0x4A111202,0x4C141502,0x4C101102,0x4C101102,0x4A131402,\n    0x48151602,0x48161602,0x48171602,0x48151602,0x46151602,0x46161602,0x46171602,0x47151602,\n    0x48151602,0x48161602,0x48171602,0x48151602,0x46151602,0x46161602,0x46171602,0x47151602,    \n    0x43181602,0x43181602,0x43181602,0x43181602,0x43181602,0x43181602,0x43181602,0x43181602,\n    0x41181602,0x41181602,0x41181602,0x41181602,0x41181602,0x41181602,0x41181602,0x41181602,\n    0x43181602,0x43191602,0x441A1602,0x00000000\n);\n//MELODY1 DELAY\nconst int sl5=84;const int[sl5] sq5=int[](\n    0x43342A03,0x43352B03,0x43362C03,0x43372D03,0x43382E03,0x43352B03,0x43362C03,0x43372D03,\n    0x43382E03,0x43352B03,0x43362C03,0x43372D03,0x43382E03,0x43352B03,0x43392F03,0x443A3003,\n    0x4B3B3103,0x4E3C3203,0x4E3C3203,0x4E3D3303,0x4A3E3403,0x4C3F3503,0x4C3C3203,0x4A403603,\n    0x4C413703,0x4E3C3203,0x4E3C3203,0x4E3D3303,0x4A3E3403,0x4C3F3503,0x4C3C3203,0x4A403603,\n    0x4C413703,0x4E3C3203,0x4E3C3203,0x4E3D3303,0x4A3E3403,0x4C3F3503,0x4C3C3203,0x4A403603,\n    0x4C413703,0x4E3C3203,0x4E3C3203,0x4E3D3303,0x4A3E3403,0x4C3F3503,0x4C3C3203,0x4A403603,\n    0x48423803,0x48433903,0x48443903,0x48453903,0x46463903,0x46433903,0x46443903,0x46473903,\n    0x48483903,0x48433903,0x48443903,0x48453903,0x46463903,0x46433903,0x46443903,0x46473903,\n    0x43493903,0x434A3903,0x434A3903,0x434A3903,0x434A3903,0x434B3903,0x434B3903,0x434B3903,\n    0x414C3903,0x414A3903,0x414A3903,0x414A3903,0x414A3903,0x414B3903,0x414B3903,0x414B3903,\n    0x434D3903,0x434E3903,0x444F3903,0x00000000\n);\n//CHORD1 & MELODY2(UNISON)\nconst int sl6=84;const int[sl6] sq6=int[](\n    0x431B1704,0x421C1804,0x431B1704,0x421D1904,0x431B1704,0x421C1804,0x431B1704,0x421D1904,\n    0x431B1704,0x421C1804,0x431B1704,0x421D1904,0x431B1704,0x421C1804,0x431E1904,0x441B1B04,\n    0x43221E04,0x431B1F04,0x431B1E04,0x43231F04,0x43261E04,0x431B1F04,0x431B1E04,0x43281F04,\n    0x43221E04,0x431B1F04,0x431B1E04,0x43231F04,0x43261E04,0x431B1F04,0x431B1E04,0x43281F04,\n    0x43221E04,0x431B1F04,0x431B1E04,0x43231F04,0x43261E04,0x431B1F04,0x431B1E04,0x43281F04,\n    0x43221E04,0x431B1F04,0x431B1E04,0x43231F04,0x43261E04,0x431B1F04,0x431B1E04,0x43281F04,\n    0x3C151608,0x3C161608,0x3C171608,0x3C151608,0x3A151608,0x3A161608,0x3A171608,0x3B151608,\n    0x3C151608,0x3C161608,0x3C171608,0x3C151608,0x3A151608,0x3A161608,0x3A171608,0x3B151608,    \n    0x37181608,0x37181608,0x37181608,0x37181608,0x37181608,0x37181608,0x37181608,0x37181608,\n    0x35181608,0x35181608,0x35181608,0x35181608,0x35181608,0x35181608,0x35181608,0x35181608,\n    0x37181608,0x37191608,0x381A1608,0x00000000\n);\n//CHORD2 & MELODY2 DELAY\nconst int sl7=84;const int[sl7] sq7=int[](\n    0x421B1705,0x411C1805,0x421B1705,0x41211D05,0x421B1705,0x411C1805,0x421B1705,0x41211D05,\n    0x421B1705,0x411C1805,0x421B1705,0x41211D05,0x421B1705,0x411C1805,0x421B1905,0x421F1C05,\n    0x42252005,0x421B1F05,0x421B1E05,0x41241F05,0x41271E05,0x421B1F05,0x421B1E05,0x42292105,\n    0x42252005,0x421B1F05,0x421B1E05,0x41241F05,0x41271E05,0x421B1F05,0x421B1E05,0x42292105,\n    0x42252005,0x421B1F05,0x421B1E05,0x41241F05,0x41271E05,0x421B1F05,0x421B1E05,0x42292105,\n    0x42252005,0x421B1F05,0x421B1E05,0x41241F05,0x41271E05,0x421B1F05,0x421B1E05,0x42292105,\n    0x3C503A09,0x3C513B09,0x3C523B09,0x3C533B09,0x3A543B09,0x3A513B09,0x3A523B09,0x3B553B09,\n    0x3C563B09,0x3C513B09,0x3C523B09,0x3C533B09,0x3A543B09,0x3A513B09,0x3A523B09,0x3B553B09,\n    0x37573B09,0x37583B09,0x37583B09,0x37583B09,0x37583B09,0x37583B09,0x37583B09,0x37583B09,\n    0x355A3B09,0x35583B09,0x35583B09,0x35583B09,0x35583B09,0x35583B09,0x35583B09,0x35583B09,\n    0x375B3B09,0x375C3B09,0x385D3B09,0x00000000\n);\n//CHORD3 & MELODY3(BATTLE THEME)\nconst int sl8=84;const int[sl8] sq8=int[](\n    0x3E1B1706,0x3D1C1806,0x3E1B1706,0x3D1D1906,0x3E1B1706,0x3D1C1806,0x3E1B1706,0x3D1D1906,\n    0x3E1B1706,0x3D1C1806,0x3E1B1706,0x3D1D1906,0x3E1B1706,0x3D1C1806,0x3E1E1906,0x3F1B1B06,\n    0x3E221E06,0x3E1B1F06,0x3E1B1E06,0x3E231F06,0x3E261E06,0x3E1B1F06,0x3E1B1E06,0x3E281F06,\n    0x3E221E06,0x3E1B1F06,0x3E1B1E06,0x3E231F06,0x3E261E06,0x3E1B1F06,0x3E1B1E06,0x3E281F06,\n    0x3E221E06,0x3E1B1F06,0x3E1B1E06,0x3E231F06,0x3E261E06,0x3E1B1F06,0x3E1B1E06,0x3E281F06,\n    0x3E221E06,0x3E1B1F06,0x3E1B1E06,0x3E231F06,0x3E261E06,0x3E1B1F06,0x3E1B1E06,0x3E281F06,\n    0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,\n    0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,\n    0x422A220A,0x492B230A,0x422C240A,0x492D250A,0x422A220A,0x492B230A,0x422C240A,0x492D250A,\n    0x422E220A,0x492F260A,0x422E220A,0x4930270A,0x422E220A,0x492F260A,0x422E220A,0x4930270A,\n    0x4E31250A,0x4F32280A,0x4F33290A,0x00000000\n);\n//CHORD4 & MELODY3 DELAY\nconst int sl9=84;const int[sl9] sq9=int[](\n    0x3B1B1707,0x3A1C1807,0x3B1B1707,0x3A1D1907,0x3B1B1707,0x3A1C1807,0x3B1B1707,0x3A1D1907,\n    0x3B1B1707,0x3A1C1807,0x3B1B1707,0x3A1D1907,0x3B1B1707,0x3A1C1807,0x3B1B1907,0x3B201C07,\n    0x3B221E07,0x3B1B1F07,0x3B1B1E07,0x3B281F07,0x3B221E07,0x3B1B1F07,0x3B1B1E07,0x3B281F07,\n    0x3B221E07,0x3B1B1F07,0x3B1B1E07,0x3B281F07,0x3B221E07,0x3B1B1F07,0x3B1B1E07,0x3B281F07,\n    0x3B221E07,0x3B1B1F07,0x3B1B1E07,0x3B281F07,0x3B221E07,0x3B1B1F07,0x3B1B1E07,0x3B281F07,\n    0x3B221E07,0x3B1B1F07,0x3B1B1E07,0x3B281F07,0x3B221E07,0x3B1B1F07,0x3B1B1E07,0x3B281F07,\n    0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,\n    0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,\n    0x425E3C0B,0x495F3D0B,0x42603E0B,0x49613F0B,0x4262400B,0x495F3D0B,0x42603E0B,0x49613F0B,\n    0x4263400B,0x4964410B,0x4265400B,0x4966420B,0x4267430B,0x4964410B,0x4265400B,0x4966420B,\n    0x4C68440B,0x4E69450B,0x4F6A460B,0x0000000B\n);\n//BASS2\nconst int slA=84;const int[slA] sqA=int[](\n    0x1C01010C,0x1C02020C,0x1C01010C,0x1C03030C,0x1C01010C,0x1C02020C,0x1C01010C,0x1C03030C,\n    0x1C01010C,0x1C02020C,0x1C01010C,0x1C03030C,0x1C01010C,0x1C02020C,0x1C04040C,0x1C05050C,\n    0x1C06060C,0x1C07070C,0x1C06060C,0x1C08070C,0x1C06060C,0x1C07070C,0x1C06060C,0x1C09070C,\n    0x1C06060C,0x1C07070C,0x1C06060C,0x1C08070C,0x1C06060C,0x1C07070C,0x1C06060C,0x1C09070C,\n    0x1C06060C,0x1C07070C,0x1C06060C,0x1C08070C,0x1C06060C,0x1C07070C,0x1C06060C,0x1C09070C,\n    0x1C06060C,0x1C07070C,0x1C06060C,0x1C08070C,0x1C06060C,0x1C07070C,0x1C06060C,0x1C09070C,\n    0x2006080C,0x2006090C,0x2006080C,0x2006090C,0x1E06080C,0x1E06090C,0x1F06080C,0x1F06090C,\n    0x2006080C,0x2006090C,0x2006080C,0x2006090C,0x1E06080C,0x1E06090C,0x1F06080C,0x1F06090C,\n    0x1C06080C,0x1C06090C,0x1C06080C,0x1C06090C,0x2106080C,0x2106090C,0x2106080C,0x2106090C,\n    0x1A06080C,0x1A06090C,0x1A06080C,0x1A06090C,0x1F06080C,0x1F06090C,0x1F06080C,0x1F06090C,\n    0x1C06080C,0x1C0A0A0C,0x22060B0C,0x00000000\n);\n\n//rhythm pattern\n//  0:note on  1-E:time from last note on  F:rest\nconst int[49] rp=int[](0xFFFFFFFF,\n    0xF0001F01,0x01F01F00,0xF001FF00,0xFFF001FF,0xF0010100,0xF00101FF,0xffffffff,0xffffffff, //01 clsd hihat\n    0xFFFFFFFF,0xFFFFFF00,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff, //09 hand clap\n    0x012FFFF0,0xF0012FFF,0x012012FF,0x01012012,0x012FF012,0xffffffff,0xffffffff,0xffffffff, //11 kick\n    0xFFFF012F,0xF012FF00,0xFFF012FF,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff, //19 snare\n    0x0012FF00,0x00120120,0xFFFF0012,0xFF01012F,0xFF012012,0xFF0012FF,0xF012FFFF,0xffffffff, //21 conga\n    0xFFFFFFFF,0x012012FF,0xFFFFFF00,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff  //29 cowbell\n);\n\n//percussion sequence\n//  gate pattern(8)x4\nconst int sl1=84;const int[sl1] sq1=int[](\n    0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,\n    0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,0x03091319,0x0409141A,\n    0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,\n    0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,\n    0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,\n    0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,0x01091119,0x02091219,\n    0x0509151B,0x060A151B,0x0509151B,0x060A151B,0x0509151B,0x060A151B,0x0509151B,0x060A151B,\n    0x0509151B,0x060A151B,0x0509151B,0x060A151B,0x0509151B,0x060A151B,0x0509151B,0x060A151B,\n    0x0509151B,0x060A151B,0x0509151B,0x060A151B,0x0509151B,0x060A151B,0x0509151B,0x060A151B,\n    0x0509151B,0x060A151B,0x0509151B,0x060A151B,0x0509151B,0x060A151B,0x0509151B,0x060A151B,\n    0x0509151B,0x060A151B,0x0509151B,0x060A151B\n);\nconst int sl2=84;const int[sl2] sq2=int[](\n    0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,\n    0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x2A2B2325,\n    0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,\n    0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x2A2B2325,\n    0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,\n    0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x29292225,0x29292124,0x2A2B2325,\n    0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,\n    0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,\n    0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,\n    0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,0x29292124,0x2A2B2325,\n    0x29292124,0x29292225,0x29292124,0x2A2B2325\n);\n\n//----------------------------------------\n// Amplifier\n//  vec3 p( drive, pressure, volume)\nvec2 amp(vec2 i,vec3 p){return clamp(sign(i)*pow(abs(i*p.x)*.01,vec2(1./p.y))*100.,-1.,1.)*p.z;}\n\n//----------------------------------------\n// Panpot\nfloat stereo=.5;\nvec2 panpot(int n){\n    float p=float(n-8);\n    float p1=.8-(abs(p)*.2)*stereo,p2=.8+(abs(p)*.06)*stereo;\n    return p<0.?vec2(p1,p2):vec2(p2,p1);\n}\n\n//----------------------------------------\n// Envelope\nfloat env1(float r,float t){float v=max(1.-t*r,0.);return v>0.?v*v:0.;}\nfloat env2(float r,float t){float v=max(1.-t*r,.75-t*r*.125);return v>0.?v*v:0.;}\nfloat env3(float r,float t){float v=max(1.-t*r,.5);return v>0.?v*v:0.;}\nfloat env4(float r,float t){float v=max(min(1.-t*r,6.-t*r*3.),.0);return v>0.?v*v:0.;}\n\n//----------------------------------------\n// SCC Oscillator\nconst float i128=1./128.;\nfloat scc(float x,int i){\n    int pos=int(mod(x*32.,32.));\n    return float((((wt[(i<<3)+(pos>>2)]>>(24-((pos&3)<<3)))&255)^128)-128)*i128;\n}\n\n//----------------------------------------\n// Percussion Oscillator\nfloat sd(float f,float t){\n    float o=scc(290.*t,6)*scc(270.*t,7)*env2(20.,t);\n    o+=clamp(sin((f-t*f*.3)*t+scc(t*42.,6)*.4)*3.,-1.,1.)*env1(6.,t);\n    return o;\n}\nfloat bd(float f,float t){\n    return clamp(sin((f-t*f*3.)*t+scc(t*160.,6)*.4)*5.,-1.,1.)*env1(11.,t);\n}\nfloat hh(float f,float t){return scc(f*t,6)*scc((f*.969)*t,7)*env1(20.,t);}\nfloat cl(float f,float t){return clamp(scc(f*t*.31,6)*scc(f*t*.1,7)*5.,-1.,1.)*env1(7.,t);}\nfloat cb(float f,float t){return (scc(f*t*.75,4)+scc(f*t,4)+scc(f*.29*t,6)*.3)*env1(10.,t)*.5;}\nfloat co(float f,float t){return scc(f*t,3)*scc(f*t*.61,5)*env1(12.,t);}\n\n//----------------------------------------\n// Frequency From MIDI Note Number\nconst float i12=1./12.;\nfloat freq(float n){return pow(2.,(n-69.)*i12)*base;}\n\n//----------------------------------------\n// Sequencer\nint bar;\nint tick;\nfloat tt;\nfloat tl;\nconst float i6=1./6.;\nconst float i15=1./15.;\nvec2 getNote(int sq){\n    vec2 o=vec2(0);\n    int n=(np[(sq>>16)&255]>>(28-(tick<<2)))&15;\n    if(n==0)return o;\n    int k=(sq>>24)&255,p=pp[sq&255],g=(gp[(sq>>8)&255]>>(28-(tick<<2)))&15;\n    int m=(p>>30)&1,i=(p>>28)&7,e=(p>>24)&7,s=(p>>16)&15;\n    float v=float((p>>20)&15)*i15,t=tt+tl*float(g);\n    if((e&2)==0){v*=(e&1)==0?env1(2.5,t):env2(2.5,t);}\n            else{v*=(e&1)==0?env3(2.0,t):env4(3.5,t);}\n    float f=freq(float(k+n-1)+float((p>>27)&1)*.05);\n    o+=panpot(s)*scc(f*t,i)*v;\n    return o;\n}\nvec2 getDrum(int sq){\n    vec2 o=vec2(0);\n    int h=(rp[(sq>>24)&255]>>(28-(tick<<2)))&15;\n    int c=(rp[(sq>>16)&255]>>(28-(tick<<2)))&15;\n    int b=(rp[(sq>>8)&255]>>(28-(tick<<2)))&15;\n    int s=(rp[sq&255]>>(28-(tick<<2)))&15;\n    o+=h<15?panpot(7)*hh(440.,tt+tl*float(h))*.4:vec2(0);\n    o+=c<15?panpot(7)*cl(440.,tt+tl*float(c))*.6:vec2(0);\n    o+=b<15?panpot(8)*bd(480.,tt+tl*float(b))*.6:vec2(0);\n    o+=s<15?panpot(10)*sd(903.,tt+tl*float(s))*.6:vec2(0);\n    return o;\n}\nvec2 getPerc(int sq){\n    vec2 o=vec2(0);\n    int c=(rp[(sq>>24)&255]>>(28-(tick<<2)))&15;\n    int b=(rp[(sq>>16)&255]>>(28-(tick<<2)))&15;\n    int l=(rp[(sq>>8)&255]>>(28-(tick<<2)))&15;\n    int m=(rp[sq&255]>>(28-(tick<<2)))&15;\n    o+=c<15?panpot(7)*cb(840.,tt+tl*float(c))*.5:vec2(0);\n    o+=b<15?panpot(7)*cb(440.,tt+tl*float(b))*.5:vec2(0);\n    o+=l<15?panpot(8)*co(904.,tt+tl*float(l))*.3:vec2(0);\n    o+=m<15?panpot(10)*co(1400.,tt+tl*float(m))*.3:vec2(0);\n    return o;\n}\nvec2 sequencer(float time){\n    vec2 o=vec2(0);\n    if(time<0.)return o;\n    tl=15./bpm;\n    tick=int(time/tl);\n    tt=mod(time,tl);\n    bar=tick>>3;\n    tick&=7;\n    o+=getDrum(sq1[bar%sl1]); //drums\n    o+=getPerc(sq2[bar%sl2]); //percussion\n    o+=getNote(sq3[bar%sl3]); //bass\n    o+=getNote(sq4[bar%sl4]); //melody1\n    o+=getNote(sq5[bar%sl5]); //melody1 delay\n    o+=getNote(sq6[bar%sl6]); //chord1 & melody2\n    o+=getNote(sq7[bar%sl7]); //chord2 & melody2 delay\n    o+=getNote(sq8[bar%sl8]); //chord3 & melody3\n    o+=getNote(sq9[bar%sl9]); //chord4 & melody3 delay\n    o+=getNote(sqA[bar%slA]); //bass2\n    return o;\n}\n\n//----------------------------------------\n// Master\nvec2 mainSound( int samp, float time )\n{\n    vec2 o=vec2(0);\n    float vol=1.;if(time>sec-fade){vol=(sec-min(time,sec))/fade;}\n    time-=start*60./bpm;if(time<0.)return o;\n    stereo=0.5;\n    o+=sequencer(time);\n    float d=delaywet,r=delaytime;\n    for(int i=0;i<delayrepeat;i++){\n        stereo+=0.3/float(delayrepeat);\n        time-=delaytime;if(time<0.)continue;\n        r+=delaytime;\n        o+=sequencer(time)*d;\n        d*=delayfb;\n    }\n    return amp(o,vec3(drive,pressure,vol));\n}\n","name":"Sound","description":"","type":"sound"}]}