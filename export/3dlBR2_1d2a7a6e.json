{"ver":"0.1","info":{"id":"3dlBR2","date":"1588643478","viewed":279,"name":"Gate505","username":"gaz","description":"random music","likes":9,"published":1,"flags":8,"usePreview":0,"tags":["music"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":3,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// soundin shader by FabriceNeyret2\n#define C(c) U.x-=.5; T+= U.x<.0||U.x>1.||U.y<0.||U.y>1. ?vec4(0): textureGrad(iChannel3, U/16. + fract( vec2(c, 15-c/16) / 16.), dFdx(U/16.),dFdy(U/16.) )\n#define initMsg vec4 T = vec4(0)\n#define endMsg  return length(T.yz)==0. ? 0. : T.x\n\nfloat message(vec2 U) { // to alter in the icon with the alter message\n    vec4 T = vec4(0);   // or: initMsg;\n    C(83);C(111);C(117);C(110);C(100);C(32);C(105);C(110); // message \"Sound in\"\n    return length(T.yz)==0. ? -1. : T.x; // or: endMsg;\n} // EOL soundin shader\n\n#define rot(a) mat2(cos(a),sin(a),-sin(a),cos(a))\n#define G(a,n)a=abs(a)-n;a*=rot(1.)\n#define t iTime\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor=vec4(0);\n    // call soundin shader \n\tif (iResolution.y<2000.) {float c=message((fragCoord/iResolution.y-vec2(0.05,0.1))*10.0);if(c>=0.){fragColor=vec4(c);return;}}\n\t\n    // ++++++++++\n    vec3 p,q,rd=vec3((fragCoord*2.-iResolution.xy)/iResolution.y,1);\n    float g,e,i;\n\tfor(i=0.0;i++<50.0;)\n    {\n   \t\tq=p=g*rd;\n    \tp.xy*=rot(sin(t*.1+.5*sin(t*.3)));\n    \tp.z+=t*.1;\n    \tp=fract(p)-.5;\n    \tfor(int j=0; j<3;j++)\n        {\n       \t\tG(p.xz,.038);\n        \tG(p.xz,.061);\n  \t\t\tG(p.zy,.088);\n      \t}\n    \tg+=e=0.7*length(p.yz)-.003;\n        if(e<.01)\n        \tfragColor+=abs(sin(0.5*q.zyxz+30.*length(q)*sin(t*.3)+t))*.6/i;\n \t}\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"//\n#define BPM 82.\n#define tick (15./BPM)\n#define bar (tick*16.0)\n\n#define PI acos(-1.0)\n#define PIH PI*0.5\n#define TAU PI*2.0\nfloat osc_sin(float x){return sin(x*TAU);}\nfloat osc_saw(float x){return 1.0-fract(x)*2.0;}\nfloat osc_sqr(float x){return sign(0.5-fract(x));}\nfloat osc_tri(float x){return asin(sin(x*TAU))/PIH;}\n\nfloat note2freq(int n)\n{\n\treturn 440.0*exp2((float(n)-69.0)/12.0);\n}\n\nint major(int n)\n{\n    return n/7*12+int[](0,2,4,5,7,9,11)[n%7];\n}\n\nint seqOrder(int s,float t)\n{\n    int n =-1;\n    for(int i=0;i<=(int(t/tick)&15);i++)\n    {\n        if((s>>i&1)==1)n++;\n    }\n    return n;\n}\n\nfloat seqTime(int s,float t)\n{\n  float n = mod(t,tick);\n  int it = int(t/tick)&15;\n  for(int i=0;i<16;i++)\n  {\n    if((s>>(it-i)&1)==1)break;\n    n+=tick;\n  }\n  return n;\n}\n\nfloat kick(float t)\n{\n\treturn sin(315.*t-10.*exp(-50.*t))*exp(-t*3.0);;\n}\n\nfloat snare(float t)\n{\n    float g = fract(sin(t*1e5)*1e5)+6.0;\n    g= exp(-0.08*g*g)*40.0-1.0;    \n    float f=t*55.0;\n    float o2=0.2*osc_tri(1.2*f);\n    float o1=0.3*osc_sin(3.5*f+o2)* exp(-t*2.0);\n    float d=osc_sin(f+o1);  \n    return 0.6*g*min(t/0.01,exp(-(t-0.01)*15.0))+\n           0.4*d*exp(-t*7.0);\n}\n\nfloat hat(float t)\n{\n\treturn (fract(sin(t*99.0)*5e5)*2.0-1.0)*exp(-t*150.0);\n}\n\nfloat piano(float f, float t)\n{\n  float g=0.0,a,b=0.0;\n  for(float j=1.0;j<8.0;j++)\n  {\n      b+=a=exp(-j*0.5);\n      g+=a*osc_sin(f*j*t)*exp(-t*1.5/(1.0-j*0.1));\n  }\n  g *= 1.0+1.5*exp(-5.0*t);\n  return g/b;\n}\n\nfloat base(float f, float t)\n{\n\tf *= t;\n  \treturn clamp((\n        5.0*osc_sin(f)\n        +2.0*osc_sin(f*2.0)\n        +osc_sin(f*3.0)\n    \t)/8.0,-1.0,1.0)*exp(-5.0 * t);\n}\n\nvec2 mainSound( in int samp,float time)\n{\n    time=mod(time,bar*16.0);\n    float b=floor(time/bar);\n    int key=68;\n\tvec2 gain=vec2(0);\n\tfloat t;\n\tint o,n,s;\n\n    gain+=0.3*kick(seqTime(0x0581,time));\n\tgain+=0.2*snare(seqTime(0x1101,time));\n\tgain+=0.1*hat(seqTime(0x5555,time));\n\t\n\tint chord=int[](1,5,6,3,4,1,4,5)[int(b)]-1; \n    \n\tt=seqTime(0x1215,time);\n    gain+=0.3*(\n   \t    piano(note2freq(key-12+major(chord)),t) +\n\t    piano(note2freq(key-12+major(chord+2)),t) +\n\t    piano(note2freq(key-12+major(chord+4)),t) +\n\t    piano(note2freq(key-12+major(chord+6)),t)     \n\t    )/4.0;\n\ts=0x1111;\n\tt=seqTime(s,time);\n\to=seqOrder(s,time);\n\ts=int[](0,2,4,2,0)[o];\n\tgain+=0.2*base(note2freq(key - 24 + chord + major(s)), t);\n\t   \n \tt=time;    \n\tfloat i;\n\tfor(i=0.0;i<2000.0;i++){\n\t\tfloat g=floor(fract(sin(i*542456.0+32436.0))*4.0)*tick;\n\t\tif(t<g)break;\n\t\tt-=g;\n\t}\n    \n    s=0;\n    int shift=0;\n    for(int i=0;i<32;i++)\n    {\n        b+=15684.12;\n        b*=2.56;\n        s+=1<<shift;\n        shift+=int[](1,2,2,3,4,4)[int(fract(sin(b)*4378.123)*6.0)];\n        if (shift>31) break;\n    }\n    \n\tt=seqTime(s&0xFFFF,time);\n\tn=key+int[](0,1,3,4,6,7,9,10,12)[int(fract(sin(i*1276.0+1235.3))*9.0)];\n\tgain+=0.2*piano(note2freq(n), t);\n    gain*=mat2(2,3,8,-5);\n\n\treturn clamp(0.6*gain,-.95,.95);\n}","name":"Sound","description":"","type":"sound"}]}