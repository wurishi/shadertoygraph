{"ver":"0.1","info":{"id":"4tcGW2","date":"1471515781","viewed":2036,"name":"Simple Luma Sharpen","username":"xwize","description":"Sharpens an image using only the luma component by unsharp masking in YUV.","likes":14,"published":1,"flags":0,"usePreview":1,"tags":["2d","filter","sharpen"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dfGRn","filepath":"/media/a/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","previewfilepath":"/media/ap/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","type":"texture","channel":0,"sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"mat3 YUVFromRGB = mat3(\n   vec3(0.299,-0.14713, 0.615),\n   vec3(0.587,-0.28886,-0.51499),\n   vec3(0.114,0.436,-0.10001));\n\nmat3 RGBFromYUV = mat3(\n    vec3(1, 1, 1),\n    vec3(0.0,-0.394,2.03211),\n    vec3(1.13983,-0.580,0.0));\n\nfloat extractLuma(vec3 c)\n{\n    return c.r * 0.299 + c.g * 0.587 + c.b * 0.114;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    \n    vec4 s = texture(iChannel0,uv);\n    \n    vec3 yuv = YUVFromRGB * s.rgb;\n    \n    vec2 imgSize = vec2(512.0,512.0);\n    \n    float accumY = 0.0; \n    for(int i = -1; i <= 1; ++i) {\n        for(int j = -1; j <= 1; ++j) {\n            vec2 offset = vec2(i,j) / imgSize;\n            \n            float s = extractLuma(texture(iChannel0,uv + offset).rgb);\n            float notCentre = min(float(i*i + j*j),1.0);\n            accumY += s * (9.0 - notCentre*10.0);\n        }\n    }\n    \n    accumY /= 9.0;\n    \n    float gain = 0.9;\n    accumY = (accumY + yuv.x)*gain;\n    \n    if( mod(iTime,1.0) > 0.5)\n\t\tfragColor = vec4(RGBFromYUV * vec3(accumY,yuv.y,yuv.z),1.0); // sharpened\n    else\n    \tfragColor = s; // original\n    \n    \n}","name":"Image","description":"","type":"image"}]}