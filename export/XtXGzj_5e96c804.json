{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"texture","id":"XsfGRn","filepath":"/media/a/1f7dca9c22f324751f2a5a59c9b181dfe3b5564a04b724c657732d0bf09c99db.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":2,"type":"texture","id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"// Mate, also known as \"yerba mate\", is a traditional South American caffeine-rich infused drink\n\n#define RAYMARCH_STEPS 60\n\nconst float detail=0.005;\nconst vec3 lightpos=vec3(13.,30.,-25.);\n\nfloat specular;\nfloat ref=0.;\nfloat gall=0.;\nvec3 color=vec3(0.);\n\n\nmat2 rot2D(float angle) {\n\tfloat a=radians(angle);\n\treturn mat2(cos(a),sin(a),-sin(a),cos(a));\n}\n\n\nfloat salpicre(vec2 p) {\n\tp*=.025;\n\tfloat c=texture(iChannel0,p.xy).x;\t\n\tc+=texture(iChannel0,p.xy*2.).y*.5;\t\n\tc+=texture(iChannel0,p.xy*4.).z*.25;\t\n\treturn c*.05;\n}\n\nfloat texture1(vec3 p) {\n\tp=abs(.5-fract(p*2.));\n\tvec3 c=vec3(3.,2.,5.);\n\tfloat es, l=es=0.;\n\tfor (int i = 0; i < 10; i++) { \n\t\t\tp = abs(p + c) - abs(p - c) - p; \n\t\t\tp/= clamp(dot(p, p), .25, 1.);\n\t\t\tp = p* -1.5 + c;\n\t\t\tif ( mod(float(i), 2.) < 1. ) { \n\t\t\t\tfloat pl = l;\n\t\t\t\tl = length(p);\n\t\t\t\tes+= exp(-1. / abs(l - pl));\n\t\t\t}\n\t}\n\treturn es/10.;\n}\n\n\nfloat rand(vec2 co){\n\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nfloat cyl(vec3 p, vec2 c) {\n\treturn max(length(p.xz)-c.x,abs(p.y)-c.y);\n}\n\nfloat mesa(vec3 p) {\n\tp.y+=texture(iChannel1,p.xz*.04).z*.03;\n\treturn cyl(p+vec3(4.,1.6,5.),vec2(12.,.3));\t\n}\n\nfloat piso(vec3 p) {\n\treturn p.y+13.;\t\n}\n\nfloat pared1(vec3 p) {\n\treturn -p.z+25.+salpicre(p.xy);\t\n}\n\nfloat pared2(vec3 p) {\n\treturn p.x+35.+salpicre(p.zy);\t\n}\n\nfloat pared3(vec3 p) {\n\treturn (-p.x+20.+salpicre(p.zy));\t\n}\n\n\nfloat galleta(vec3 p, inout float c) {\n\tp.y-=-.1;\n\tp.x*=.8;\n\tc=length(sin(p.xz*16.))*.7-texture(iChannel0,p.xz*.06).x*.3;\n\tp.y-=c*.05+texture(iChannel0,p.xz*.15).y*.008;\n;\n\tfloat shape1=length(pow(abs(p),vec3(3.)));\n\tshape1=pow(abs(shape1),1./3.)-.8;\n\tfloat shape2=length(pow(abs(p-vec3(0.,1.3,0.)),vec3(3.)));\n\tshape2=pow(abs(shape2),1./3.)-.8;\n\treturn max(shape1,shape2);\n}\n\nfloat mate(vec3 p)\n{\n\tfloat c=sin(p.y*2.5)*(.03+(p.y+1.)*.03)-pow(abs(p.y-1.),.5)*.15-pow(abs(p.y+1.1),.3)*.12;\n\tc+=smoothstep(0.,1.,max(0.,-p.y)*.25);\n\tp.zx*=1.+c;\n\tfloat exter=cyl(p,vec2(1.,1.4));\n\tfloat inter=cyl(p-vec3(0.,.1,0.),vec2(.85,1.4));\n\treturn max(exter,-inter)*.9+texture(iChannel1,vec2(atan(p.x,p.z),p.y*.5)).x*.005;\n}\n\nfloat yerba(vec3 p) \n{\n\tfloat s=sin(iTime);\n\tfloat ag=cyl(p-vec3(0.,.58+s*.17,0.),vec2(.95,.1));\t\n\tp.y*=1.+p.x*.3;\n\tfloat y=texture(iChannel0, p.xz*.05).x;\n\ty+=texture(iChannel0, p.xz*.1).x*.5;\n\tfloat d=cyl(p-vec3(0.,.58,0.),vec2(.95,.1))-y*.065;\t\n\treturn min(d*.7,ag);\n}\n\nfloat bombilla(vec3 p) \n{\n\tp.y-=.5;\n\tp.xy*=rot2D(-32.-max(0.,p.y-1.5)*7.);\n\tp.x*=1.+pow(clamp(p.y-1.5,0.,1.),2.)*.5;\n\tp.z*=1.-pow(clamp(p.y-1.8,0.,1.),5.)*.15;\n\tfloat y=sin(p.y*50.+p.x*50.)*.015*pow(1.-min(1.,abs(p.y-2.)),4.);\n\tfloat exte=cyl(p-vec3(0.4,1.,0.),vec2(.09,2.))+y;\n\tfloat inte=cyl(p-vec3(0.4,1.05,0.),vec2(.08,2.))+y;\n\treturn max(exte,-inte)*.5;\n}\n\n\nfloat de(vec3 p) {\n\n\tref=gall=0.;\n\t\n\tfloat c1,c2;\n\tfloat ma=mate(p);\n\tfloat ye=yerba(p);\n\tfloat bo=bombilla(p);\n\tfloat me=mesa(p);\n\tfloat pis=piso(p);\n\tfloat pa1=pared1(p);\n\tfloat pa2=max(-p.z-30., min(pared2(p),pared3(p)));\n\n\tvec3 pc=p;\n\tpc+=vec3(4.,1.75,0.);\n\tpc.xz*=mat2(0.6428,0.766,-0.766,0.6428);//rot2D(50.);\n\tfloat cr1=galleta(pc,c1);\n\t\n\tpc=p;\n\tpc+=vec3(4.,1.65,0.8);\n\tpc.yz*=mat2(0.9848,-0.1736,0.1736,0.9848);//rot2D(-10.);\n\tpc.xz*=mat2(0.5,-0.866,0.866,0.5);//rot2D(-60.);\n\tfloat cr2=galleta(pc,c2);\n\n\tfloat d=min(ma,ye);\n\td=min(d,bo);\n\td=min(d,me);\n\td=min(d,pis);\n\td=min(d,pa1);\n\td=min(d,pa2);\n\td=min(d,cr1);\n\td=min(d,cr2);\n\n\tif (abs(d-bo)<.001) ref=1.;\n\tif (cr1+cr2<2.) gall=1.;\n\treturn d;\t\n}\n\nvec3 colorize(vec3 p) {\n\tvec3 color=vec3(0.);\n\tfloat c1,c2;\n\tfloat ma=mate(p);\n\tfloat ye=yerba(p);\n\tfloat bo=bombilla(p);\n\tfloat me=mesa(p);\n\tfloat pis=piso(p);\n\tfloat pa1=pared1(p);\n\tfloat pa2=max(-p.z-30., min(pared2(p),pared3(p)));\n\n\tvec3 pc=p;\n\tpc+=vec3(4.,1.75,0.);\n\tpc.xz*=rot2D(50.);\n\tfloat cr1=galleta(pc,c1);\n\t\n\tpc=p;\n\tpc+=vec3(4.,1.65,0.8);\n\tpc.yz*=rot2D(-10.);\n\tpc.xz*=rot2D(-60.);\n\tfloat cr2=galleta(pc,c2);\n\n\tfloat d=min(ma,ye);\n\td=min(d,bo);\n\td=min(d,me);\n\td=min(d,pis);\n\td=min(d,pa1);\n\td=min(d,pa2);\n\td=min(d,cr1);\n\td=min(d,cr2);\n\n\tref=0.; specular=0.;\n\t\n\t\tif (abs(ma-d)<.001) {\n\t\t\tspecular=.3;\n\t\t\tfloat c=pow(texture1(p)*1.15,1.3);\n\t\t\tcolor=vec3(c*.9,c*c*1.4,c*c*c)+.2;\n\t\t}\n\t\tif (abs(ye-d)<.001) {\n\t\t\tspecular=max(0.,p.x+1.3)*.35;\n\t\t\tfloat c=pow(texture(iChannel0, p.xz*.1).x,2.);\n\t\t\tfloat w=pow(texture(iChannel0, p.xz*.015).y,4.);\n\t\t\tcolor=mix(vec3(1.,.85,.5)*.3,vec3(1.,.8,0.1),c)*.6+w*vec3(1.,.9,.8)*.4;\n\t\t}\n\t\tif (abs(bo-d)<.001) {\n\t\t\tspecular=1.;\n\t\t\tcolor=vec3(.3);\n\t\t}\n\t\tif (abs(me-d)<.001) {\n\t\t\tvec3 tex=pow(texture(iChannel1,p.zx*.15).xyz,vec3(1.5))*vec3(.7,1.,1.)+.15;\n\t\t\tspecular=length(tex)*.5;\n\t\t\tcolor=vec3(1.,.8,.6)*tex*.35+.15;\n\t\t}\n\t\tif (abs(pis-d)<.001) {\n\t\t\tspecular=.1;\n\t\t\tcolor=vec3(.9,.95,1.)*(texture(iChannel2,p.xz*.05).xyz*.5+.1);\n\t\t}\n\t\tif (abs(pa1-d)<.001) {\n\t\t\tspecular=.07;\n\t\t\tcolor=texture(iChannel1,p.xy*.005).xxx*.2+.5;\n\t\t}\n\t\tif (abs(pa2-d)<.001) {\n\t\t\tspecular=.07;\n\t\t\tcolor=texture(iChannel1,p.zy*.005).xxx*.2+.5;\n\t\t}\n\t\tif (abs(cr1-d)<.001) {\n\t\t\tspecular=.1;\n\t\t\tcolor=mix(vec3(1.,.7,.5)*.8,vec3(1.,.65,.3),min(1.,c1))*.53;\n\t\t\tcolor*=1.-texture(iChannel0,p.xz*.05).y*.3;\n\t\t}\n\t\tif (abs(cr2-d)<.001) {\n\t\t\tspecular=.1;\n\t\t\tcolor=mix(vec3(1.,.7,.5)*.8,vec3(1.,.65,.3),min(1.,c2))*.53;\n\t\t\tcolor*=1.-texture(iChannel0,p.xz*.05).y*.3;\n\t\t}\n\treturn color;\n}\n\n\nvec3 normal(vec3 p, float d) {\n\tvec3 e = vec3(0.0,detail,0.0);\n\treturn normalize(vec3( de(p+e.yxx)-d, de(p+e.xyx)-d, de(p+e.xxy)-d) );\n}\n\nfloat AO( const vec3 pos, vec3 nor ) {\n\tfloat totao = 0.0;\n\tfloat pd=de(pos);\n\tfloat dd;\n\tif (gall>0.) dd=.07; else dd=.15;\n\tfloat aodet=dd*(1.+max(0.,pos.z*.15));\n\tfor( int aoi=1; aoi<5; aoi++ ) {\n\t\tfloat d=float(aoi)*aodet;\n\t\ttotao+=(d-de(pos+nor*d))*exp(-2.2*d);\n\t}\n    return clamp(1.-totao, 0., 1.0 );\n}\n\n\nvec3 light(in vec3 p, in vec3 dir, in vec3 n, in float sp, in vec3 col) {\n\tvec3 ldir=-normalize(lightpos-p);\n\tfloat ldist=distance(p,lightpos);\n\tfloat diff=max(0.,dot(ldir,-n))*exp(-.00015*ldist*ldist);\n\tdiff+=max(0.,dot(vec3(1.,0.,0.),-n))*.12;\n\tdiff+=max(0.,dot(vec3(0.,0.,-1.),-n))*.25;\n\tdiff+=max(0.,dot(vec3(0.,-1.,0.),-n))*.2;\n\tdiff+=max(0.,dot(vec3(0.,1.,0.),-n))*.12;\n\tdiff+=.15;\n\tdiff*=AO(p,n);\n\tvec3 r = reflect(ldir,n);\n\tfloat spec=pow(max(0.,dot(dir,-r)),15.);\n\tfloat c=texture1(p);\n\treturn (col*diff+spec*sp);\t\n\t\t}\n\nvec3 raymarch(in vec3 from, in vec3 dir) \n{\n\tvec3 lightdir=-normalize(lightpos-from);\n\tfloat totdist=0., refl=0.; \n\tvec3 col, refcol=col=vec3(0.);\n\tvec3 p,p2;\n\tfloat d=100.;\n\tvec3 norm=vec3(0.);\n\tvec3 odir=dir;\n\tp=p2=from;\n\tfor (int i=0; i<RAYMARCH_STEPS; i++) {\n\t\tif (d>detail) {\n\t\t\td=de(p);\n\t\t\tp+=d*dir;\n\t\t\ttotdist+=d; \n\t\t} \n\t}\n\n\tif (ref>0.) {\n\t\t\trefcol=light(p,dir,norm,specular,vec3(1.5));\n\t\t\trefl=.4;\n\t\t\tp-=d*dir;\n\t\t\tnorm=normal(p,d);\n\t\t\tdir=reflect(dir,-norm);\n\t\t\tp+=detail*2.*dir;\n\t\t\td=1.;\n\t\t\tfor (int i=0; i<40; i++) {\n\t\t\t\tif (d>detail) {\n\t\t\t\t\td=de(p);\n\t\t\t\t\tp+=d*dir;\n\t\t\t\t\ttotdist+=d; \n\t\t\t\t} \n\t\t\t}\n\t}\n\t\t\n\tp+=(d-detail)*dir;\n\tnorm=normal(p,de(p));\n\tcol=mix(light(p, dir, norm, specular, colorize(p)),refcol,refl); \n\tcol+=pow(max(0.,dot(dir,-lightdir)),2.)*refl;\n\tcol+=pow(max(0.,dot(odir,-lightdir)),2.5)*.5;\n\treturn col;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tfloat t=iTime*.2;\n\tvec2 ang;\n\tif (iMouse.z>0.) {\n\t\tang=iMouse.xy/iResolution.xy-.5;\n\t} else {\n\t\tang=vec2(sin(t*2.),cos(t))*.4;\n\t}\n\tmat2 camrot1=rot2D(ang.x*180.);\n\tmat2 camrot2=rot2D((ang.y-.5)*60.);\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\tuv=uv*2.-1.;\n\tuv.y*=iResolution.y/iResolution.x;\n\tvec3 from=vec3(-0.5,0.3,-8.5);\n\tfrom.yz*=camrot2;\n\tfrom.xz*=camrot1;\n\tvec3 dir=normalize(vec3(uv*.75,1.));\n\tdir.yz*=camrot2;\n\tdir.xz*=camrot1;\n\tvec3 col=vec3(0.);\n\tcol=raymarch(from,dir); \n\tcol*=vec3(1.,.9,.75)+.2;\n\tfragColor = vec4(col*1.2,1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XtXGzj","date":"1423183824","viewed":468,"name":"Mate ","username":"Kali","description":"Mate, also known as \"yerba mate\", is a traditional South American caffeine-rich infused drink","likes":16,"published":1,"flags":0,"usePreview":0,"tags":["df"],"hasliked":0,"parentid":"","parentname":""}}