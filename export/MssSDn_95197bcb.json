{"ver":"0.1","info":{"id":"MssSDn","date":"1456828955","viewed":133,"name":"CafeRaymarchExperiment2","username":"cafe","description":"CafeRaymarchExperiment2","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["caferaymarchexperiment2"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float PI=3.14159;\n\nfloat hash(float x){ return fract(sin(x)*43758.5453);}\nfloat hash(vec2 x){ return hash(hash(x.x)+x.y); }\nfloat hash(vec3 x){ return hash(hash(x.xy)*x.z); }\n\nfloat shash(vec3 x){\n\tvec3 ix=floor(x);\n\tvec3 fx=smoothstep(0.,1.,fract(x));\n\tvec3 e=vec3(1.,0.,0.);\n\t\n\t//return mix(ix,fx,0.5).x;\n\t\n\t/*\n\tvec2 r = vec2(vec4(vec2(ha1sh(ix+e.yyy),hash(ix+e.yxy)),vec2(hash(ix+e.xyy),hash(ix+e.xxy)))*fx.x),\n\t\t       (vec4(vec2(hash(ix+e.yyx),hash(ix+e.yxx)),vec2(hash(ix+e.xyx),hash(ix+e.xxx)))*fx.x)*fx.z;\n\t\n\t/*/\n\treturn\n\tmix(mix(mix(hash(ix+e.yyy),hash(ix+e.xyy),fx.x),\n\t\t\tmix(hash(ix+e.yxy),hash(ix+e.xxy),fx.x),fx.y),\n\t\tmix(mix(hash(ix+e.yyx),hash(ix+e.xyx),fx.x),\n\t\t\tmix(hash(ix+e.yxx),hash(ix+e.xxx),fx.x),fx.y),fx.z);\n\t//*/\n}\n\nfloat box(vec3 p, float d){\n\tp = abs(p)-d;\n\treturn min(max(p.x,max(p.y,p.z)),0.)+length(max(p,0.));\n}\nfloat box(vec2 p, float d){\n\treturn box(vec3(p,0.),d);\n}\nfloat crossb(vec3 p){\n\treturn min(box(p.xy,1.),min(box(p.xz,1.),box(p.yz,1.)));\n}\n\nfloat cube(vec3 p){\n\t\n\t//p=normalize(p)*dot(p,vec3(1.));\n\t\n\tfloat d = box(p,1.0);\n\n   float s = 1.0;\n   for( int m=0; m<4; m++ )\n   {\n      vec3 a = mod( p*s, 2.0 )-1.0;\n      s *= 3.0;\n      vec3 r = 1.0 - 3.0*abs(a);\n\n      float c = crossb(r)/s;\n      d = max(d,c);\n   }\n\treturn d+0.01*sin(iTime*-3.+length(p)*10.);\n\n}\n\n\nvec3 tex(vec3 p, float mat){\n\tvec3 color;\n\t\n\t\n\t\n\tif(mat==0.){\n\t\tfloat d=5.;\n\t\tvec3 md = vec3(0.15,0.05,0.1);\n\t\tcolor=vec3(smoothstep(-0.1,0.1,sin(p.x*d)*sin(p.y*d)*sin(p.z*d)));\n\t\tcolor.r=smoothstep(0.35,0.65,color.r);\n\t\tcolor.g=smoothstep(0.45,0.55,color.b);\n\t\tcolor.b=smoothstep(0.4,0.6,color.g);\n\t\tcolor=mix(color,vec3(0.1,0.3,0.6),0.35);\n\t}\n\t\n\tif(mat==1.){\n\t\tcolor=vec3(1.5,1.1,0.8)*(sin(length(p)*10.)*0.1+0.6);\n\t}\n\t\n\treturn clamp(color,0.,1.);\n}\n\nvec2 map(vec3 p){\n\tfloat d=5.;\n\tvec2 t0=vec2(5.-max(abs(p.x),max(abs(p.y),abs(p.z))),0.);\n\tvec2 t1=vec2(cube(p),1.);\n\tif(t1.x<t0.x)t0=t1;\n\treturn t0;\n}\n\nvec3 normal(vec3 p){\n\tvec3 e=vec3(0.001,0.,0.);\n\tvec3 n=vec3(\n\t\tmap(p+e.xyy).x-map(p-e.xyy).x,\n\t\tmap(p+e.yxy).x-map(p-e.yxy).x,\n\t\tmap(p+e.yyx).x-map(p-e.yyx).x);\n\treturn normalize(n);\n}\n\nvec2 intersect(vec3 ro, vec3 rd){\n\tconst int iter=200;\n\tconst float mint=0.0005;\n\tfloat t=0.;\n\tfor(int i=0 ; i<iter ; i++){\n\t\tvec2 h = map(ro+t*rd);\n\t\tif(h.x<mint*1.) return vec2(t,h.y);\n\t\tt+=max(mint*t,h.x);\n\t}\n\treturn vec2(-1.);\n}\n\n\nvec3 shade(vec2 uv){\n    \n    vec2 mouse = (2.*iMouse.xy-iResolution.xy)/iResolution.y;\n\t\n\tvec3 ro=vec3(sin(mouse.x*PI/2.)*2.,sin(mouse.y*PI/2.)*2.,2.);\n\tro.z=cos(length(ro.xy)*PI/2.)*0.1+1.9;\n\t\n\tvec3 lat=vec3(0.,0.,0.);\n\tvec3 dir = normalize(lat-ro);\n\tvec3 axr  = normalize(cross(dir,vec3(0.,1.,0.)));\n\tvec3 axu  = normalize(cross(axr,dir));\n\tvec3 rd = normalize(uv.x*axr+uv.y*axu+dir);\n\t\n\tvec2 t = intersect(ro,rd);\n\tvec3 color=vec3(0.);\n\t\n\tif(t.y>=0.){\n\t\tvec3 p = ro+t.x*rd;\n\t\tvec3 n = normal(p);\n\t\tvec3 l = normalize(vec3(1.,1.,1.));\n\t\t\n\t\t\t\t\n\n\t\t\n\t\t\n\t\tfloat amb=0.5+0.5*n.y;\n\t\tfloat dif=pow(max(0.,dot(n,l)),3.);\n\t\tfloat brightness=(sin(length(p)*2.+iTime)+2.)/2.5;\n\t\t\n\t\tcolor  = amb*vec3(0.2);\n\t\tcolor += dif;//-hash(floor(p*10.-0.5))*(length(fract(p*10.)-0.5)*-1.+0.5);\n\t\tcolor += brightness;\n\t\tcolor *= tex(p,t.y);\n\t\t\n\t}\n\t\n\treturn vec3(color);\t\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n\tvec2 uv = (2.*fragCoord.xy-iResolution.xy)/iResolution.y;\n\tfragColor = vec4(shade(uv),1.0);\n}","name":"Image","description":"","type":"image"}]}