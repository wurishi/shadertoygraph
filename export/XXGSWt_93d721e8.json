{"ver":"0.1","info":{"id":"XXGSWt","date":"1720596122","viewed":54,"name":"Jump Flood Algorithm","username":"twixuss","description":".","likes":2,"published":1,"flags":32,"usePreview":0,"tags":["sdf","flood","jump","algorithm","fill","jfa"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Click to Draw\n// voronoi diagram and distance field will be computed shortly after\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec4 canvas = texelFetch(iChannel0, ivec2(fragCoord), 0);\n    if (canvas.x > 0.5) {\n        fragColor = vec4(1);\n    } else {\n        vec4 diagram = texelFetch(iChannel1, ivec2(fragCoord), 0);\n        // .xy = position of closest drawn pixel\n        // .z  = distance to that pixel\n        \n        fragColor = vec4(diagram.xy / iResolution.xy, 0, 1);\n        fragColor.b = smoothstep(0.8, 1.0, sin(diagram.z * 0.5));\n    }\n    fragColor.a = 1.;\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"// .x = 1 if drawn, 0 if empty\n\n#define DRAW(P) \\\n    if (distance(fragCoord, P) < 8.) { \\\n        fragColor = vec4(1); \\\n    }\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor = texelFetch(iChannel0, ivec2(fragCoord), 0);\n    if (iFrame == 0) {\n        fragColor = vec4(0);\n        DRAW(iResolution.xy * vec2(0.125, 0.125));\n        DRAW(iResolution.xy * vec2(0.25, 0.75));\n        DRAW(iResolution.xy * vec2(0.75, 0.5));\n        DRAW(iResolution.xy * vec2(0.5, 0.25));\n    } else {\n        if (iMouse.z > 0.5) {\n            DRAW(iMouse.xy);\n        }\n    }\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"// .xy = position of closest drawn pixel\n// .z  = distance to that pixel\n// .w  = is 0 when not initialized\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    int maxResolution = int(max(iResolution.x, iResolution.y));\n    int passCount = int(ceil(log2(float(maxResolution))));\n    int passIndex = (iFrame / int(iFrameRate * 0.75)) % (passCount + 1); // Add 1 for initialization pass\n    \n    fragColor = texelFetch(iChannel1, ivec2(fragCoord), 0);\n        \n    if (passIndex == 0) {\n        // Initializate buffer with positions of drawn pixels on canvas\n        \n        vec4 canvas = texelFetch(iChannel0, ivec2(fragCoord), 0);\n        \n        if (canvas.r > 0.5) {\n            fragColor = vec4(fragCoord.xy, 0, 1);\n        } else {\n            fragColor = vec4(0);\n        }\n    } else {\n        passIndex -= 1;\n\n        float inf = 999999999.0;\n\n        float closestDist = inf;\n        vec2 closestPos = vec2(0);\n\n        for (int x = -1; x <= 1; ++x) {\n            for (int y = -1; y <= 1; ++y) {\n                vec2 offset = vec2(x, y) * exp2(float(passCount - passIndex - 1));\n                vec4 diagram = texelFetch(iChannel1, ivec2(fragCoord + offset), 0);\n                if (diagram.w > 0.5) {\n                    float l = distance(diagram.xy, fragCoord);\n                    if (l < closestDist) {\n                        closestDist = l;\n                        closestPos = diagram.xy;\n                    }\n                }\n            }\n        }\n        \n        if (closestDist < inf) {\n            fragColor = vec4(closestPos, closestDist, 1);\n        }\n    }\n    \n}","name":"Buffer B","description":"","type":"buffer"}]}