{"ver":"0.1","info":{"id":"td2BDm","date":"1590223205","viewed":93,"name":"mouse double click","username":"kastorp","description":"didn't find one, so I built my own","likes":3,"published":1,"flags":32,"usePreview":0,"tags":["mouse"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const vec2 _mouse = vec2(0, 0);\nconst vec2 _mouseDblClk = _mouse + vec2(1, 0);    \n#define loadVar(c) texture(iChannel0, vec2((floor(c) + 0.5) / iChannelResolution[0].xy), 0.0)\n\n/*----------------------------------------------------------------\n//\n//  example usage: \n//     CYAN: last double click\n//\t   RED: last click\n//\t   YELLOW: double click event in current frame\n//---------------------------------------------------------------*/\nvoid mainImage( out vec4 o, in vec2 c )\n{\n    vec3 dblClk=  loadVar(_mouseDblClk).xyz;\n    vec4 clk=  loadVar(_mouse);\n    if(length(c-dblClk.xy)<10.)o = vec4(0.,1.,1.,1.);\n    else if(length(c-clk.xy)<10.) o = vec4(1.,0.,0.,1.);\n\telse if(dblClk.z>0.)o = vec4(1.,1.,0.,1.);\n    else  o = vec4(.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"const vec2 _mouse = vec2(0, 0);\nconst vec2 _mouseDblClk = _mouse+ vec2(1, 0);    \nconst vec2 _old = vec2(0, 1) ; \nconst float _mouse_buffer=32.;\n#define loadVar(c) texture(iChannel0, vec2((floor(c) + 0.5) / iChannelResolution[0].xy), 0.0)\n#define storeVar( mc,value, o,  c)  if( c.x >= mc.x && c.y >= mc.y && c.x < (mc.x + 1.) && c.y < (mc.y + 1. )){  o = value; }\n\nbool mouseDoubleClick(inout vec4 o, in vec2 c){   \n    if(iMouse.z <1. ) {  \n        int changeCount=0;\n        for(int i=0;i<int(_mouse_buffer);i++){\n            int mouseChange=(loadVar(_old *vec2(i) + _mouse ).z>0.?0:1)\n                +(loadVar( _old * vec2(i+1) +_mouse ).z>0.?0:1);\n\n            if(mouseChange==1)changeCount++;\n            if(loadVar(_mouseDblClk).x>0.) {storeVar(_mouseDblClk,vec4(loadVar(_mouseDblClk).xy,vec2(0.)),o,c);return false;}                              \n            if(changeCount>2){               \n                if(length(loadVar(_mouse).xy -loadVar(_old * vec2(i+1) +_mouse).xy)>10.) return false;\n                storeVar(_mouseDblClk,vec4(loadVar(_old * vec2(i+1) +_mouse).xy,vec2(1.)),o,c);\n                return true;\n            }         \n        }\n    }\n    storeVar(_mouseDblClk,vec4(-10.),o,c);\n    return false; \n}\n\n// 2 x 32  pixels used (adjust _mouse_buffer to resize)\n// \n// column 0=  mouse\n// column 1=  mouse double click  (xy), double click called (z)\n// row 0 = current value\n// row i = value at the previous i-th frame \nvoid mainImage( out vec4 o, in vec2 c )\n{   \n    vec2 tc = floor(c);\t\n    if ( tc.x <  2. && tc.y < (_mouse_buffer-1.)) {\n        if (tc.y == 0.) {\n            bool dblClk =mouseDoubleClick(o,tc);\n            storeVar(_mouse, iMouse, o,tc);         \n        }\n        else o = loadVar(tc- _old);            \n    }\n    else discard;             \n}\n        \n","name":"Buffer A","description":"","type":"buffer"}]}