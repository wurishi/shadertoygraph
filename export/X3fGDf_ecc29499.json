{"ver":"0.1","info":{"id":"X3fGDf","date":"1707982415","viewed":49,"name":"ICtCp space visualizer","username":"StarlightSource","description":"LC projection of ICtCp","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["template"],"hasliked":0,"parentid":"4XX3Wf","parentname":"Jzazbz space visualizer"},"renderpass":[{"inputs":[{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float L_sdr = 203.0;\n\nconst float GAMMA = 2.4;\nconst float L_W = 1.0;\nconst float L_B = L_W / 1000.0;\n\nfloat bt1886_r(float L, float gamma, float Lw, float Lb) {\n    float a = pow(pow(Lw, 1.0 / gamma) - pow(Lb, 1.0 / gamma), gamma);\n    float b = pow(Lb, 1.0 / gamma) / (pow(Lw, 1.0 / gamma) - pow(Lb, 1.0 / gamma));\n    float V = pow(max(L / a, 0.0), 1.0 / gamma) - b;\n    return V;\n}\n\nvec3 bt1886_r_3(vec3 x) {\n    return vec3(\n        bt1886_r(x.r, GAMMA, L_W, L_B),\n        bt1886_r(x.g, GAMMA, L_W, L_B),\n        bt1886_r(x.b, GAMMA, L_W, L_B)\n    );\n}\n\nconst float pq_m1 = 0.1593017578125;\nconst float pq_m2 = 78.84375;\nconst float pq_c1 = 0.8359375;\nconst float pq_c2 = 18.8515625;\nconst float pq_c3 = 18.6875;\n\nconst float pq_C  = 10000.0;\n\nfloat Y_to_ST2084(float C) {\n    float L = C / pq_C;\n    float Lm = pow(L, pq_m1);\n    float N = (pq_c1 + pq_c2 * Lm) / (1.0 + pq_c3 * Lm);\n    N = pow(N, pq_m2);\n    return N;\n}\n\nfloat ST2084_to_Y(float N) {\n    float Np = pow(N, 1.0 / pq_m2);\n    float L = Np - pq_c1;\n    if (L < 0.0 ) L = 0.0;\n    L = L / (pq_c2 - pq_c3 * Np);\n    L = pow(L, 1.0 / pq_m1);\n    return L * pq_C;\n}\n\nvec3 Y_to_ST2084_3(vec3 x) {\n    return vec3(\n        Y_to_ST2084(x.r),\n        Y_to_ST2084(x.g),\n        Y_to_ST2084(x.b)\n    );\n}\n\nvec3 RGB_to_XYZ(vec3 RGB) {\n    mat3 M = mat3(\n        0.6369580483012914, 0.14461690358620832,  0.1688809751641721,\n        0.2627002120112671, 0.6779980715188708,   0.05930171646986196,\n        0.000000000000000,  0.028072693049087428, 1.060985057710791);\n    return RGB * M;\n}\n\nvec3 XYZ_to_RGB(vec3 XYZ) {\n    mat3 M = mat3(\n         1.716651187971268,  -0.355670783776392, -0.253366281373660,\n        -0.666684351832489,   1.616481236634939,  0.0157685458139111,\n         0.017639857445311,  -0.042770613257809,  0.942103121235474);\n    return XYZ * M;\n}\n\nvec3 XYZ_to_LMS(vec3 XYZ) {\n    mat3 M = mat3(\n         0.3592832590121217,  0.6976051147779502, -0.0358915932320290,\n        -0.1920808463704993,  1.1004767970374321,  0.0753748658519118,\n         0.0070797844607479,  0.0748396662186362,  0.8433265453898765);\n    return XYZ * M;\n}\n\nvec3 LMS_to_XYZ(vec3 LMS) {\n    mat3 M = mat3(\n         2.0701522183894223, -1.3263473389671563,  0.2066510476294053,\n         0.3647385209748072,  0.6805660249472273, -0.0453045459220347,\n        -0.0497472075358123, -0.0492609666966131,  1.1880659249923042);\n    return LMS * M;\n}\n\nvec3 LMS_to_ICtCp(vec3 LMS) {\n    LMS.x = Y_to_ST2084(LMS.x);\n    LMS.y = Y_to_ST2084(LMS.y);\n    LMS.z = Y_to_ST2084(LMS.z);\n    mat3 M = mat3(\n         2048.0 / 4096.0,   2048.0 / 4096.0,    0.0 / 4096.0,\n         6610.0 / 4096.0, -13613.0 / 4096.0, 7003.0 / 4096.0,\n        17933.0 / 4096.0, -17390.0 / 4096.0, -543.0 / 4096.0);\n    return LMS * M;\n}\n\nvec3 ICtCp_to_LMS(vec3 ICtCp) {\n    mat3 M = mat3(\n        0.9999999999999998,  0.0086090370379328,  0.1110296250030260,\n        0.9999999999999998, -0.0086090370379328, -0.1110296250030259,\n        0.9999999999999998,  0.5600313357106791, -0.3206271749873188);\n    ICtCp *= M;\n    ICtCp.x = ST2084_to_Y(ICtCp.x);\n    ICtCp.y = ST2084_to_Y(ICtCp.y);\n    ICtCp.z = ST2084_to_Y(ICtCp.z);\n    return ICtCp;\n}\n\nvec3 RGB_to_ICtCp(vec3 color) {\n    color *= L_sdr;\n    color = RGB_to_XYZ(color);\n    color = XYZ_to_LMS(color);\n    color = LMS_to_ICtCp(color);\n    return color;\n}\n\nvec3 ICtCp_to_RGB(vec3 color) {\n    color = ICtCp_to_LMS(color);\n    color = LMS_to_XYZ(color);\n    color = XYZ_to_RGB(color);\n    color /= L_sdr;\n    return color;\n}\n\nconst float pi = 3.141592653589793;\nconst float epsilon = 1e-6;\n\nvec3 Lab_to_LCH(vec3 Lab) {\n    float a = Lab.y;\n    float b = Lab.z;\n\n    float C = length(vec2(a, b));\n    float H = 0.0;\n\n    if (!(abs(a) < epsilon && abs(b) < epsilon)) {\n        H = atan(b, a);\n        H = H * 180.0 / pi;\n        H = mod((mod(H, 360.0) + 360.0), 360.0);\n    }\n\n    return vec3(Lab.x, C, H);\n}\n\nvec3 LCH_to_Lab(vec3 LCH) {\n    // float C = max(LCH.y, 0.0);\n    float C = LCH.y;\n    float H = LCH.z * pi / 180.0;\n\n    float a = C * cos(H);\n    float b = C * sin(H);\n\n    return vec3(LCH.x, a, b);\n}\n\nmat3 BT2020_to_BT709 = mat3(\n     1.66049100210843540, -0.58764113878854950,  -0.072849863319884740,\n    -0.12455047452159074,  1.13289989712595960,  -0.008349422604369515,\n    -0.01815076335490526, -0.10057889800800737,   1.118729661362913000\n);\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    vec3 lch = vec3(\n        fragCoord.y / iResolution.y,\n        (fragCoord.x / iResolution.x) - 0.5,\n        (iMouse.x / iResolution.x) * 360.0\n    );\n    bool inGamut;\n\n    fragColor = vec4(0.5, 0.5, 0.5, 1.0);\n\n    vec3 bt2100pq = Y_to_ST2084_3(ICtCp_to_RGB(LCH_to_Lab(lch)) * L_sdr);\n    inGamut = bt2100pq == clamp(bt2100pq, 0.0, 1.0);\n    if(inGamut) fragColor = vec4(bt2100pq, 1.0);\n\n    vec3 bt2020 = bt1886_r_3(ICtCp_to_RGB(LCH_to_Lab(lch)));\n    inGamut = bt2020 == clamp(bt2020, 0.0, 1.0);\n    if(inGamut) fragColor = vec4(bt2020, 1.0);\n\n    vec3 bt709 = bt1886_r_3(ICtCp_to_RGB(LCH_to_Lab(lch)) * BT2020_to_BT709);\n    inGamut = bt709 == clamp(bt709, 0.0, 1.0);\n    if(inGamut) fragColor = vec4(bt709, 1.0);\n}\n","name":"Image","description":"","type":"image"}]}