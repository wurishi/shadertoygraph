{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"4sXGRn","filepath":"/media/a/95b90082f799f48677b4f206d856ad572f1d178c676269eac6347631d4447258.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define PI 3.14159\n#define SMALL_FLOAT 0.0001\n#define BIG_FLOAT 1000000.\n#define DISTMARCH_STEPS 60\n#define DISTMARCH_MAXDIST 400.\n#define REP_XZ 45.\n#define REP_Y 25.\n#define CLOCK_R 15.\n#define CLOCK_H 1.\n\n// Based on IÃ±igo Quilez articles:\n// https://www.shadertoy.com/view/Xds3zN\n\nconst float fov = PI / 4.0;\nvec3 LigthPos = vec3(0.0,0.0,0.0);\n    \nfloat clock( vec3 p, float r, float h )\n{\n\tvec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);\n  \treturn min(max(d.x,d.y),0.0) + length(max(d,0.0));\n}\n\n\n\nfloat map( vec3 pos)\n{\n    pos.y += REP_Y;\n\tvec3 c = vec3(REP_XZ);\n    vec3 p = mod(pos,c)-0.5*c;    \n    pos.xz = p.xz;\n    float da = clock(pos,CLOCK_R,CLOCK_H);\n    pos.y -= REP_Y*2.0;\n    float db = clock(pos,CLOCK_R,CLOCK_H);\n    \n    return min(da,db);\n}\n\nfloat distmarch( vec3 ro, vec3 rd)\n{   \n    float dist = 10. * SMALL_FLOAT;\n    float t = 0.;\n    for (int i=0; i < DISTMARCH_STEPS; i++) \n    {\n        if ( abs(dist) < SMALL_FLOAT || t > DISTMARCH_MAXDIST ) break;\n        // advance the distance of the last lookup\n        t += dist;\n        dist = map( ro + t * rd);\n    }\n\n    return t;\n}\n\nvec3 texture2d( in vec3 pos )\n{\n    //return vec3(1.0);\n    \n\tvec3 c = vec3(REP_XZ);\n    vec3 p = mod(pos,c)-0.5*c;    \n    pos.xz = p.xz;\n    \n    \n    float len = length(pos.xz);\n    if(len<1.0)\n        return vec3(0.0);\n    \n    if(len>CLOCK_R-1.0)\n        return vec3(0.7,0.7,0.2);\n        \n    \n    float ep = 0.05;\n    float alfa =atan(pos.z,pos.x);\n    float an = abs(alfa);\n    if((abs(an)<ep || abs(an-PI)<ep || abs(an-PI/2.0)<ep || abs(an-PI/4.0)<ep\n       || abs(an-3.0*PI/4.0)<ep )\n       && len>CLOCK_R-5.0)\n        return vec3(0.2,0.2,0.6);\n\n    float min = mod(iTime*15.0,2.0*PI) - PI;\n    if(abs(alfa-min)<ep)\n        return vec3(0.0);\n    \n    if(len<4.0)\n    {\n    \tfloat hour = mod(iTime*3.0,2.0*PI) - PI;\n        if(abs(alfa-hour)<ep)\n            return vec3(0.0);\n    \n    }\n       \n\n    \n    \n    return vec3(0.5 + len / CLOCK_R);\n}\n\nvec3 calcNormal( in vec3 pos )\n{\n\tvec3 eps = vec3( 0.001, 0.0, 0.0 );\n\tvec3 nor = vec3(\n\t    map(pos+eps.xyy) - map(pos-eps.xyy),\n\t    map(pos+eps.yxy) - map(pos-eps.yxy),\n\t    map(pos+eps.yyx) - map(pos-eps.yyx) );\n\treturn normalize(nor);\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\tfloat x = 2.0*uv.x-1.0;\n    float y = 2.0*uv.y-1.0;\n\tfloat time = iTime*2.5;\n    \n    \n \tvec3 vLookFrom = vec3(30.0*time,2.0,21.0);\n \tvec3 vLookAt = vec3(30.0*time+10.0,0.0,21.0);\n\tvec3 LigthPos = vec3(30.0*time,0.0,12.0);\n    \n    vec3 N = normalize(vLookAt-vLookFrom);\n    vec3 V = normalize(cross( N , vec3(0.0,1.0,0.0)));\n    vec3 U = cross(V , N);\n    float k = 2.0*tan(fov/2.0);\n\tvec3 Dy = U*(k*iResolution.y/iResolution.x);\n\tvec3 Dx = V*k;\n\t// direccion de cada rayo\n\tvec3 D = normalize(N + Dx*x + Dy*y);\n    \n\tfloat dist = distmarch( vLookFrom,D);\n    vec3 rgb;\n    if(dist < DISTMARCH_MAXDIST)\n    {\n        // computo n dot l \n        vec3 Ip = vLookFrom + D*dist;\n        vec3 Ld = normalize(LigthPos - Ip);\n        vec3 Normal = calcNormal(Ip);\n        float Kd = 0.2 + clamp(dot(Normal , Ld) , 0.0 , 1.0);\n        rgb = texture2d(Ip) *Kd;\n    }\n    else\n    {\n        rgb = texture( iChannel0, ((uv+ 0.5)+iTime*0.15)/16.0).rgb;\n    \n    }\n\n    vec3 final_color = mix(vec3(0.85,0.85,1.0),rgb, \n\t\tsmoothstep(0.0,0.65,abs(y-0.4)));\n\tfragColor = vec4(final_color, 1.0);    \n\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4lsGR4","date":"1419220928","viewed":170,"name":"time","username":"mbanquiero","description":"test distance field\nBased on IÃ±igo quilez distance field articles\nhttps://www.shadertoy.com/view/Xds3zN","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["timepinkfloyd"],"hasliked":0,"parentid":"","parentname":""}}