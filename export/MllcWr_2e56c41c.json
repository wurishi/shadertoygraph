{"ver":"0.1","info":{"id":"MllcWr","date":"1504448298","viewed":80,"name":"lighting practice2","username":"Torumu106","description":"lighting","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["lighting"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float PI = 3.1415926535;\nvec3 col = vec3(1.0, 1.0, 1.0);\nint stop = 0;\nvec3 stoppos = vec3(0.0);\nfloat map(vec3 p){\n    float d = length(p) - 1.0;\n    d = min(d, dot(p,vec3(0.0, 1.0, 0.0)) + 1.0);\n    return d;\n}\nvec3 grad(vec3 p) {\n    vec2 d = vec2(0.0, 0.001);\n\tfloat dFx = map(p + d.yxx) - map(p - d.yxx);\n\tfloat dFy = map(p + d.xyx) - map(p - d.xyx);\n\tfloat dFz = map(p + d.xxy) - map(p - d.xxy);\n\treturn normalize(vec3(dFx, dFy, dFz));\n}\nfloat trace(vec3 o, vec3 r){\n\tfloat t = 0.0;\n    vec3 p;\n    for(int i = 0; i < 128; ++i){\n    \tp = o + r * t;\n        float d = map(p);\n        if(d < 0.001){\n            stop = 1;\n        \tbreak;\n        }\n        t += d * 0.9;\n    }\n    stoppos = p;\n    return t;\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    uv = uv * 2.0 - 1.0;\n    uv.x *= iResolution.x / iResolution.y;\n    vec3 r = normalize(vec3(uv - vec2(0.0, PI / 3.0), 1.0));\n    \n    float the = iTime;\n    vec3 o = vec3(0.0,10.0, -10.0);\n    r.xz *= mat2(cos(the), -sin(the), sin(the), cos(the));\n    o.xz *= mat2(cos(the), -sin(the), sin(the), cos(the));\n    \n    float t = trace(o, r);\n    float light = 0.0;\n    if(stop == 1){\n    \tvec3 nor = grad(stoppos);\n        light = 0.7 * max(dot(nor, vec3(1.0)), 0.0) + 0.1;\n        stop = 0;\n        trace(stoppos + nor * 0.002, normalize(vec3(1.0)));\n        if(stop == 1) light = 0.1;\n    }\n    \n    vec3 fc = vec3(light) * col;\n    fragColor = vec4(fc,1.0);\n}","name":"Image","description":"","type":"image"}]}