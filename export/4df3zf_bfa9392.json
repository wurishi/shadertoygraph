{"ver":"0.1","info":{"id":"4df3zf","date":"1585828395","viewed":57,"name":"raymarched ripple thing","username":"Tim","description":"Use your mouse to change position of the light source!","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["raymarchtest"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[],"code":"vec3 eye = vec3(0.0, 0.0, 1.0);\n\nfloat rayDistance = 200.0;\n\nvec3 sphere = vec3(0.0, 0.0, -10.0);\n\n\nfloat sphereRadius = 6.0;\n\nstruct Ray\n{\n\tvec3 p;\n\tvec3 u;\n\tfloat a;\t\n};\n\t\n\nvec4 hitTestSphere(Ray ray)\n{\n    vec2 mouse = iMouse.xy / iResolution.xy - 0.5;\n    \n\tvec3 lightSource = vec3(mouse.x * 16.0, mouse.y * 16.0, -6.0);\n    \n\tvec4 result = vec4(0.0, 0.0, 0.0, 1.0);\n\t\n\tray.a = dot(-(ray.p - sphere), ray.u);\n\t\n\tvec3 q = ray.p + ray.a * ray.u;\n\t\n\t// Rough check if we hit the object\n\tfloat ripple = 0.1 * sin((q.x) * 10.0);\n\n\tif (distance(q, sphere) < sphereRadius - ripple)\n\t{\n\t\t// Calculate the real hit-point\n\t\tfloat x = sqrt(pow(sphereRadius  - ripple, 2.0) - pow(distance(q, sphere), 2.0));\n\t\t\n\t\tvec3 hit = ray.p + (ray.a - x) * ray.u;\n\t\thit += normalize(hit) * ripple;\n\t\t\n\t\tvec3 normal = normalize(hit);\n\t\tnormal.x += 0.1 * cos(q.x * 10.0);\n\t\tnormal = normalize(normal);\n\t\t\n\t\tvec3 toLight = normalize(lightSource - hit);\n\t\t\n\t\t// Diffuse\n\t\tfloat diffuse = dot(normal, toLight);\n\n\t\t// Specular\n\t\tvec3 r = reflect(normalize(hit - lightSource), normal);\n\t\tfloat spec = pow(max(0.0, dot(normalize(ray.u), r)), 8.5);\n\t\tresult.xyz = vec3(diffuse) * vec3(1.0, 0.0, 0) + spec;\t\n\t}\n\t\n\treturn result;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy ;\n\t\n\tvec2 screenPlane = (uv - 0.5) * 2.0;\n\t\n\tvec3 screen = vec3(screenPlane.x, screenPlane.y, 0.0);\n\t\n\tRay ray;\n\t\n\tray.p = eye;\n\tray.u = normalize(screen - eye);\n\tray.a = 20.0;\n\t\t\n\tfragColor = hitTestSphere(ray);\n}","name":"Image","description":"","type":"image"}]}