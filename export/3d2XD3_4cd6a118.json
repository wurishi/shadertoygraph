{"ver":"0.1","info":{"id":"3d2XD3","date":"1557636201","viewed":355,"name":"rotate rings","username":"gaz","description":"3d","likes":19,"published":1,"flags":0,"usePreview":0,"tags":["3d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec3 POS,NOR;\nfloat SIZE;\n\nvec3 rotate(vec3 p,vec3 n,float a)\n{\n\tn = normalize(n);\n    vec3 v = cross(p, n), u = cross(v, n); \n    return u * cos(a) + v * sin(a) + n * dot(p, n);   \n}\n\nfloat map(vec3 p)\n{\n\tp-=POS;\n    vec3 u = normalize(cross(NOR, vec3(0,1,0)));\n    p *= mat3(u, cross(NOR, u), NOR);\n    float w= abs(length(p.xy)-SIZE)-0.3;\n    vec2 d = vec2(w, abs(p.z)-0.05);\n    return length(max(d,0.0))-0.1;\n}\n\nvec3 calcNormal(vec3 p){\n \tvec2 e = vec2(1, -1) * 0.002;\n  \treturn normalize(\n    \te.xyy*map(p+e.xyy)+e.yyx*map(p+e.yyx)+ \n    \te.yxy*map(p+e.yxy)+e.xxx*map(p+e.xxx)\n\t);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 p = (fragCoord * 2.0 - iResolution.xy) / iResolution.y;\n\tvec3 rd = normalize(vec3(p,-2));\n\tvec3 ro = vec3(0,0,20);\n\tvec3 col = vec3(0.2);\n\tfloat z=50.0;\n\tfloat itr =20.0;\n\tfor (float j=1.0; j<=itr;j++)\n\t{\n\t\tfloat t =-iTime+j*0.5;\n\t     POS = vec3(cos(t),sin(t),0.3*sin(t))*2.0;\n \t\tNOR = normalize(vec3(1,2,3));\n\t\tNOR = rotate(NOR,normalize(vec3(1,2,3)), iTime*1.2 + j*0.4);\n\t\tNOR = rotate(NOR,normalize(vec3(-5,2,6)), -iTime*1.2 + j*0.3);\n\t\tSIZE=0.7*j;\n\t\tif (length(cross(rd,POS-ro))<SIZE+0.5)\n\t\t{\n\t\t\tfloat ITR = 100.0;\n\t\t\tvec3 p =ro;\n\t\t\tfloat t=0.0,x;\n\t\t\tfloat i;\n \t\t\tfor( i = 0.0; i < ITR; i++)\n  \t\t\t{\n\t    \t\tt += x =map(p);\n       \t\t\tif(x < 0.001 || t > 50.0) break;\n\t\t\t\tp+=rd*x;\n  \t\t\t}\n  \t\t\tif(x < 0.001)\n  \t\t\t{\n\t\t\t\tif(t<z)\n\t\t\t\t{\n\t\t\t\t \tvec3 nor = calcNormal(p);\n\t\t\t\t\tvec3 li = normalize(vec3(0.3,0.5,0.8));\n\t\t\t\t\tcol=  pow(1.0 - i / ITR, 3.0)*(vec3(1.5)*(1.0-0.3*j/itr)); \n\t\t\t\t\tcol *= clamp(dot(nor, li), 0.3, 1.0);\n        \t\t\tcol *= max(0.5 + 0.5 * nor.y, 0.0);\n        \t\t\tcol += pow(clamp(dot(\n                        reflect(normalize(p - ro), nor), li), 0.0, 1.0), 20.0);\n       \t\t\t\tcol = clamp(col,0.0,1.0);\n\t\t\t\t\tz=t;\n\t\t\t\t}\n\n\t\t\t}\t\n\t\t}\n\t}   \n\tcol = pow(col, vec3(0.8)); \n\tfloat t=iTime * 5.0;\n\tcol +=vec3(1,0.5,0)* sin(p.y*500.0-t)*sin(p.x*300.0- t) *0.2;\n\tcol *= clamp(2.4-length(p),0.0,1.0);\n\tfragColor=vec4(col,1);\n}\n","name":"Image","description":"","type":"image"}]}