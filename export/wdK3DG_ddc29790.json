{"ver":"0.1","info":{"id":"wdK3DG","date":"1570890237","viewed":82,"name":"voxel raymarch (went wrong)","username":"sasha_sortai","description":"after some work to find out how this wouldn't work, this didn't actually work","likes":1,"published":1,"flags":32,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nfloat SDF(vec3 pos);\nvec3 SDFg(vec3 pos);\nvec4 march(vec3 pos, vec3 tar, vec2 uv, float fd);\nvec4 march(vec3 pos, vec3 tar, vec2 uv);\nvec4 march(vec3 pos, vec3 ray);\nfloat obst(vec3 op, vec3 lp, float k);\nfloat sdBox( vec3 p, vec3 b );\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord-.5*iResolution.xy)*2./min(iResolution.x,iResolution.y)*.6;\n    vec3 cpos = vec3(cos(iTime),sin(iTime),0)*1.5;\n    vec3 lpos = vec3(2.);\n    vec4 mres = march(cpos,vec3(0),uv);\n    \n    if (mres.w<0.) fragColor = vec4(.2,.3,.25,1);\n    //else fragColor = vec4(vec3(dot(normalize(lpos-mres.xyz),SDFg(mres.xyz)))*exp(-distance(lpos,mres.xyz)*.1),1);\n    else fragColor = vec4(vec3(obst(mres.xyz,lpos,10.)),1);\n}\n\nfloat SDF(vec3 pos){\n    float bd = -sdBox(pos,vec3(5)); bd = 1000.;\n    float ins = sdBox(pos,vec3(1))-.001;\n    if (ins>0.) return min(bd,ins+.1);\n    else return min(bd,texture(iChannel0,(pos.xy+1.)*.5).x+abs(pos.z));\n}\nvec3 SDFg(vec3 pos){\n    vec3 er = vec3(.00001,0,0);\n    return vec3(\n        SDF(pos+er.xyz)-SDF(pos-er.xyz),\n        SDF(pos+er.yzx)-SDF(pos-er.yzx),\n        SDF(pos+er.zxy)-SDF(pos-er.zxy)\n        )/(er.x*2.);\n}\nvec4 march(vec3 pos, vec3 ray){\n    float d;\n    float td = 0.;\n    int imax = 500;\n    int i;\n    for (i = 0; i<imax; i++){\n        d = SDF(pos+td*ray);\n        if (d<=0.005) break;\n        td+=d;\n    }\n    if (i<imax-1) return vec4(pos+td*ray,float(i)/float(imax-2));\n    else return vec4(pos+td*ray,-1);\n}\nvec4 march(vec3 pos, vec3 tar, vec2 uv, float fd){\n    vec3 fo = normalize(tar-pos);\n    vec3 ri = cross(fo,vec3(0,0,1));\n    vec3 up = cross(ri,fo);\n    vec3 ray = normalize(mat3(ri,up,fo)*vec3(uv,fd));\n    return march(pos,ray);\n}\nvec4 march(vec3 pos, vec3 tar, vec2 uv){\n    return march(pos, tar, uv, 1.);\n}\nfloat obst(vec3 op, vec3 lp, float k){\n    float off = .01;\n    vec3 rd = lp-op;\n    float md = length(rd);\n    float res = 1.;\n    float d;\n    for(float t=.000000001; t<1.;){\n        d = SDF(op + rd*t);\n        if(d<0.0){\n            res=0.;\n            break;\n        }\n        res = min(res, k*d/t/md);\n        t+=off;\n    }\n    return res;\n}\nfloat sdBox( vec3 p, vec3 b )\n{\n  vec3 q = abs(p) - b;\n  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor = vec4(vec3(length((fragCoord/iResolution.xy)*2.-1.)-1.),1.0);\n}","name":"Buf A","description":"","type":"buffer"}]}