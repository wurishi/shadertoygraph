{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"4dXGzn","filepath":"/media/a/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"texture","id":"XsX3Rn","filepath":"/media/a/92d7758c402f0927011ca8d0a7e40251439fba3a1dac26f5b8b62026323501aa.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":2,"type":"texture","id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":3,"type":"texture","id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"//#define cam1\n\n#define pi acos(-1.0)\n#define pi2 pi/2.0\n\n/***********************************************/\nfloat hash(float n) { \n\treturn fract(sin(n)*43758.5453123); \n}\n\nfloat noise3(vec3 x) {\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f*f*(3.0-2.0*f);\n    float n = p.x + p.y*57.0 + p.z*113.0;\n    float res = mix(mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n                        mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y),\n                    mix(mix( hash(n+113.0), hash(n+114.0),f.x),\n                        mix( hash(n+170.0), hash(n+171.0),f.x),f.y),f.z);\n    return res;\n}\n/***********************************************/\nfloat sdCylinder(vec3 p, vec2 h) {\n    return max( length(p.xz)-h.x, abs(p.y)-h.y );\n}\n/***********************************************/\nfloat sdCone(vec3 p, vec3 c){\n    vec2 q = vec2( length(p.xz), p.y );\n    return max( max( dot(q,c.xy), p.y), -p.y-c.z );\n}\n/***********************************************/\nvec3 opRep(vec3 p, float l, float s, float d) {\n\t\n\tfloat r=1./l;\n\tfloat ofs=s+s/(r*2.0);\n\tfloat a= mod( atan(p.x, p.z) + d + pi2*r, pi*r) -pi2*r;\n\tp.xz=vec2(sin(a),cos(a))*length(p.xz) -ofs;\n\tp.x+=ofs;\n\t\n\treturn p;\n}\n/***********************************************/\nvec2 opU(vec2 a, vec2 b) {\n\treturn mix(a, b, step(b.x, a.x));\n}\n\n/***********************************************/\nvec2 DE(vec3 p) {\n    float m=texture(iChannel0, p.xy ).x*texture(iChannel0, p.yz ).x*0.03;\n\t\n\tvec2 uv=floor(vec2(p.xz+2.0)*0.5)/4.;\n    p.xz=mod(p.xz,2.0)-0.5*2.0;\n    p.y-= texture(iChannel1, uv.xy*0.005).x*2.5;\n\n    //tower shape from top to bottom\n    p.y-=2.0;\n    float b=sdCone(p,vec3(0.5,0.125,0.5));\n    //spikes\n    vec3 q=opRep(p,2.0,0.11,0.0);\n    q.y+=0.2;\n    b=min(b, sdCone(q,vec3(1.7,0.125,0.5)));\n    //disc\n    p.y+=0.7;\n    b=min(b, sdCylinder(p, vec2(0.35,0.01)));\n    //ball    \n    b=min(b, length(p)-0.25 );\n    //pillars\n    p.y+=0.35;\n    q=opRep(p,4.0,0.09,0.0);\n    b=min(b, sdCylinder(q, vec2(0.04,0.35)));\n    //center pillar\n    b=min(b, sdCylinder(p, vec2(0.15,0.35)));\n    //disc\n    p.y+=0.35;\n    b=min(b, sdCylinder(p, vec2(0.5,0.015)));    //add trees here\n    //pillars\n    p.y+=0.535;\n    q=opRep(p,4.0,0.14,0.0);\n    b=min(b, sdCylinder(q, vec2(0.04,0.535)));\n    //center pillar\n    b=min(b, sdCylinder(p, vec2(0.20,0.535)));\n    //disc\n    p.y+=0.55;\n    b=min(b, sdCylinder(p, vec2(0.6,0.015)));    //add trees here\n    //pillars\n    p.y+=2.75;\n    q=opRep(p,4.0,0.17,0.0);\n    b=min(b, sdCylinder(q, vec2(0.04,2.75)));\n    //center pillar\n    b=min(b, sdCylinder(p, vec2(0.3,2.75)));\n    //tower var\n    vec2 ret=vec2(b,1.0);\n\n    /* trees plstform 1*/\n    p.y-=3.98;\n    q=opRep(p,8.0,0.09,0.0);\n        float t=sin(p.x*16.)*0.01;\n    q.y+=t;\n        ret=opU(ret,vec2(length(q)-0.06+m, 2.0));\n    //wood\n    q.y+=0.1-t*0.5;\n        ret=opU(ret,vec2(sdCylinder(q, vec2(0.015,0.05)), 3.0));\n    //row 2\n    q=opRep(p,8.0,0.07,0.2);\n        t=abs(sin(p.x*16.0+2.54)*0.04);\n    q.y+=t-0.05;\n        ret=opU(ret,vec2(length(q)-0.06+m, 2.0));\n    //wood\n    q.y+=0.1-t*0.5;\n        ret=opU(ret,vec2(sdCylinder(q, vec2(0.015,0.05+t)), 3.0));    \n\n     /* trees platform 2*/\n    p.y+=1.08;\n    q=opRep(p,10.0,0.09,0.0);\n        t=sin(p.x*16.)*0.01;\n    q.y+=t;\n        ret=opU(ret,vec2(length(q)-0.06+m, 2.0));\n    //wood\n    q.y+=0.1-t*0.5;\n        ret=opU(ret,vec2(sdCylinder(q, vec2(0.015,0.05)), 3.0));\n    //row 2\n    q=opRep(p,10.0,0.07,0.2);\n        t=abs(sin(p.x*16.0+2.54)*0.04);\n    q.y+=t-0.05;\n        ret=opU(ret,vec2(length(q)-0.06+m, 2.0));\n    //wood\n    q.y+=0.1-t*0.5;\n        ret=opU(ret,vec2(sdCylinder(q, vec2(0.015,0.05+t)), 3.0));    \n\n    return ret;\n}\n/***********************************************/\nvec3 normal(vec3 p) {\n\tvec3 e=vec3(0.01,-0.01,0.0);\n\treturn normalize( vec3(\te.xyy*DE(p+e.xyy).x +\te.yyx*DE(p+e.yyx).x +\te.yxy*DE(p+e.yxy).x +\te.xxx*DE(p+e.xxx).x));\n}\n/***********************************************/\nfloat csh( vec3 ro, vec3 rd, float mint, float maxt, float k ) {\n    float res = 1.0;\n    float dt = 0.02;\n    float t = mint;\n    for( int i=0; i<8; i++ ) {\n        float h = DE( ro + rd*t ).x;\n        res = min( res, k*h/t );\n        t += max( 0.05, dt );\n    }\n    return clamp( res, 0.0, 1.0 );\n}\n/***********************************************/\nvec3 fog(vec3 col, float d, vec3 p) {\n\tfloat fog=exp(-0.08 * d*d );\n\treturn clamp( mix(vec3(0.57,0.65,0.89)*0.25, col, fog), 0.0, 1.0);\n}\n/***********************************************/\n/* taken from iq's Clouds shader and a bit tweaked */\nvec4 cfog(vec4 ccol, vec3 ww, vec3 lig) {\n    float d=noise3(ww*1.8-iTime*0.2);\n    vec4 tc=vec4(mix( vec3(0.47,0.55,0.79)*0.2, vec3(0.57,0.65,0.89)*1.1, d), d);\n    d=noise3((ww+0.3*lig)*1.8-iTime*0.3);\n    float dif=clamp(d/0.6, 0.0,1.0);\n    vec3 brdf = vec3(0.5, 0.5, 0.55)*dif*0.9;\n \ttc.xyz*=brdf;\n \ttc.a*=0.53;\n \ttc.rgb*=tc.a;\n \treturn ccol + tc*(1.0 - ccol.a);    \n}\n/***********************************************/\nvec3 tex3D(vec3 pos, vec3 nor, sampler2D s) {\n\treturn texture( s, pos.yz).xyz*abs(nor.x)+\n\t       texture( s, pos.xz).xyz*abs(nor.y)+\n\t       texture( s, pos.xy).xyz*abs(nor.z);\n}\n/***********************************************/\nvoid rot( inout vec3 p, vec3 r) {\n\tfloat sa=sin(r.y); float sb=sin(r.x); float sc=sin(r.z);\n\tfloat ca=cos(r.y); float cb=cos(r.x); float cc=cos(r.z);\n\tp*=mat3( cb*cc, cc*sa*sb-ca*sc, ca*cc*sb+sa*sc,\tcb*sc, ca*cc+sa*sb*sc, -cc*sa+ca*sb*sc,\t-sb, cb*sa, ca*cb );\n}\n/***********************************************/\nvoid animate(inout vec3 ro, inout vec3 ta) {\n    float p=iTime*0.25;\n   \n\t/* TO DO A MORE DECENT PATHING */\n\t\n#ifdef cam1\n\trot(ro,vec3( cos(p+sin(p)), sin(p*0.5), 0.0  ));\t\n\tro.y+=abs(sin(p*0.25));\n\tta.y+=abs(sin(p*0.25));\n    ro.z+=p;\n \tta.z+=p;\t\n#else\t\n\tro.z+=sin(p+cos(p))+0.85;\n    ro.y+=abs(sin(2.45+p))+sin(p+cos(p*0.25))*2.;\n\trot(ro,vec3( p, 0.0, sin(p)*0.35  ));\n\tta.y+=cos(p)*2.0;\n#endif \n}\n/***********************************************/\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    vec2 p = -1.0 + 2.0 * fragCoord.xy / iResolution.xy;\n    p.x *= iResolution.x/iResolution.y;\t\n\tvec3 ta = vec3(0.0, 0.0, 0.0);\n\tvec3 ro =vec3(0.0, 1.0, -4.0);\n\tvec3 lig=normalize(vec3(-1.0, 4.0, 6.0));\n\t\n//\tvec2 mp=iMouse.xy/iResolution.xy;\n//\trot(ro,vec3(mp.x,mp.y,0.0));\n//\trot(lig,vec3(mp.x,mp.y,0.0));\n\n    animate(ro,ta);\n\n\tvec3 cf = normalize( ta - ro );\n    vec3 cr = normalize( cross(cf,vec3(0.0,1.0,0.0) ) );\n    vec3 cu = normalize( cross(cr,cf));\n\tvec3 rd = normalize( p.x*cr + p.y*cu + 2.5*cf );\n\n\tvec3 col=vec3(0.0);\n\tvec4 fcol=vec4(0.0); \n\n\t/* trace */\n\tvec2 r=vec2(0.0);\t\n\tfloat f=0.0;\n\tvec3 ww;\n\tfor(int i=0; i<60; i++) {\n\t\tww=ro+rd*f;\n\t\tr=DE(ww);\t\n\t\tfcol=cfog(fcol,ww,lig);\n\t\tif( r.x<0.0 ) break;\n\t\tf+=r.x;\n//\t    fcol=cfog(fcol,ww,lig);\t\n\t}\n\t/* draw */\n\tif( f<15.0 ) {\n\t\tvec3 nor=normal(ww);\n\n\t\tif (r.y==1.0) col=vec3(0.3,0.35,0.32) * tex3D(ww*2.,nor,iChannel3)*0.37;    //tower\n\t\tif (r.y==2.0) col=vec3(0.3,0.6,0.4) * tex3D(ww*2.,nor,iChannel2);    //leafs\n\t\tif (r.y==3.0) col=vec3(1.0,0.6,0.3) * tex3D(ww*2.,nor,iChannel1)*0.33;    //wood\n\n\t\t\tfloat amb =0.2;//*ww.y;\n\t\t\tfloat dif =0.7*clamp(dot(lig, nor), 0.0,1.0);\n\t\t\tfloat bac =0.2*clamp(dot(nor,-lig), 0.0,1.0);\n\t\t\tfloat sh=csh(ww, lig, 0.01, 1.0, 4.0);\n\t\t\n\t\t    col*=(amb+dif+bac+sh);\n            col*=1.1*ww.y;   \n\t}\n\n//\tcol*=0.55;\n\t\n    col=fog(col,f,ww);\n   \n    \n    fcol.xyz /= fcol.w;\n\t\n    col=mix(col,fcol.xyz,fcol.w*0.5);\n\t\n    \n//     col*=0.55;\n\n\tfragColor = vec4( col, 1.0 );\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XsSGDV","date":"1393324251","viewed":680,"name":"Dark pillars","username":"avix","description":"fantasy theme dark pillars with somekind clody volumetric fok wannabe style...","likes":9,"published":1,"flags":0,"usePreview":0,"tags":["procedural","3d","raymarch","dynamicfog"],"hasliked":0,"parentid":"","parentname":""}}