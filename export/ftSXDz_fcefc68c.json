{"ver":"0.1","info":{"id":"ftSXDz","date":"1627397935","viewed":57,"name":"Ray Tracing with Phong Shading","username":"AshutoshR","description":"Ray Tracing with Phong Shading","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["raytracing","phongshading"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"struct Ray {\n    vec3 origin;\n    vec3 direction;\n} ray;\n\nstruct Material {\n    vec3 color;\n    float ambience;\n    float diffuse;\n    float specular;\n    float shininess;\n};\n\nstruct Sphere {\n    vec3 position;\n    float radius;\n    Material material;\n} sphere1;\n\nstruct Camera {\n    vec3 position;\n    float aspectRatio;\n} camera;\n\nstruct DirectionalLight {\n    vec3 direction;\n    vec3 color;\n} sunLight;\n\nvoid setupScene() {\n    sphere1.position = vec3(0 , 0 , 30);\n    sphere1.radius = 1.0;\n    \n    sphere1.material.color = vec3(0.5, 0.5, 1.0);\n    sphere1.material.ambience = 0.2;\n    sphere1.material.diffuse = 0.5;\n    sphere1.material.specular = 0.8;\n    sphere1.material.shininess = 25.;\n    \n    camera.position = vec3(0 , 0 , -5);\n    camera.aspectRatio = iResolution.x / iResolution.y;\n    \n    sunLight.direction = normalize(vec3(-0.5 , -0.5 , 0.8));\n    sunLight.color = vec3(1.);\n    \n    ray.origin = camera.position;\n}\n\nbool checkIntersect(Sphere sphere, vec2 px, out float p1, out float p2) {\n    ray.direction = normalize(vec3(px, 1.0) - ray.origin);\n\n    vec3 oc = ray.origin - sphere.position;\n    float a = dot(ray.direction, ray.direction);\n    float b = 2.0 * dot(ray.direction, oc);\n    float c = dot(oc,oc) - pow(sphere.radius, 2.0);\n    \n    float d = pow(b, 2.0) - (4.0 * a *c);\n    if (d < 0.0) {\n        return false;\n    }\n    if (d == 0.0) {\n        p1 = p2 = -b / 2.0 * a;\n        return true;\n    }\n    if (d > 0.0) {\n       p1 = (-b - sqrt(d)) / 2.0 * a;\n       p2 = (-b + sqrt(d)) / 2.0 * a;\n       return true;\n    }\n}\n\nvec3 calculateSunLight(Sphere sphere, vec3 hitPoint) {\n    vec3 sphereNormal = normalize(hitPoint - sphere.position);\n    vec3 invlDir = sunLight.direction;\n    float intensity = max(-dot(invlDir, sphereNormal), 0.);\n    return vec3(1) * intensity;\n}\n\nvec3 calculateShininess(Sphere sphere, vec3 hitPoint) {\n    vec3 sphereNormal = normalize(hitPoint - sphere.position);\n    vec3 viewDirection = normalize(camera.position - hitPoint);\n    \n    vec3 refLight = normalize(reflect(sunLight.direction, sphereNormal));\n    \n    float intensity = max(0.,dot(viewDirection, refLight));\n    \n    float shininess = pow(intensity, sphere1.material.shininess);\n    \n    return shininess * sunLight.color;\n}\n\n\nvec3 rayTrace(vec2 fCord) {\n    float p1 , p2;\n    if(checkIntersect(sphere1, fCord, p1, p2)) {\n        float p = p1;\n        if (p2 < p) {\n            p = p2;\n        }\n        vec3 hitPoint = ray.origin + (ray.direction * p);\n        \n        vec3 ambience = sphere1.material.ambience * sphere1.material.color * sunLight.color;\n        vec3 diffuse = sphere1.material.diffuse * calculateSunLight(sphere1, hitPoint) * sphere1.material.color;\n        vec3 specular = sphere1.material.specular * calculateShininess(sphere1, hitPoint) * sphere1.material.color;\n        \n        return ambience + diffuse + specular;\n    } else {\n        return vec3(0.0);\n    }\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    setupScene();\n    \n    // sphere.position.z = sin(iTime) * 4. + 10.;\n    sphere1.position.x = sin(iTime) * 2.9;\n    // sphere1.position.y = cos(iTime) * 1.5;\n    \n    sunLight.direction.x = sin(iTime);\n    sunLight.direction.y = cos(iTime);\n    \n    ///sphere1.material.shininess = sin(iTime) * 40. + 50.;\n    \n    ray.origin = camera.position;\n\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n    uv -= 0.5;\n    uv.x *= camera.aspectRatio;\n    \n    vec3 col = rayTrace(uv);\n\n    // Output to screen\n    fragColor = vec4(col, 1.0);\n}","name":"Image","description":"","type":"image"}]}