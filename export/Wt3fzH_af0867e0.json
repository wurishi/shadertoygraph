{"ver":"0.1","info":{"id":"Wt3fzH","date":"1612194259","viewed":148,"name":"Matchstick Menger","username":"eiffie","description":"Built a Menger out of matchsticks. I'd show it to you but it didn't last long.","likes":11,"published":1,"flags":0,"usePreview":0,"tags":["menger"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//Matchstick Menger by eiffie\n#define time iTime\n#define rez iResolution\nvec3 mcol=vec3(0.0);\nfloat noyz(vec3 p){p.y-=time*5.;vec3 r=abs(sin(p+sin(p.yzx*2.+sin(p.zxy*3.))));return r.x+r.y+r.z;}\nfloat axi(vec3 p){p=abs(p);return min(max(p.x,p.y),min(max(p.y,p.z),max(p.x,p.z)));}\nfloat box(vec3 p){p=abs(p);return max(abs(p.x),max(abs(p.y),abs(p.z)));}\nfloat smk=0.0;\nfloat DE(vec3 p){\n  const float thrd=1./3.;\n  float g=max(p.x+p.y+p.z-1.5,0.);\n  p+=vec3((0.07+0.007*sin(g*20.0))*sin(g));\n  float r=box(p)-1.0,s=thrd,d=axi(p)-s;\n  vec3 v=mod(p+1./(54.*s),1./(27.*s))-1./(54.*s);\n  float b=max(length(v)-0.01,r-0.01);\n  float sm=min(g,max(min(p.x,p.z),max(0.,p.y-1.)));\n  sm*=noyz(p*vec3(40.,20.,40.)); \n  r=max(axi(v)-0.005,r);\n  p=2.*clamp(p,-s,s)-p;\n  s*=thrd;\n  d=min(d,axi(p)-s);\n  r=max(r,-d-0.005);\n  b=max(b,-d-0.02);\n  smk+=sm*max(1.-b*10.,0.);\n  mcol+=(r<b?vec3(.9,.6,.3):vec3(.9,.3,.1))*max(1.-g,0.);\n  d=min(r,b)*(.9-min(g*.2,.2));\n  return d;\n}\nvec3 normal(vec3 p, float d){//from dr2\n  vec2 e=vec2(d,-d);vec4 v=vec4(DE(p+e.xxx),DE(p+e.xyy),DE(p+e.yxy),DE(p+e.yyx));\n  return normalize(2.*v.yzw+vec3(v.x-v.y-v.z-v.w));\n}\nvec3 sky(vec3 rd, vec3 L){\n  float d=0.4*dot(rd,L)+1.6;\n  return vec3(0.6,0.8,1.)*d*max(0.1,rd.y+.2);\n}\nfloat rnd;\nvoid randomize(in vec2 p){rnd=fract(float(time)+sin(dot(p,vec2(13.3145,117.7391)))*42317.7654321);}\n\nfloat ShadAO(in vec3 ro, in vec3 rd){\n float t=0.01*rnd,s=1.0,d,mn=0.01;\n for(int i=0;i<12;i++){\n  d=max(DE(ro+rd*t)*1.5,mn);\n  s=min(s,d/t+t*0.5);\n  t+=d;\n }\n return s;\n}\nvec3 scene(vec3 ro, vec3 rd){\n  float t=DE(ro)*rnd,d,px=1.0/rez.x;\n  for(int i=0;i<64;i++){\n    t+=d=DE(ro+rd*t);\n    if(t>10.0 || d<px*t)break;\n  }\n  vec3 L=normalize(vec3(ro.x,0.5,ro.z+.4));\n  vec3 col=sky(rd,L);\n  if(d<px*t*5.0){\n    mcol=vec3(0.001);\n    vec3 so=ro+rd*t;\n    vec3 N=normal(so,d);\n    vec3 scol=mcol*0.25;\n    float dif=0.5+0.5*dot(N,L);\n    float vis=clamp(dot(N,-rd),0.05,1.0);\n    float fr=0.2*pow(1.-vis,5.0);\n    float shad=ShadAO(so,L);\n    col=(scol*dif+fr*sky(reflect(rd,N),L))*shad;\n  }\n  return col+smk*0.01*vec3(0.9,1.,0.7);\n}\nmat3 lookat(vec3 fw){fw=normalize(fw);vec3 up=vec3(0,1,0),rt=normalize(cross(up,fw));\n  return mat3(rt,cross(fw,rt),fw);\n}\nvoid mainImage(out vec4 O, in vec2 U){\n  vec2 uv=vec2(U-0.5*rez.xy)/rez.x;\n  randomize(U.xy);\n  float tim=-3.+time*0.25;\n  vec3 ro=vec3(cos(tim),0.5+tim*0.25,sin(tim))*(2.-tim*.25);\n  vec3 rd=lookat(-ro)*normalize(vec3(uv,1.0));\n  O=vec4(scene(ro,rd),1.0);\n  O*=max(0.,1.-0.3*pow(abs(tim),2.));\n}","name":"Image","description":"","type":"image"}]}