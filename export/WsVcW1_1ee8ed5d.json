{"ver":"0.1","info":{"id":"WsVcW1","date":"1602753235","viewed":377,"name":"lazzy SDF evaluation","username":"FabriceNeyret2","description":"Lazzy evaluation: buffer A computes the SDF at low resolution\nbuff B,C,D computes at double resolution (emulating quadtree) only in prev tiles close to SDF=0\nImage evaluates and draw SDF in last near-zero tiles\n","likes":5,"published":3,"flags":32,"usePreview":0,"tags":["quadtree","lazy","interval","lazzy","hierachical"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XdfGR8","filepath":"/media/previz/buffer03.png","previewfilepath":"/media/previz/buffer03.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 O, vec2 u )\n{\n    float SIZE = 4.*L, l;      // below: to test Buffers content\n // SIZE = 8.*L; O = texture(iChannel3,u/SIZE/R); O=vec4(-O.r*R.y/16.,O.g,O.r*R.y/16.,0); return;\n    \n    vec2 U = u/R.y;\n    int n = 0;\n     \n#if LAZZY\n    \n    O = texture(iChannel0,u/SIZE/R); l = O.r;    // LOD content\n    n = int(O.g);                                // \"near\" LOD flags\n    if ( abs(l) < k*SIZE/R.y )                   // near tile on: compute\n        { SDF(U); n += 8; }\n    \n#else\n    \n    SDF(U);\n    \n#endif\n    O-=O;\n    O = vec4( smoothstep(1./R.y, 0., abs(l) ) ); // isovalue SDF = 0\n    O += .5 * vec4((n&4)>0,(n&2)>0,n&1,0);       // show flags\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define LAZZY 1              // lazzyness on/off\n#define L (.5+max(0.,log(R.y/360.))) // scaling of resolutions   ( for worthful LOD0 )\n#define k 1.2                // neighborhood gain factor ( don't loose, don't redund )\n\n#define R        iResolution.xy\n#define hash(p)  fract(sin( p * vec2(12.9898, 78.233) ) * 43758.5453)\n\n\n// --- put your costly SDF here\n\n#define SDF(U) /* as a macro because we stupidely can't access resol in Common */  \\\n{   l = 1e5;                                                                       \\\n    for(float i=0.; i<1e3; i++) {                                                  \\\n        vec2 P = R/R.y*hash(i) + .2*cos(iTime*(2.*hash(i+.3)-1.)+hash(i+.7)+vec2(0,11)); \\\n        l = min(l, length(U-P) -1./R.y);                                           \\\n    }                                                                              \\\n    l -= .04;                                                                      \\\n}\n\n// --- compute a hierarchy of intervals\n\n#define LOD(scale,flag)                                          \\\nvoid mainImage( out vec4 O, vec2 u )                             \\\n{   if ( LAZZY < 1 ) discard;                                    \\\n    float SIZE = (scale)*L, l;                                   \\\n                                                                 \\\n    vec2 U = SIZE*u/R.y;                                         \\\n    if ( max( U.x*R.y/R.x , U.y ) > 1. ) discard;                \\\n    O = texture(iChannel0,u/2./R); l = O.r;                      \\\n    if ( abs(l) < k*SIZE/R.y )                                   \\\n        { SDF(U); O.r = l; O.g += float(1<<flag); }              \\\n}\n","name":"Common","description":"","type":"common"},{"inputs":[],"outputs":[{"id":"4dXGR8","channel":0}],"code":"LOD(32.,-1)    // === compute SDF at res 1/32 ====================\n\n    \n    \n    \n    \n    \n    \n    \n/*    \nvoid mainImage( out vec4 O, vec2 u )\n{   \n    if (LAZZY<1) discard;\n    float SIZE = 32.*L;\n    \n    vec2 U = SIZE*u/R.y;\n    if ( max(U.x*R.y/R.x,U.y) > 1. ) discard;\n    float l; SDF(U);\n    O.rg = vec2(l,0);\n}\n*/\n","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"LOD(16.,0)    // === compute SDF at res 1/16 ====================","name":"Buffer B","description":"","type":"buffer"},{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4sXGR8","channel":0}],"code":"LOD(8.,1)    // === compute SDF at res 1/8 ====================","name":"Buffer C","description":"","type":"buffer"},{"inputs":[{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XdfGR8","channel":0}],"code":"LOD(4.,2)    // === compute SDF at res 1/4 ====================","name":"Buffer D","description":"","type":"buffer"}]}