{"ver":"0.1","info":{"id":"4dtyRf","date":"1519698141","viewed":278,"name":"Inside out grid","username":"wyatt","description":"Learned about space today","likes":16,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","inversion"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"mat3 rot (vec3 s) {\n\t\tfloat \tsa = sin(s.x),\n\t\t\t\tca = cos(s.x),\n\t\t\t\tsb = sin(s.y),\n\t\t\t\tcb = cos(s.y),\n\t\t\t\tsc = sin(s.z),\n\t\t\t\tcc = cos(s.z);\n\t\treturn mat3 (\n\t\t\tvec3(cb*cc, -cb*sc, sb),\n\t\t\tvec3(sa*sb*cc+ca*sc, -sa*sb*sc+ca*cc, -sa*cb),\n\t\t\tvec3(-ca*sb*cc+sa*sc, ca*sb*sc+sa*cc, ca*cb)\n\t\t);\n\t}\n\tmat3 mm;\n\tvec4 light;\n\tfloat map (vec3 p) {\n\t\tfloat a = .8;\n\t\tfloat d = length(p-light.xyz)-light.w;\n\t\td = min(d,max(15.-p.z,0.));\n\t\tp = mm*p;\n\t\tfloat r = dot(p,p);\n\t\tp = 11.*p/r;\n\t\tfloat b = .1*sqrt(r)/(r);\n\t\tp = (fract((p*0.5)/a)*2.-1.)*a;\n\t\td = min(d,length(p.xz)-b);\n\t\td = min(d,length(p.xy)-b);\n\t\td = min(d,length(p.zx)-b);\n\t\td = min(d,length(p)-2.5*b);\n  \t\treturn d;\n\t}\n\tvec3 norm (vec3 p) {\n\t\tvec2 e = vec2 (.001,0.);\n\t\treturn normalize(vec3(\n\t\t\t\tmap(p+e.xyy) - map(p-e.xyy),\n\t\t\t\tmap(p+e.yxy) - map(p-e.yxy),\n\t\t\t\tmap(p+e.yyx) - map(p-e.yyx)\n\t\t\t));\n\t}\n\tvec3 dive (vec3 p, vec3 d) {\n\t\tfor (int i = 0; i < 110; i++) {\n\t\t\tp += min(1.,(.1*dot(p,p)))*d*map(p);\n\t\t}\n\t\treturn p;\n\t}\n\tvoid mainImage (out vec4 fragColor, vec2 vv) {\n        float ui = float(iFrame);\n\t\tvec2 v = (vv/iResolution.xy)*2.-1.;\n        v.x *= iResolution.x/iResolution.y;\n\t\tvec3 r = vec3(0,0,-10.);\n\t\tlight = vec4(5.*sin(0.01*ui),3,-7,1);\n\t\tvec3 d = normalize(vec3(v,3.));\n\t\tmm = rot(0.01*ui*vec3(0,1,1));\n\t\tvec3 p = dive(r,d);\n\t\td = normalize(light.xyz-p);\n\t\tvec3 bounce = dive(p+0.01*d,d);\n        vec3 no = norm(p);\n\t\tvec3 col = vec3(dot(no,normalize(light.xyz-p))*0.5+0.5);\n        col = col*col;//1.-0.01*exp(-100.*col*col);\n\t\tif (length(bounce-light.xyz) > light.w+0.1) col *= 0.2;\n\t\tif (length (p-r)>15.-r.z) col *= vec3(0.5,0.6,0.9);\n        fragColor = vec4(col,1);\n    }","name":"Image","description":"","type":"image"}]}