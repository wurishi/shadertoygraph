{"ver":"0.1","info":{"id":"NssSDs","date":"1619467247","viewed":115,"name":"Prysmic Abyss","username":"Hyeve","description":"Not the neatest or best code, but I'm super super happy with the outcome on this one!","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["3d","raymarching","reflections"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define rot(a) mat2(cos(a),-sin(a),sin(a),cos(a))\nfloat bx(vec3 p,vec3 s)\n{\n    vec3 q = abs(p) - s;\n    return min(max(q.x, max(q.y, q.z)), 0.) + length(max(q, 0.));\n}\nvec2 mp1(vec3 p)\n{\n    float b1 = bx(p, vec3(1)) - 0.05;\n    float b2 = bx(p + vec3(0.,0.,0.4), vec3(0.8)) - 0.03;\n    float b3 = length(p) - 1.2;\n    vec2 r = vec2(0);\n    r.x = min(b1, min(b2, b3));\n    r.y = b1 < b2 ? 1. : 2.;\n    r.y = r.x < b3 ? r.y : 3.;\n    return r;\n}\nvec2 mp(vec3 p,vec3 ro)\n{\n    vec3 bxp = abs(p) - vec3(2, 2, 0);\n    bxp.z = mod(p.z, 8.) - 5.;\n   \n    //this line creates the \"static\" further back. Remove if you want the reflections to work all the way\n    bxp.z += cos(iTime * fract(bxp.x * bxp.y)) * smoothstep(ro.z + 32.,ro.z + 128.,p.z) * 0.2;\n    bxp.xy = mod(p.xy, 4.) - 2.;\n    bxp.xz *= rot(-iTime * 0.1);\n    bxp.yz *= rot(iTime * 0.1);  \n    return mp1(bxp);\n}\nvec2 rm(vec3 ro, vec3 rd)\n{\n    vec2 d = vec2(0.);\n    for(int i=0;i<256;i++)\n    {\n        vec3 p=ro+rd*d.x;\n        vec2 s=mp(p,ro);\n        d.y=s.y;d.x+=s.x;\n        if(s.x<0.01||d.x>128.)break;\n    }\n    if(d.x>128.)d.y=0.;\n    return d;\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv=(fragCoord-0.5*iResolution.xy)/iResolution.y;\n    uv *= rot(iTime/4. - length(uv) * sin(iTime));\n    vec3 ro=vec3(0,1,iTime * 4. + sin(iTime * 4.)),rd=normalize(vec3(uv.x + cos(iTime) * 0.1,uv.y + sin(iTime) * 0.1,1)),\n    col=vec3(clamp(sin(iTime/2.) + 0.5,0.,1.));\n    \n    //uncomment this line for just dark mode\n    //col=vec3(clamp(-abs(sin(iTime/4.) + 0.5),0.,1.));\n    \n    vec2 s=rm(ro,rd);\n    vec3 p=ro+rd*s.x;\n    vec2 e=vec2(0.02,0.);\n    vec3 n=normalize(mp(p,ro).x - vec3(mp(p-e.xyy,ro).x,mp(p-e.yxy,ro).x,mp(p-e.yyx,ro).x));\n    if(s.y > 0.)\n    {\n        vec3 al= s.y == 1. ? vec3(0.,0.3,sin(iTime + s.x) * 0.5 + 0.5) : (s.y == 2. ? vec3(sin(iTime + s.x) * 0.5 + 0.5,0.,0.8) :\n        vec3(cos(-iTime),0.2,sin(-iTime)));\n        al.xy *= rot(iTime/10.);\n        al.xz *= rot(-iTime/10.);\n        al.zy *= rot(iTime/15.);\n        vec3 sss = vec3(0.5)*smoothstep(0.,1.,mp(p+-rd*0.2,ro).x/0.2);\n        float d = dot(n, -rd);\n        float diff = max(d, 0.);\n        float fres = pow(1. - d, 3.);\n        float spec = pow(abs(dot(reflect(rd,n),-rd)),20.);\n        float disf = pow(smoothstep(0., 128., s.x),3.);\n        float smx = mix(s.x, -s.x, sin(iTime));\n        float mx = mix(1. - disf, disf, smoothstep(0., 128., smx));\n        col = mix(al*(diff+fres+sss)+spec,col,mx);\n            vec3 rfd = reflect(rd, n);\n    vec3 rfo = p + n * 0.05;\n    vec2 s2=rm(rfo, rfd);\n    p=ro+rd*s2.x;\n    n=normalize(mp(p,rfo).x - vec3(mp(p-e.xyy,rfo).x,mp(p-e.yxy,rfo).x,mp(p-e.yyx,rfo).x));\n    if(s2.y > 0.)\n    {\n        vec3 al1= s2.y == 1. ? vec3(0.,0.3,sin(iTime + s2.x) * 0.5 + 0.5) : (s2.y == 2. ? vec3(sin(iTime + s2.x) * 0.5 + 0.5,0.,0.8) :\n        vec3(cos(-iTime),0.2,sin(-iTime)));\n        al1.xy *= rot(iTime/10.);\n        al1.xz *= rot(-iTime/10.);\n        al1.zy *= rot(iTime/15.);\n        vec3 sss1 = vec3(0.5)*smoothstep(0.,1.,mp(p+-rfd*0.2,rfo).x/0.2);\n        float d = dot(n, -rfd);\n        float diff1 = max(d, 0.);\n        float fres1 = pow(1. - d, 3.);\n        float spec1 = pow(abs(dot(reflect(rfd,n),-rfd)),20.);\n        float disf1 = pow(smoothstep(0., 128., s2.x),3.);\n        float smx1 = mix(s2.x, -s2.x, sin(iTime));\n        float mx1 = mix(1. - disf1, disf1, smoothstep(0., 128., smx));\n        vec3 refcol = mix(al1*(diff1+fres1+sss1)+spec1,col,mx);\n        col = mix(col, refcol, 0.3);\n    }\n    }\n   \n\n    fragColor = vec4(col * min(iTime * 0.1, 1.), 1.);\n}\n\n","name":"Image","description":"","type":"image"}]}