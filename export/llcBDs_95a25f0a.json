{"ver":"0.1","info":{"id":"llcBDs","date":"1541476441","viewed":222,"name":"Dark when Wet","username":"MoltenQwartz","description":"Darkening effect due to thin layer of liquid on top of a not absorbent material","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["refraction","wetness"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","previewfilepath":"/media/ap/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Implemntation of:\n// https://www.victoria.ac.nz/scps/about/staff/pdf/darkerwhenwet.pdf\n\n// http://forums.cgsociety.org/t/a-complete-ior-list/1070401\n// LIQUID IOR\nconst float nAcetone = 1.36;\nconst float nAlcoholEthyl = 1.36;\nconst float nAlcoholMethyl =  1.329;\nconst float nBeer = 1.345;\nconst float nCarbonatedBeverages = 1.356;\nconst float nChlorine = 1.385;\nconst float nCranberryJuice = 1.351;\nconst float nGlycerin = 1.473;\nconst float nHoney = 1.504;\nconst float nIce = 1.309;\nconst float nMilk = 1.35;\nconst float nOil = 1.47;\nconst float nRum = 1.361;\nconst float nShampoo = 1.362;\nconst float nSugarSolution = 1.49;\nconst float nTurpentine = 1.472;\nconst float nVodka = 1.363;\nconst float nWater = 1.33283;\nconst float nWhisky = 1.356;\n// SOLIDS\n// range from 1.5 to 2.3\n\n// Model constants:\n// two layer: top is fluid, bottom is solid\n// upper layer\nconst float nl = nWater;\n// lower layer\nconst float nr = 2.0;\n\nfloat Raverage_approx(float n)\n{\n    float n2 = n*n;\n    float n3 = n2*n;\n    float n4 = n3*n;\n    float n5 = n4*n;\n    float n6 = n5*n;\n    \n    return -0.0095*n6 + 0.1134*n5 - 0.5639*n4 + 1.4968*n3 - 2.2538*n2 + 1.9795*n - 0.7566;\n}\n\nfloat Raverage(float n)\n{\n    return Raverage_approx(n);\n    \n    /*\n    float n2 = n*n;\n    float n3 = n2*n;\n    \n    return (3.0*n2+2.0*n+1.0)/(3.0*(n+1.0)*(n+1.0)) - 2.0*n3*(n2+2.0*n-1.0)/((n2+1.0)*(n2+1.0)*(n2-1.0))\n        + n2*(n2+1.0)/((n2-1.0)*(n2-1.0)) * log(n) - n2*(n2-1.0)*(n2-1.0)/((n2+1.0)*(n2+1.0)*(n2+1.0)) * log(n*(n+1.0)/(n-1.0));\n    */\n}\n\n\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n\n\n    vec3 dryAlbedo = texture(iChannel0,uv).rgb;\n       \n    // https://www.victoria.ac.nz/scps/about/staff/pdf/darkerwhenwet.pdf\n    // total inner refraction with solid-liquid interface\n    float p = 1.0-1.0/(nl*nl)*(1.0-Raverage(nl));\n   \n    vec3 aD = 1.0 - dryAlbedo;\n    vec3 aW0 = aD * (1.0 - Raverage(nr/nl))/(1.0-Raverage(nr));\n    vec3 aW1 = aD;\n    \n    vec3 aW = (1.0-aD)*aW0 +  aD*aW1;\n    \n    vec3 A = (1.0-Raverage(nl))*aW/(1.0-p*(1.0-aW));\n    \n    \n    vec3 wetAlbedo = 1.0-A;\n    \n\n    // Output to screen\n    if(uv.y>0.5)\n    \tfragColor = vec4(wetAlbedo,1.0);\n    else\n    \tfragColor = vec4(dryAlbedo,1.0);\n}","name":"Image","description":"","type":"image"}]}