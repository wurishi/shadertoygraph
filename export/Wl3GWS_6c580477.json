{"ver":"0.1","info":{"id":"Wl3GWS","date":"1577463033","viewed":502,"name":"Bit Pattern Editor","username":"Catzpaw","description":"Clicking on a numeric cell clears it.\nClick outside to see hexadecimal and signed int. Default is uint.","likes":27,"published":1,"flags":32,"usePreview":1,"tags":["tool"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":3,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//---BitPattern Editor\n// by catzpaw 2019\n\n//STATE OPERATION (iChannel0)\nvec4 peek(in ivec2 a){return texelFetch(iChannel0,a,0);}\n\n//FONT (iChannel3)\nvec2 hom=vec2(0,0),cur=vec2(0,0);\nfloat siz=12.;\nvoid cr(){cur.x=hom.x;cur.y+=1./siz;}\nfloat chr(int c){\n    vec2 p=cur*siz;\n    vec4 t=p.x<.0||p.x>1.||p.y<0.||p.y>1.?vec4(0):\n        textureGrad(iChannel3,p/16.+fract(vec2(c,15-c/16)/16.),dFdx(p/16.),dFdy(p/16.));\n    cur.x-=(c>38&&c<47)?.4/siz:.5/siz;\n    return length(t.yz)==0.?0.:t.x;\n}\n\nint imod(int x,int y){return int(x-y*(x/y));}\nint imod(uint x,uint y){return int(x-y*(x/y));}\nfloat putint(vec2 p,uint n){\n\tfloat w=max(ceil(log(float(n)+1.)/log(10.)),1.);\n    siz=12.+w;p.y+=.6/siz;\n    cur=hom+p;cur.x+=(w/siz)*.25;\n    float c=0.;\n    c+=w>9.?chr(48+imod(n/1000000000u,10u)):0.;\n    c+=w>8.?chr(48+imod(n/100000000u,10u)):0.;\n    c+=w>7.?chr(48+imod(n/10000000u,10u)):0.;\n    c+=w>6.?chr(48+imod(n/1000000u,10u)):0.;\n    c+=w>5.?chr(48+imod(n/100000u,10u)):0.;\n    c+=w>4.?chr(48+imod(n/10000u,10u)):0.;\n    c+=w>3.?chr(48+imod(n/1000u,10u)):0.;\n    c+=w>2.?chr(48+imod(n/100u,10u)):0.;\n    c+=w>1.?chr(48+imod(n/10u,10u)):0.;\n    c+=chr(48+imod(n,10u));\n    return c;\n}\nfloat putint(vec2 p,int n){\n\tfloat w=max(ceil(log(abs(float(n)))/log(10.)),1.);\n    siz=12.+w;p.y+=.6/siz;\n    cur=hom+p;cur.x+=(w/siz)*.25;\n    cur.x+=n<0?(1./siz)*.25:0.;\n    float c=0.;\n    int s=n<0?-1:1;\n    c+=n<0?chr(45):0.;\n    c+=w>9.?chr(48+s*imod(n/1000000000,10)):0.;\n    c+=w>8.?chr(48+s*imod(n/100000000,10)):0.;\n    c+=w>7.?chr(48+s*imod(n/10000000,10)):0.;\n    c+=w>6.?chr(48+s*imod(n/1000000,10)):0.;\n    c+=w>5.?chr(48+s*imod(n/100000,10)):0.;\n    c+=w>4.?chr(48+s*imod(n/10000,10)):0.;\n    c+=w>3.?chr(48+s*imod(n/1000,10)):0.;\n    c+=w>2.?chr(48+s*imod(n/100,10)):0.;\n    c+=w>1.?chr(48+s*imod(n/10,10)):0.;\n    c+=chr(48+s*imod(n,10));\n    return c;\n}\nfloat puthex(vec2 p,uint n){\n    siz=14.;p.y+=.6/siz;\n    cur=hom+p;cur.x+=(2./siz)*.25;\n    float c=0.;\n    int b=imod(n/16u,16u)>9?55:48;\n    c+=chr(b+imod(n/16u,16u));\n    b=imod(n,16u)>9?55:48;\n    c+=chr(b+imod(n,16u));\n    return c;\n}\n\n//GRAPHICS\nfloat box(vec2 xy,vec2 p,vec3 s){s.xy-=s.z;s.xy*=.5;\n    return smoothstep(5e-3,0.,length(max(abs(xy-p-s.xy)-s.xy,0.))-s.z);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    //LOAD STATE\n    float mode=peek(txmode).x;\n    vec4 lmo=peek(txlmo);\n    vec4[8] pt;\n    for(int i=0;i<8;i++){\n        pt[i]=peek(txptn.xy+ivec2(i,0));\n    }\n\n    //COODINATES\n    vec2 uv=(fragCoord-.5*iResolution.xy)/iResolution.y;\n    vec2 xy=vec2(uv.x+.8,.5-uv.y);\n\n    //BACKGROUND\n    vec3 col=.3+.2*cos(iTime*.3+uv.xyx+vec3(0,2,4));\n\n    //PATTERN\n    float c=0.;\n    float x=.05,y=.07;\n    for(int i=0;i<8;i++){\n        for(int j=0;j<8;j++){\n            c+=box(xy,vec2(x,y),b1)*(.1+float((int(pt[i].x)>>(7-j))&1)*.9);\n            x+=.11;\n        }\n        c+=box(xy,vec2(x,y),b2)*.3;\n        x+=.16;\n        if((i&1)==0)c+=box(xy,vec2(x,y),b3)*.25;\n        x+=.21;\n        if((i&3)==0)c+=box(xy,vec2(x,y),b4)*.2;\n        x=.05;\n        y+=.11;\n    }\n\n    //DIGITS\n    hom=uv;cur=hom;\n    for(int i=0;i<8;i++){\n        if(mode==0.){\n\t\t    c+=putint(vec2(-.187,float(i)*.11-.385),uint(pt[i].x));\n        }else{\n\t\t    c+=puthex(vec2(-.187,float(i)*.11-.385),uint(pt[i].x));\n        }\n    }\n    for(int i=0;i<8;i+=2){\n\t    c+=putint(vec2(-.375,float(i)*.11-.33),(uint(pt[i].x)<<8)+uint(pt[i+1].x));\n    }\n    for(int i=0;i<8;i+=4){\n        uint n=(uint(pt[i].x)<<24)+(uint(pt[i+1].x)<<16)+(uint(pt[i+2].x)<<8)+uint(pt[i+3].x);\n        if(mode==0.){\n\t    c+=putint(vec2(-.613,float(i)*.11-.22),n);\n        }else{\n\t    c+=putint(vec2(-.613,float(i)*.11-.22),int(n));\n        }\n    }\n\n    col+=c;\n    fragColor = vec4(col,1.0);\n}\n","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"//---BitPattern Editor\n// by catzpaw 2019\n\n//STATE OPERATION\nvec4 peek(in ivec2 a){return texelFetch(iChannel0,a,0);}\nvoid poke(in ivec2 a,in vec4 v,inout vec4 fragColor,in ivec2 p){fragColor=(p==a)?v:fragColor;}\nvoid poke(in ivec4 a,in vec4 v,inout vec4 fragColor,in ivec2 p){fragColor=(p.x>=a.x&&p.y>=a.y&&p.x<=a.z&&p.y<=a.w)?v:fragColor;}\n\n//BUTTONS\nfloat chkrect(vec2 c,vec4 r,float d){\n    return((c.x>r.x)&&(c.x<r.x+r.z)&&(c.y>r.y)&&(c.y<r.y+r.w))?floor((c.y-r.y)/(r.w/d)):-1.;\n}\n\n//MAIN\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\n    //FRAME INIT\n    if(fragCoord.x>memx||fragCoord.y>memy)discard;\n    ivec2 fcd=ivec2(fragCoord-.5);\n    fragColor=vec4(0);\n\n    //LOAD STATE\n    float mode=peek(txmode).x;\n    vec4 stat=peek(txstat);\n    vec4 lmo=peek(txlmo);\n    vec4[8] pt;\n    for(int i=0;i<8;i++){\n        pt[i]=peek(txptn.xy+ivec2(i,0));\n    }\n\n    //FIRST FRAME\n    if(iFrame==0)stat.x=-1.;\n\n    if(stat.x<-.5){\n        stat.x=1.;\n        mode=0.;\n        lmo=iMouse;\n        pt[0].x=60.;\n        pt[1].x=66.;\n        pt[2].x=145.;\n        pt[3].x=161.;\n        pt[4].x=161.;\n        pt[5].x=133.;\n        pt[6].x=66.;\n        pt[7].x=60.;\n    }\n\n    //COMPUTE\n    if(stat.x>.5){\n        bool click=((iMouse.z>1e-3)&&(lmo.z<-1e-3))?true:false;\n        if(click){\n            ivec2 fc=ivec2(fragCoord.xy);\n            vec2 uv=(fragCoord.xy-.5*iResolution.xy)/iResolution.y;\n            vec2 xy=vec2(uv.x+.8,.5-uv.y);\n            vec2 mo=(iMouse.xy-.5*iResolution.xy)/iResolution.y;\n            mo=vec2(mo.x+.8,.5-mo.y);\n            //EDIT\n            for(int i=0;i<8;i++){\n                int sel=int(chkrect(mo,r1+vec4(float(i)*.11,0,0,0),8.));\n                if((sel>=0)&&(fc==ivec2(sel,1))){\n                    int bp=int(pt[sel].x);\n                    int b=bp&(128>>i);\n                    if(b>0){\n                        pt[sel].x=float(bp-b);\n                    }else{\n                        pt[sel].x=float(bp|(128>>i));\n                    }\n                }\n            }\n            \n            //CLEAR 8\n            int sel=int(chkrect(mo,r2,8.));\n            if((sel>=0)&&(fc==ivec2(sel,1))){\n                int bp=int(pt[sel].x);\n                pt[sel].x=float(bp>0?0:255);\n            }\n            //CLEAR 16\n            sel=int(chkrect(mo,r3,4.))*2;\n            if((sel>=0)&&(fc.y==1)&&((fc.x==sel)||(fc.x==sel+1))){\n                int bp=int(pt[sel].x)|int(pt[sel+1].x);\n                pt[sel].x=float(bp>0?0:255);\n                pt[sel+1].x=float(bp>0?0:255);\n            }\n            //CLEAR 32\n            sel=int(chkrect(mo,r4,2.))*4;\n            if((sel>=0)&&(fc.y==1)&&((fc.x>-1)||(fc.x<4))){\n                int bp=int(pt[sel].x)|int(pt[sel+1].x)|int(pt[sel+2].x)|int(pt[sel+3].x);\n                pt[sel].x=float(bp>0?0:255);\n                pt[sel+1].x=float(bp>0?0:255);\n                pt[sel+2].x=float(bp>0?0:255);\n                pt[sel+3].x=float(bp>0?0:255);\n            }\n            //MODE\n            if((chkrect(mo,r0,1.)<0.)&&(fc==txmode)){\n                mode=1.-mode;\n            }\n        }\n    }\n    lmo=iMouse;\n\n    //STORE STATE\n    poke(txstat,stat,fragColor,fcd);\n    poke(txmode,vec4(mode,0,0,0),fragColor,fcd);\n    poke(txlmo,lmo,fragColor,fcd);\n    poke(txptn,pt[int(fragCoord.x)],fragColor,fcd);\n\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"//---BitPattern Editor\n// by catzpaw 2019\n\n//STATE\nconst float memx=8.,memy=2.;\nconst ivec2 txstat=ivec2(0,0);\nconst ivec2 txmode=ivec2(1,0);\nconst ivec2 txlmo =ivec2(2,0);\nconst ivec2 txcol =ivec2(3,0);\nconst ivec4 txptn =ivec4(0,1,7,1);\n\n//ROUNDBOX\nconst vec3 b1=vec3(.10,.10,1e-3);\nconst vec3 b2=vec3(.15,.10,1e-3);\nconst vec3 b3=vec3(.20,.21,1e-3);\nconst vec3 b4=vec3(.25,.43,1e-3);\n\n//REGION\nconst vec4 r0=vec4(0.05,.07,1.5,.87);\nconst vec4 r1=vec4(0.05,.07,.10,.87);\nconst vec4 r2=vec4(0.93,.07,.15,.87);\nconst vec4 r3=vec4(1.09,.07,.20,.87);\nconst vec4 r4=vec4(1.30,.07,.25,.87);\n","name":"Common","description":"","type":"common"}]}