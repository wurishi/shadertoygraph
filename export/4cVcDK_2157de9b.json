{"ver":"0.1","info":{"id":"4cVcDK","date":"1732401892","viewed":90,"name":"gyroid demonstration loop","username":"ufffd","description":"gyroid demonstration loop","likes":4,"published":3,"flags":0,"usePreview":0,"tags":["raymarcher","kilobyte"],"hasliked":0,"parentid":"lcfXD8","parentname":"kbmarcher genuary14 2024"},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI 3.14159\n#define SS(a,b,c) smoothstep(a-b,a+b,c)\n#define gyr(p) dot(sin(p.xyz),cos(p.zxy))\n#define T (iTime*.7)\n#define R iResolution\n#define rot(r) mat2(sin(r),cos(r),-cos(r),sin(r))\nfloat map(in vec3 p, float cen) {\n    float roid = gyr((p*10.))+0.;\n    roid = max(length(p)-1.5,roid);\n    return max(roid, (p.x-cen)-.02);\n}\nfloat map2(in vec3 p, float cen) {\n    float roid = gyr((p*10.))+0.;\n    roid = max(length(p)-1.5,roid);\n    return max(roid, abs(p.x-cen)-.02);\n}\nfloat mapE(in vec3 p) {\n    float roid = gyr((p*10.))+0.;\n    return distance(length(p)-1.5,roid);\n}\nvec3 norm(in vec3 p, float cen) {\n    vec2 d = vec2(.06+.06*sin(p.z),0.);\n    return map(p,cen)-vec3(\n        map(p-d.xyy,cen),map(p-d.yxy,cen),map(p-d.yyx,cen)\n    );\n}\nvec3 norm2(in vec3 p, float cen) {\n    vec2 d = vec2(.06+.06*sin(p.z),0.);\n    return map2(p,cen)-vec3(\n        map2(p-d.xyy,cen),map2(p-d.yxy,cen),map2(p-d.yyx,cen)\n    );\n}\nvoid mainImage( out vec4 color, in vec2 coord ) {\n    vec2 uv = coord/R.xy;\n    vec2 uvc = (coord-R.xy/2.)/R.y;\n    float cen = sin(T+2.)*2.4+.82;\n    vec3 ro = vec3(0.,0.,-4.);\n    vec3 rd = normalize(vec3(uvc.xy,1.));\n    ro.xz *= rot(T+1.);\n    rd.xz *= rot(T+1.);\n    bool hit = false;\n    {\n    float d = 0.;\n    float dd = 1.;\n    vec3 p = ro;\n    for (float i=0.;i<400. && dd>.001 && d < 20.;i++) {\n        d += dd;\n        p += rd*dd;\n        dd = map(p, cen)*.05;\n        if (dd<.001) hit = true;\n    }\n    vec3 n = norm(p, cen);\n    float bw = dot(n,vec3(0,1,0))+(1./d);\n    bw += SS(cen-.05,0.1,p.x) * SS(cen+.05,-0.1,p.x) * 4./(d*d);\n    // bw *= SS(.9,.15,1./d);\n    color = vec4(vec3(bw),1.0);\n    color.gr -= .1*SS(1.5,0.01,length(p));\n    // draw edges\n    float e = mapE(p);\n    color.g += .2*e*float(hit);\n    color *= 1.+.3*float(hit);\n    }\n    // 2nd march, xray\n    {\n    float d = 0.;\n    float dd = 1.;\n    vec3 p = ro;\n    for (float i=0.;i<500. && dd>.001 && d < 20.;i++) {\n        d += dd;\n        p += rd*dd;\n        dd = map2(p,cen)*.05;\n    }\n    vec3 n = norm2(p,cen);\n    float bw = dot(n,vec3(0,1,0))+(1./d);\n    // bw *= SS(.9,.15,1./d);\n    color += vec4(vec3(2.)*bw,1.0);\n    }\n    if (!hit) color *= .0;\n}","name":"Image","description":"","type":"image"}]}