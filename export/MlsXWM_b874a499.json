{"ver":"0.1","info":{"id":"MlsXWM","date":"1437251875","viewed":459,"name":"NES CRT simulation","username":"r57shell","description":"some details http://forums.nesdev.com/viewtopic.php?f=3&t=12788&start=15","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["crt"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"// WARNING: NOOB HERE :)\n// Stream RU\n// http://sc2tv.ru/channel/r57shell\n// http://cybergame.tv/r57shell\n// http://twitch.tv/elektropage\n\n// some details\n// http://forums.nesdev.com/viewtopic.php?f=3&t=12788&start=15\n\n\n// CG version for retroarch http://pastebin.com/aW3nCjaf\n\n// old version\n/*void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    float pi = acos(-1.0);\n    float angle = -0.1;\n    \n    vec2 dir = vec2(cos(angle), sin(angle));\n    \n    float phase = dot(uv, dir)*700.+iTime*500.;\n    float luma = 1.0-(sin(phase)/2.+0.5)/4.;\n    uv.x *= iChannelResolution[0].y/iChannelResolution[0].x;\n    uv.y = 1.-uv.y;\n    uv *= 10.;\n    uv.x -= floor(uv.x);\n    uv.y -= floor(uv.y);\n\tfragColor = luma*texture(iChannel0, uv);\n    float k = 1.0;\n    float test = fragCoord.x/k;\n    float xpos = test-floor(test/3.0)*3.;\n    if (xpos < 1.)\n        fragColor.yz = vec2(0.);\n    else if (xpos < 2.)\n        fragColor.xz = vec2(0.);\n    else if (xpos < 3.)\n        fragColor.xy = vec2(0.);\n    float test2 = fragCoord.y/k/2.0 + floor(test/3.)/2.;\n    float ypos = test2-floor(test2/3.0)*3.;\n    float z = sin((test-floor(test))*pi);\n    float w = sin((test2-floor(test2))*pi)*2.;\n    float t = pow(z+0.3,2.0);\n    float t2 = pow(w+0.3,2.0);\n    if (t > 1.0)\n        t = 1.0;\n   \tif (t2 > 1.0)\n        t2 = 1.0;\n    fragColor*= t*t2; \n}*/\n\nconst vec2 size = vec2(320.,240.);\nconst float pi = 3.142;\n\nvec3 monitor(vec2 p)\n{\n\tvec2 pos = floor(p*size);\n\tvec2 uv = floor(pos)/size;\n   \tvec4 res = texture(iChannel0, uv);\n    vec3 yuv = res.xyz*mat3(\n        0.2126, 0.7152, 0.0722,\n\t\t-0.09991, -0.33609, 0.436,\n\t\t0.615, -0.55861, -0.05639);\n    float alpha = (floor(p.x*size.x*4.)/2.0)*pi;\n    vec2 sincv = vec2(cos(alpha), sin(alpha));\n    if (mod(pos.y + 5.,4.) < 2.)\n     sincv.x = -sincv.x;\n    if (mod(pos.y, 4.) >= 2.)\n     sincv.y = -sincv.y;\n    float mc = 1.+dot(sincv, yuv.zy)/yuv.x;\n\n    /*vec3 rgb = vec3(\n        yuv.x + 1.28033 * yuv.z,\n\t\tyuv.x - 0.21482 * yuv.y - 0.38059 * yuv.z,\n\t\tyuv.x + 2.12798 * yuv.y);*/\n    return res.xyz*mc;\n}\n\n// pos (left corner, sample size)\nvec4 monitor_sample(vec2 p, vec2 sample)\n{\n\t// linear interpolation was...\n    // now other thing.\n    // http://imgur.com/m8Z8trV\n    // AT LAST IT WORKS!!!!\n    vec2 next = vec2(.25,1.)/size;\n    vec2 f = fract(vec2(4.,1.)*size*p);\n    sample *= vec2(4.,1.)*size;\n    vec2 l;\n    vec2 r;\n    if (f.x+sample.x < 1.)\n    {\n       \tl.x = f.x+sample.x;\n        r.x = 0.;\n    }\n    else\n    {\n        l.x = 1.-f.x;\n        r.x = min(1.,f.x+sample.x-1.);\n    }\n    if (f.y+sample.y < 1.)\n    {\n       \tl.y = f.y+sample.y;\n        r.y = 0.;\n    }\n    else\n    {\n        l.y = 1.-f.y;\n        r.y = min(1.,f.y+sample.y-1.);\n    }\n    vec3 top = mix(monitor(p),monitor(p+vec2(next.x,0.)),r.x/(l.x+r.x));\n    vec3 bottom = mix(monitor(p+vec2(0.,next.y)),monitor(p+next),r.x/(l.x+r.x));\n   \treturn vec4(mix(top,bottom,r.y/(l.y+r.y)),1.0);\n    //difference should be only on border of pixels\n    //return vec4((mix(top,bottom,r.y/(l.y+r.y)) - monitor(p))*2.+0.5,1.0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tfloat zoom = 1.;\n\tfragColor = monitor_sample(fragCoord.xy/zoom/iResolution.xy, 1./zoom/iResolution.xy);\n}\n","name":"","description":"","type":"image"}]}