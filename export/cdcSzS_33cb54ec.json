{"ver":"0.1","info":{"id":"cdcSzS","date":"1679989297","viewed":128,"name":"fill all closed polygon v1","username":"yunhai","description":"my resolution for a problem: \"how to fill all the closed polygon in a texture\"\nhttps://www.zhihu.com/question/592147611/answer/2957248432","likes":1,"published":1,"flags":32,"usePreview":0,"tags":["try"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 O, in vec2 I )\n{\n    //O=1.-texture(iChannel0,I/iResolution.xy);\n    O=texture(iChannel0,I/iResolution.xy);\n\n    if(equalsZero(O.a-.1))//mask.alpha=.1\n        O.rgb=vec3(.2);\n\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"\nfloat lineSeg(vec2 p,vec2 s,vec2 e){vec2 sp=p-s,se=e-s;\n      return SL(length(p-clamp(dot(sp,se)/dot(se,se),0.,1.)*se-s));}\nfloat polygon(vec2 uv,in vec2 arr[10],int size)\n{\n    float d=0.;\n    for(int i=0;i<size;i++)\n    {\n        d=mix(d,1.,lineSeg(uv,arr[i],arr[(i+1)%size]));\n    }\n    return d;\n}\n\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    if(iFrame<5)//polygon defination\n    {\n    \n    vec2 uv=(I-.5*iR)*PIXW;;\n    \n    O = vec4(0);\n    vec2 off=vec2(-4.,1.);\n    vec2 arr[10];\n    arr[0]=vec2(5,2);\n    arr[1]=vec2(-1,2);\n    arr[2]=vec2(2,-2);\n    for(int i=0;i<3;i++)\n        arr[i]+=off;\n    O=mix(O,vec4(1.,1.,0.,1.),polygon(uv,arr,3));\n    \n    off=vec2(-0.,-2.);\n    arr[0]=vec2(-2,-2);\n    arr[1]=vec2(-8,-2);\n    arr[2]=vec2(-8,4);\n    arr[3]=vec2(-4,-1);\n    arr[4]=vec2(0,0);\n    for(int i=0;i<5;i++)\n        arr[i]+=off;\n    \n    O=mix(O,vec4(0.,1.,0.,1.),polygon(uv,arr,5));\n    \n    \n    off=vec2(-0.,-3.);\n    arr[0]=vec2(-2,-2);\n    arr[1]=vec2(-8,-2);\n    arr[2]=vec2(-8,1);\n    arr[3]=vec2(-4,-1);\n    arr[4]=vec2(0,0);\n    for(int i=0;i<5;i++)\n        arr[i]=-arr[i]+off;\n    \n    O=mix(O,vec4(0.,1.,1.,1.),polygon(uv,arr,5));\n    }\n    else if(iFrame<7)//init texture outline\n    {\n        O=texture(iChannel0,I/iResolution.xy);\n        if(I.x<1.||I.y<1.||I.y>iR.y-1.||I.x>iR.x-1.)\n            O=vec4(0,0,0,0.1);//mask.alpha=.1\n    }\n    else if(iFrame<450)//flood fill mask\n    {\n        O=texture(iChannel0,I/iResolution.xy);\n        if(equalsZero(O.a-1.)) return;\n        for(float i=0.;i<2.9;i++)\n            for(float j=0.;j<2.9;j++)\n            {\n                vec2 samp=I+vec2(i-1.,j-1.);\n                vec4 col=texture(iChannel0,samp/iResolution.xy);\n                if(equalsZero(col.a-.1))\n                {\n                    O=col;\n                    return;\n                }\n            }\n\n    }\n    else\n    {\n        O=texture(iChannel0,I/iResolution.xy);\n                if(!equalsZero(O)) return;\n        for(float i=0.;i<2.9;i++)\n            for(float j=0.;j<2.9;j++)\n            {\n                vec2 samp=I+vec2(i-1.,j-1.);\n                vec4 col=texture(iChannel0,samp/iResolution.xy);\n                if(equalsZero(col.a-1.))\n                {\n                    O=col;\n                    return;\n                }\n            }\n\n\n    }\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define iR (iResolution.xy)\n#define PIXW (CANVAS_WIDTH/iR.x)\n#define LW (1.*PIXW)\n#define SL(d) step(d,LW)\n//#define SL(d) smoothstep(3.*LW,0.,d)\nconst float CANVAS_WIDTH=20.;\nbool equalsZero(float a)\n{\n    return abs(a)<1e-4;\n}\nbool equalsZero(vec4 a)\n{\n    return equalsZero(a.x+a.y+a.z+a.w);\n}","name":"Common","description":"","type":"common"}]}