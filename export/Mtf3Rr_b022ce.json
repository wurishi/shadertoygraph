{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"// http://www.fractalforums.com/movies-showcase-%28rate-my-movie%29/very-rare-deep-sea-fractal-creature/\n\nconst int Iterations=20;\nconst float Scale=1.25;\nconst vec3 Julia=vec3(-3.,-1.5,-0.5);\nconst vec3 RotVector=vec3(0.5,-0.05,-1.);\nconst float RotAngle=40.;\nconst float Speed=1.3;\nconst float Amplitude=0.6;\nconst float detail=.025;\nconst vec3 lightdir=-vec3(0.,1.,0.);\n\nmat2 rot;\n\nfloat de(vec3 p); \nvec3 color(vec3 p);\n\nvec3 normal(vec3 p) {\n\tvec3 e = vec3(0.0,detail,0.0);\n\t\n\treturn normalize(vec3(\n\t\t\tde(p+e.yxx)-de(p-e.yxx),\n\t\t\tde(p+e.xyx)-de(p-e.xyx),\n\t\t\tde(p+e.xxy)-de(p-e.xxy)\n\t\t\t)\n\t\t);\t\n}\n\nfloat calcAO( const vec3 pos, const vec3 nor ) {\n\tfloat aodet=detail*3.;\n\tfloat totao = 0.0;\n    float sca = 1.0;\n    for( int aoi=0; aoi<5; aoi++ ) {\n        float hr = aodet*float(aoi*aoi);\n        vec3 aopos =  nor * hr + pos;\n        float dd = de( aopos );\n        totao += -(dd-hr)*sca;\n        sca *= 0.7;\n    }\n    return clamp( 1.0 - 5.0*totao, 0., 1.0 );\n}\n\n\nfloat softshadow( in vec3 ro, in vec3 rd, float mint, float k )\n{\n    float res = 1.0;\n    float t = mint;\n    for( int i=0; i<48; i++ )\n    {\n        float h = de(ro + rd*t);\n\t\th = max( h, 0.0 );\n        res = min( res, k*h/t );\n        t += clamp( h, 0.01, 0.5 );\n    }\n    return clamp(res,0.0,1.0);\n}\n\n\n\n\nvec3 light(in vec3 p, in vec3 dir) {\n\tvec3 ldir=normalize(lightdir);\n\tvec3 n=normal(p);\n\tfloat sh=softshadow(p,-ldir,1.,20.);\n\tfloat diff=max(0.,dot(ldir,-n));\n\tvec3 r = reflect(ldir,n);\n\tfloat spec=max(0.,dot(dir,-r));\n\tvec3 colo=color(p);\n    return (diff*sh+.15*max(0.,dot(normalize(dir),-n))*calcAO(p,n))*colo+pow(spec,30.)*.5*sh;\t\n\t\t}\n\n\nfloat kaliset(vec3 p) {\n    p.y-=iTime;\n\tp.y=abs(2.-mod(p.y,4.));\n    for (int i=0;i<18;i++) p=abs(p)/dot(p,p)-.8;\n    return length(p);\n}\n\n\nvec3 raymarch(in vec3 from, in vec3 dir, vec2 fragCoord)\n{\n\tvec3 col=vec3(0.);\n    float st,d=1.0,totdist=st=0.;\n\tvec3 p;\n\tfloat k;\n    for (int i=0; i<70; i++) {\n\tif (d>detail && totdist<50.)\n\t{\n\t\tk+=kaliset(p)*exp(-.002*totdist*totdist)*max(0.,totdist-3.)*(1.-step(0.,.2-d));\n        p=from+totdist*dir;\n\t\td=de(p);\n\t\ttotdist+=d;\n\t}\n\t}\n\tvec3 backg=vec3(.4,.5,.55)*(1.+fragCoord.y/iResolution.y*1.5);\n\tif (d<detail) {\n\t\tcol=light(p-detail*dir, dir); \n\t} else { \n\t\tcol=vec3(backg);\n\t}\n\tcol = mix(col, vec3(backg), 1.0-exp(-.002*totdist*totdist));\n    return col+k*.002;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tfloat t=iTime*.3;\n\tvec2 uv = fragCoord.xy / iResolution.xy*2.-1.;\n\tuv.y*=iResolution.y/iResolution.x;\n\tvec3 from=vec3(0.,-.7,-25.+sin(t)*8.);\n\tvec3 dir=normalize(vec3(uv,1.));\n\trot=mat2(cos(-.5),sin(-.5),-sin(-.5),cos(-.5));\n\tdir.yz=dir.yz*rot;\n\tfrom.yz=from.yz*rot;\n\n\tvec3 col=raymarch(from,dir,fragCoord); \n\tcol*=max(0.,.1-length(uv*.05))/.1;\n    fragColor = vec4(col,1.);\n}\n\n\nmat3  rotationMatrix3(vec3 v, float angle)\n{\n\tfloat c = cos(radians(angle));\n\tfloat s = sin(radians(angle));\n\t\n\treturn mat3(c + (1.0 - c) * v.x * v.x, (1.0 - c) * v.x * v.y - s * v.z, (1.0 - c) * v.x * v.z + s * v.y,\n\t\t(1.0 - c) * v.x * v.y + s * v.z, c + (1.0 - c) * v.y * v.y, (1.0 - c) * v.y * v.z - s * v.x,\n\t\t(1.0 - c) * v.x * v.z - s * v.y, (1.0 - c) * v.y * v.z + s * v.x, c + (1.0 - c) * v.z * v.z\n\t\t);\n}\n\n\nfloat de(vec3 p) {\n\tp=p.zxy;\n\tfloat a=1.5+sin(iTime*.3578)*.5;\n\tp.xy=p.xy*mat2(cos(a),sin(a),-sin(a),cos(a));\n\tp.x*=.75;\n\tfloat time=iTime*Speed;\n\tvec3 ani;\n\tani=vec3(sin(time),sin(time),cos(time))*Amplitude;\n\tp+=sin(p*3.+time*6.)*.04;\n\tmat3 rot = rotationMatrix3(normalize(RotVector+ani), RotAngle+sin(time)*10.);\n\tvec3 pp=p;\n\tfloat l;\n\tfor (int i=0; i<Iterations; i++) {\n\t\tp.xy=abs(p.xy);\n\t\tp=p*Scale+Julia;\n\t\tp*=rot;\n\t\tl=length(p);\n\t}\n\treturn l*pow(Scale, -float(Iterations))-.1;\n}\n\n\n\nvec3 color(vec3 p) {\n\tp=p.zxy;\n\tfloat a=1.5+sin(iTime*.3578)*.5;\n\tp.xy=p.xy*mat2(cos(a),sin(a),-sin(a),cos(a));\n\tp.x*=.75;\n\tfloat time=iTime*Speed;\n\tvec3 ani;\n\tani=vec3(sin(time),sin(time),cos(time))*Amplitude;\n\tp+=sin(p*3.+time*6.)*.04;\n\tmat3 rot = rotationMatrix3(normalize(RotVector+ani), RotAngle+sin(time)*10.);\n\tvec3 pp=p;\n\tfloat l;\n\tfloat ot=9999.;\n    for (int i=0; i<15; i++) {\n\t\tp.xy=abs(p.xy);\n\t\tp=p*Scale+Julia;\n\t\tp*=rot;\n\t\tl=length(p.x);\n        ot=min(l,ot);\n\t}\n\treturn mix(vec3(1.,0.2,0.1),vec3(0.6,0.5,0.6),max(0.,2.-ot)/2.);\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"Mtf3Rr","date":"1417820420","viewed":2911,"name":"Underwater Fractal Creature","username":"Kali","description":"Enhanced version of my original \"LivingKIFS\" shader.","likes":86,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","fractal","kifs"],"hasliked":0,"parentid":"","parentname":""}}