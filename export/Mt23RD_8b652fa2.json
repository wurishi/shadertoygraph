{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"cubemap","id":"XdX3zn","filepath":"/media/a/488bd40303a2e2b9a71987e48c66ef41f5e937174bf316d3ed0e86410784b919.jpg","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define MAX_DIST 20.0\n\nfloat f(in float x, in float z)\n{\n    float y = cos(x) + cos(z) + cos(x * 8.0) * 0.16;\n    return y;\n}\n\nvec3 castRay(in vec3 ro, in vec3 rd)\n{\n    const float maxt = MAX_DIST;\n    const float delt = MAX_DIST / 1000.0;\n    \n    for(float t = 0.0; t < MAX_DIST; t += delt)\n    {\n        vec3 p = ro + rd*maxt*pow(t/maxt, 1.5);\n        \n        if (p.y < f(p.x, p.z)) {\n            return p;\n        }\n    }\n    \n    return ro + rd*maxt;\n}\n\nvec3 getNormal(in vec3 p)\n{\n    float eps = 0.001;\n    vec3 n = vec3(f(p.x - eps, p.z) - f(p.x + eps, p.z),\n                  2.0*eps,\n                  f(p.x, p.z - eps) - f(p.x, p.z + eps) );\n    return normalize(n);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    vec2 uv = fragCoord.xy / iResolution.xy;\n    float t = iTime * 0.5;\n    \n    vec3 ro = vec3(0.0, 2.5 + f(0.0, t), t);\n    vec3 rd = vec3(uv.x - 0.5 + sin(t * 0.6) * 0.15, uv.y - 1.0, 0.6);\n    rd = normalize(rd);\n    \n    vec3 hitp = castRay(ro, rd);\n    float ndist = distance(ro, hitp) / MAX_DIST;\n    vec3 normal = getNormal(hitp);\n    \n    vec4 baseColor = vec4(0.8, 0.6, 0.8, 1.0);\n    vec4 cubeColor = texture(iChannel0, reflect(rd, normal));\n    vec4 color = mix(baseColor, cubeColor, 0.5);\n        \n    vec3 lightDir = normalize(vec3(cos(t) * 0.5, 0.5, sin(t) * 0.5));\n    float light = clamp(dot(normal, lightDir), 0.0, 1.0);\n    float specular = pow(clamp(dot(reflect(rd, normal), lightDir), 0.0, 1.0), 64.0);\n    vec4 fog = pow(ndist, 2.0) * vec4(0.5, 0.5, 1.0, 1.0) + pow(ndist, 4.0);\n    fragColor = color * light + specular + fog;\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"Mt23RD","date":"1427448561","viewed":250,"name":"Glossy Hills","username":"purton","description":"Testing raymarching with glossy hills.","likes":6,"published":1,"flags":0,"usePreview":0,"tags":["3d","raymarching","cubemap","lightning","hills","glossy"],"hasliked":0,"parentid":"","parentname":""}}