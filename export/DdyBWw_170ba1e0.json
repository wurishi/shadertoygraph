{"ver":"0.1","info":{"id":"DdyBWw","date":"1698251811","viewed":75,"name":"OKLab hue rotation","username":"charmless","description":"Excuse to fiddle with OKLab","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["hue","oklab"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xdf3Rn","filepath":"/media/a/e81e818ac76a8983d746784b423178ee9f6cdcdf7f8e8d719341a6fe2d2ab303.webm","previewfilepath":"/media/ap/e81e818ac76a8983d746784b423178ee9f6cdcdf7f8e8d719341a6fe2d2ab303.webm","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// conversion are from https://bottosson.github.io/posts/oklab/\n\nvec3 linear_srgb_to_oklab(vec3 c) \n{\n    float l = 0.4122214708f * c.x + 0.5363325363f * c.y + 0.0514459929f * c.b;\n\tfloat m = 0.2119034982f * c.x + 0.6806995451f * c.y + 0.1073969566f * c.b;\n\tfloat s = 0.0883024619f * c.x + 0.2817188376f * c.g + 0.6299787005f * c.b;\n\n    float l_ = pow(l, 1./3.);\n    float m_ = pow(m, 1./3.);\n    float s_ = pow(s, 1./3.);\n\n    return vec3 (\n        0.2104542553f*l_ + 0.7936177850f*m_ - 0.0040720468f*s_,\n        1.9779984951f*l_ - 2.4285922050f*m_ + 0.4505937099f*s_,\n        0.0259040371f*l_ + 0.7827717662f*m_ - 0.8086757660f*s_);\n}\n\nvec3 oklab_to_linear_srgb(vec3 c) \n{\n    float l_ = c.x + 0.3963377774f * c.y + 0.2158037573f * c.z;\n    float m_ = c.x - 0.1055613458f * c.y - 0.0638541728f * c.z;\n    float s_ = c.x - 0.0894841775f * c.y - 1.2914855480f * c.z;\n\n    float l = l_*l_*l_;\n    float m = m_*m_*m_;\n    float s = s_*s_*s_;\n\n    return vec3(\n\t\t+4.0767416621f * l - 3.3077115913f * m + 0.2309699292f * s,\n\t\t-1.2684380046f * l + 2.6097574011f * m - 0.3413193965f * s,\n\t\t-0.0041960863f * l - 0.7034186147f * m + 1.7076147010f * s);\n}\n\n\nmat2 rotate2d(float rad){\n    return mat2(cos(rad),-sin(rad),\n                sin(rad),cos(rad));\n}\n\nvec3 rotate_hue(vec3 color, float t)\n{\n    mat2 rot = rotate2d(3.1415926*2.0*(fract(t)));\n\n    vec3 color_srgb = pow(color,vec3(2.2));\n    vec3 color_oklab = linear_srgb_to_oklab(color_srgb);\n    \n    vec2 color_hue_rotated = rot*color_oklab.yz;\n    vec3 color_oklab_hue_rotated =    \n        vec3(color_oklab.x, \n             color_hue_rotated.x,\n             color_hue_rotated.y);\n             \n    vec3 color_srgb_out = oklab_to_linear_srgb(color_oklab_hue_rotated);\n    vec3 color_rgb_out = pow(color_srgb_out,vec3(1./2.2)) ;\n    return color_rgb_out;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\tfragColor = texture(iChannel0, uv);\n    float foo = (atan(uv.x - 0.5, uv.y-0.5) / 3.1415926); // / (3.1415926*2.0);\n    fragColor.rgb = rotate_hue(fragColor.rgb, foo + iTime);\n    //iTime * 0.3 + pow(uv.x, 3.0) );\n\n}\n","name":"Image","description":"","type":"image"}]}