{"ver":"0.1","info":{"id":"dtBczG","date":"1691912996","viewed":148,"name":"quartz clusters","username":"chenxianming","description":"make this scene inspired from crystal and light reflect / refract cross beer glass.","likes":10,"published":1,"flags":0,"usePreview":0,"tags":["crystal","cluster"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// animation loop\nfloat q(float a) { return fract(iTime * a) * 3.141593 * 4.; }\n// smin / smax\nfloat k(float a, float b, float c) {\n  float d = clamp(.5 + .5 * (b - a) / c, 0., 1.);\n  return mix(b, a, d) - c * d * (1. - d);\n}\nfloat l(float a, float b, float c) { return -k(-a, -b, c); }\n// rotation\nmat2 j(float a) {\n  float b = sin(a), c = cos(a);\n  return mat2(c, b, -b, c);\n}\n// geometry\nfloat r(vec3 b, float c) {\n  float d = .1, a = 1.;\n  a = b.y, a = abs(a) - .5, a = abs(a),\n  d = l(l(abs(b.x) - .5 * a, abs(b.z) - .5 * a, c), abs(b.y) - .5, c);\n  return d;\n}\n// sdf\nfloat m(vec3 a) {\n  float c = 5.;\n  a.z -= 2., a.xz *= j(q(5e-3));\n  float d = .8;\n  for (float b = 0.; b < round( 19. + fract( iTime * .05 ) * 4. ); b++)\n    a.xz *= j(b), d += b / 15., a.xz = abs(a.xz) - .01 * b,\n                                a.y += d * .01 * round(fract(iTime * .15) * -1.),\n                                a.zy *= -j(b);\n  c = k(c, r(a, 0.), 0.);\n  return c;\n}\n// trace\nvec3 t(vec3 n, vec3 i) {\n  float d = 0., e = 0., f = 0., g = 0., a = 0., b = .3;\n  b = 1. - b, g = sqrt(1e-4) * (1. - b);\n  vec3 c = vec3(0), h = vec3(0);\n  for (int o = 0; o < 32; o++) {\n    c = n + i * d, e = m(c), a = 1. - abs(e) / g;\n    if (a > 0.)\n      h += .1 * a / d, f++;\n    if (f > 10.)\n      break;\n    d += max(abs(e), g * b);\n  }\n  c = vec3(0), b = .8, b = 1. - b, a = 0., f = 0.;\n  for (int p = 0; p < 10; p++) {\n    c = n + i * d, c = reflect(c, i) + normalize(i) * .5, e = m(c),\n    a = 1. - abs(e) / g;\n    if (a > 0.) {\n      vec3 u = vec3(a * .01);\n      h -= .5 * (u + .25 * a / d), h += sign(h) * .08, f++;\n    }\n    if (f > 6.)\n      break;\n    d -= max(abs(e), g * b);\n  }\n  return h;\n}\n// main\nvoid mainImage(out vec4 b, in vec2 c) {\n  vec2 a = c / iResolution.xy;\n  a = (a - .5) * 2., a.x *= iResolution.x / iResolution.y;\n  vec3 d = vec3(0), f = vec3(0, 0, -7), e = vec3(a, 1);\n  e.xy *= .08, d = t(f, e), b = vec4(d, 1);\n}","name":"Image","description":"","type":"image"}]}