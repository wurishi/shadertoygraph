{"ver":"0.1","info":{"id":"4ljSRW","date":"1441985637","viewed":637,"name":"RNM PD Approx","username":"jasminpatry","description":"Approximation for reoriented normal mapping using partial-derivative normals. See http://discourse.selfshadow.com/t/blending-in-detail/21/34 for more info.","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["normalmapdetailblending"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","previewfilepath":"/media/ap/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"vec3 blend_rnm_pd(vec3 n1, vec3 n2)\n{\n\tvec3 t = vec3(n1.xy, 1.0);\n\tvec3 u = vec3(-n2.xy, 1.0);\n\tfloat q = dot(t, t);\n\tfloat s = sqrt(q);\n\n\tif (fract(iTime * 0.6) < 0.5)\n\t{\n\t\t// Least-squares fit of sqrt(x) using (1-a)x + a, over the range [1, 5]\n\n\t\ts = 0.336 * q + 0.664;\n\t}\n\n\tt.z += s;\n\tvec3 r = t * dot(t, u) - u * (q + s);\n    r.z = max(r.z, 0.0);\n\treturn normalize(r);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\tvec3 n1 = vec3(2.0 * uv - 1.0, 1.0);\n    float s = length(n1.xy);\n\n\t// Maximum length of n1 is 3.0, the maximum possible length with a normal strength of 2.0 (sqrt(2^2 + 2^2 + 1) = 3).\n\n\tn1.xy *= sqrt(8.0) * (1.0 - s) / s;\n    n1.xy *= (s > 1.0) ? 0.0 : 1.0;\n\n    vec3 n2 = vec3(0.0);\n\tfloat rFreq = 4.0;\n\tfloat rAmp = 1.0 / 28.0;\n\tfor (int i = 0; i < 4; ++i)\n\t{\n\t\tn2.xy += (texture(iChannel0, uv * rFreq).xy * 2.0 - 1.0) * rAmp;\n\t\trFreq /= 1.8715;\n\t\trAmp *= 1.8715;\n\t}\n    n2.z = 1.0;\n\n    vec3 nr = blend_rnm_pd(n1, n2);\n\n    nr = normalize(nr);\n    fragColor = vec4(nr * 0.5 + 0.5, 1);\n}\n","name":"","description":"","type":"image"}]}