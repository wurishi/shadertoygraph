{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define t (iTime*.25)\n\nfloat dist_obj(vec3 p)\n{\n\t\t//p.x = mod(p.x+1.0,2.0)-1.0;\n\tfloat tm = mod(t,.5);\n\ttm = smoothstep(.3,.5,tm);\n\tfloat ta = t-mod(t,0.5);\n\t\n\tvec3 pm = p;\n\tpm.x = mod(p.x+0.5-tm,1.0)-0.5+tm;\n\tvec3 pm2 = p;\n\tpm2.x= mod(p.x+0.5+tm,1.0)-0.5-tm;\n\t\n\tfloat s1 = length(pm+vec3(-tm,.0,.0))-.5;\n\ts1 = max(s1,p.x-tm-ta-ta-.5);\n\ts1 = max(s1,-p.x);\n\t\n\tfloat s2 = length(pm2+vec3(tm,.0,.0)) -.5;\n\ts2 = max(s2,-p.x-tm-ta-ta-.5);\n\ts2 = max(s2,p.x);\n\t\n\treturn min(s1,s2);\n}\n\nfloat dist_floor(vec3 p)\n{\n\treturn p.y+.5;\n}\n\nfloat dist(vec3 p)\n{\n\treturn min(dist_obj(p),dist_floor(p));\n}\n\nvec3 normal(vec3 p) \n{\n\tfloat e = .003; float d=dist(p);\n\treturn normalize(vec3(dist(p+vec3(e,0,0))-d,dist(p+vec3(0,e,0))-d,dist(p+vec3(0,0,e))-d));\n\t\n}\n\nmat2 rotate_2D(float a){float sa = sin(a); float ca = cos(a); return mat2(ca,sa,-sa,ca);}\nmat3 rotate_x(float a){float sa = sin(a); float ca = cos(a); return mat3(1.,.0,.0,    .0,ca,sa,   .0,-sa,ca);}\nmat3 rotate_y(float a){float sa = sin(a); float ca = cos(a); return mat3(ca,.0,sa,    .0,1.,.0,   -sa,.0,ca);}\nmat3 rotate_z(float a){float sa = sin(a); float ca = cos(a); return mat3(ca,sa,.0,    -sa,ca,.0,  .0,.0,1.);}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.yy - vec2(.9,.5);\n\tvec2 m = iMouse.xy/iResolution.yy*4.0;\n\t\n\tmat3 rotmat = rotate_y(m.x-4.0)*rotate_x(m.y+0.5);\n\tvec3 p = vec3(.0,.0,-4.0)*rotmat;\n\tvec3 d = normalize(vec3(uv,1.0))*rotmat;\n\t\n\tvec3 color = vec3(1.3);\n\t\n\tfloat dt = .0;\n\tfor (int i=0; i<70; i++)\n\t{\n\t\tdt = dist(p);\t\t\n\t\tp += d*dt;\n\t\tif (dt<.0001) break;\n\t}\n\t\n\tif (dt<.9)\n\t{\n\t\tvec3 n = normal(p);\n\t\tvec3 l = normalize(vec3(1.0));\n\t\tif (dist_obj(p)<dist_floor(p))\n\t\t{\n\t\t\tfloat ao = dist(p+n)*.5+.5;\n\t\t\tfloat diffuse = dot(n,l);\n\t\t\tdiffuse = max(.0,diffuse);\n\t\t\tdiffuse = diffuse*.9*ao+.1;\n\t\t\tfloat diffuse2 = dot(n,vec3(.0,-1.0,.0));\n\t\t\tdiffuse2 = max(.0,diffuse2);\n\t\t\tdiffuse+=diffuse2*.2;\n\t\t\tfloat specular = dot(reflect(d,n),l);\n\t\t\tspecular = max(.0,specular);\n\t\t\tspecular = pow(specular,80.0);\n\t\t\tcolor = vec3(.9,.1,.1)*max(.0,diffuse)*.5;\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tcolor += vec3(.1,.2,.3)*.5+vec3(specular)*.5;\n\t\t\t\n\t\t\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfloat ao = dist(p+n*.5)*.4+.6;\n\t\t\tao = smoothstep(.0,1.0,ao);\n\t\t\tfloat diffuse = dot(n,l);\n\t\t\tdiffuse = max(.0,diffuse);\n\t\t\t;\n\t\t\t\n\t\t\tfloat occ = 1.0;\n\t\t\tvec3 sp = p+l*.125, sd = +l*.125;\n\t\t\tfor (int i=0; i<10; i++)\n\t\t\t{\n\t\t\t\tfloat ddd=dist(sp)*8.0;\n\t\t\t\tsp+=ddd*sd*.1;\n\t\t\t\tocc = min(occ,ddd);\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tfloat occ2 = 1.0;\n\t\t\tsp = p+reflect(d,n)*.125, sd = +l+reflect(d,n)*.125;\n\t\t\tfor (int i=0; i<10; i++)\n\t\t\t{\n\t\t\t\tfloat ddd=dist(sp)*8.0;\n\t\t\t\tsp+=ddd*sd*.1;\n\t\t\t\tocc2 = min(occ2,ddd);\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tdiffuse = diffuse*.9*ao*occ*occ2+.1;\n\t\t\t\n\t\t\tcolor = vec3(.3,.3,.3)*max(.0,diffuse);\n\t\t\tcolor += vec3(.1,.2,.3)*.5;\n\t\t\t\n\t\t}\n\t}\n\tcolor += vec3(1.0-1.0/(1.0+length(p)*.01));\n\tcolor -=length(uv)*.1;\n\tcolor +=texture(iChannel0,fragCoord.xy*(1.0/256.0)).xyz*.01;\n\tcolor = mix(color,vec3(length(color)),length(color));\n\tcolor = pow(color,vec3(.6));\n\t\n\tfragColor = vec4(color,1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"Xsj3Wd","date":"1395286490","viewed":272,"name":"[SH2014] Grow!","username":"mu6k","description":"My entry for SH2014","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","distancefield","shadow","sphere","occlusion"],"hasliked":0,"parentid":"","parentname":""}}