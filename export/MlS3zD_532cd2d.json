{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"float hash( vec3 p )\n{\n\tfloat h = dot(p,vec3(127.1,311.7,201.3));\n\t\n    return fract(sin(h)*43758.5453123);\n}\n\nfloat noise( in vec3 p )\n{\n    vec3 i = floor( p );\n    vec3 f = fract( p );\n\t\n\tvec3 u = f*f*(3.0-2.0*f);\n\n    return mix(mix( mix( hash( i + vec3(0,0,0) ), \n                         hash( i + vec3(1,0,0) ), u.x),\n                    mix( hash( i + vec3(0,1,0) ), \n                         hash( i + vec3(1,1,0) ), u.x), u.y),\n               mix( mix( hash( i + vec3(0,0,1) ), \n                         hash( i + vec3(1,0,1) ), u.x),\n                    mix( hash( i + vec3(0,1,1) ), \n                         hash( i + vec3(1,1,1) ), u.x), u.y), u.z );\n}\n\nfloat noise(vec2 p)\n{\n    return noise(vec3(p.xy, 1));\n}\n\nfloat fbm(vec2 p)\n{\n    const mat2 m = mat2(0.8, 0.6, -0.6, 0.8);\n \n    float f = 0.0;\n    f += 0.5000 * noise(p); p = m * p * 2.02;\n    f += 0.2500 * noise(p); p = m * p * 2.03;\n    f += 0.1250 * noise(p); p = m * p * 2.01;\n    f += 0.0625 * noise(p);\n    return f / 0.9375;\n}\n\n// ...\n\nconst vec2 brick_size = vec2(0.2, 0.1);\n\nvoid masks(vec2 p, out float mortar, out float mortar_grain, out float brick_grain)\n{\n    vec2 b = p / brick_size;\n    ivec2 bi = ivec2(b);\n    \n    b.x += 0.5 * float(bi.y - (bi.y / 2) * 2);\n    bi = ivec2(b);\n\n    vec2 bf = fract(b);\n    \n    bf.x += 0.05 * fbm(50.0 * p);\n    bf.y += 0.1 * fbm(30.0 * p);\t\n\n    mortar = 1.0 - smoothstep(0.025, 0.0255, bf.x) * smoothstep(0.975, 0.965, bf.x) * smoothstep(0.05, 0.051, bf.y) * smoothstep(0.90, 0.89, bf.y);\n    mortar_grain = 0.5 * fbm(300.0*p);\n    brick_grain = smoothstep(0.7, 0.9, fbm(100.0*p*vec2(1.0, 1.3)));\n}\n\nfloat height(vec2 p)\n{\n    float mortar, mortar_grain, brick_grain;\n    masks(p, mortar, mortar_grain, brick_grain);\n    return 0.01 * mortar * mortar_grain  + (1.0 - mortar) * (1.0 - 0.3 * brick_grain + 0.003 * fbm(110.0*p));\n}\n\nvec3 normal(vec2 p)\n{\n    float d = 0.001;\n    vec2 dx = vec2(d, 0.0);\n    vec2 dy = vec2(0.0, d);\n    float dh_dx = (height(p + dx) - height(p)) / d;\n    float dh_dy = (height(p + dy) - height(p)) / d;\n    return normalize(vec3(-dh_dx, -dh_dy, 1.0));\n}\n\nvec3 diffuse(vec2 p)\n{\n    vec2 b = p / brick_size;\n    ivec2 bi = ivec2(b);\n    \n    b.x += 0.5 * float(bi.y - (bi.y / 2) * 2);\n    bi = ivec2(b);\n\n    vec2 bf = fract(b);\n  \n    float mortar_mask, mortar_grain_mask, brick_grain_mask;\n    masks(p, mortar_mask, mortar_grain_mask, brick_grain_mask);\n    \n    vec3 mortar_color = vec3(0.7, 0.7, 0.7) - 0.1 * vec3(fbm(20.0*p));\n\tvec3 mortar_grain_color = 0.1 * vec3(0.6, 0.5, 0.3);\n    \n    mortar_color = mortar_grain_mask * mortar_grain_color + (1.0 - mortar_grain_mask) * mortar_color;\n    \n    vec3 brick_color = vec3(0.5, 0.1, 0.1);\n    brick_color += vec3(0.1 * noise(vec2(bi)));\n    brick_color -= vec3(smoothstep(0.0, 1.0, 0.7*fbm(20.0*(p)) - 0.3));\n\n\tvec3 brick_grain_color = vec3(0.6, 0.3, 0.2);\n    brick_color = brick_grain_mask * brick_grain_color + (1.0 - brick_grain_mask) * brick_color;\n    \n  \treturn mortar_color * mortar_mask + (1.0 - mortar_mask) * brick_color;\n}\n\nvec3 light(vec3 p, vec3 n, vec3 c, vec3 l, float i)\n{\n    vec3 d = l - p;\n    float a = 1.0 / (1.0 + length(d));\n    float f = dot(normalize(d), n);\n    float w = 0.5; \n    return c * a * i * max(0.0, (f + w) / (1.0 + w));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 p = fragCoord.xy / iResolution.xy;\n    p.x *= iResolution.x / iResolution.y;\n\n    vec3 l = vec3(0.5 + 0.5 * sin(2.0 * iTime), 0.5 + 0.5 * sin(3.0 * iTime), 1.0 + sin(iTime));\n\n    vec3 color;\n    //color = diffuse(q.xy);\n    //color = normal(p);\n    color = light(vec3(p, 0.0), normal(p), diffuse(p), l, 1.1);\n    fragColor = vec4(color, 1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"MlS3zD","date":"1427309507","viewed":240,"name":"Ugly Brick","username":"psykotic","description":"Just a test for now.","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["2d"],"hasliked":0,"parentid":"","parentname":""}}