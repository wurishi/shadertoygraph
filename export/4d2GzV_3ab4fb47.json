{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"4dXGzn","filepath":"/media/a/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"const float s3 = 1.7320508075688772;\nconst float i3 = 0.5773502691896258;\n\n\nconst mat2 tri2cart = mat2(1.0, 0.0, -0.5, 0.5*s3);\n\nconst mat2 cart2tri = mat2(1.0, 0.0, i3, 2.0*i3);\n\nvec3 L = vec3(i3, -i3, i3);\n\nvec4 pick3(vec4 a, vec4 b, vec4 c, float u) {\n\tfloat v = fract(u * 0.3333333333333);\n\treturn mix(mix(a, b, step(0.3, v)), c, step(0.6, v));\n}\n\nvec4 closestHexCenters(vec2 p) {\n\t\n\tvec2 pi = floor(p);\n\tvec2 pf = fract(p);\n\n\tvec4 nn = pick3(vec4(0.0, 0.0, 2.0,  1.0),\n\t\t\t\t\tvec4(1.0, 1.0, 0.0, -1.0),\n\t\t\t\t\tvec4(1.0, 0.0, 0.0,  1.0),\n\t\t\t\t\tpi.x + pi.y);\n\t\n\treturn ( mix(nn, nn.yxwz, step(pf.x, pf.y)) +\n\t\t\t vec4(pi, pi) );\n\t\n}\n\nvec3 perpBisector(vec2 p1, vec2 p2) {\n\tvec2 p21 = p2-p1;\n\tvec3 pa = vec3(p1+0.5*p21, 1.0);\n\tvec3 pb = vec3(pa.x-p21.y, pa.y+p21.x, 1.0);\n\tvec3 l = cross(pa, pb);\n\treturn l * inversesqrt(dot(l.xy, l.xy));\n}\n\nfloat hash(vec2 pos) {\n\treturn texture(iChannel0, fract(pos/511.0)).x;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\t\n\tfloat scl = (0.03 + 0.02*(1.0+sin(0.31*iTime))) * 200.0 / min(iResolution.x, iResolution.y);\n\t\n\tfloat cx = 2.0 * cos(iTime*0.3) + 1.0 * cos(iTime*0.7+2.0);\n\tfloat cy = 4.0 * sin(iTime*0.4) + 0.3 * sin(iTime*1.2+4.0);\n\tfloat theta = 0.05*iTime;\n\t\t\n\tvec2 pos = (fragCoord.xy - 0.5*iResolution.xy)*scl + vec2(cx, cy);\n\t\n\tfloat ct = cos(theta);\n\tfloat st = sin(theta);\n\t\n\tpos = mat2(ct, -st, st, ct) * pos;\n\tL.xy = mat2(ct, -st, st, ct) * L.xy;\n\t\n\tvec4 h = closestHexCenters(cart2tri*pos);\n\t\n\tvec2 q1 = tri2cart * h.xy;\n\t\n\tfloat s = step(hash(h.xy), 0.5)*2.0-1.0;\n\t\n\tvec2 d1 = pos - q1;\n\t\n\tfloat l = min(min(distance(d1, vec2(-s*1.0, 0.0)), \n\t\t\t\t\t  distance(d1, vec2(s*0.5, 0.5*s3))), \n\t\t\t\t      distance(d1, vec2(s*0.5, -0.5*s3)));\n\t\n\t\n\tconst float r = 0.5;\n\n\tvec4 truchet = vec4(vec3(smoothstep(0.1+scl, 0.1, abs(l-r))), 1.0);\n\t\n\tvec2 q2 = tri2cart * h.zw;\n\t\n\tvec4 rgb = pick3(vec4(1.0, 0.0, 0.0, 1.0),\n\t\t\t\t\t vec4(0.0, 1.0, 0.0, 1.0),\n\t\t\t\t\t vec4(0.0, 0.0, 1.0, 1.0),\n\t\t\t\t\t h.x);\n\t\n\tvec3 line = perpBisector(q1, q2);\n\n\tfloat d = dot(vec3(pos, 1.0), line);\n\n\tvec4 black = vec4(vec3(0.), 1.0);\n\t\n\tvec2 nxy = mix(0.4*line.xy, vec2(0.0), smoothstep(0.3, 0.3+scl, d));\n\t\n\tvec3 N = vec3(nxy, sqrt(1.0-dot(nxy,nxy)));\n\tfloat ln = clamp(0.0, 1.0, dot(L, N));\n\t\n\tvec4 lite = mix(rgb, vec4(1.0), clamp(0.0, 1.0, 2.0*ln-1.0));\n\tvec4 dark = mix(black, rgb, clamp(0.0, 1.0, 2.0*ln));\n\tvec4 lrgb = mix(dark, lite, step(0.5, ln));\n\t\n\tvec4 crgb = mix(black, lrgb, smoothstep(0.01, 0.01+scl, d));\n\t\n\tfloat t = fract(0.04*iTime);\n\tfloat invb = 4.0;\n\t\n\tfloat k = smoothstep(0.0, 1.0, min(t*invb-0.5*invb+1.0, -t*invb+invb));\n\t\t\n\tfragColor = mix(crgb, truchet, k);\n\t\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4d2GzV","date":"1391146551","viewed":1471,"name":"hexagonal tiling","username":"mattz","description":"playing with hexagonal symmetry","likes":67,"published":1,"flags":0,"usePreview":0,"tags":["2d","truchet","fakelighting","tiling","hexagons"],"hasliked":0,"parentid":"","parentname":""}}