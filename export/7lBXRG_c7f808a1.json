{"ver":"0.1","info":{"id":"7lBXRG","date":"1627913491","viewed":517,"name":"Ã©chappatoire","username":"sukupaper","description":"An infinite corridor in which you are escaping something (I duno)","likes":54,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","blackandwhite","doors","corridor","rooms","escaping"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define P 6.283185307\nconst float div = 4.9, spiralspeed = P/35.;\nvec3 c, map;\nfloat t, roomId;\nint matid=0, doorpart=0;\n\nmat2 rot(in float a) { return mat2(cos(a),sin(a),-sin(a),cos(a)); }\n\nfloat box(in vec3 p, in vec3 s, in float r) { return length(max(abs(p) - s,0.)) - r; }\nfloat box(in vec2 p, in vec2 s) { p = abs(p) - s; return max(p.x,p.y); }\nfloat cyl(in vec3 p, in float h, in float r) {\n  vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(h,r);\n  return min(max(d.x,d.y),0.) + length(max(d,0.));\n}\n\nfloat door(in vec3 p, in vec3 s, in float opened) {\n    p.x -= s.x; p.xz *= rot(opened); p.x += s.x;\n    float ddbis = -max(box(vec3(p.x, mod(abs(p.y + .2) - .2, 1.285) - .6425, abs(p.z) - .03), s*vec3(1.,.5,1.), .01), box(p, s*vec3(.725,.85,1.), .02));\n    float dd = box(p, s, .01);\n    p.z = abs(p.z); p.x += .435;\n    float ddd = min(length(max(abs(vec2(length(p.xy) - .012, p.z - .075)) - vec2(.01,.0),0.)) - .015, length(max(abs(vec2(length(p.xy) - .01, p.z - .012)) - vec2(.02,.0),0.)) - .015);\n    ddd = min(ddd, cyl(p.yzx, .015, .075));\n    float d = min(max(dd, ddbis), ddd);\n    doorpart = d == dd ? 1 : 0;\n    return d;\n}\n\nfloat df(in vec3 p) {\n    p.xy *= rot(cos(p.z*spiralspeed)*1.75);\n    \n    float pz = p.z;\n    float Pz = floor(p.z/div + .4)*div;\n    roomId = floor(p.z/div + .5);\n    p.z = mod(pz, div) - div*.5;\n    \n    float pz2 = pz/(div*2.) + 0.24  ;\n    p.xy = mix(p.xy,p.yx,mod(floor(pz2),2.))*sign(mod(floor(pz2 + .5),2.) - .5);\n    map = p;\n    \n    const vec3 doorSize = vec3(.5, 1.125, .01);\n    float wall = box(p.xy, vec2(1.5));\n    p.y += doorSize.y/3.;\n    \n    float dap = abs(Pz - c.z + div/2.);\n    float door = door(p, doorSize, P*.35*(cos(clamp( (dap*dap*dap)*.0125 ,-3.14,3.14))*.5 + .5));\n    \n    float endwall = abs(p.z) - .01;\n\n    float plaintesFond = max(endwall, p.y + 1.05) - .025;\n    float doorShape = box(p.xy, doorSize.xy);\n    float doorShapeExtr = max(doorShape - .05, abs(p.z) - .035);\n    float walls = min(abs(wall) - .01, max(max(wall, min(min(endwall, doorShapeExtr), plaintesFond)),  -doorShape));\n        \n    float plaintes = max(-wall, p.y + 1.02) - .025;\n    \n    float d = min(min(walls, door), plaintes);\n    \n    matid = d == plaintesFond || d == doorShapeExtr ? 3 : d == door ? 1 : d == walls  ? 2 : 3;\n    \n    return d;\n}\n\n#define LIM .001\n#define MAX_D 20.\n#define MAX_IT 50\nstruct rmRes { vec3 pos; int it; bool hit; };\nrmRes rm(in vec3 c, in vec3 r) {\n    vec3 p = c;\n    int it;\n    bool hit = false;\n    for(int i = 0; i < MAX_IT; i++) {\n        float d = df(p);\n        if(d < LIM) { hit = true; break; }\n        if(distance(c,p) > MAX_D) break;\n        p += d*r;\n        it = i;\n    }\n    rmRes res;\n    res.pos = p;\n    res.it = it;\n    res.hit = hit;\n    return res;\n}\n\nvec3 plane2sphere(in vec2 p) {\n    float t = -4./(dot(p,p) + 4.);\n    return vec3(-p*t, 1. + 2.*t);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    vec2 st = (fragCoord.xy - iResolution.xy*.5)/iResolution.x;\n    t = iTime < 0.01 ? 98. : -iTime*5. ;\n        \n    c = vec3(0.,0.,t);\n    vec3 r = -plane2sphere(st*5.);\n    r.xz *= rot(cos(t*spiralspeed/3.)*.75);\n    r.xy *= rot(-cos(t*spiralspeed)*1.75);\n\n    rmRes res = rm(c,r);\n    \n    vec3 n = vec3(0.), b = vec3(.88);\n    float whichroom = step(.5,fract(roomId/2.));\n    vec3 c1 = mix(n,b,whichroom), c2 = mix(b,n,whichroom);\n    vec3 color = c2;\n    \n    if(res.hit)\n        if(matid == 1) color = doorpart == 1 ? c2 : c1;\n        else if(matid == 2) color = c2;\n        else {\n            if(map.y < -1.45) {\n                if(map.z > .1 || map.z < 0.) {\n                    map.xz *= rot(3.14*.25);\n                    map.xz *= 10.;\n                    color = mix(c1,c2,step(0.,cos(map.x)*cos(map.z)));                    \n                } else\n                    color = c2;\n            } else color = c1;\n        }\n    \n    float l = length(st);\n    fragColor = vec4(color - l*l*.5,1.0);\n}","name":"Image","description":"","type":"image"}]}