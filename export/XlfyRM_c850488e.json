{"ver":"0.1","info":{"id":"XlfyRM","date":"1503914516","viewed":135,"name":"Ray marching practice","username":"balintfodor","description":"A basic code for getting familiar with ray marching and signed distance functions. Added some fun coloring. Suggestions and improvements are welcome.","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define EPS 0.001\n#define CAM_NEAR 0.1\n#define CAM_FAR 10.\n\nfloat dSphere(vec3 p, float r)\n{\n    return length(p) - r;\n}\n\nvec3 distort(vec3 p)\n{\n    return p + 0.253 * sin(p * 3.827 + iTime);\n}\n\nfloat dScene(vec3 p)\n{\n    vec3 offset = vec3(0., 0., 4.);\n    float sp = dSphere(distort(p) + offset, 1.);\n    return sp;\n}\n\nvec3 estimateNormal(vec3 p)\n{\n    vec3 e = vec3(EPS, 0., 0.);\n    return normalize(vec3(\n        dScene(p + e.xyy) - dScene(p - e.xyy),\n        dScene(p + e.yxy) - dScene(p - e.yxy),\n        dScene(p + e.yyx) - dScene(p - e.yyx)));\n}\n\nvec4 custom_lighting(vec3 n, vec3 ld, vec3 v)\n{\n    float li = max(dot(n, ld), 0.);\n    float vi = max(dot(n, v), 0.);\n    vec3 x = vi * vec3(11., 13., 17.);\n    vec3 c = sin(x);\n    return vec4(li * (0.5 * c + 0.5), 1.);\n}\n\nvec4 render(vec3 ro, vec3 rd)\n{\n    float t = CAM_NEAR;\n    vec4 color = vec4(0.);\n    vec3 light = vec3(-1., 1.5, -2.0);\n    for (int i = 0; i < 256; ++i) {\n        vec3 p = ro + rd * t;\n        float d = dScene(p);\n        if (d <= EPS) {\n            vec3 n = estimateNormal(p);\n            color = custom_lighting(n, normalize(light - p), -rd);\n            break;\n        }\n        if (d > CAM_FAR) {\n            break;\n        }\n        t += d;\n    }\n    return color;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    vec2 uv = (fragCoord - .5* iResolution.xy) / iResolution.x;\n    vec3 ro = vec3(0., 0., 1.);\n    vec3 rd = normalize(vec3(uv, 0.) - ro);\n    fragColor = render(ro, rd);\n}\n","name":"Image","description":"","type":"image"}]}