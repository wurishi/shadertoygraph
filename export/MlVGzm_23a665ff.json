{"ver":"0.1","info":{"id":"MlVGzm","date":"1474044208","viewed":976,"name":"Cartoon Effect","username":"hypothete","description":"WIP, trying to get a hand-drawn look kind of like a Julian Opie portrait.","likes":15,"published":1,"flags":32,"usePreview":0,"tags":["sobel","cartoon","postprocess","edgedetect"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec4 texa = texture(iChannel0, uv);\n    vec4 texb = texture(iChannel1, uv);\n    //vec3 finalrgb = texa.rgb;\n\t//vec3 finalrgb = 1.0 - texb.rgb;\n    vec3 finalrgb = min(texa.rgb, texb.rgb);\n\tfragColor = vec4(finalrgb,1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"vec3 lumvals = vec3(0.2,0.7,0.9);\n\nvec3 rgb2hsv(vec3 c){\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n    vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec3 stepColor(vec3 col){\n\tvec3 hsv = rgb2hsv(col);\n    if(hsv.z <= 0.33){\n    \thsv.z = lumvals.x;\n    }\n    else if(hsv.z <= 0.67){\n    \thsv.z = lumvals.y;\n    }\n    else{\n    \thsv.z = lumvals.z;\n    }\n    return hsv2rgb(hsv);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec4 tex = texture(iChannel0, uv);\n\n\tfragColor = vec4(stepColor(tex.rgb),1.0);\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"///outlines\n\nmat3 sobelX = mat3(-1.0, -2.0, -1.0,\n                    0.0,  0.0,  0.0,\n                    1.0,  2.0,  1.0);\n\nmat3 sobelY = mat3(-1.0,  0.0,  1.0,\n                   -2.0,  0.0,  2.0,\n                   -1.0,  0.0,  1.0);\n\nvec3 samplef(int x, int y, vec2 res){\n\treturn texture(iChannel0, vec2(x,y)/res).xyz;\n}\n\nfloat lum(vec3 rgb){\n\treturn (0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec3 sx = vec3(0);\n    vec3 sy = vec3(0);\n    \n    for(int i=0; i<=2; i++){\n        for(int j=0; j<=2; j++){\n        \tsx += samplef(int(fragCoord.x)+i-1, int(fragCoord.y)+j-1, iResolution.xy) * sobelX[i][j];\n            sy += samplef(int(fragCoord.x)+i-1, int(fragCoord.y)+j-1, iResolution.xy) * sobelY[i][j];\n        }\n    }\n    float finalLum = pow(lum(sx*sx + sy*sy), 0.5);\n    if(finalLum < 0.4){\n        finalLum = smoothstep(0.0,1.0,finalLum);\n    }\n    else{\n        finalLum = 1.0;\n    }\n\tfragColor = vec4(vec3(1.0 - finalLum), 1.0);\n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[{"id":"XdfGRr","filepath":"/media/a/35c87bcb8d7af24c54d41122dadb619dd920646a0bd0e477e7bdc6d12876df17.webm","previewfilepath":"/media/ap/35c87bcb8d7af24c54d41122dadb619dd920646a0bd0e477e7bdc6d12876df17.webm","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4sXGR8","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec4 tex = texture(iChannel0, uv);\n\tfragColor = vec4(tex.rgb,1.0);\n}","name":"Buffer C","description":"","type":"buffer"}]}