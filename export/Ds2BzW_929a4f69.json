{"ver":"0.1","info":{"id":"Ds2BzW","date":"1689504510","viewed":126,"name":"Brownian Caves","username":"kastorp","description":"not what I intended to do, but still interesting (at least for me)","likes":13,"published":1,"flags":48,"usePreview":0,"tags":["ca","caves"],"hasliked":0,"parentid":"csXfRX","parentname":"Ecosystem CA"},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//Brownian Caves by Kastorp\n//------------------\nvoid mainImage( out vec4 O, in vec2 I )\n{\n   \n    vec2 R= iResolution.xy;\n    float sp= (R.x-200.)/2.;\n    ivec2 c=  ivec2(I/R.y*100.+ (iMouse.z>0.? vec2(iMouse.x*sp/R.x,0): vec2(sp ,0.)) );\n    O = texelFetch(iChannel0,c,0);\n    vec3 col= vec3(0);\n\n    if(EMPTY) col= vec3(0,1,0.)*(.1 +.7*O.w);\n\n    if(WORM) col= O.w>0.? vec3(1):vec3(0.737,0.482,0.125);\n    O.xyz=col;\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void mainImage( out vec4 O, in vec2 I )\n{\n    \n    bool rc =texelFetch(iChannel0,ivec2(iResolution.x-1.,0),0)==vec4(0);\n    if(iFrame==0|| rc ||texelFetch(iChannel3,ivec2(32,0),0).x>.5) { \n    \n        //initialize\n        O = vec4(0); //VOID\n        if(hash13(vec3(I,iFrame))>.99)  O = vec4(8.,0,3,0);\n        if(I.y<1. && I.x>iResolution.x-2.)O=vec4(1);      \n        return;\n    }\n    else{\n        //get current\n        O=texelFetch(iChannel0,ivec2(I),0);\n        if(I.y>100.) return;\n        \n        //get neighbors\n        vec4[4] c ;\n        for(int i=0;i<4;i++){ \n           //0:Bottom, 1:up, 2:left, 3:right \n           vec2 d =vec2(i<2?0:i==2?-1:1, i>1?0:i==0?-1:1);\n           c[i]= texelFetch(iChannel0,ivec2(I+d)% ivec2(iResolution.x,100),0);      \n        }\n        \n        RULE_ALL(EMPTY && O.w>0. && (!N_WORM  || ND==0 || (  ND>0  && !OPPOSITE(int(O.w),ND))),vec4(O.xyz,0.);return;);\n        RULE_ALL(WORM && O.w>0. && (!N_EMPTY  || (  ND>0  &&  !OPPOSITE(int(O.w),ND))),vec4(O.xyz,0.);return;);\n        RULE_ANY(EMPTY  && N_WORM && O.w>0. && ND>0 && OPPOSITE(int(O.w),ND) ,vec4(8.,0,0,0);return);\n       // RULE_ANY(WORM  && N_EMPTY && O.w>0. && ND>0 && OPPOSITE(int(O.w),ND) ,vec4(0);return);\n\n        RULE_ANY(EMPTY &&  N_WORM && O.w==0. && ND>0  && OPPOSITE(i+1,ND),vec4(O.xyz,i+1);return);      \n        RULE_ANY(WORM  && N_EMPTY && O.w==0. && ND==0  && int(hash13(vec3(I ,iFrame))*4.)==i,vec4(O.xyz,i+1);return);\n        //RULE_ANY(WORM && N_WORM  &&O.w>0. && i+1==int(O.w),vec4(O.xyz,5.);return;);\n          \n    }\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define NG c[i].x //near group\n#define NT c[i].y //near type\n#define NV c[i].z //near value  \n#define ND int(c[i].w) //near value \n#define RULE(check,val) if( check) O=val;\n#define RULE_ANY(check,val) for(int i=0;i<4;i++){ if( check){ O=val;}}\n#define RULE_ALL(check,val) {bool ch=true; for(int i=0;i<4;i++) ch=ch&& check; if(ch) {O=val;}}\n#define BOTTOM 0 \n#define UP 1 \n#define LEFT 2 \n#define RIGHT 3  \n#define OPPOSITE(a,b)  (a+b==7 || a+b==3)\n\n//NEIGHBORS CONDITIONS\n#define N_EMPTY (NG==0.)\n#define N_WORM (NG==8.)\n\n//CURENT BLOCK CONDITIONS\n#define EMPTY (O.x==0.)\n#define WORM (O.x==8.)\n\n\n//https://www.shadertoy.com/view/4djSRW\nfloat hash13(vec3 p3)\n{\n\tp3  = fract(p3 * .1031);\n    p3 += dot(p3, p3.zyx + 31.32);\n    return fract((p3.x + p3.y) * p3.z);\n}\n","name":"Common","description":"","type":"common"}]}