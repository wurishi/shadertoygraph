{"ver":"0.1","info":{"id":"4dKXzD","date":"1463254428","viewed":142,"name":"quad amortization test","username":"kingeric1992","description":"testing quad amortization","likes":0,"published":1,"flags":32,"usePreview":0,"tags":["gaussian"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xsf3Rn","filepath":"/media/a/cbcbb5a6cfb55c36f8f021fbb0e3f69ac96339a39fa85cd96f2017a2192821b5.png","previewfilepath":"/media/ap/cbcbb5a6cfb55c36f8f021fbb0e3f69ac96339a39fa85cd96f2017a2192821b5.png","type":"texture","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nmat4 get_quad(vec2 quad_vector, vec4 curr)\n{\n    vec4 adjx = curr - dFdx(curr) * quad_vector.x;\n    vec4 adjy = curr - dFdy(curr) * quad_vector.y;\n    vec4 diag = adjx - dFdy(adjx) * quad_vector.y;\n\n    return mat4(curr, adjx, adjy, diag);\n}\n\nvec2 get_quad_vector(vec2 tex_iuv)\n{\n    return fract(vec2(tex_iuv) * 0.5) * vec2( 4.0) - vec2(1.0);\n}\n\nvec4 tex2Dblur4N_shared(sampler2D s0, vec2 tex_iuv, vec2 dxdy, float sigma, const int N)\n{\n    float  denom_inv = -0.5 / ( sigma * sigma );\n    vec2 quad_vector = get_quad_vector(tex_iuv);\n    vec4 sum         = vec4(0.0);\n    vec2 w_sum       = vec2(0.0);\n\n    for(int i=0; i<10; i+=2)\n    {\n        for(int j=0; j<10; j+=2)\n        {\n            vec2 dist    = vec2(i, j);\n            vec2 w       = exp( (dist + 1.0) * (dist + 1.0) * denom_inv);\n            vec2 w_local = w + exp( dist * dist * denom_inv);\n            vec3 tap     = texture(s0, (tex_iuv + (dist + w / w_local) * quad_vector) * dxdy).rgb;\n                 sum    += vec4(tap, 1.0) *  w_local.x * w_local.y;\n        }\n        w_sum += exp( vec2(i)*vec2(i) * denom_inv) + exp(vec2(i+1)*vec2(i+1)*denom_inv);\n    }    \n    sum /= sum.a;\n    \n    vec4 weight = vec4(1.0);\n    weight.y -= (1.0 - exp( float(N * 2) * float(N * 2) * denom_inv)) / w_sum.x;\n    weight.z -= (1.0 - exp( float(N * 2) * float(N * 2) * denom_inv)) / w_sum.y;\n    weight.w  = weight.y * weight.z;\n \n    \n//      vec4 weight = vec4(1.0, 0.5, 0.5, 0.25);\n    \n    return get_quad(quad_vector, sum) * (weight / dot(weight, vec4(1.0))); \n\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec4 shared = tex2Dblur4N_shared(iChannel1, floor(fragCoord), 1.0/iResolution.xy, 4.0, 5);\n    fragColor = shared;\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"Xsf3Rn","filepath":"/media/a/cbcbb5a6cfb55c36f8f021fbb0e3f69ac96339a39fa85cd96f2017a2192821b5.png","previewfilepath":"/media/ap/cbcbb5a6cfb55c36f8f021fbb0e3f69ac96339a39fa85cd96f2017a2192821b5.png","type":"texture","channel":0,"sampler":{"filter":"nearest","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"//from https://www.shadertoy.com/view/lsX3Rr\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 p = fragCoord.xy / iResolution.xy;\n\n\tvec2 uv = vec2( p.x+mod(iTime,2.0), p.y );\t\n\n\n\tuv = (p - vec2(0.20,0.15)) / (vec2(0.8,0.9) - vec2(0.20,0.15));\n\t\t\t\t\t\t\t  \n\tuv = clamp( uv, 0.0, 1.0 );\n\t\n\tfloat ofx = floor( mod( iTime*10.0*2.0, 6.0 ) );\n\n\tfloat ww = 40.0/256.0;\n\tuv.x = clamp( uv.x*ww + ofx*ww, 0.0, 1.0 );\n\tvec4 fg = texture( iChannel0, uv );\n\t\n\n    fragColor = fg;\n}","name":"Buf A","description":"","type":"buffer"}]}