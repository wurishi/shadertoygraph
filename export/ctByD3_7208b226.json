{"ver":"0.1","info":{"id":"ctByD3","date":"1692333953","viewed":53,"name":"chrome-plated hyperboloid","username":"Efim","description":"https://en.wikipedia.org/wiki/Hyperboloid","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["3d","raytracing","reflection","hyperboloid"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsfGzn","filepath":"/media/a/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","previewfilepath":"/media/ap/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","type":"cubemap","channel":0,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI 3.14159265359\nmat3 rotateX(float f)\n{\n    return mat3(\n    vec3(1.0,    0.0,      0.0),\n    vec3(0.0,\t cos(f),  -sin(f)), \t\n\tvec3(.0, sin(f), cos(f))\n    );\n}\n\n\nmat3 rotateZ(float f)\n{\n    return mat3(\n    vec3(cos(f),    -sin(f),  0.0),\n    vec3(sin(f),\t cos(f),  0.0), \t\n\tvec3(0.0, 0.0, 1.0)\n    );\n    \n}\n\n\nmat3 rotateY(float f)\n{\n    return mat3(\n    vec3(cos(f), 0.0,  sin(f)),\n    vec3(0.0,\t 1.0,  0.0), \t\n\tvec3(-sin(f), 0.0, cos(f))\n    );\n}\n\n\nstruct HIT\n{\n    float dist;\n    vec3 nor;\n    vec3 pos;\n};\n\n\nconst float dist_infin = 100000.0;\nconst HIT hit_inf = HIT(100000.0, vec3(0.0), vec3(0.0));\n\nvec3 calcSkyReflect(vec3 rd, vec3 nor, mat3 sky)\n{\n    vec3 n = nor;\n    float d = dot(rd, nor);\n    n = nor*sign(d);\n    vec3 r = reflect(rd, n);\n    //vec2 fon = lonlat(sky*r); //get longitude and latitude\n    vec3 col = texture(iChannel0, r).rgb;\n    return col;\n\n}\n\nvec3 culccolor(vec3 col_in, vec3 backcol, vec3 rd, vec3 light, vec3 nor)\n{\n    vec3 col = col_in;\n    float d = dot(rd, nor);\n    if (d < 0.0)\n        col = backcol;\n    \n    nor *= -sign(d);\n    float difu = dot(nor, light);\n    col *= clamp(difu, 0.05, 1.0);\n    return col;   \n}\nHIT giperI(vec3 ro, vec3 rd, float ax, float by, float cz, float h, float t)\n{\n    if (t > 0.0)\n        return hit_inf;\n    vec3 pos = ro + rd*t;\n    if (abs(pos.z) > h)\n        return hit_inf;\n    float dist = length(ro - pos);\n    vec3 nor = vec3(pos.x/ax/ax, pos.y/by/by, -pos.z/cz/cz);\n    nor = normalize(nor);\n    return HIT(dist, nor, pos);\n}\n\nHIT giper3D(vec3 ro1, vec3 rd1, float ax, float by, float cz, float h)\n{\n    \n    \n    \n    vec3 ro = vec3(ro1.x/ax, ro1.y/by, ro1.z/cz);\n    vec3 rd = vec3(rd1.x/ax, rd1.y/by, rd1.z/cz);\n    float a = rd.x*rd.x + rd.y*rd.y - rd.z*rd.z;\n    float b = 2.0 * (ro.x*rd.x + ro.y*rd.y - ro.z*rd.z);\n    float c = ro.x*ro.x + ro.y*ro.y - ro.z*ro.z - 1.0;\n    float d = b*b - 4.0*a*c;\n    if (d < 0.0)\n        return hit_inf;\n\n    \n    d = pow(d, 0.5);\n    float t1 = (-b + d)/2.0/a;\n    float t2 = (-b - d)/2.0/a;\n\n    HIT r = hit_inf;\n    HIT r1 = giperI(ro1, rd1,  ax,  by,  cz,  h,  t1);\n    if (r1.dist < r.dist)\n        r = r1;\n    \n    HIT r2 = giperI(ro1, rd1,  ax,  by,  cz,  h,  t2);\n    if (r2.dist < r.dist)\n        r = r2;\n\n    return r;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    \n    vec2 p = (2.0*fragCoord-iResolution.xy)/iResolution.y;\n    vec3 light = normalize(vec3(2.0, 1.0, -1.0)); //light\n\n\tvec3 ro = vec3(0.0, 0.0, 15.0); // camera\t\n    const float fl = 2.5; // focal length\n\n    vec3 rd = normalize( vec3(p,fl) ); // ray direction\n    float t = iTime;\n\t\n    vec3 col = vec3(0.7, 0.7, 0.9); // background\n    //t = 0.0;\n    \n    float dist = dist_infin;\n    mat3 rota  = rotateZ(PI/3.0+t)*rotateX(PI/2.0*3.0/4.0+t)*rotateY(-t/3.0);\n    mat3 rota_1  = rotateY(t/3.0)*rotateX(-PI/2.0*3.0/4.0-t)*rotateZ(-PI/3.0-t);\n    mat3 sky = rotateZ(0.0)*rotateX(PI/2.0);\n\n\n    HIT giper = giper3D(rota*(ro), rota*rd, 1.0, 1.0, 2.0, 4.0);\n    if (giper.dist < dist)\n    {\n        col = vec3(1.0, 1.0, 0.0);\n        vec3 backcol = vec3(0.0, 1.0, 1.0);\n        vec3 nor = rota_1*giper.nor;\n        //col = culccolor(col, backcol, rd, light, nor);\n        // gamma\n        //col = pow( col, vec3(0.4545) ); \n        //reflect\n        col = calcSkyReflect(rd, nor, sky);\n    }\n    \n   \n    fragColor = vec4(col,1.0);\n    \n}","name":"Image","description":"","type":"image"}]}