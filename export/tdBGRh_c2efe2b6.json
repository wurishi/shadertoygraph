{"ver":"0.1","info":{"id":"tdBGRh","date":"1548105848","viewed":100,"name":"Normal","username":"valler","description":"Numerical normals for SDFs","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["ray","distance","normal","numerical","march"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// https://iquilezles.org/articles/distfunctions\nfloat sdTorus( vec3 p, vec2 t )\n{\n  vec2 q = vec2(length(p.xz)-t.x,p.y);\n  return length(q)-t.y;\n}\n\nfloat f (vec3 p)\n{\n    return sdTorus(p,vec2(cos(iTime)+4.5,.5*cos(iTime)+1.1));\n}\n\n// https://iquilezles.org/articles/normalsSDF\nvec3 calcNormal( vec3 p, float t )\n{\n    float e = 1.e-3*t;\n    vec2 h = vec2(1.0,-1.0)*0.5773;\n    return normalize( h.xyy*f( p + h.xyy*e ) + \n\t\t\t\t\t  h.yyx*f( p + h.yyx*e ) + \n\t\t\t\t\t  h.yxy*f( p + h.yxy*e ) + \n\t\t\t\t\t  h.xxx*f( p + h.xxx*e ));\n}\n\n// https://www.shadertoy.com/view/tsXGRl\nvec3 bg (vec2 p)\n{    \n    vec2 c = step(.1,fract(p*2.25+.05));\n    return vec3(c.x*c.y);\n}\n\nvoid mainImage( out vec4 c, in vec2 a )\n{\n    vec3 o = vec3(0,sin(iTime)+2.5,0);\n    vec3 y = vec3(0,1,0);\n    vec3 w = normalize(-o);\n    if (abs(dot(o,y)) > .999) y = y.xxy;\n    vec3 u = normalize(cross(w,y));\n    vec2 g = (a-.5*iResolution.xy)/iResolution.x;\n\tvec3 d = mat3(u,cross(u,w),w) * normalize(vec3(g,.25));\n    float t = 0., e = 1.e-4, m = 1.e6, h;\n    vec3 p = o;\n    while (t < m)\n    {\n        h = f(p);\n        if (h < e) break;\n        t = min(m,t+h);\n        p = o+d*t;\n    }\n    vec3 n = t > e && t < m ? calcNormal(p,t) : bg(g);\n    c = vec4(n,1);\n}","name":"Image","description":"","type":"image"}]}