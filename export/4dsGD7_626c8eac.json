{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"// \"The Inversion Machine\" by Kali\r\n\r\nconst float width=.22;\r\nconst float scale=4.;\r\nconst float detail=.002;\r\n\r\nvec3 lightdir=-vec3(.2,.5,1.);\r\n\r\nmat2 rot;\r\n\r\nfloat rand(vec2 co){\r\n\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\r\n}\r\n\r\nfloat de(vec3 p) {\r\n\tfloat t=iTime;\r\n\tfloat dotp=dot(p,p);\r\n\tp.x+=sin(t*40.)*.007;\r\n\tp=p/dotp*scale;\r\n\tp=sin(p+vec3(sin(1.+t)*2.,-t,-t*2.));\r\n\tfloat d=length(p.yz)-width;\r\n\td=min(d,length(p.xz)-width);\r\n\td=min(d,length(p.xy)-width);\r\n\td=min(d,length(p*p*p)-width*.3);\r\n\treturn d*dotp/scale;\r\n}\r\n\r\nvec3 normal(vec3 p) {\r\n\tvec3 e = vec3(0.0,detail,0.0);\r\n\t\r\n\treturn normalize(vec3(\r\n\t\t\tde(p+e.yxx)-de(p-e.yxx),\r\n\t\t\tde(p+e.xyx)-de(p-e.xyx),\r\n\t\t\tde(p+e.xxy)-de(p-e.xxy)\r\n\t\t\t)\r\n\t\t);\t\r\n}\r\n\r\nfloat light(in vec3 p, in vec3 dir) {\r\n\tvec3 ldir=normalize(lightdir);\r\n\tvec3 n=normal(p);\r\n\tfloat sh=1.;\r\n\tfloat diff=max(0.,dot(ldir,-n))+.1*max(0.,dot(normalize(dir),-n));\r\n\tvec3 r = reflect(ldir,n);\r\n\tfloat spec=max(0.,dot(dir,-r))*sh;\r\n\treturn diff+pow(spec,20.)*.7;\t\r\n\t\t}\r\n\r\nfloat raymarch(in vec3 from, in vec3 dir, in vec2 fragCoord) \r\n{\r\n\tvec2 uv = fragCoord.xy / iResolution.xy*2.-1.;\r\n\tuv.y*=iResolution.y/iResolution.x;\r\n\tfloat st,d,col,totdist=st=0.;\r\n\tvec3 p;\r\n\tfloat ra=rand(uv.xy*iTime)-.5;\r\n\tfloat ras=max(0.,sign(-.5+rand(vec2(1.3456,.3573)*floor(30.+iTime*20.))));\r\n\tfloat rab=rand(vec2(1.2439,2.3453)*floor(10.+iTime*40.))*ras;\r\n\tfloat rac=rand(vec2(1.1347,1.0331)*floor(40.+iTime));\r\n\tfloat ral=rand(1.+floor(uv.yy*300.)*iTime)-.5;\r\n\tfor (int i=0; i<60; i++) {\r\n\t\tp=from+totdist*dir;\r\n\t\td=de(p);\r\n\t\tif (d<detail || totdist>2.) break;\r\n\t\ttotdist+=d; \r\n\t\tst+=max(0.,.04-d);\r\n\t}\r\n\tvec2 li=uv*rot;\r\n\tfloat backg=.45*pow(1.5-min(1.,length(li+vec2(0.,-.6))),1.5);\r\n\tif (d<detail) {\r\n\t\tcol=light(p-detail*dir, dir); \r\n\t} else { \r\n\t\tcol=backg;\r\n\t}\r\n\tcol+=smoothstep(0.,1.,st)*.8*(.1+rab);\r\n\tcol+=pow(max(0.,1.-length(p)),8.)*(.5+10.*rab);\r\n\tcol+=pow(max(0.,1.-length(p)),30.)*50.;\r\n\tcol = mix(col, backg, 1.0-exp(-.25*pow(totdist,3.)));\r\n\tif (rac>.7) col=col*.7+(.3+ra+ral*.5)*mod(uv.y+iTime*2.,.25);\r\n\tcol = mix(col, .5+ra+ral*.5, max(0.,3.-iTime)/3.);\r\n\treturn col+ra*.03+(ral*.1+ra*.1)*rab;\r\n}\r\n\r\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\r\n{\r\n\tfloat t=iTime*.2;\r\n\tvec2 uv = fragCoord.xy / iResolution.xy*2.-1.;\r\n\tuv.y*=iResolution.y/iResolution.x;\r\n\tvec3 from=vec3(0.,0.1,-1.2);\r\n\tvec3 dir=normalize(vec3(uv,1.));\r\n\trot=mat2(cos(t),sin(t),-sin(t),cos(t));\r\n\tdir.xy=dir.xy*rot;\r\n\tfloat col=raymarch(from,dir,fragCoord); \r\n\tcol=pow(col,1.25)*clamp(60.-iTime,0.,1.);\r\n\tfragColor = vec4(col);\r\n}\r\n","name":"Image","description":"","type":"image"},{"outputs":[],"inputs":[],"code":"float rand(vec2 co){\n\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n\nvec2 mainSound( in int samp,float time)\n{\n\tfloat ti=time;\n    vec2 s=vec2(0.);\n    float t=mod(time,10.)-5.;\n    float tb=mod(time,.3);\n\tfloat x=t*.1;\n\t//fractal sound\n    for (int i=0;i<23;i++) {\n    \tx=1.3/abs(x)-1.; \t   \n    }\n    s+=x*2.;\n\t//noise\n\tti*=5.;\n    s+=vec2(rand(vec2(ti,1234.258-ti*2.568))*sin(time*100.),0.)*4.;\n\tti*=2.;\n    s+=vec2(0.,rand(vec2(ti,1234.258-time*2.568))*sin(time*100.))*4.;\n\tti*=.02;\n    //pulse\n\ts*=.2;\n\ttb-=x*.0003;\n    s+=vec2(sin(time),cos(time))*sin(tb*tb*4000.)*exp(-15.*tb)*20.;\n\ts+=(1.-mod(time*(2000.+sin(t*t)*100.)+x*.2,2.))*.7;\n    //starting noise\n\ts*=clamp(time*.2,0.,1.);\n    s=mix(s,vec2(rand(vec2(ti*1.5,1234.258-ti*2.568))-.3)*10.,clamp(1.-time*.5,0.,1.));\n    return vec2(s)*.5*clamp(60.-time,0.,1.);\n}","name":"Sound","description":"","type":"sound"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":true,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4dsGD7","date":"1372228953","viewed":18241,"name":"The Inversion Machine","username":"Kali","description":"My \"Inversion Machine\" shader now with synthesized sound","likes":236,"published":1,"flags":8,"usePreview":0,"tags":["raymarching","sound"],"hasliked":0,"parentid":"","parentname":""}}