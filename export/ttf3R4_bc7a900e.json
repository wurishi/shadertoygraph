{"ver":"0.1","info":{"id":"ttf3R4","date":"1555717619","viewed":687,"name":"Access Inputs from Common Tab","username":"ttg","description":"Reconstructs what the Shadertoy header omits for Common tab, allowing compilation to succeed even when samplers and uniforms normally defined only in other tabs are used.\nCompatible with all types of buffer, but not every input uniform has been tested.\n","likes":11,"published":1,"flags":8,"usePreview":0,"tags":["preprocessor"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n// Where's iChannel1?  It's in Common tab!\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* Some notes about how the header works.\n\n2019-04-19:\n_ST_TAB_COMMON: Common tab header is 19 lines shorter than others.\n  Common: __LINE__==11\n  Image: __LINE__==30\n  Sound: __LINE__==18\n  Buf/Cube:  __LINE__==24\n  >> Threshold must be between 11 and 18\n  Use a margin of safety for changes to Shadertoy:\n  Split the difference!\n  Line number more likely to increase than to decrease.\n  Sound header does not define some inputs.\n                                #if __LINE__<17          // Must be on line 3!\n                                #define _ST_TAB_COMMON\n                                #endif\n                                #if __LINE__<25\n                                #define _ST_TAB_SOUND\n\n2022-08-29: Discover the hack is no longer working, probably since Shadertoy\nstopped using footer (goodbye #define mainImage hack) and puts all its output\ncode into headers.\nThe hack is now working when sound-tab test line number is in range [27,59].\n                                #if __LINE__<17          // Must be on line 3!\n                                #define _ST_TAB_COMMON\n                                #endif\n                                #if __LINE__<40\n                                #define _ST_TAB_SOUND\n*/\n","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"                            // From https://www.shadertoy.com/view/ttf3R4\n                            // Do not use on public shaders!\n                                #if __LINE__<17          // Must be on line 3!\n                                #define _ST_TAB_COMMON\n                                #endif\n                                #if __LINE__<40\n                                #define _ST_TAB_SOUND\n                                uniform vec3 iResolution; // Sound tab\n                                uniform float iTime;  // never defines these\n                                #endif\n                                #ifdef _ST_TAB_COMMON\n                                #undef _ST_TAB_SOUND\n                                uniform float iTimeDelta;\n                                uniform int iFrame;\n                                uniform float iChannelTime[4];\n                                uniform vec3 iChannelResolution[4];\n                                uniform vec4 iMouse;\n                                // iDate and iSampleRate: Alread have them.\n                                uniform sampler2D iChannel0;\n                                uniform sampler2D iChannel1; // Change type to\n                                uniform sampler2D iChannel2; // samplerCube\n                                uniform sampler2D iChannel3; // if Cube input\n                                #endif\n                            // End header\n\n// DO NOT USE ON PUBLIC SHADERS.  This is not futureproof.\n// It may be useful for prototyping in private shaders.\n// Switch it out for a better approach in public shaders: Let main functions\n// in the Shader Pass tabs feed the values to the Common functions as needed.\n// The ugliness of the indented header should serve as a reminder.\n\n// Example Common source starts below.\n\n// how the message works: good luck!\nfloat message (vec2 U) { int i=int(U.x*2.);return int(U.y)!=1||i>6?0.:\n  texture(iChannel1,U/16.+vec2((1296376004>>5*i&62)+9,i<1?48:32)/64.).r; }\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n\n    // Time varying pixel color\n    vec3 col = 0.5 + 0.5*cos(iTime+uv.xyx+vec3(0,2,4));\n\n    // Output to screen\n    fragColor = vec4(col,1.0);\n    \n    // message\n    fragColor-=message(fragCoord/64.);\n}\n\nvec2 mainSound( in int samp, float time )\n{\n    int isample = int(time*iSampleRate);\n    return .1*texelFetch(iChannel2, ivec2(isample, isample/512)%512, 0).xy;\n}\n","name":"Common","description":"","type":"common"},{"inputs":[{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"\n// Where's iChannel2?  It's in Common tab!\n","name":"Sound","description":"","type":"sound"}]}