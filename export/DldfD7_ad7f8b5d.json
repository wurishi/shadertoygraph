{"ver":"0.1","info":{"id":"DldfD7","date":"1701320121","viewed":83,"name":"empty town but in shadertoy","username":"bward194","description":"i made this in 2 days.\na sort of technical test in terms of sound synthesis\nsound stops after 3 minutes for some reason","likes":3,"published":1,"flags":8,"usePreview":0,"tags":["sequencer","deltarune"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// === icon message: \"sound in\". link: https://www.shadertoy.com/view/MtyXRW\n\n// --- access to the image of ascii code c\n//#define C(c) U.x-=.5; T+= U.x<.0||U.x>1.||U.y<0.||U.y>1. ?vec4(0): texture( iChannel3, U/16. + fract( vec2(c, 15-c/16) / 16.))\n//#define C(c) U.x-=.5; T+= U.x<.0||U.x>1.||U.y<0.||U.y>1. ?vec4(0): textureLod( iChannel3, U/16. + fract( vec2(c, 15-c/16) / 16.), \\\n//                                                                               log2(length(fwidth(U/16.*iResolution.xy))) )\n  #define C(c) U.x-=.5; T+= U.x<.0||U.x>1.||U.y<0.||U.y>1. ?vec4(0): textureGrad(iChannel0, U/16. + fract( vec2(c, 15-c/16) / 16.), dFdx(U/16.),dFdy(U/16.) )\n#define initMsg vec4 T = vec4(0)\n#define endMsg  return length(T.yz)==0. ? 0. : T.x\n\nfloat message(vec2 U) { // to alter in the icon with the alter message\n    vec4 T = vec4(0);   // or: initMsg;\n    C(83);C(111);C(117);C(110);C(100);C(32);C(105);C(110); // message \"Sound in\"\n    return length(T.yz)==0. ? -1. : T.x; // or: endMsg;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    //  if (iResolution.y<200.) to display only in the icon \n    if (iResolution.y<2000.) {float c=message((fragCoord/iResolution.y-vec2(.1,.2))*8.);if(c>=0.){fragColor=vec4(c);return;}}\n\n    \n    vec2 uv = fragCoord.xy / iResolution.xy;\n\tfragColor = vec4(uv,0.5+0.5*sin(iTime),1.0);\n\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"\n    \nvec2 mainSound( int samp, float time )\n{\ntime=mod(time,96./(tempo/120.));\nreturn snd(time);\n}","name":"Sound","description":"","type":"sound"},{"inputs":[],"outputs":[],"code":"//TODO add harmony track on segment two\n\n//audio wave functions\n#define offset 0.65\nfloat vbt(float freq, float time) {\n\n    return  (abs(fract(freq * time - 0.25) - 0.5) * 4.0 - 1.0);\n}\nfloat s50( float f, float x )\n{\n    return floor( 2.0 * floor( f * x ) - floor( 2.0 * f * x ) + 1.0 );\n}\n\nfloat s25( float f, float x )\n{\n    return floor( 4.0 * floor( f * x ) - floor( 4.0 * f * x ) + 1.0 );\n}\n\nfloat s12( float f, float x )\n{\n    return floor( 6. * floor( f * x ) - floor( 6. * f * x ) + .0 );\n}\nfloat wt(float freq, float time) {\n\n    return round((abs(fract(freq * time - .25) - 0.5) * 4.0 - 1.0)*8.)/8.;\n\n\n} \n\n//audio int\n\nfloat tempo=138.;\n//for reference, the X value is the key that specific note is, and the Y value is the time it plays. it is much MUCH more cleaner(and easier to look at(and to work with)) than the last version.\nvec2 m1[]=vec2[](vec2(-3.,0.),vec2(0.,1.),vec2(4.,1.25),vec2(12.,1.5),vec2(11.,2.5),vec2(7.,3.),vec2(2.,4.),vec2(4.,4.5),vec2(4.,6.),vec2(5.,7.),vec2(7.,7.25),vec2(5.,7.5),vec2(4.,8.5),vec2(2.,9.),vec2(0.,10.),vec2(4.,10.5));\n\nvec3 m1harm[]=vec3[](vec3(4,0,1),vec3(9,1,.25),vec3(12,1.25,.25),vec3(16,1.5,1.5),vec3(14,3.,1.),\nvec3(11,4.,.5),vec3(9,4.5,1.),vec3(7,5.5,.5),vec3(9,6.,1.25),vec3(11,7.25,.25),vec3(12,7.5,1.),\nvec3(11,8.5,.5),vec3(7,9,1.),vec3(4,10,.5),vec3(11,10.5,1.5),vec3(5,12,1.25),vec3(7,13.25,.25)\n,vec3(9,13.5,.5),vec3(7,14.,.5),vec3(5,14.5,.5),vec3(4,15.,.5),vec3(14,15.5,.25),vec3(12,15.75,.25),\nvec3(11,16.,.25),vec3(9,16.25,.25),vec3(7,16.5,1.5),vec3(9,18,1.),vec3(10,19.,.25),vec3(12,19.25,.25)\n,vec3(10,19.5,1.),vec3(9,20.5,.5),vec3(9,21.,1.),vec3(8,22.,.25),vec3(9,22.25,.25),vec3(11,22.5,1.5)\n);\n//X=Pitch, Y= Time it plays, Z = length of note\n//Table is separated by 3/4 time signature\nvec3 m1bass[]=vec3[](\nvec3(-3.,0.,.375),vec3(4.,.5,.25),vec3(4.,1.,.25),\nvec3(-3.,1.5,.375),vec3(4.,2.,.25),vec3(4.,2.5,.25),\nvec3(-5.,3.,.375),vec3(4.,3.5,.25),vec3(4.,4.,.25),\nvec3(-5.,4.5,.375),vec3(4.,5.,.25),vec3(4.,5.5,.25),\nvec3(-7.,6.,.375),vec3(0.,6.5,.25),vec3(0.,7.,.25),\nvec3(-7.,7.5,.375),vec3(0.,8.,.25),vec3(0.,8.5,.25),\nvec3(-8.,9.,.375),vec3(-1.,9.5,.25),vec3(-1.,10.,.25),\nvec3(-8.,10.5,.375),vec3(-1.,11.,.25),vec3(-1.,11.5,.25),\nvec3(-10.,12.,.375),vec3(-3.,12.5,.25),vec3(-3.,13.,.25),\nvec3(-10.,13.5,.375),vec3(-3.,14,.25),vec3(-3.,14.5,.25),\nvec3(-12.,15.,.375),vec3(-5.,15.5,.25),vec3(-5.,16.,.25),\nvec3(-12.,16.5,.375),vec3(-5.,17,.25),vec3(-5.,17.5,.25),\nvec3(-14.,18.,.375),vec3(-7.,18.5,.25),vec3(-7.,19.,.25),\nvec3(-14.,19.5,.375),vec3(-7.,20,.25),vec3(-7.,20.5,.25),\nvec3(-8.,21.,.375),vec3(-3.,21.5,.25),vec3(-3.,22.,.25),\nvec3(-8.,22.5,.375),vec3(-4.,23,.25),vec3(-4.,23.5,.25),\n\n\nvec3(-3.,24.,.375),vec3(4.,24.5,.25),vec3(4.,25.,.25),\nvec3(-3.,25.5,.375),vec3(4.,26.,.25),vec3(4.,26.5,.25),\nvec3(-5.,27.,.375),vec3(4.,27.5,.25),vec3(4.,28.,.25),\nvec3(-5.,28.5,.375),vec3(4.,29.,.25),vec3(4.,29.5,.25),\nvec3(-7.,30.,.375),vec3(0.,30.5,.25),vec3(0.,31.,.25),\nvec3(-7.,31.5,.375),vec3(0.,32.,.25),vec3(0.,32.5,.25),\nvec3(-8.,33.,.375),vec3(-1.,33.5,.25),vec3(-1.,34.,.25),\nvec3(-8.,34.5,.375),vec3(-1.,35.,.25),vec3(0.,35.25,.25),vec3(2.,35.5,.25),vec3(-1.,35.75,.25),\nvec3(-10.,36.,.375),vec3(-3.,36.5,.25),vec3(-3.,37.,.25),\nvec3(-10.,37.5,.375),vec3(-3.,38,.25),vec3(-3.,38.5,.25),\nvec3(-12.,39.,.375),vec3(-5.,39.5,.25),vec3(-5.,40.,.25),\nvec3(-12.,40.5,.375),vec3(-5.,41,.25),vec3(-5.,41.5,.25),\nvec3(-14.,42.,.375),vec3(-7.,42.5,.25),vec3(-7.,43.,.25),\nvec3(-14.,43.5,.375),vec3(-7.,44,.25),vec3(-7.,44.5,.25),\nvec3(-8.,45.,.375),vec3(-3.,45.5,.25),vec3(-3.,46.,.25),\nvec3(-8.,46.5,.375),vec3(-4.,47,.25),vec3(-4.,47.5,.25));\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\nvec3 m2bass[]=vec3[](vec3(-3.,0.,.375),vec3(4.,.5,.25),vec3(4.,1.,.25),\nvec3(-3.,1.5,.375),vec3(4.,2.,.25),vec3(4.,2.5,.25),\nvec3(-5.,3.,.375),vec3(4.,3.5,.25),vec3(4.,4.,.25),\nvec3(-5.,4.5,.375),vec3(4.,5.,.25),vec3(4.,5.5,.25),\nvec3(-7.,6.,.375),vec3(4.,6.5,.25),vec3(4.,7.,.25),\nvec3(-7.,7.5,.375),vec3(0.,8.,.25),vec3(4.,8.5,.25),\nvec3(0.,9.,.375),vec3(7.,9.5,.25),vec3(7.,10.,.25),\nvec3(7.,10.5,.25),vec3(5.,10.75,.0625),vec3(7.,10.8125,.0625),vec3(4.,10.875,.0625),vec3(5.,10.9375,.0625),\nvec3(4.,11.,.25),vec3(5.,11.25,.25),vec3(4.,11.5,.25),\nvec3(2.,11.75,.25),vec3(-2.,12.,.375),vec3(2.,12.5,.25),\nvec3(5.,13.,.25),vec3(-2.,13.5,.375),vec3(2.,14.,.25),\nvec3(5.,14.5,.25),vec3(-3.,15.,.375),vec3(0.,15.5,.25),\nvec3(4.,16.,.25),vec3(-3.,16.5,.375),vec3(0.,17.,.25),\nvec3(4.,17.5,.25),vec3(-1.,18.,.25),vec3(6.,18.5,.25),\nvec3(6.,19.,.25),vec3(-1.,19.5,.25),vec3(6.,20.,.25),\nvec3(6.,20.5,.25),vec3(4.,21.,.25),vec3(11.,21.5,.25),\nvec3(11.,22.,.25),vec3(7.,22.46875,.03125),vec3(4.,22.5,.25),\nvec3(2.,22.75,.25),vec3(0.,23.,.25),vec3(2.,23.25,.25),vec3(0.,23.5,.25),vec3(-4.,23.75,.25));\n\nvec3 m2[]=vec3[](vec3(0.,-2.,0.),vec3(-1.,0.5,.25),vec3(-0.,0.75,.25),vec3(-1.,1.,.25),vec3(-3.,1.25,.25),\nvec3(-8.,1.5,.25),vec3(-12.,2.,.25),vec3(-8.,2.5,.25),vec3(-1.,3.5,.25),vec3(-0.,3.75,.25),\nvec3(-1.,4.,.25),vec3(-3.,4.25,.25),vec3(2.,4.5,1.5),vec3(-1.,6.5,.25),vec3(-0.,6.75,.25),\nvec3(-1.,7.,.25),vec3(-3.,7.25,.25),vec3(-1.,7.5,1.),vec3(0.,8.5,.25),vec3(-5.,9.,.25)\n,vec3(0.,9.4583333,.041666),vec3(-5.,9.5,.25),vec3(-7.,9.75,.25),vec3(-8.,10.,.25),vec3(-7.,10.25,.25)\n,vec3(-8.,10.5,1.5),vec3(-8.,12.5,.25),vec3(-7.,12.75,.25),vec3(-8.,13.,.25),vec3(-10.,13.25,.25)\n,vec3(-14.,13.5,.5),vec3(-19.,14.,.5),vec3(-7.,14.5,.5),vec3(-8.,15.,.75),vec3(-10.,15.75,.25),\nvec3(-12.,16.,.25),vec3(-10.,16.25,.25),vec3(-8.,16.5,1.),vec3(-12.,17.5,.5),vec3(-9.,18.,.5)\n,vec3(-13.,18.5,.5),vec3(-15.,19.,.5),vec3(-21.,19.5,1.),vec3(-9.,20.5,.5),vec3(-8.,21.,3.));\n\nvec3 m2harm[]=vec3[](vec3(0.,-2.,0.),vec3(-10.,0.5,.25),vec3(-8.,0.75,.25),vec3(-10.,1.,.25),vec3(-12.,1.25,.25),\nvec3(-13.,1.5,.25),vec3(-15.,2.,.25),vec3(-13.,2.5,.25),vec3(-10.,3.5,.25),vec3(-8.,3.75,.25),\nvec3(-10.,4.,.25),vec3(-12.,4.25,.25),vec3(-13.,4.5,1.5),vec3(-5.,6.5,.25),vec3(-3.,6.75,.25),\nvec3(-5.,7.,.25),vec3(-7.,7.25,.25),vec3(-5.,7.5,1.),vec3(-3.,8.5,.25),vec3(-8.,9.,.25)\n,vec3(-3.,9.4583333,.041666),vec3(-8.,9.5,.25),vec3(-10.,9.75,.25),vec3(-12.,10.,.25),vec3(-10.,10.25,.25)\n,vec3(-12.,10.5,1.5),vec3(-12.,12.5,.25),vec3(-10.,12.75,.25),vec3(-12.,13.,.25),vec3(-14.,13.25,.25)\n,vec3(-19.,13.5,.5),vec3(-22.,14.,.5),vec3(-10.,14.5,.5),vec3(-12.,15.,.75),vec3(-13.,15.75,.25),\nvec3(-15.,16.,.25),vec3(-13.,16.25,.25),vec3(-12.,16.5,1.),vec3(-15.,17.5,.5),vec3(-13.,18.,.5)\n,vec3(-21.,18.5,.5),vec3(-25.,19.,.5),vec3(-30.,19.5,1.),vec3(-13.,20.5,.5),vec3(-15.,21.,.5),vec3(-16.,21.5,.25),vec3(-15.,21.75,.25),vec3(-16.,22.,.25),vec3(-15.,22.25,.25),vec3(-16.,22.5,2.));\nvec3 whatthefuck=vec3(-31.,14.,.5);\n// audio playback\n\nvec2 seg1b(float time){    float tone =0.;\n    float amp=1.;\n    for (int i=0; i<m1bass.length();i++){\n    if(m1bass[i].y<=time*(tempo/120.)){\n    amp=(m1bass[i].z+m1bass[i].y)>=time*(tempo/120.)?0.2:0.; \ntone=m1bass[i].x;}}\n\n    return amp*vec2( wt(pow(2.,((tone+offset)/12.)+8.),time));}\n    \n\n    \nvec2 seg1(float time){    float tone =0.;\n    float amp=0.2;\n    float vib =0.;\n    for (int i=0; i<m1.length();i++){\n    if(m1[i].y<=time*(tempo/120.)){\n    float vi=vbt(5.,(time*(tempo/120.)-m1[i].y));\n    vib=time*(tempo/120.)-m1[i].y>=0.45 ? 0.0001*vi :0. ;\n    amp=min(round(8.*(time*(tempo/120.)-m1[i].y+.25)),8.)/16.;\ntone=m1[i].x;}}\n\n    return amp*vec2( s50(pow(2.,((tone+offset)/12.)+9.),time-vib));}\n    \n    vec2 seg1h(float time){    float tone =0.;\n    float amp=0.2;\n    float vib =0.; \n    for (int i=0; i<m1harm.length();i++){\n    if(m1harm[i].y<=time*(tempo/120.)){\n    float vi=vbt(5.,(time*(tempo/120.)-m1[i].y));\n    vib=time*(tempo/120.)-m1harm[i].y>=0.45 ? 0.0001*vi :0. ;\n    amp=((m1harm[i].z+m1harm[i].y)>=time*(tempo/120.)?0.2:0.)*min(round(8.*(time*(tempo/120.)-m1harm[i].y+.1)),4.)/16.;\ntone=m1harm[i].x;}}\n\n    return amp*vec2( s25(pow(2.,((tone+offset)/12.)+8.),time-vib));}\n    //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    \n  vec2 seg2(float time){    float tone =0.;\n    float amp=0.2;\n    float vib =0.; \n    for (int i=0; i<m2.length();i++){\n    if(m2[i].y<=time*(tempo/120.)){\n    float vi=vbt(5.,(time*(tempo/120.)-m2[i].y));\n    vib=time*(tempo/120.)-m2[i].y>=0.45 ? 0.0001*vi :0. ;\n    amp=((m2[i].z+m2[i].y)>=time*(tempo/120.)?0.2:0.)*min(round(12.*(time*(tempo/120.)-m2[i].y+.15)),4.)/16.;\ntone=m2[i].x;}}\nreturn amp*vec2( s12(pow(2.,((tone+offset)/12.)+10.),time-vib));}\n\n  vec2 seg2h(float time){    float tone =0.;\n    float amp=0.2;\n    float vib =0.; \n    for (int i=0; i<m2harm.length();i++){\n    if(m2harm[i].y<=time*(tempo/120.)){\n    float vi=vbt(5.,(time*(tempo/120.)-m2harm[i].y));\n    vib=time*(tempo/120.)-m2harm[i].y>=0.45 ? 0.0001*vi :0. ;\n    amp=((m2harm[i].z+m2harm[i].y)>=time*(tempo/120.)?0.1:0.)*min(round(12.*(time*(tempo/120.)-m2harm[i].y+.15)),4.)/16.;\ntone=m2harm[i].x;}}\nreturn amp*vec2( s12(pow(2.,((tone+offset)/12.)+10.),time-vib));}\n\n  vec2 w(float time){    float tone =0.;\n    float amp=0.2;\n    float vib =0.; \n\n    if(whatthefuck.y<=time*(tempo/120.)){\n    float vi=vbt(5.,(time*(tempo/120.)-whatthefuck.y));\n    vib=time*(tempo/120.)-whatthefuck.y>=0.45 ? 0.0001*vi :0. ;\n    amp=((whatthefuck.z+whatthefuck.y)>=time*(tempo/120.)?0.05:0.)*min(round(12.*(time*(tempo/120.)-whatthefuck.y+.15)),4.)/16.;\ntone=whatthefuck.x;}\nelse{\namp=0.;}\nreturn amp*vec2( s12(pow(2.,((tone+offset)/12.)+10.),time-vib));}\n\n        vec2 seg2b(float time){    float tone =0.;\n    float amp=1.;\n    for (int i=0; i<m2bass.length();i++){\n    if(m2bass[i].y<=time*(tempo/120.)){\n    amp=(m2bass[i].z+m2bass[i].y)>=time*(tempo/120.)?0.2:0.; \ntone=m2bass[i].x;}}\n\n    return amp*vec2( wt(pow(2.,((tone+offset)/12.)+8.),time));}\n    \n    vec2 snd(float time){\nif (time*(tempo/120.)>=48.) {\nreturn seg2b(mod(time-48./(tempo/120.),24./(tempo/120.)))+(seg2h(mod(time-48./(tempo/120.),24./(tempo/120.)))+seg2h(mod(time-48./(tempo/120.)-0.5*(tempo/120.),24./(tempo/120.)))*.2)+(seg2(mod(time-48./(tempo/120.),24./(tempo/120.)))+seg2(mod(time-48./(tempo/120.)-0.25*(tempo/120.),24./(tempo/120.)))*.2)+(w(mod(time-48./(tempo/120.),24./(tempo/120.)))+w(mod(time-48./(tempo/120.)-0.5*(tempo/120.),24./(tempo/120.)))*.2);\n}\nelse{\nreturn  (time*(tempo/120.)<=24.?vec2(0.):seg1h(time-24./(tempo/120.)))+seg1b(time)+(seg1(mod(time,12./(tempo/120.)))+(seg1(mod(time,12./(tempo/120.))-(0.5*(tempo/120.)))*.2))*.5;}}\n    ","name":"Common","description":"","type":"common"}]}