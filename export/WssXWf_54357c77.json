{"ver":"0.1","info":{"id":"WssXWf","date":"1552381350","viewed":248,"name":"RayRepitation","username":"kiyamada96","description":"Ray fbm repitation","likes":8,"published":1,"flags":0,"usePreview":0,"tags":["rayfbm"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define OCTAVES 5\n#define CS(a) vec2(cos(a),sin(a))\n\nconst float sphereSize=1.;\nconst vec3 lightDir=vec3(-0.577,0.577,0.577);\n\nconst float PI=3.14;\nconst float angle=90.0;\nconst float fov=angle*0.5*PI/180.0;\n\nvec3 trans(vec3 p)\n{\n\treturn mod(p,4.0)-2.0;\n}\n\nfloat random(in vec2 st)\n{\n\treturn fract(sin(dot(st.xy,vec2(12.443,78.4)))*43758.2);\n}\n\nfloat noise(in vec2 st)\n{\n\tvec2 i=floor(st);\n    vec2 f=fract(st);\n    float a=random(i);\n    float b=random(i+vec2(1.0,0.0));\n    float c=random(i+vec2(0.0,1.0));\n    float d=random(i+vec2(1.0,1.0));\n    \n    vec2 u=smoothstep(0.0,1.0,f);\n    return mix(a,b,u.x)+(c-a)*u.y*(1.0-u.x)+(d-b)*u.x*u.y;\n    \n}\n\nfloat fbm(vec2 p)\n{\n\tfloat result=0.0;\n    float amplitude=1.0;\n    \n    for(int i=0;i<OCTAVES;i++)\n    {\n    \tresult+=amplitude*noise(p);\n        amplitude*=0.5;\n        p*=2.;\n    }\n    return result;\n}\n\nfloat distanceFunc(vec3 p)\n{\n    return length(trans(p)) - (1.0+sin((p.y+iTime) * 10.0) * 0.1);\n}\n\nvec3 getNormal(vec3 p)\n{\n\tfloat d=0.01;\n\treturn normalize(vec3(\n        distanceFunc(p+vec3(d,0.0,0.0))-distanceFunc(p+vec3(-d,0.0,0.0)),\n        distanceFunc(p+vec3(0.0,d,0.0))-distanceFunc(p+vec3(0.0,-d,0.0)),\n        distanceFunc(p+vec3(0.0,0.0,d))-distanceFunc(p+vec3(0,0.0,-d))\n    ));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 p=(fragCoord.xy*2.0-iResolution.xy)/min(iResolution.x,iResolution.y);\n   \tp+=fbm(p+iTime*0.1);\n    \n    vec3 cPos=vec3(0.0,0.0,2.0);\n    vec3 cDir=vec3(0.0,0.0,-1.0);\n    vec3 cUp=vec3(0.0,1.0,0.0);   \n    vec3 cSide=cross(cDir,cUp);\n    float targetDepth=1.0;\n    \n    vec3 ray=normalize(vec3(sin(fov)*p.x,sin(fov)*p.y,-cos(fov)));\n    \n    float dist=0.0;\n    float rlen=0.0;\n   \tvec3 rPos=cPos;\n    \n    for(int i=0;i<128;i++)\n    {\n    \tdist=distanceFunc(rPos);\n        rlen+=dist;\n        rPos=cPos+ray*rlen;\n    }\n   \n    if(abs(dist)<0.001)\n    {\n   \t\tvec3 nor=getNormal(rPos);\n        float diff=clamp(dot(nor,lightDir),0.1,1.0);\n        fragColor=vec4(vec3(nor),1.0);\n    }\n    else\n    {\n    \tfragColor=vec4(vec3(0.),1.0);\n    }\n}","name":"Image","description":"","type":"image"}]}