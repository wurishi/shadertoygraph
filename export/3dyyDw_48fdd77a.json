{"ver":"0.1","info":{"id":"3dyyDw","date":"1602954621","viewed":221,"name":"Runaway Rocket","username":"dyla","description":"dangerous trajectory","likes":4,"published":1,"flags":32,"usePreview":0,"tags":["2d","particles","smoke"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\n    vec2 uv = fragCoord/iResolution.xx;\n\n    float intensity = 0.0;\n    float age = 0.0;\n    float ageCnt = 0.1;\n    for (int i=0; i<PART_CNT; i++) {\n        Particle p = getParticle(i, iChannel0);\n        float size = exp(p.age*5.3) * 0.005;\n        float dist = length(uv-p.position);\n        float pint = exp(-8.0*p.age);\n        float distWeight = (1.0-smoothstep(size-size*0.5, size, dist));\n        float intAdd = distWeight*pint;\n        intensity += intAdd;\n\t\tage += p.age * intAdd;\n    }\n    \n    age = age/(intensity+0.0001);\n    intensity = min(intensity, 1.0);\n    // Output to screen\n    vec4 pColor = mix(vec4(1.0,1.0,0.25, 1.0), vec4(0.0), smoothstep(0.0,0.95,age));\n    fragColor = mix(vec4(0.2, 0.5, 0.7, 1.0), pColor, intensity);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define PART_CNT 250\n#define POS_VEL_ROW 0\n#define AGE_ROW 1\n#define isInit (iFrame<5)\n#define t (float(iFrame)*0.0125)\n#define dt (0.0125)\n#define aspRat (iResolution.y/iResolution.x)\n\nstruct Particle {\n  vec2 position;\n  vec2 velocity;\n  float age;\n};\n\n    \nParticle getParticle(int idx, sampler2D buffer) {\n    vec4 posVel = texelFetch(buffer, ivec2(idx, POS_VEL_ROW), 0);\n    float age = texelFetch(buffer, ivec2(idx, AGE_ROW), 0).x;\n    return Particle(posVel.xy, posVel.zw, age);\n}\n\nfloat prand(vec2 uv) {\n    return fract(sin(dot(mod(uv,153.789),vec2(12.9898,78.233)))*43758.5453) ;\n}\n\nvec4 rand(vec2 p) {\n    return vec4(prand(p), prand(p+0.71), prand(p-0.31), prand(p+0.97));\n}\n\n","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void initParticle(int idx) {\n    \n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n   bool isPosVel = int(fragCoord.y)==POS_VEL_ROW;\n   bool isAge = int(fragCoord.y)==AGE_ROW;\n   float t1 = t*smoothstep(0.0, 10.0, t);\n   vec2 emitterPos = vec2(sin(t1*1.0)*0.45+0.5, -cos(t1*1.393)*0.45*aspRat+0.5*aspRat);\n   \n   if (isInit) {\n       if (isPosVel) {\n         // poition components in [0.0, 1.0]; velocity components in [-0.5, 0.5]\n         fragColor = vec4(emitterPos, rand(fragCoord).xy - vec2(0.5, 0.5));\n       } else if (isAge) {\n           fragColor = vec4(prand(fragCoord));\n       } else {\n           discard;\n       }\n   }\n   else {\n       Particle p = getParticle(int(fragCoord.x), iChannel0);\n       \n       if (isAge){\n           fragColor.x = p.age>1.0 ? 0.0 : p.age+dt;\n   \t   } else if (isPosVel) {\n           if (p.age<1.0) {\n           \t  fragColor = vec4(p.position+p.velocity*dt*0.2, p.velocity);\n           } else {\n               fragColor = vec4(emitterPos, p.velocity);\n           }\n       }\n       else {\n            discard;\n       }\n   }\n}","name":"Buffer A","description":"","type":"buffer"}]}