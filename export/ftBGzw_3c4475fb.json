{"ver":"0.1","info":{"id":"ftBGzw","date":"1623511556","viewed":55,"name":"Cubemap step1","username":"kithy","description":"cubemap texture and projection.","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","cubemap","morphing"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define MAX_STEPS 100.0\n#define EPS 0.001\n\nmat2 rot(float a){\n\tfloat s=sin(a);\n\tfloat c=cos(a);\n\treturn mat2(c,s,-s,c);\n}\n\nfloat sdSphere(vec3 p){\n\treturn length(p)-1.0;\n}\n\nfloat sdCube(vec3 p){\n\tfloat r=0.7;\n\tvec3 q=abs(p)-r;\n\treturn length(max(q,0.0))+min(max(q.x,max(q.y,q.z)),0.0);\n}\n\nfloat mainDist(vec3 p){\n\t\n\tfloat s=sdSphere(p);\n\tfloat c=sdCube(p);\n\treturn mix(s,c,cos(iTime*2.0)*0.5+0.5);\n}\n\nvec3 GetRayDir(vec2 uv,vec3 ro){\n\tvec3 f=normalize(vec3(0.0)-ro),\n\tr=normalize(cross(vec3(0.0,1.0,0.0),f)),\n\tu=cross(f,r),\n\tc=ro+f,\n\ti=c+uv.x*r+uv.y*u,\n\trd=normalize(i-ro);\n\treturn rd;\n}\n\nvec3 WorldToCube(vec3 p){\n\tvec3 ap=abs(p);\n\tvec3 sp=sign(p);\n\tfloat m=max(ap.x,max(ap.y,ap.z));\n\tvec3 st;\n\tif(m==ap.x)\n\t\tst=vec3(p.zy,1.0*sp.x);\n\telse if(m==ap.y)\n\t\tst=vec3(p.zx,2.0*sp.y);\n\telse\n\t\tst=vec3(p.xy,3.0*sp.z);\n\tst.x/=m;\n\tst.xy*=(1.45109572583-0.451095725826*abs(st.xy));\n\treturn st;\n}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\tvec2 uv=(2.0*fragCoord.xy-iResolution.xy)/iResolution.y;\n\n\tvec3 ro=vec3(0.0,0.0,-2.5);\n\tvec3 rd=GetRayDir(uv,ro);\n\n\tfloat dO=0.0,dS;\n\tvec3 p;\n\n\tfor(float i=0.0;i<MAX_STEPS;i++){\n\n\t\tp=ro+rd*dO;\n\t\tdS=mainDist(p);\n\t\tdS=min(dS,-(length(p)-4.0));\n\t\tif(dS<EPS)break;\n\t\tdO+=dS;\n\t}\n\n\tvec3 col=WorldToCube(p);\n\n\n\tfragColor=vec4(col,1.0);\n}\n","name":"Image","description":"","type":"image"}]}