{"ver":"0.1","info":{"id":"cs2GWD","date":"1667610707","viewed":20665,"name":"20221105_inercia intended one","username":"0b5vr","description":"OVERSLEPT + BUG PANIC\n\nIntended to be won the InÃ©rcia 2022 Shader Royale\nThe estimated time will be 120min\n\nhttps://2022.inercia.pt/","likes":456,"published":1,"flags":64,"usePreview":1,"tags":["3d","music","livecoding","soundcloud","dubstep2"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"llBXD1","filepath":"https://soundcloud.com/artbyform/dubstep-2-emotional-clap","previewfilepath":"https://soundcloud.com/artbyform/dubstep-2-emotional-clap","type":"musicstream","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":0}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define lofi(i,j) (floor((i)/(j))*(j))\n#define lofir(i,j) (round((i)/(j))*(j))\n\nconst float PI=acos(-1.);\nconst float TAU=PI*2.;\n\nmat2 r2d(float t){\n  float c=cos(t),s=sin(t);\n  return mat2(c,s,-s,c);\n}\n\nmat3 orthbas(vec3 z){\n  z=normalize(z);\n  vec3 up=abs(z.y)>.999?vec3(0,0,1):vec3(0,1,0);\n  vec3 x=normalize(cross(up,z));\n  return mat3(x,cross(z,x),z);\n}\n\nuvec3 pcg3d(uvec3 s){\n  s=s*1145141919u+1919810u;\n  s.x+=s.y*s.z;\n  s.y+=s.z*s.x;\n  s.z+=s.x*s.y;\n  s^=s>>16;\n  s.x+=s.y*s.z;\n  s.y+=s.z*s.x;\n  s.z+=s.x*s.y;\n  return s;\n}\n\nvec3 pcg3df(vec3 s){\n  uvec3 r=pcg3d(floatBitsToUint(s));\n  return vec3(r)/float(0xffffffffu);\n}\n\nstruct Grid{\n  vec3 s;\n  vec3 c;\n  vec3 h;\n  int i;\n  float d;\n};\n\nGrid dogrid(vec3 ro,vec3 rd){\n  Grid r;\n  r.s=vec3(2,2,100);\n  for(int i=0;i<3;i++){\n    r.c=(floor(ro/r.s)+.5)*r.s;\n    r.h=pcg3df(r.c);\n    r.i=i;\n\n    if(r.h.x<.4){\n      break;\n    }else if(i==0){\n      r.s=vec3(2,1,100);\n    }else if(i==1){\n      r.s=vec3(1,1,100);\n    }\n  }\n  \n  vec3 src=-(ro-r.c)/rd;\n  vec3 dst=abs(.501*r.s/rd);\n  vec3 bv=src+dst;\n  float b=min(min(bv.x,bv.y),bv.z);\n  r.d=b;\n  \n  return r;\n}\n\nfloat sdbox(vec3 p,vec3 s){\n  vec3 d=abs(p)-s;\n  return length(max(d,0.))+min(0.,max(max(d.x,d.y),d.z));\n}\n\nfloat sdbox(vec2 p,vec2 s){\n  vec2 d=abs(p)-s;\n  return length(max(d,0.))+min(0.,max(d.x,d.y));\n}\n\nvec4 map(vec3 p,Grid grid){\n  p-=grid.c;\n  p.z+=.4*sin(2.*iTime+1.*fract(grid.h.z*28.)+.3*(grid.c.x+grid.c.y));\n  \n  vec3 psize=grid.s/2.;\n  psize.z=1.;\n  psize-=.02;\n  float d=sdbox(p+vec3(0,0,1),psize)-.02;\n  \n  float pcol=1.;\n\n  vec3 pt=p;\n  \n  if(grid.i==0){//2x2\n    if(grid.h.y<.3){//speaker\n      vec3 c=vec3(0);\n      pt.xy*=r2d(PI/4.);\n      c.xy=lofir(pt.xy,.1);\n      pt=pt-c;\n      pt.xy*=r2d(-PI/4.);\n      \n      float r=.02*smoothstep(.9,.7,abs(p.x))*smoothstep(.9,.7,abs(p.y));\n      float hole=length(pt.xy)-r;\n      d=max(d,-hole);\n    }else if(grid.h.y<.5){//eq\n      vec3 c=vec3(0);\n      c.x=clamp(lofir(pt.x,.2),-.6,.6);\n      pt-=c;\n      float hole=sdbox(pt.xy,vec2(0.,.7))-.03;\n      d=max(d,-hole);\n      \n      pt.y-=.5-smoothstep(-.5,.5,sin(iTime+c.x+grid.h.z*100.));\n      float d2=sdbox(pt,vec3(.02,.07,.07))-.03;\n      \n      if(d2<d){\n        float l=step(abs(pt.y),.02);\n        return vec4(d2,2.*l,l,0);\n      }\n      \n      pt=p;\n      c.y=clamp(lofir(pt.y,.2),-.6,.6);\n      pt-=c;\n      pcol*=smoothstep(.0,.01,sdbox(pt.xy,vec2(.07,.0))-.005);\n\n      pt=p;\n      c.y=clamp(lofir(pt.y,.6),-.6,.6);\n      pt-=c;\n      pcol*=smoothstep(.0,.01,sdbox(pt.xy,vec2(.1,.0))-.01);\n      \n      pcol=mix(1.,pcol,smoothstep(.0,.01,sdbox(pt.xy,vec2(.03,1.))-.01));\n\n    }else if(grid.h.y<.6){//kaosspad\n      float hole=sdbox(p.xy,vec2(.9,.9)+.02);\n      d=max(d,-hole);\n\n      float d2=sdbox(p,vec3(.9,.9,.05));\n\n      if(d2<d){\n        float l=step(abs(p.x),.7)*step(abs(p.y),.7);\n        return vec4(d2,4.*l,0,0);\n      }\n    }else if(grid.h.y<1.){//bigass knob\n      float ani=smoothstep(-.5,.5,sin(iTime+grid.h.z*100.));\n      pt.xy*=r2d(PI/6.*5.*mix(-1.,1.,ani));\n\n      float metal=step(length(pt.xy),.45);\n      float wave=metal*sin(length(pt.xy)*500.)/1000.;\n      float d2=length(pt.xy)-.63+.05*pt.z-.02*cos(8.*atan(pt.y,pt.x));\n      d2=max(d2,abs(pt.z)-.4-wave);\n\n      float d2b=length(pt.xy)-.67+.05*pt.z;\n      d2b=max(d2b,abs(pt.z)-.04);\n      d2=min(d2,d2b);\n      \n      if(d2<d){\n        float l=smoothstep(.01,.0,length(pt.xy-vec2(0,.53))-.03);\n        return vec4(d2,3.*metal,l,0);\n      }\n      \n      pt=p;\n      float a=clamp(lofir(atan(-pt.x,pt.y),PI/12.),-PI/6.*5.,PI/6.*5.);\n      pt.xy*=r2d(a);\n      pcol*=smoothstep(.0,.01,length(pt.xy-vec2(0,.74))-.015);\n\n      pt=p;\n      a=clamp(lofir(atan(-pt.x,pt.y),PI/6.*5.),-PI/6.*5.,PI/6.*5.);\n      pt.xy*=r2d(a);\n      pcol*=smoothstep(.0,.01,length(pt.xy-vec2(0,.74))-.03);\n      \n      float d3=length(p-vec3(.7,-.7,0))-.05;\n      \n      if(d3<d){\n        float led=1.-ani;\n        led*=.5+.5*sin(iTime*exp2(3.+3.*grid.h.z));\n        return vec4(d3,2,led,0);\n      }\n    }\n  }else if(grid.i==1){//2x1\n    if(grid.h.y<.4){//fader\n      float hole=sdbox(p.xy,vec2(.9,.05));\n      d=max(d,-hole);\n      \n      float ani=smoothstep(-.2,.2,sin(iTime+grid.h.z*100.));\n      pt.x-=mix(-.8,.8,ani);\n      \n      float d2=sdbox(pt,vec3(.07,.25,.4))+.05*p.z;\n      d2=max(d2,-p.z);\n\n      if(d2<d){\n        float l=smoothstep(.01,.0,abs(p.y)-.02);\n        return vec4(d2,0,l,0);\n      }\n      \n      pt=p;\n      vec3 c=vec3(0);\n      c.x=clamp(lofir(pt.x,.2),-.8,.8);\n      pt-=c;\n      pcol*=smoothstep(.0,.01,sdbox(pt.xy,vec2(.0,.15))-.005);\n\n      pt=p;\n      c=vec3(0);\n      c.x=clamp(lofir(pt.x,.8),-.8,.8);\n      pt-=c;\n      pcol*=smoothstep(.0,.01,sdbox(pt.xy,vec2(.0,.18))-.01);\n      \n      pcol=mix(1.,pcol,smoothstep(.0,.01,sdbox(p.xy,vec2(1.,.08))));\n    }else if(grid.h.y<.5){//button\n      vec3 c=vec3(0);\n      c.x=clamp(lofi(pt.x,.44)+.44/2.,-.44*1.5,.44*1.5);\n      pt-=c;\n\n      float hole=sdbox(pt.xy,vec2(.19,.33))-.01;\n      d=max(d,-hole);\n      \n      float ani=smoothstep(.8,.9,sin(10.*iTime-c.x*2.2+grid.h.z*100.));\n\n      vec4 fuck=vec4(d,0,0,0);\n      float d3=length(pt-vec3(0,.22,.04))-.05;\n      \n      if(d3<fuck.x){\n        float led=ani;\n        fuck=vec4(d3,2,led,0);\n      }\n\n      float d2=sdbox(pt,vec3(.17,.3,.05))-.01;\n      d2=min(d2,sdbox(pt-vec3(0,-.1,0),vec3(.17,.2,.08))-.01)+.5*pt.z;\n\n      if(d2<fuck.x){\n        fuck=vec4(d2,5,fract(grid.h.z*8.89),0);\n      }\n      \n      if(fuck.x<d){\n        return fuck;\n      }\n      \n    }else if(grid.h.y<1.){//meter\n      float hole=sdbox(p.xy,vec2(.9,.3)+.02);\n      d=max(d,-hole);\n\n      float d2=sdbox(p,vec3(.9,.3,.1));\n\n      if(d2<d){\n        float l=step(abs(p.x),.8)*step(abs(p.y),.2);\n        return vec4(d2,l,0,0);\n      }\n    }\n  }else{//1x1\n    if(grid.h.y<.5){//knob\n      float hole=length(p.xy)-.25;\n      d=max(d,-hole);\n      \n      float ani=smoothstep(-.5,.5,sin(2.*iTime+grid.h.z*100.));\n      pt.xy*=r2d(PI/6.*5.*mix(-1.,1.,ani));\n      \n      float d2=length(pt.xy)-.23+.05*pt.z;\n      d2=max(d2,abs(pt.z)-.4);\n      \n      if(d2<d){\n        float l=smoothstep(.01,.0,abs(pt.x)-.015);\n        l*=smoothstep(.01,.0,-pt.y+.05);\n        return vec4(d2,0,l,0);\n      }\n      \n      pt=p;\n      float a=clamp(lofir(atan(-pt.x,pt.y),PI/6.),-PI/6.*5.,PI/6.*5.);\n      pt.xy*=r2d(a);\n      pcol*=smoothstep(.0,.01,sdbox(pt.xy-vec2(0,.34),vec2(.0,.02))-.005);\n\n      pt=p;\n      a=clamp(lofir(atan(-pt.x,pt.y),PI/6.*5.),-PI/6.*5.,PI/6.*5.);\n      pt.xy*=r2d(a);\n      pcol*=smoothstep(.0,.01,sdbox(pt.xy-vec2(0,.34),vec2(.0,.03))-.01);\n    }else if(grid.h.y<.8){//jack\n      float hole=length(p.xy)-.1;\n      d=max(d,-hole);\n      \n      float d2=length(p.xy)-.15;\n      d2=max(d2,abs(p.z)-.12);\n      \n      pt.xy*=r2d(100.*grid.h.z);\n      float d3=abs(pt.y)-.2;\n      pt.xy*=r2d(PI/3.*2.);\n      d3=max(d3,abs(pt.y)-.2);\n      pt.xy*=r2d(PI/3.*2.);\n      d3=max(d3,abs(pt.y)-.2);\n      d3=max(d3,abs(p.z)-.03);\n\n      d2=min(d2,d3);\n      d2=max(d2,-hole);\n      \n      if(d2<d){\n        return vec4(d2,3,0,0);\n      }\n    }else if(grid.h.y<.99){//button\n      pt.y+=.08;\n      \n      float hole=sdbox(pt.xy,vec2(.22))-.05;\n      d=max(d,-hole);\n      \n      float ani=sin(2.*iTime+grid.h.z*100.);\n      float push=smoothstep(.3,.0,abs(ani));\n      ani=smoothstep(-.1,.1,ani);\n      pt.z+=.06*push;\n\n      float d2=sdbox(pt,vec3(.2,.2,.05))-.05;\n\n      if(d2<d){\n        return vec4(d2,0,0,0);\n      }\n      \n      float d3=length(p-vec3(0,.3,0))-.05;\n      \n      if(d3<d){\n        float led=ani;\n        return vec4(d3,2,led,0);\n      }\n    }else if(grid.h.y<1.){//0b5vr\n      pt=abs(pt);\n      pt.xy=pt.x<pt.y?pt.yx:pt.xy;\n      pcol*=smoothstep(.0,.01,sdbox(pt.xy,vec2(.05)));\n      pcol*=smoothstep(.0,.01,sdbox(pt.xy-vec2(.2,0),vec2(.05,.15)));\n      pcol=1.-pcol;\n    }\n  }\n  \n  return vec4(d,0,pcol,0);\n}\n\nvec3 nmap(vec3 p,Grid grid,float dd){\n  vec2 d=vec2(0,dd);\n  return normalize(vec3(\n    map(p+d.yxx,grid).x-map(p-d.yxx,grid).x,\n    map(p+d.xyx,grid).x-map(p-d.xyx,grid).x,\n    map(p+d.xxy,grid).x-map(p-d.xxy,grid).x\n  ));\n}\n\nstruct March{\n  vec4 isect;\n  vec3 rp;\n  float rl;\n  Grid grid;\n};\n\nMarch domarch(vec3 ro,vec3 rd,int iter){\n  float rl=1E-2;\n  vec3 rp=ro+rd*rl;\n  vec4 isect;\n  Grid grid;\n  float gridlen=rl;\n  \n  for(int i=0;i<iter;i++){\n    if(gridlen<=rl){\n      grid=dogrid(rp,rd);\n      gridlen+=grid.d;\n    }\n    \n    isect=map(rp,grid);\n    rl=min(rl+isect.x*.8,gridlen);\n    rp=ro+rd*rl;\n    \n    if(abs(isect.x)<1E-4){break;}\n    if(rl>50.){break;}\n  }\n  \n  March r;\n  r.isect=isect;\n  r.rp=rp;\n  r.rl=rl;\n  r.grid=grid;\n  \n  return r;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n  vec2 uv = vec2(fragCoord.x / iResolution.x, fragCoord.y / iResolution.y);\n  vec2 p=uv*2.-1.;\n  p.x*=iResolution.x/iResolution.y;\n\n  vec3 col=vec3(0);\n\n  float canim=smoothstep(-.2,.2,sin(iTime));\n  vec3 co=mix(vec3(-6,-8,-40),vec3(0,-2,-40),canim);\n  vec3 ct=vec3(0,0,-50);\n  float cr=mix(.5,.0,canim);\n  co.xy+=iTime;\n  ct.xy+=iTime;\n  mat3 cb=orthbas(co-ct);\n  vec3 ro=co+cb*vec3(4.*p*r2d(cr),0);\n  vec3 rd=cb*normalize(vec3(0,0,-2));\n  \n  March march=domarch(ro,rd,100);\n  \n  if(march.isect.x<1E-2){\n    vec3 basecol=vec3(.5);\n    vec3 speccol=vec3(.2);\n    float specpow=30.;\n    float ndelta=1E-4;\n    \n    float mtl=march.isect.y;\n    float mtlp=march.isect.z;\n    if(mtl==0.){\n      mtlp=mix(mtlp,1.-mtlp,step(fract(march.grid.h.z*66.),.1));\n      vec3 c=.9+.0*sin(.1*(march.grid.c.x+march.grid.c.y)+march.grid.h.z+vec3(0,2,3));\n      basecol=mix(vec3(.04),c,mtlp);\n    }else if(mtl==1.){\n      basecol=vec3(0);\n      speccol=vec3(.5);\n      specpow=60.;\n      \n      vec2 size=vec2(.05,.2);\n      vec2 pp=(march.rp-march.grid.c).xy;\n      vec2 c=lofi(pp.xy,size)+size/2.;\n      vec2 cc=pp-c;\n      vec3 led=vec3(1);\n      led*=exp(-60.*sdbox(cc,vec2(0.,.08)));\n      led*=c.x>.5?vec3(5,1,2):vec3(1,5,2);\n      float lv=texture(iChannel0,vec2(march.grid.h.z,0)).x*1.;\n      col+=led*step(c.x,-.8+1.6*lv);\n      basecol=.04*led;\n    }else if(mtl==2.){//led\n      basecol=vec3(0);\n      speccol=vec3(1.);\n      specpow=100.;\n      \n      col+=mtlp*vec3(2,.5,.5);\n    }else if(mtl==3.){//metal\n      basecol=vec3(.2);\n      speccol=vec3(1.8);\n      specpow=100.;\n      ndelta=3E-2;\n    }else if(mtl==4.){//kaoss\n      basecol=vec3(0);\n      speccol=vec3(.5);\n      specpow=60.;\n      \n      vec2 size=vec2(.1);\n      vec2 pp=(march.rp-march.grid.c).xy;\n      vec2 c=lofi(pp.xy,size)+size/2.;\n      vec2 cc=pp-c;\n      vec3 led=vec3(1);\n      led*=exp(-60.*sdbox(cc,vec2(0.,.0)));\n      led*=vec3(2,1,2);\n      float plasma=sin(length(c)*10.-10.*iTime+march.grid.h.z*.7);\n      plasma+=sin(c.y*10.-7.*iTime);\n      led*=.5+.5*sin(plasma);\n      col+=2.*led;\n      basecol=.04*led;\n    }else if(mtl==5.){//808\n      basecol=vec3(.9,mtlp,.02);\n    }\n    \n    vec3 n=nmap(march.rp,march.grid,ndelta);\n    vec3 v=-rd;\n    \n    {\n      vec3 l=normalize(vec3(1,3,5));\n      vec3 h=normalize(l+v);\n      float dotnl=max(0.,dot(n,l));\n      float dotnh=max(0.,dot(n,h));\n      float shadow=step(1E-1,domarch(march.rp,l,30).isect.x);\n      vec3 diff=basecol/PI;\n      vec3 spec=speccol*pow(dotnh,specpow);\n      col+=vec3(.5,.6,.7)*shadow*dotnl*(diff+spec);\n    }\n    {\n      vec3 l=normalize(vec3(-1,-1,5));\n      vec3 h=normalize(l+v);\n      float dotnl=max(0.,dot(n,l));\n      float dotnh=max(0.,dot(n,h));\n      float shadow=step(1E-1,domarch(march.rp,l,30).isect.x);\n      vec3 diff=basecol/PI;\n      vec3 spec=speccol*pow(dotnh,specpow);\n      col+=shadow*dotnl*(diff+spec);\n    }\n  }\n  \n  col=pow(col,vec3(.4545));\n  col=smoothstep(vec3(0,-.1,-.2),vec3(1,1.1,1.2),col);\n  fragColor = vec4(col,0);\n}\n","name":"Image","description":"","type":"image"}]}