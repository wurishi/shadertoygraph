{"ver":"0.1","info":{"id":"Dd2yWd","date":"1688345504","viewed":385,"name":"Fiesta","username":"Kali","description":"Livecoded at a party with friends","likes":51,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","livecoding"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//originally coded in poshbrolly.net\n#define _t (iTime+14.)\n#define _res iResolution.xy\n\nconst float PI=3.14159265359;\nfloat maxdist=50.;\nfloat det=.001;\nfloat t;\nvec3 objcol;\n\nmat2 rot(float a){\n    float s=sin(a),c=cos(a);\n    return mat2(c,s,-s,c);\n}\n\nfloat sabs(float x, float s) {\n    return sqrt(x*x+s);\n}\n\nfloat fractal(vec3 p) {\n    p*=.1;\n    float m=100.;\n    for (int i=0; i<6; i++) {\n        p=abs(p)/clamp(abs(p.x*p.y),.3, 2.)-1.;\n        m=min(m,abs(p.x));\n    }\n    m=exp(-3.*m);\n    return m;\n}\n\nfloat de(vec3 p){\n    p.xz*=rot(smoothstep(-.5,.5,sin(t))*PI);\n    float f=fractal(p);\n    objcol=vec3(0.4,0,1)*f;\n    objcol.rb*=rot(f*3.+t);\n    objcol+=.4;\n    float l=length(p)-3.;\n    p.x=sabs(p.x,2.)-smoothstep(-.5,.5,sin(t*2.))*5.;\n    p.y=sabs(p.y,2.)-smoothstep(-.5,.5,cos(t*2.))*4.;\n    p.z=sabs(p.z,2.)-smoothstep(-.5,.5,cos(t*2.))*4.;\n    float d= length(p)-2.5;\n    d=min(d,l);\n    return d*.5-f*.5;\n}\n\nvec3 normal(vec3 p) {\n    vec2 e=vec2(0,det);\n    return normalize(vec3(de(p+e.yxx),de(p+e.xyx),de(p+e.xxy))-de(p));\n}\n\n\nvec3 march(vec3 from, vec3 dir){\n    vec3 p=from, col=vec3(0), g=col;\n    float d, td=0.;\n    for (int i=0;i<100;i++){\n        p+=dir*d;\n        d=de(p);\n        if (d<det||td>maxdist) break;\n        td+=d;\n        g+=.1/(.1+d*.5)*objcol;\n    }\n    vec3 n=normal(p);\n    if (d<det) {\n        col=objcol*n.z*n.z;\n    }\n    return col+g*.12;\n}\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n    t=_t*2.;\n    vec2 uv=(fragCoord/_res-0.5)/vec2(_res.y/_res.x,1);  //2d uvs\n    float h=asin(sin(t*.1))*5.;\n    vec2 id=floor(uv*h);\n    if (sin(t*.1)>.3) uv=fract(uv*h)-.5;\n    t+=(id.x*3.+id.y*2.)*.1;\n    vec3 from=vec3(0,0,min(-20.,sin(t*1.5)*15.));\n    vec3 dir=normalize(vec3(uv,1.));\n    vec3 col=march(from,dir);\n    fragColor=vec4(col,1);\n}","name":"Image","description":"","type":"image"}]}