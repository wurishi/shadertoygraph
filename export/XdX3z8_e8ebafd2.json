{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"music","id":"4df3Rn","filepath":"/media/a/3c33c415862bb7964d256f4749408247da6596f2167dca2c86cc38f83c244aa6.mp3","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}}],"code":"float pi = 3.241;\r\n\r\nfloat sphere( in vec3 p, float s )\r\n{\r\n  return length(p)-s;\r\n}\r\n\r\nfloat box( vec3 p, vec3 b )\r\n{\r\n  vec3 d = abs(p) - b;\r\n  return min(max(d.x,max(d.y,d.z)),0.0) +\r\n         length(max(d,0.0));\r\n}\r\n\r\nvec3 twist(in vec3 p, float a, float b) {\r\n\tfloat c = cos(a*p.y);\r\n    float s = sin(b*p.y);\r\n    mat2  m2 = mat2(c,-s,s,c);\r\n    return vec3(m2*p.xz,p.y);\r\n}\r\n\r\nvec3 repeat(in vec3 p, in float c) {\r\n\tvec3 vc = vec3(c);\r\n\treturn mod(p,vc)-.5*vc;\r\n}\r\n\r\nfloat scene( in vec3 p, float m ) {\r\n\t\r\n\t// twist modifier\r\n\tfloat t1 = texture( iChannel0, vec2(.25,0.25) ).x * 4.;\r\n\t\r\n\t// twist parameters\r\n\tfloat tpa = -pi+.8*sin(t1)*pi;\r\n\tfloat tpb = -pi+.4*cos(t1)*pi;\r\n\tfloat a = box( twist(p,tpa,tpb), vec3(.15,.15,1.3) );\r\n\tfloat b = sphere(p, 0.3);\r\n\treturn mix(a,b,clamp(t1/8.,0.,1.));\r\n}\r\n\r\nvec3 sceneNormal( in vec3 pos )\r\n{\r\n    float eps = 0.001;\r\n    vec3 n;\r\n\tfloat d = scene(pos, 0.0);\r\n    n.x = scene( vec3(pos.x+eps, pos.y, pos.z), 0.0 ) - d;\r\n    n.y = scene( vec3(pos.x, pos.y+eps, pos.z), 0.0 ) - d;\r\n    n.z = scene( vec3(pos.x, pos.y, pos.z+eps), 0.0 ) - d;\r\n    return normalize(n);\r\n}\r\n\r\n\r\nvec3 march(in vec3 ro, in vec3 rd, out bool hit)\r\n{\r\n\tfloat s = 0.1;\r\n\tfor (int i = 0; i < 32; ++i) \r\n\t{\r\n\t\tif (s < 0.1) {\r\n\t\t\thit = true;\r\n\t\t}\r\n\t\ts = scene(ro, 0.0);\r\n\t\tro+=rd*s;\r\n\t\t\r\n\t}\r\n\r\n\treturn ro;\r\n} \r\n\r\n\r\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\r\n{\r\n\t// compute pixel, with origin at the screen center\r\n\tvec2 uv = -1.0 + 2.0 * fragCoord.xy / iResolution.xy;\r\n\r\n\t// compute ray origin and direction\r\n    float asp = iResolution.x / iResolution.y;\r\n    vec3 rd = normalize(vec3(asp*uv.x, uv.y, -2.0));\r\n    vec3 ro = vec3(0, 0, 4);\r\n\tvec3 ls = normalize(vec3(1,0,1));\t// light source\r\n\tvec3 eye = normalize(vec3(.5, .5, 1)); // eye\r\n\r\n\tbool hit = false;\r\n\tvec3 p = march(ro, rd, hit);\r\n\tif (hit) {\r\n\t\t// lighting\r\n\t\tvec3 n = sceneNormal(p);\r\n\t\tfloat diffuse = dot(n, ls) * .5;\r\n\t\tfloat spec = pow(dot(n, eye),200.0);\r\n\t\tfloat t = diffuse+spec;\r\n\t\tfloat c = clamp(texture( iChannel0, vec2(.25, .25 )).x, 0., 1.)*5.;\r\n\t\tfragColor = vec4(t*.5*c,t*.8*c,t*.4,1.0);\r\n\t}\r\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XdX3z8","date":"1362569039","viewed":176,"name":"Weirdness","username":"al","description":"Experimenting with raymarching.","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""}}