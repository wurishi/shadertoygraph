{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define INF 7.0\n\nfloat marched = 0.0;\nconst float PI = 3.14159265359;\nconst float DEG_TO_RAD = PI / 180.0;\n// camera rotation : pitch, yaw\nmat3 rotationXY( vec2 angle ) {\n\tvec2 c = cos( angle );\n\tvec2 s = sin( angle );\n\t\n\treturn mat3(\n\t\tc.y      ,  0.0, -s.y,\n\t\ts.y * s.x,  c.x,  c.y * s.x,\n\t\ts.y * c.x, -s.x,  c.y * c.x\n\t);\n}\n\nfloat sdSphere( vec3 p, float size)\n{\n  return length(p)-1.2;\n}\n/*\nfloat sdBox( vec3 p, vec3 b )\n{\n  vec3 d = abs(p) - b;\n  return min(max(d.x,max(d.y,d.z)),0.0) +\n         length(max(d,0.0));\n}\n*/\nfloat sdBox( vec3 p, vec3 b )\n{\n vec3 moi;\n\tvec3 d ;\n  d.x = abs(p.x) - b.x;\n  d.y = abs(p.y) - b.y;\n  d.z = abs(p.z) - b.z;\n  moi.x = max(d.x,0.0);\n\tmoi.y = max(d.y,0.0);\n\tmoi.z = max(d.z,0.0);\n\treturn min(max(d.x,max(d.y,d.z)),0.0) +\n         sqrt(moi.x*moi.x+moi.y*moi.y+moi.z*moi.z);\n}\n\nfloat sdCross( in vec3 p )\n{\n  float da = sdBox(p.xyz,vec3(INF,1.0,1.0));\n  float db = sdBox(p.yzx,vec3(1.0,INF,1.0));\n  float dc = sdBox(p.zxy,vec3(1.0,1.0,INF));\n  return min(da,min(db,dc));\n}\n\n\n\n\t\nfloat map( vec3 p )\n{\n   vec3 pui;\n   pui.x = 1.0;\n   pui.y = 1.0;\n   pui.z = 1.0;\n   float d = sdBox(p,pui);\n   int m;\n   float s = 1.0;\n   for( int m=0; m<3; m++ )\n   {\n   \t  vec3 a;\n   \t  vec3 q;\n   \t  q.x = p.x*s;\n   \t  q.y = p.y*s;\n   \t  q.z = p.z*s;\n      a.x = mod( q.x, 1.0 )-1.0;\n      a.y = mod( q.y, 1.0 )-1.0;\n      a.z = mod( q.z, 1.0 )-1.0;\n      s *= 3.0;\n      vec3 r;\n      r.x = 3.0 - 6.0*abs(a.x);\n      r.y = 3.0 - 6.0*abs(a.y);\n      r.z = 3.0 - 6.0*abs(a.z);\n      \n      float c = sdCross(r)/s;\n      d = max(d,-c);\n   }\n\n   return d;\n}\nfloat rm(vec3 origin, vec3 ray, float min_distance, float max_distance) {\n\tint i;\n\tfloat distance_marched = min_distance;\n\tfor (int i=0; i<240; i++) {\n\t\tfloat indiX = ray.x*distance_marched;\n\t\tfloat indiY = ray.y*distance_marched;\n\t\tfloat indiZ = ray.z*distance_marched;\n\t\tvec3 moi;\n\t\tmoi.x = indiX + origin.x;\n\t\tmoi.y = indiY + origin.y;\n\t\tmoi.z = indiZ + origin.z;\n\t\tfloat step_distance = map(moi);\n\t\tif (abs(step_distance) < 0.0001) {\n\t\t\treturn distance_marched/(max_distance-min_distance);\n\t\t}\n\t\tdistance_marched += step_distance;\n\t\tmarched=distance_marched;\n\t\tif (distance_marched > max_distance) {\n\t\t\treturn -1.0;\n\t\t}\n\t}\n\treturn -1.0;\n}\n\tvec3 render(vec2 q) {\n\tvec3 dir;\n\tvec3 screen;\n\tvec3 ray;\n    vec2 moro = vec2 (iTime);\n\n\tdir.x = 0.0;\n\tdir.y = 0.0;\n\tdir.z = -2.8;\n\tmat3 rot = rotationXY(moro);\n\tscreen.x = q.x;\n\tscreen.y = q.y;\n\tscreen.z = -2.0;\n\tray.x = screen.x - dir.x;\n\tray.y = screen.y - dir.y;\n\tray.z = screen.z - dir.z;\n\t\n\tfloat s = rm(rot*dir, rot*ray, 1.0, 4.0);\n\t\n\tvec3 col;\n\t\n\tif (s == -1.0) {\n\t\t\t\tcol.x = 0.0;\n\t\t\t\tcol.y = 0.0;\n\t\t\t\tcol.z = 0.0;\n\n\t} else {\n\t\n      //  float f = 1.0-(it/float(MAX_RAY_STEPS));\n\n\t  \n\t\tcol = vec3(s-.8*.8+0.4*q.y *sin(q.x))*marched/1.76;\n\t\tcol.rg *= marched*.4;\n\t}\n\t\n\treturn col;\n\t\n\t}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 q = (2.0*fragCoord.xy - iResolution.xy)/iResolution.x;\n\t\n\tvec3 col = render(q);\n\tfragColor = vec4(col.xyz, 1.0);\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4ssGR2","date":"1374682071","viewed":286,"name":"mengerSponge","username":"rebb","description":"sponge bob","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""}}