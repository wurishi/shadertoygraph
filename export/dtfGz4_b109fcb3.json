{"ver":"0.1","info":{"id":"dtfGz4","date":"1671376294","viewed":98,"name":"terrain with lighting","username":"gcgac","description":"Terrain. I'm not too happy with how the snow, rock and grass positioning turned out but it's alright.","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","terrain","raycasting","lighting","snow","nature"],"hasliked":0,"parentid":"DdSSRd","parentname":"terrainish"},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// thanks to inigo quilez for making this site and for making the normal function\nvec3 normal;\n\nfloat yval(float x,float z){\n    return ((sin(x*8.0)+sin(z*7.0)+sin((x+0.3)*10.0))/10.0)+sin(x)+sin(z)+(sin((x+sin(z)/2.0)*6.5)+cos(z*3.2))/10.0;\n}\n\nfloat calc_sdf(vec3 ray){\n    return abs(yval(ray.x,ray.z)-ray.y);\n}\n\nvec3 calcNormal( in vec3 p ) // for function f(p)\n{\n    const float eps = 0.0001; // or some other value\n    const vec2 h = vec2(eps,0);\n    return normalize( vec3(calc_sdf(p+h.xyy) - calc_sdf(p-h.xyy),\n                           calc_sdf(p+h.yxy) - calc_sdf(p-h.yxy),\n                           calc_sdf(p+h.yyx) - calc_sdf(p-h.yyx) ) );\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n    vec2 uv = (fragCoord/iResolution.xy)-0.5*2.0;\n    vec3 ray = vec3(sin(iTime*1.3),2.0,iTime);\n    vec3 light = vec3(sin(iTime*1.3)+2.0,5.0,iTime+2.0);\n    int steps = 0;\n    float inter = 0.0;\n    while (inter == 0.0 && steps<1200){\n        ray += normalize(vec3(uv,1.0))/100.0;\n        if (calc_sdf(ray)<0.1){\n            inter = length(vec3(sin(iTime*1.3),2,iTime)-ray)*0.1;\n            normal = calcNormal(ray);\n        }\n        steps += 1;\n    }\n    if (inter == 0.0){\n        fragColor = vec4(0,0,0,1);\n    }else if (normal.y>=0.7 && ray.y>0.9){\n        fragColor = vec4((1.0-vec3(inter))*dot(normal,normalize(light-ray)),1.0);\n    }else if (normal.y>=ray.y*1.5){\n        fragColor = vec4(vec3(0,(1.0-inter)*dot(normal,normalize(light-ray)),0),1.0);\n    }else{\n        fragColor = vec4((1.0-vec3(inter))*dot(normal,normalize(light-ray))/2.0,1.0);\n    }\n}","name":"Image","description":"","type":"image"}]}