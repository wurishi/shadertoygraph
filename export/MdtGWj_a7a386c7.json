{"ver":"0.1","info":{"id":"MdtGWj","date":"1452265621","viewed":208,"name":"Wave city","username":"qleonetti","description":"Practicing","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["3d","raymarching","waves"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[],"code":"float sdBox( vec3 p, vec3 b )\n{\n  vec3 d = abs(p) - b;\n  return min(max(d.x,max(d.y,d.z)),0.0) +\n         length(max(d,0.0));\n}\n\nfloat opU( float d1, float d2 )\n{\n    return min(d1,d2);\n}\nvec3 opRep( vec3 p, vec3 c )\n{\n    return mod(p,c)-0.5*c;\n}\n\nvec2 distance_to_obj(in vec3 p) {\n    vec3 q = opRep(p,vec3(3.,p.y,3.));\n    //vec3 q = p;\n    return vec2(sdBox(q,vec3(1.,\n                             //abs(cos(iTime)) * \n                             (cos(sin(iTime/2.)*floor(p.z/3.))/2. + 0.5) * \n                             (sin(sin(iTime/2.)*floor(p.x/3.))/2. + 0.5) * 3.+.2,1.)\n    ));\n}\n\n// primitive color\nvec3 prim_c(in vec3 p) {\n    return vec3(sin(floor(sqrt((p.x)*(p.x)+(p.z)*(p.z)))*8.)+p.y/4.,\n                sin(floor(sqrt((p.x)*(p.x)+(p.z)*(p.z)))*8.)+p.y/4.,\n                p.y/2.\n                );\n    //return vec3(sin(p.x*p.y*p.z/10.),cos(p.x*p.y*p.z/5.),.5);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec3 cam_pos = vec3(cos(iTime/3.)*10.0,10.0,10.0);\n\t//vec3 cam_pos = vec3(10.);\n\tvec2 tx = fragCoord.xy / iResolution.xy;\n    vec2 vPos = -1.0 + 2.0 * tx;\n\n    //camera up vector\n    vec3 vuv = vec3(0,1,0);\n\n    //camera lookat\n    vec3 vrp=vec3(0,0,0);\n\n    vec3 prp = cam_pos;\n    vec3 vpn = normalize(vrp-prp);\n    vec3 u = normalize(cross(vuv,vpn));\n    vec3 v = cross(vpn,u);\n    vec3 vcv = (prp+vpn);\n    vec3 scrCoord = vcv+vPos.x*u*0.8+vPos.y*v*0.8;\n    vec3 scp=normalize(scrCoord-prp);\n\n    //Raymarching\n    const vec3 e=vec3(0.02,0,0);\n    const float maxd=100.0;\n    vec2 d=vec2(0.02,0.0);\n    vec3 c,p,N;\n\n    float f=1.0;\n    for(int i=0;i<256;i++) {\n        if ((abs(d.x)<.001) || (f > maxd)) break;\n\n        f+=d.x;\n        p=prp+scp*f;\n        d = distance_to_obj(p);\n    }\n    if (f<maxd) {\n        c=prim_c(p);\n        vec3 n = vec3(\n            d.x-distance_to_obj(p-e.xyy).x,\n            d.x-distance_to_obj(p-e.yxy).x,\n            d.x-distance_to_obj(p-e.yyx).x\n            );\n        N = normalize(n);\n        float b=dot(N,normalize(prp-p));\n        fragColor = vec4((b*c+pow(b,16.0))*(1.0-f*0.01), 1.0 );\n    } else {\n    fragColor=vec4(0,0,0,1);\n    }\n}","name":"","description":"","type":"image"}]}