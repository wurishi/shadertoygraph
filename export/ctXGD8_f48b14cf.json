{"ver":"0.1","info":{"id":"ctXGD8","date":"1671655995","viewed":356,"name":"Stochastic bokeh blur (not good)","username":"fishy","description":"Meh","likes":20,"published":3,"flags":0,"usePreview":0,"tags":["sketch"],"hasliked":0,"parentid":"Dlf3W8","parentname":"Sketchy sphere"},"renderpass":[{"inputs":[{"id":"XdfGRn","filepath":"/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","previewfilepath":"/media/ap/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","type":"texture","channel":1,"sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define HPI 1.57079632679\n#define PI 3.14159265359\n#define TAU 6.28318530718\n\nvec2 hash22(vec2 p)\n{\n    vec3 p3 = fract(vec3(p.xyx) * vec3(.1031, .1030, .0973));\n    p3 += dot(p3, p3.yzx+33.33);\n    return fract((p3.xx+p3.yz)*p3.zy);\n}\n\nvec4 stochasticBokehBlur(sampler2D tex, vec2 p, float radius, float ratio, float gamma, float samples)\n{\n    vec4 acc = vec4(0);\n    for(float i = 0.; i < samples; i++)\n    {\n        vec2 rnd = hash22((p+i)*25.)*vec2(TAU, 1);\n        rnd = vec2(cos(rnd.x)*ratio, sin(rnd.x))*sqrt(rnd.y)*radius;\n        acc += pow(texture(tex, p+rnd), vec4(gamma));\n    }\n    return pow(acc/samples, 1./vec4(gamma));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n\n    // Output to screen\n    fragColor = stochasticBokehBlur(iChannel1, uv, max(0., abs(uv.y-iMouse.y/iResolution.y)-0.1)*0.1, iResolution.y/iResolution.x, 4., 32.);\n}","name":"Image","description":"","type":"image"}]}