{"ver":"0.1","info":{"id":"ds23zD","date":"1667340557","viewed":399,"name":"水のような歪みのサンプル","username":"beffell","description":"マウスクリック・ドラッグで操作できます。\n物理的に正しい描写ではなく、なんちゃって実装です。\n参考にどうぞ。","likes":8,"published":1,"flags":0,"usePreview":1,"tags":["lens","water"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//ランダム\nfloat rand(float n){\n\treturn fract(sin(dot(vec2(n,n),vec2(12.9898,78.233))) * 43758.5453);\n}\n\n//乱気流\nvec2 turbulence(vec2 uv)\n{\n\tvec2 speed = vec2(1.0,-2.0);\n\tfloat frequency = 30.0;\n\tfloat random1 = 1.0;\n\tfloat random2 = 2.0;\n\n\tvec2 turb;\n\tturb.x = sin(uv.x);\n\tturb.y = cos(uv.y);\n\n\tfor(int i = 0; i < 2; i++)\n\t{\n\t\tfloat ifloat = 1.0 + float(i);\n\n\t\tfloat r1 = rand(ifloat + random1) * 2.0 - 1.0;\n\t\tfloat r2 = rand(ifloat + random2) * 2.0 - 1.0;\n\n\t\tvec2 turb2;\n\t\tturb2.x = sin(uv.x * (1.0 + r1 * frequency) + turb.y * ifloat + iTime * speed.x * r2);\n\t\tturb2.y = cos(uv.y * (1.0 + r1 * frequency) + turb.x * ifloat + iTime * speed.y * r2);\n\n\t\tturb.x = mix(turb.x, turb2.x, 0.5);\n\t\tturb.y = mix(turb.y, turb2.y, 0.5);\n\t}\n\n\treturn turb;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\t//画面の比率\n\tfloat ratio = iResolution.y / iResolution.x;\n\n\t//マウス位置（クリック・ドラッグ）\n\tvec2 pos = iMouse.z > 0.0 ? iMouse.xy / iResolution.xy : vec2(0.5, 0.5);\n\tpos.y *= ratio;\n\n\t//テクスチャ座標\n\tvec2 texCoord = fragCoord.xy / iResolution.xy;\n\ttexCoord.y *= ratio;\n\n\tvec4 color = texture(iChannel0, texCoord);\n\n\t//歪み\n\tfloat dist = distance(texCoord, pos);\n\tvec2 turb = (turbulence(texCoord) * 2.0 - 1.0) * 0.02;\n\tdist = dist + turb.x;\n\tfloat size = 0.2;\n    float shadowSize = 0.02;\n\tif(dist <= size)\n\t{\n\t\ttexCoord += (\n\t\t\t(texCoord - pos)\n\t\t\t* pow(dist / size * 0.2, 2.0)\n\t\t\t* (dist / 2.0 - dist) / size * 0.2\n\t\t\t* 120.0\n\t\t);\n\n\t\tcolor = texture(iChannel0, texCoord);\n\n\t\t//色収差\n\t\tfloat strength = pow(dist / size, 3.0);\n        vec4 aberrationColor;\n\t\taberrationColor.r += texture(iChannel0, texCoord).r * strength * 1.5;\n\t\taberrationColor.g += texture(iChannel0, texCoord + vec2(0.0,0.002)).g * strength * 1.5;\n\t\taberrationColor.b += texture(iChannel0, texCoord + vec2(0.0,0.004)).b * strength * 1.5;\n        aberrationColor.a = 1.0;\n        color = mix(color, aberrationColor, vec4(strength,strength,strength,strength));\n\t}else if(dist <= size + shadowSize){\n\t\t//影\n\t\tfloat shadow = (dist - size) * (1.0 / shadowSize) * 0.3 + 0.7;\n\t\tcolor.rgb *= shadow;\n\t}\n\n\tfragColor = color;\n}","name":"Image","description":"","type":"image"}]}