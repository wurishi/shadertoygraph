{"ver":"0.1","info":{"id":"NlsyDs","date":"1648928348","viewed":116,"name":"shadow butterfly","username":"jneen","description":"volumetric fog yay","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["jneen","shadowbutterfly"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float D=0.,G=0.;\nvec3 P,CAM,DIR,N;\nmat2 rot(float a){float s=sin(a),c=cos(a);return mat2(c,s,-s,c);}\nvec2 UV;\nfloat box(vec3 p, vec3 a) {\n  vec3 q = abs(p)-a;\n  return length(max(q, 0.)) + min(0., max(q.x,max(q.y,q.z)));\n}\n\nfloat W(vec3 p) {\n  p.xy *= rot(radians(180.)+.3*sin(iTime));\n  \n  float flap = .6*(.5+.5*sin(10.*iTime));\n  \n  float central = length(p-vec3(0.,-.2,flap))-1.;\n\n  p.x = abs(p.x) - .9;\n  p.xz *= rot(.5+.5*sin(3.*iTime));\n\n  float cyl = length(p.xy)-.2;\n  float cyll = length(p.yz)-.8;\n  p.xy *= rot(iTime);\n  p.xz *= rot(.2*iTime+0.*length(UV));\n  \n  float b = box(p,vec3(1.));\n  float s=length(p)-1.1;\n  float ss=length(p)-.8;\n  float sss=length(p)-.7;\n  \n  float dist=max(b,-s);\n  dist=min(dist,ss);\n  dist=max(dist,-sss);\n  //dist=max(dist,-cyl);\n  dist=max(dist,cyll);\n  dist = mix(central, dist, .8);\n  \n  if(dist<0.)G+=-dist;//-min(0., b);\n  return abs(dist)+.01;\n}\n\nvoid ray(){for(;;){float c=W(P);P+=DIR*c*.5;D+=c;if(c<.001||D>100.){return;}}}\nvoid norm(){mat3 k = mat3(P,P,P)-mat3(.0001);N=normalize(W(P)-vec3(W(k[0]),W(k[1]),W(k[2])));}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n    uv -= .5;\n    uv.y *= iResolution.y/iResolution.x;\n    UV=uv;\n    P=vec3(0,0,5);\n    DIR=normalize(vec3(uv, -1.));\n    ray();\n    \n    \n    \n    \n    \n    // Time varying pixel color\n    vec3 col = vec3(0);\n    \n    if (D<100.) {\n        norm();\n\n        float diff = length(sin(N)*.5+.5)/sqrt(3.);\n\n        col=vec3(diff*diff)*N;\n    }\n    \n    col += pow(G, 2.2)*.2;\n    \n    // Output to screen\n    fragColor = vec4(sqrt(col),1.0);\n}","name":"Image","description":"","type":"image"}]}