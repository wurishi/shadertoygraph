{"ver":"0.1","info":{"id":"XsBBzW","date":"1499633746","viewed":444,"name":"MRF Texture synthesis","username":"rory618","description":"https://courses.cs.washington.edu/courses/csep576/05wi/lectures/texture.pdf\n\nMake sure to set the input texture in both buffer a and b\n\nPress R and use the mouse to draw\n\nChange size in buf b for more lag but larger local consistency and better letters.","likes":14,"published":1,"flags":48,"usePreview":0,"tags":["texture","random","field","markov"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = (floor(fragCoord.xy)+.5) / iResolution.xy;\n    fragColor = texture(iChannel0, uv).xxxx;\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"\nconst float KEY_R     = 82.5/256.0;\n\nvec4 hash44(vec4 p4){\n    p4 = fract(sin(p4)  * vec4(443.897, 441.423, 437.195, 444.129)/8.);\n    p4 += dot(p4, p4.wzxy+19.19);    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\nfloat isKeyPressed(float key)\n{\n\treturn texture( iChannel3, vec2(key, 0.5) ).x;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    \n    if(iFrame <5){\n        fragColor = hash44(hash44(iDate)+hash44(uv.xyxy));\n    } else {\n        fragColor = texture(iChannel0, uv);\n    \n        vec2 closest = (textureLod(iChannel1, uv,-100.).xy+.5)/iChannelResolution[2].xy;\n        float e = textureLod(iChannel1, uv,-100.).z;\n\n        float r = .03;\n\n        fragColor = (1.-r)*fragColor + r*textureLod(iChannel2,closest,-100.);\n    }\n    if(iMouse.z>0. && length(fragCoord.xy-iMouse.xy) < 20.)\n        fragColor = hash44(hash44(iDate)+hash44(uv.xyxy));\n    if(isKeyPressed(KEY_R)>.5){\n        fragColor = vec4(0);\n    }\n    \n}","name":"Buf A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"\nconst float KEY_R     = 82.5/256.0;\nconst int size = 5;\n\nvec4 hash44(vec4 p4){\n    p4 = fract(sin(p4)  * vec4(443.897, 441.423, 437.195, 444.129)/8.);\n    p4 += dot(p4, p4.wzxy+19.19);    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\nfloat isKeyPressed(float key)\n{\n\treturn texture( iChannel3, vec2(key, 0.5) ).x;\n}\n\n\nfloat error(vec2 p, vec2 uv){\n    float e = 0.;\n    for(int dx = -size; dx <= size; dx++){\n        for(int dy = -size; dy <= size; dy++){\n            vec2 d = vec2(dx,dy);\n            vec4 a = texture(iChannel0,uv+d/iChannelResolution[0].xy);\n            vec4 b = textureLod(iChannel2,(p+.5+d)/iChannelResolution[2].xy,-100.);\n            e += length(a-b);\n            \n        }\n    }\n    return e;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec2 px = vec2(1) / iResolution.xy;\n    \n    if(iFrame <5){\n        fragColor = floor(iChannelResolution[2].xyzz*hash44(hash44(iDate)+hash44(uv.xyxy)));\n        fragColor.z = 1000.;\n    } else {\n        fragColor = texture(iChannel1, uv);\n    \n        vec2 p = fragColor.xy;\n        float e = fragColor.z;\n        vec2 np;\n        float ne;\n        //for (int i = 0; i < 4; i++){\n            np = floor(iChannelResolution[2].xy*hash44(hash44(iDate)+hash44(uv.xyxy)).xy);\n            ne = error(np,uv);\n            if(ne<e){\n               e = ne;\n               p = np;\n            }\n        //}\n\n        vec4 u = texture(iChannel1, uv+px*vec2(0,1));\n        vec4 d = texture(iChannel1, uv+px*vec2(0,-1));\n        vec4 l = texture(iChannel1, uv+px*vec2(-1,0));\n        vec4 r = texture(iChannel1, uv+px*vec2(1,0));\n        np = u.xy-vec2(0,1);\n        ne = error(np,uv);\n        if(ne<e){\n            e = ne;\n            p = np;\n        }\n        np = d.xy-vec2(0,-1);\n        ne = error(np,uv);\n        if(ne<e){\n            e = ne;\n            p = np;\n        }\n        np = l.xy-vec2(-1,0);\n        ne = error(np,uv);\n        if(ne<e){\n            e = ne;\n            p = np;\n        }\n        np = r.xy-vec2(1,0);\n        ne = error(np,uv);\n        if(ne<e){\n            e = ne;\n            p = np;\n        }\n\n\n        fragColor.xy = p;\n        fragColor.z = e;\n    }\n    if(iMouse.z>0. && length(fragCoord.xy-iMouse.xy) < 20.){\n        fragColor = hash44(hash44(iDate)+hash44(uv.xyxy));\n        fragColor.z = 1000.;\n    }\n    if(isKeyPressed(KEY_R)>.5){\n        fragColor = vec4(0);\n    }\n}","name":"Buf B","description":"","type":"buffer"}]}