{"ver":"0.1","info":{"id":"ll2GDh","date":"1428681166","viewed":322,"name":"cubemap germangb","username":"germangb","description":"testing the cubemap thing\n\n-ugly white pixels","likes":13,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","cubemap"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sX3zn","filepath":"/media/a/0681c014f6c88c356cf9c0394ffe015acc94ec1474924855f45d22c3e70b5785.png","previewfilepath":"/media/ap/0681c014f6c88c356cf9c0394ffe015acc94ec1474924855f45d22c3e70b5785.png","type":"cubemap","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"float field (vec3 pos, vec3 rawPos) {\n    float b = texture( iChannel1, vec2(20./256.,0.25) ).x;\n    return length(pos) - (0.8);\n}\n\nvec3 normal (vec3 p) {\n    vec2 eps = vec2(0.001, 0.0);\n    return normalize(vec3(\n    \tfield(p + eps.xyy, p) - field(p - eps.xyy, p),\n        field(p + eps.yxy, p) - field(p - eps.yxy, p),\n        field(p + eps.yyx, p) - field(p - eps.yyx, p)\n    ));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    uv = uv*2.0-1.0;\n    uv.x *= iResolution.x/iResolution.y;\n    \n    fragColor = vec4(1.0);\n    \n    vec3 ro = vec3(uv, -2);\n    vec3 rd = normalize(vec3(uv*0.25, 1.0));\n    \n    float h = 0.0;\n    float last = 9999.0;\n    for (int i = 0; i < 100; ++i) {\n     \tvec3 pos = ro+h*rd;\n        float fog = exp(-length(pos) * 0.05);\n        float fog2 = exp(-length(pos) * 0.005);\n\n        float time = iTime*0.125;\n        pos.xz *= mat2(sin(time),cos(time),cos(time),-sin(time));\n        pos.xy *= -mat2(sin(time),cos(time),cos(time),-sin(time));\n        \n       \tpos.x += iTime * 4.0;\n\n\t\t//pos.z += iTime*4.0;\n        vec3 rawPos = pos;\n    \tpos = mod(pos+3.0, 6.0)-3.0;\n        \n        float hit = field(pos, rawPos);\n        h += max(0.0025, hit);\n        if (h > 200.0) break;\n                \n        if (hit < 1.0) {\n            if (hit < 0.1)\n                last = hit;  \n            else {\n                if (last < 0.1) {\n                    fragColor = vec4(0.0);\n                    fragColor = mix(vec4(1.0), fragColor, fog2);\n                    break;\n                } else last = 9999.0;\n            }\n        }\n        \n        if (hit < 0.1) {\n            vec3 n = normal(pos);\n            float diff = clamp(dot(n, normalize(vec3(1,1,-1))), 0.0, 1.0);\n            float sky = clamp(dot(n, normalize(vec3(-1,1,0))), 0.0, 1.0);\n            vec4 cubemap = pow(texture(iChannel0, n), vec4(2.0));\n            diff = mix(0.025, 1.0, diff);\n            sky = mix(0.025, 1.0, sky);\n        \tfragColor = vec4(vec3(1.0,0.9,0.5)*diff + vec3(0.3, 0.5, 0.75)*0.5*sky + cubemap.rgb * 0.5 * diff, 1.0);\n        \t\n            fragColor = mix(vec4(1.0), fragColor, fog);\n            \n        }\n    }\n    \n    vec2 uv2 = fragCoord.xy / iResolution.xy;\n    uv2 = uv2 * 2.0 - 1.0;\n    fragColor *= smoothstep(1.65, 1.65 - 0.75, length(uv2));\n    \n    fragColor = pow(sqrt(fragColor), vec4(0.45));\n}","name":"Image","description":"","type":"image"}]}