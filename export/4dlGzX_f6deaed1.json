{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"/*\n\nSimply click somewhere outside the object and drag your mouse\ntowards (what should be) the nearest surface. The indicator\nwill tell you how correct the distance field is by marching a\nray from your original click position to the new position.\n\nThe green circles are the raymarching steps.\n\nThe bar at the bottom displays the number of raymarching steps taken.\n\nField colors:\nWhite: Positive distance\nGreen: Negative distance\nPink: Zero distance (surface)\n\nDot colors:\nBlue: Ray origin\nRed: Ray target\nWhite: Intersection\n\nIndicator colors:\nGreen: Distance is accurate.\nYellow: Distance is too small (this is okay, just means multiple steps are needed).\nRed: Distance is too big (this is bad).\nBlue: No object was hit.\n\nKnown issues:\nIt sometimes steps over objects and without turning the indicator\nred if the field is very inaccurate\n\n*/\n\nconst float ACCURATE_DIST = 0.01;\nconst int NUM_MARCH_ITER = 50;\n\n// Put a distance function you want to test in here\nfloat map(vec2 p)\n{\n\tvec2 d = abs(p) - 0.5;\n\t\n\treturn max(d.x, d.y); // Imperfect field\n\t//return length(max(d, 0.0)); // Perfect unsigned field\n\t//return length(p) - 0.5; // Perfect signed field\n\t//return abs(length(p) - 0.75)*1.1 - 0.3; // Bad field because of scaling\n\t//eturn length(mod(p, 0.5) - 0.25) - 0.1; // Perfect signed field\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tfloat aspect = iResolution.x / iResolution.y;\n\tvec2 indicator = vec2(aspect - 0.3, 0.7);\n\tvec2 uv = -1.0 + 2.0 * fragCoord.xy / iResolution.xy;\n\tuv.x *= aspect;\n\tvec4 m = -1.0 + 2.0 * iMouse / iResolution.xyxy;\n\tm.xz *= aspect;\n\t\n\t// Background color\n\tfloat d = map(uv);\n\tvec4 color = vec4(1, 1, 1, 1) * max(d, 0.0) + \n\t\t\t\t vec4(0, 1, 0, 1) * max(-d, 0.0);\n\tif (abs(d) < 0.005)\n\t\tcolor = vec4(1, 0, 1, 1);\n\n\t// March a ray from the click pos to the current pos\n\tif (m.z > -aspect) { // If mouse down\n\t\t// Mouse dots\n\t\tif (distance(m.xy, uv) < 0.02)\n\t\t\tcolor = vec4(1, 0, 0, 1);\n\t\tif (distance(m.zw, uv) < 0.02)\n\t\t\tcolor = vec4(0, 0, 1, 1);\n\t\n\t\tvec2 p = m.zw;\n\t\tvec2 rd = normalize(m.xy - m.zw);\n\t\tfloat md = 1.0;\n\t\tint ls = int(sign(map(p)));\n\t\tfloat steps = 0.0;\n\t\tfor (int i = 0; i < NUM_MARCH_ITER; i++) {\n\t\t\tif (md < ACCURATE_DIST) continue;\n\t\t\tmd = map(p);\n\t\t\t// The sign flipped, field is too big\n\t\t\tif (int(sign(md)) != ls && abs(md) > ACCURATE_DIST) {\n\t\t\t\tm.zw = vec2(1000.0);\n\t\t\t\tmd = 0.0;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tls = int(sign(md));\n\t\t\tmd = abs(md);\n\t\n\t\t\t// Display marching steps\n\t\t\tfloat sd = distance(p, uv);\n\t\t\tif (sd < md && sd > md-0.01)\n\t\t\t\tcolor = vec4(0, 1, 0, 1);\n\n\t\t\tp += md * rd;\n\t\t\tsteps++;\n\t\t}\n\t\tfloat total = distance(p, m.zw);\n\t\tif (distance(p, uv) < 0.02)\n\t\t\tcolor = vec4(1);\n\t\n\t\t// Indicator\n\t\tif (distance(uv, indicator) < 0.1) {\n\t\t\tif (md < ACCURATE_DIST && \n\t\t\t\t\tdistance(p, m.zw) > 0.001) { // Fix for unsigned distance fields\n\t\t\t\tif (distance(abs(map(m.zw)), total) < ACCURATE_DIST)\n\t\t\t\t\tcolor = vec4(0, 1, 0, 1);\n\t\t\t\telse if (m.z > 999.0)\n\t\t\t\t\tcolor = vec4(1, 0, 0, 1);\n\t\t\t\telse if (abs(map(m.zw)) < total)\n\t\t\t\t\tcolor = vec4(1, 1, 0, 1);\n\t\t\t} else {\n\t\t\t\tcolor = vec4(0, 0, 1, 1);\n\t\t\t}\n\t\t} else if (distance(uv, indicator) < 0.15) {\n\t\t\tcolor = vec4(0);\n\t\t}\n\t\t\n\t\t// Num steps bar\n\t\tif (-uv.y > 0.95) {\n\t\t\tif (uv.x/aspect * 0.5 + 0.5 < steps/float(NUM_MARCH_ITER))\n\t\t\t\tcolor = vec4(1, 0, 0, 1);\n\t\t\telse\n\t\t\t\tcolor = vec4(1);\n\t\t}\n\t}\n\n\tfragColor = color;\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4dlGzX","date":"1375846520","viewed":1674,"name":"Distance field debugger","username":"gleurop","description":"A tool for debugging and designing distance fields. Read the comments at the top to figure out how to use it.","likes":30,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""}}