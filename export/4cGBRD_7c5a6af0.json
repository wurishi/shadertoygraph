{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[{"channel":1,"type":"texture","id":"4sXGRn","filepath":"/media/a/95b90082f799f48677b4f206d856ad572f1d178c676269eac6347631d4447258.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"}}],"code":"float dot2(in vec3 v){return dot(v,v);}\n\nfloat Box(vec3 p,vec3 s){\nvec3 d=abs(p)-s;\nreturn min(max(d.x,max(d.y,d.z)),0.)+length(max(d,0.));}\n\nfloat Ell(in vec3 p,in vec3 r){\nfloat k=length(p/r);\nreturn k*(k-1.)/length(p/r/r);}\n\nfloat Cyl(vec3 p,vec3 a,vec3 b,float r){\nvec3 pa=p-a,ba=b-a;\nfloat BA=dot(ba,ba),PB=dot(pa,ba),x=length(pa*BA-ba*PB)-r*BA,y=abs(PB-BA*.5)-BA*.7,\nx2=x*x,y2=y*y*BA,d=(max(x,y)<0.)?-min(x2,y2):(((x>0.)?x2:0.)+((y>0.)?y2:0.));\nreturn sign(d)*sqrt(abs(d))/BA;}\n\nvec2 M(vec2 d1,vec2 d2){return(d1.x<d2.x)?d1:d2;} \n\nvec2 map(in vec3 p){\nvec2 r=vec2(p.y,-1.5); \nr=M(r,vec2(Box(p-vec3(0.,1.35,0.),vec3(5.,.05,.5)),77.99));\nr=M(r,vec2(Ell(p-vec3(0.,1.2,0.),vec3(1.2,.8,2.)),3.)); \nr=M(r,vec2(Ell(p-vec3(.68,1.4,-.77),vec3(.35,.35,.55)),86.6)); \nr=M(r,vec2(Ell(p-vec3(.68,1.4,.77),vec3(.35,.35,.55)),86.6));\nr=M(r,vec2(Ell(p-vec3(-.68,1.4,-.77),vec3(.35,.35,.55)),86.6));\nr=M(r,vec2(Ell(p-vec3(-.68,1.4,.77),vec3(.35,.35,.55)),86.6));\nr=M(r,vec2(Cyl(p-vec3(0.,1.2,-2.7),vec3(0.,0.,1.),vec3(0.,0.,0.),.5),3.));\nr=M(r,vec2(Cyl(p-vec3(0.,1.2,1.7),vec3(0.,0.,1.),vec3(0.,0.,0.),.5),3.));\nr=M(r,vec2(Cyl(p-vec3(0.,1.4,0.),vec3(0.,1.,0.),vec3(0.,0.,0.),.07),3.));\nreturn r;}\n\nvec2 iBox(in vec3 co,in vec3 rd,in vec3 r){\nvec3 m=1./rd,k=1.2*abs(m)*r,z1=-m*co-k,z2=-m*co+k;\nreturn vec2(max(max(z1.x,z1.y),z1.z),min(min(z2.x,z2.y),z2.z));} \n\nvec2 rcast(in vec3 co,in vec3 rd){\nvec2 r=vec2(-6.,-6.),tb=iBox(co-vec3(0.,.5,-.5),rd,vec3(2.5,1.5,3.));\nfloat t=1.,tx=10.;  \nif(tb.x<tb.y&&tb.y>-3.5&&tb.x<tx){t=max(tb.x,t);tx=min(tb.y,tx);\nfor(int i=0;i<70&&t<tx;++i){vec2 h=map(co+rd*t);\nif(abs(h.x)<.001*t){r=vec2(t,h.y);break;}t+=h.x;}}return r;} \n\nvec3 calcNorm(in vec3 p){vec2 e=vec2(1.,-1.)*.6*.001;\nreturn normalize(e.xyy*map(p+e.xyy).x+e.yyx*map(p+e.yyx).x+e.yxy*map(p+e.yxy).x+e.xxx*map(p+e.xxx).x);}\n\nfloat calcSh(in vec3 ro, in vec3 rd, in float tx){\nfloat tp=(.7-ro.y)/rd.y,r=1.,tn=.01; \nif(tp>0.){tx=min(tx,tp);}\nfor(int i=min(iFrame,0);i<24;++i){\nfloat h=map(ro+rd*tn).x,s=clamp(8.*h/tn,.1,1.);\nr=min(r,s);tn+=clamp(h,.01,.2);\nif(r<.004||tn>tx){break;}}\nr=clamp(r,0.,1.);\nreturn r*r*r*2.;}\n  \nvec3 rend(in vec3 co,in vec3 rd,in vec3 rdx,in vec3 rdy){ \nvec2 r=rcast(co,rd);float t=r.x, m=r.y;\nif(m>-1.5){\nvec3 norm=(m<1.3)?vec3(0.,1.,0.):calcNorm(co+t*rd),col=.2+.1*sin(m*2.+vec3(0.,1.,2.)),\nlig=normalize(vec3(-.6,.35,-.82)),\nlin=col*1.5*clamp(dot(norm,lig),0.,1.)*calcSh(co+t*rd,lig,1.5)*vec3(1.8,1.1,1.1)+col*0.35*pow(clamp(1.0+dot(norm,rd),0.,1.),2.)*vec3(1.,1.,1.);\nreturn vec3(clamp(lin,0.,1.));}} \n\nmat3 set(in vec3 co,in vec3 cp,float cr){\nvec3 a=normalize(cp-co),b=normalize(cross(a,vec3(sin(cr),cos(cr),0.))),c=cross(b,a);\nreturn mat3(b,c,a);}\n\nvec3 text(sampler2D p,in vec3 d,in float s,in float b){\nvec3 x=texture(p,.5+s*d.yz/d.x, b).xyz,y=texture(p,.5+s*d.zx/d.y, b).xyz,z=texture(p,.5+s*d.xy/d.z, b).xyz,n=d*d;\nreturn(x*n.x+y*n.y+z*n.z)/(n.x+n.y+n.z);}\n\nvec2 H(vec2 n){n=vec2(dot(n,vec2(243.9,305.2)),dot(n,vec2(20.6,99.)));return fract(cos(n)*3.5);}\n\nvec2 C(in vec2 x){\nvec2 n=floor(x),f=fract(x);vec3 m=vec3(8.);\nfor(float i=-1.;i<2.;++i){\nfor(float j=-1.;j<2.;++j){\nvec2 g=vec2(i,j),o=H(n+g),r=g-f+o;\nfloat d=dot(r,r);\nif(d<m.x){m=vec3(d,o);}}}\nreturn vec2(sqrt(m.x),m.y+m.z);} \n\nvec3 B(in vec3 d){vec3 n=abs(d);n=n*n*n;\nvec2 r=(C(25.*d.yz*1.5)*n.x+C(25.*d.zx*1.5)*n.y+C(25.*d.xy*1.5)*n.z)/(n.x+n.y+n.z);\nreturn clamp(1.-(3.+r.y*3.)*r.x,.005,1.)*smoothstep(.7,.4,text(iChannel1,d,.95,.9).x)+text(iChannel1,d,.3,3.).zyx-vec3(.4,.4,.4);}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\nfloat t=64.+iTime*1.5;\nvec3 co=vec3(0.,1.3,0.)+vec3(4.*cos(.3*t),2.5,4.*sin(.3*t));\nmat3 ca=set(co,vec3(0.,-.3,0.),0.);\nvec3 rd=ca*normalize(vec3((2.1*fragCoord-iResolution.xy)/iResolution.y,1.5)),\nrdx=ca*normalize(vec3(iResolution.xy/iResolution.x,8.)),\nrdy=ca*normalize(vec3(iResolution.xy/iResolution.y,1.)),c;\nif(rend(co,rd,rdx,rdy)!=vec3(0.,0.,0.)){c=rend(co,rd,rdx,rdy);\nif(c.r>c.g&&c.r>c.b){\nc+=vec3(.1,.4*cos(t)+.1,.4*sin(t)+.1);}}else{c=B(rd)*.7;}\nfragColor=vec4(c,1.);}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4cGBRD","date":"1734028915","viewed":24,"name":"Space station technodemo!!","username":"paanamka","description":"Зажигательная дискотека в необычной локации","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["space","stars","spaceship"],"hasliked":0,"parentid":"","parentname":""}}