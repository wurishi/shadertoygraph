{"ver":"0.1","info":{"id":"fsSXRm","date":"1619843151","viewed":123,"name":"VolumeRaymarching Basic","username":"kithy","description":"Basic Volume Raymarching","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["cloud","volumetric"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"mat2 m(float a){\n\tfloat s=sin(a);\n\tfloat c=cos(a);\n\treturn mat2(c,s,-s,c);\n}\n\nfloat hash(float n){\n\treturn fract(sin(n)*43758.5453);\n}\n\nfloat noise(in vec3 x){\n\tvec3 p=floor(x);\n\tvec3 f=fract(x);\n\n\tf=f*f*(3.0-2.0*f);\n\n\tfloat n=p.x+p.y*57.0+113.0*p.z;\n\n\tfloat res=mix(mix(mix(hash(n+0.0),hash(n+1.0),f.x),\n\t\t\tmix(hash(n+57.0),hash(n+58.0),f.x),f.y),\n\t\t\tmix(mix(hash(n+113.0),hash(n+114.0),f.x),\n\t\t\tmix(hash(n+170.0),hash(n+171.0),f.x),f.y),f.z);\n\n\treturn res;\n}\n\nfloat fbm(vec3 p){\n\tfloat f;\n\tf=0.500000*noise(p);\n\tp.xy*=m(iTime)*2.02;\n\tf+=0.25000*noise(p);\n\tp.yz*=m(iTime)*2.03;\n\tf+=0.1250*noise(p);\n\treturn f;\n}\n\nfloat scene(vec3 p){\n\treturn 0.1-length(p)*0.05+fbm(p*0.3);\n}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\tvec2 uv=(2.0*fragCoord.xy-iResolution.xy)/iResolution.y;\n\n\tvec3 ro=vec3(0.0,0.0,-30.0);\n\tvec3 ta=vec3(0.0);\n\tvec3 ww=normalize(ta-ro);\n\tvec3 uu=normalize(cross(vec3(0.0,1.0,0.0),ww));\n\tvec3 vv=normalize(cross(ww,uu));\n\tvec3 dir=normalize(uv.x*uu+uv.y*vv+1.5*ww);\n\tvec4 color=vec4(0.0);\n\n\tconst int nbSample=64;\n\tconst int nbSampleLight=6;\n\n\tfloat zMax=40.0;\n\tfloat step=zMax/float(nbSample);\n\tfloat zMaxl=20.0;\n\tfloat stepl=zMaxl/float(nbSampleLight);\n\tvec3 p=ro;\n\tfloat t=1.0;\n\tfloat absorption=100.0;\n\tvec3 sun_direction=normalize(vec3(0.0,1.0,0.0));\n\n\tfor(int i=0;i<nbSample;i++)\n\t{\n\t\tfloat density=scene(p);\n\t\tif(density>0.0)\n\t\t{\n\t\t\tfloat tmp=density/float(nbSample);\n\t\t\tt*=1.0-tmp*absorption;\n\t\t\tif(t<=0.01)\n\t\t\t\tbreak;\n\n\t\t\t\tfloat tl=1.0;\n\t\t\t\tfor(int j=0;j<nbSampleLight;j++){\n\t\t\t\t\tfloat densityLight=scene(p+normalize(sun_direction)*float(j)*stepl);\n\t\t\t\t\tif(densityLight>0.0)\n\t\t\t\t\t\ttl*=1.0-densityLight*absorption/float(nbSample);\n\t\t\t\t\tif(tl<=0.01)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcolor+=vec4(0.1)*tmp+vec4(0.7,0.0,1.0,1.0)*80.0*tmp*t;\n\t\t\t}\n\t\t\tp+=dir*step;\n\t\t}\n\t\tfragColor=color;\n}","name":"Image","description":"","type":"image"}]}