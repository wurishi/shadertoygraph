{"ver":"0.1","info":{"id":"ldG3WR","date":"1453934804","viewed":477,"name":"liquid xtals","username":"stb","description":"mouse: draw; R: clear field","likes":34,"published":1,"flags":48,"usePreview":0,"tags":["2d","automata","cellular","ca"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":1,"sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"#define t2D(x, y) texture(iChannel0, fract(uv-vec2(x, y)/res)).r\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tvec2 res = iResolution.xy;\n    vec2 uv = fragCoord.xy / res;\n    \n    vec2 bump =\n        2.*vec2(\n            t2D(1., 0.)-t2D(-1., 0.),\n            t2D(0., 1.)-t2D(0., -1.)\n        );\n    \n    float env = 2. * texture(iChannel1, uv/5.-bump+vec2(0., .01*iTime)).r;\n    \n    fragColor =\n        vec4(\n            env * mix(vec3(.7, .8, 1.), vec3(.7, 1., .5), vec3(pow(t2D(0., 0.), .3))),\n            1.\n        );\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":3,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"const float brushRad = 1.; // in pixels\n\n#define t2D(x, y) texture(iChannel0, fract(uv-vec2(x, y)/res))\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    vec2 res = iResolution.xy;\n    vec2 uv = fragCoord.xy / res;\n    \n    vec4 buf[9];\n    buf[0] = t2D(0.,  0.);\n    buf[1] = t2D(1.,  0.);\n    buf[2] = t2D(-1., 0.);\n    buf[3] = t2D(0.,  1.);\n    buf[4] = t2D(0., -1.);\n    buf[5] = t2D(1.,  1.);\n    buf[6] = t2D(-1., 1.);\n    buf[7] = t2D(1., -1.);\n    buf[8] = t2D(-1.,-1.);\n\n    //vec4 blur = .2 * (buf[0]+buf[1]+buf[2]+buf[3]+buf[4]);\n    vec4 blur = .25*buf[0] + .125*(buf[1]+buf[2]+buf[3]+buf[4]) + .0625*(buf[5]+buf[6]+buf[7]+buf[8]);\n    \n    float R, G;\n    vec4 Max;\n    \n    Max = buf[0];\n    Max = max(Max, buf[1]);\n    Max = max(Max, buf[2]);\n    Max = max(Max, buf[3]);\n    Max = max(Max, buf[4]);\n    \n    R = Max.r - buf[0].g;\n    G = buf[0].r - .5 * (blur.g-R);\n    \n    // draw with mouse\n    if(iMouse.z>0.)\n        R += 1. * max(0., 1.-length((fragCoord.xy-iMouse.xy)/res.y)*res.y/brushRad);\n    \n    R = clamp(R, 0., 1.);\n    G = clamp(G, 0., 1.);\n    \n    // clear field\n    if(texture(iChannel3, vec2(82.5 / 256., 0.)).r>0.) \n        R = G = 0.;\n    \n    fragColor = vec4(R, G, 0., 0.);\n}","name":"Buf A","description":"","type":"buffer"}]}