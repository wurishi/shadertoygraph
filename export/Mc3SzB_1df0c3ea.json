{"ver":"0.1","info":{"id":"Mc3SzB","date":"1714063477","viewed":94,"name":"Yet another Nyan Cat","username":"genisarte","description":"Just playing with textures.","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["animation","rainbow","nyancat"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xsf3Rn","filepath":"/media/a/cbcbb5a6cfb55c36f8f021fbb0e3f69ac96339a39fa85cd96f2017a2192821b5.png","previewfilepath":"/media/ap/cbcbb5a6cfb55c36f8f021fbb0e3f69ac96339a39fa85cd96f2017a2192821b5.png","type":"texture","channel":0,"sampler":{"filter":"nearest","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGzn","filepath":"/media/a/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","previewfilepath":"/media/ap/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","type":"texture","channel":1,"sampler":{"filter":"nearest","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Set to 1 to move the cat using the mouse\n#define USE_MOUSE 0\n\n#define FRAMERATE 12.0\n\n#define CAT_SCALE 4.0\n#define CAT_H 0.2\n#define RAINBOW_LENGTH 1.5\n\n#define BG_COLOR vec3(0.0, 0.14, 0.3)\n\n// ======================================================================================\n\nstruct Transform\n{\n    vec2 pos;\n    float a;\n    float s;\n};\n\nvec4 drawCat(vec2 uv, Transform cat)\n{\n    uv -= cat.pos;\n    uv *= cat.s;\n    uv *= mat2(cos(cat.a), -sin(cat.a), sin(cat.a), cos(cat.a));\n    uv = clamp(vec2(0.5) + uv, 0.0, 1.0);\n    return texture(iChannel0, vec2((uv.x + mod(floor(iTime * FRAMERATE), 6.0)) * 40.0 / 256.0, uv.y));\n}\n\nvec4 drawRainbowFart(float axis, float cutoff)\n{\n    float bandWidth = 1.0 / 9.0;\n    float bands[8];\n    \n    for (int i = 1; i < 9; i++)\n        bands[i-1] = step(float(i) * bandWidth, axis);\n    \n    float shutterStart = step(RAINBOW_LENGTH * (1.0 - abs(0.5 - axis)), -cutoff);\n    float shutterEnd = step(0.0, cutoff);\n    \n    // ROYGBIV\n    const vec3 spectrum[7] = vec3[7](\n        vec3(0.578, 0.0, 0.824),\n        vec3(0.293, 0.0, 0.5  ),\n        vec3(0.0  , 0.0, 1.0  ),\n        vec3(0.0  , 1.0, 0.0  ),\n        vec3(1.0  , 1.0, 0.0  ),\n        vec3(1.0  , 0.5, 0.0  ),\n        vec3(1.0  , 0.0, 0.0  )\n    );\n    \n    vec3 color = vec3(0.0);\n    for (int i = 0; i < 7; i++)\n        color = mix(color, spectrum[i], bands[i]);\n    color = mix(color, vec3(0.0), bands[7]);\n    \n    color = mix(color, vec3(0.0), shutterStart);\n    color = mix(color, vec3(0.0), shutterEnd);\n    \n    return vec4(color, (bands[0] - bands[7]) * (1.0 - shutterEnd - shutterStart));\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    vec2 uv = (fragCoord - 0.5 * iResolution.xy) / iResolution.y;\n    \n    Transform cat;\n# if USE_MOUSE\n    cat.pos = (iMouse.xy - 0.5 * iResolution.xy) / iResolution.y;\n    cat.a = 0.0;\n    float rby = uv.y - cat.pos.y;\n    float wave = 0.0;\n# else\n    cat.pos = vec2(mod(0.3 * iTime, RAINBOW_LENGTH + 2.0) - 1.0, CAT_H * sin(iTime));\n    cat.a = sin(1.5 * cat.pos.y);\n    float rby = uv.y;\n    float wave = 2.4 * sin(iTime + 10.0 * CAT_H * (uv.x - cat.pos.x));\n# endif\n    cat.s = CAT_SCALE;\n    \n    vec4 catColor = drawCat(uv, cat);\n    \n    float turb = 0.3 * sin(FRAMERATE * iTime + 8.0 * CAT_SCALE * uv.x);\n    float h = wave + turb;\n    float pixel_size = CAT_SCALE * 32.0;\n    float axis = floor(rby * pixel_size) / pixel_size;\n    vec4 rainbowColor = drawRainbowFart(0.5 + 3.0 * CAT_SCALE * axis - h, uv.x - cat.pos.x);\n    \n    vec4 bg = texture(iChannel1, 0.4 * uv + 0.1 * vec2(iTime, cat.pos.y));\n    bg.a = step(0.005, bg.r);\n    \n    vec3 color = mix(vec3(1.0), BG_COLOR, bg.a);\n    color = mix(color, rainbowColor.rgb, rainbowColor.a);\n    color = mix(color, catColor.rgb, catColor.a);\n    \n    fragColor = vec4(color, 1.0);\n}","name":"Image","description":"","type":"image"}]}