{"ver":"0.1","info":{"id":"MlKfzd","date":"1543747923","viewed":362,"name":" Burn [TDF2018]","username":"gaz","description":"tokyo demo fest 2018 entry 4k intro \nwebGL version","likes":10,"published":1,"flags":8,"usePreview":0,"tags":["2d","raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"int S[26]=int[](7325,53709,35217,53705,36241,3217,39317,7196,49601,39176,11282,35088,6202,14392,39321,3229,47513,11421,37285,16577,39192,2578,14872,8738,16418,33667);\nint N[10]=int[](39835,4106,36237,38285,5148,38293,40341,643,40349,38301);\nint Z[9]=int[](35861,7316,7066,48336,52518,39559,74724,35165,50625);\nvec4 K=vec4(1,0.7,0.4,0.1);\nvec3 G=vec3(1,0,-1);\n\nfloat Q(float a,float b)\n{\n\treturn step(iTime,a+b)*max(0.0,iTime-a);\n}\n\nmat2 Rt(float a)\n{\n\treturn mat2(cos(a), sin(a), -sin(a), cos(a));\n}\n\nmat3 Rt(vec3 n, float a)\n{\n    n = normalize(n);\n    float x = n.x, y = n.y, z = n.z;\n    float s = sin(a), c = cos(a), o = 1.0-c;\n    return mat3(\n        o*x*x+c,o*x*y+z*s,o*z*x-y*s,\n        o*x*y-z*s,o*y*y+c,o*y*z+x*s,\n        o*z*x+y*s,o*y*z-x*s,o*z*z+c);\n}\nmat3 Pa(vec3 d, vec3 n)\n{\n\td=normalize(d);\n    vec3 u = normalize(cross(d,n));\n    return inverse(mat3(u,cross(u,d),d));\n}\n\n#define A\\\n \tz=dot(p-o,n)/dot(d,n);\\\n\ta=o+d*z-p;\\\n\tb=normalize(cross(h,n));\\\n\tq=vec2(dot(a,b),dot(a,normalize(cross(n,b))));\n\nfloat H(float n)\n{\n\treturn fract(sin(n+99.0)*float(1<<9))*2.0-1.0;\n}\n\n#define P(i)m*vec2(26>>(i)&1,19>>(i)&1)*vec2(0.6,1)\nfloat dF(vec2 p,int n)\n{\n\tfloat e=9.0;\n\tmat2 m=mat2(1);\n\tfor(int i=0;i<16;i++){\n\t\tif((i&7)==4||i==8)m*=mat2(0,1,-1,0);\n\t\tif((n>>i &1) == 1){\n\t\t\tvec2 a=P(i&3),b=P((i&3)+1),c=p-a,d=b-a;\n\t\t\te=min(e,length(c-d* clamp(dot(c,d)/dot(d,d), 0.1, 0.9)));\n\t\t}\n\t}\n\treturn e;\n}\n\nfloat dN(vec2 a, float b)\n{\n  vec2 c = pow(abs(a), vec2(b));\n  return pow(c.x+c.y, 1.0/b);\n}    \n\nfloat dX(vec3 p,vec3 d,float a)\n{\n\tfloat l=9.0;\n\tfor(int i=0;i<4;i++){\n\t\tvec3 q=p;\n\t\tq.xz+=(vec2(i&1,i>>1)-0.8);\n\t\tfloat n = H(dot(floor(q.xz/8.0),vec2(1,99))+float(i)*45.23);\n     \tq.xz = mod(q.xz,8.0) -4.0;\n\t\tl=min(l,\n\t\t\tlength(max(vec2(abs(sin(1.5*abs(dN(q.xz,a)-3.0-0.1*float(i)))), abs(q.y)\n\t\t\t\t-3.0-0.3*float(i)-2.0*n*exp(-5.0*fract(n*iTime))),0.0))-0.2);\n\t}\n\tl=min(l,\n          min((step(0.0,d.x)-fract(p.x))/d.x, \n              (step(0.0,d.z)-fract(p.z))/d.z)+0.01);\n\treturn l;\n}\n\nvec3 Y(float t)\n{\n\treturn vec3(\n        \tsin(t+2.0*sin(2.0*t)),\n        \tcos(2.0*t-2.0*cos(2.0*t)),\n        \tsin(3.0*t+0.5*sin(t*1.2)));\n}\n\nvec3 Fk(float t)\n{\n  return Rt(G.xxx,iTime*0.6)*vec3(\n    sin(t)+2.0*sin(2.0*t),\n    cos(t)-2.0*cos(2.0*t),\n    -sin(3.0*t)\n  );\n}\n\nvec3 Fr(float t)\n{\n\treturn Rt(G.xzx,iTime*0.6)*(vec3(sin(t),cos(t),0)+G.xyy*0.5);\n}\n\nvec3 Fl(float t)\n{\n\treturn Rt(G.xzx,iTime*0.6)*(vec3(sin(t),0,cos(t))-G.xyy*0.5);\n}\n\n#define B(a) k=S[a];x=min(x,dF(q,k));q.x-=2.0;\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec3 d = normalize(vec3((fragCoord * 2.0-iResolution.xy) / iResolution.y,-2.0)),\n        y=d,f,\n    o = G.yyx*20.0,\n\tc = K.www,\n\tn=G.yyx,\n\th=G.yxy,\n\ta,b,p,u,v,w;\n\tfloat t,z,e,x,s,g;\n\tvec2 q;\n\tint k;\n\n\tn=G.yyx;\n\tz=99.0;\n\tt=Q(0.0,18.0);\n\tif(t>0.0)\n    {\n\t\tp=G.yyx;\n\t\tA\n\t\tq.x+=0.5*t*(mod(floor(q.y/2.0),2.0)-0.5);\n\t\ts = dot(floor(q/2.0),vec2(1,99))+99.9;\n\t\tk=int(mix(H(s)*float(1<<16),float(Z[int(s)%9]),fract(iTime*3e-5))) *int(step(H(s)+1.0,t*t*0.008));\n\t\tq=mod(q,2.0)-1.0;\n\t\tq*=2.0;\n\t\tx=dF(q,k);\n\t\tc=mix(c, K.xzw,exp(-5.0*x));\n\t\tc=mix(c, K.yyw,exp(-8.0*x));\n\t\tc=pow(c,vec3(0.8));\n\t}\n\n\tt=max(Q(18.0,16.0),Q(81.0,64.0));\n\te=step(81.0,iTime);\n\tif(t>0.0)\n    {\n\t\tp=G.yyx*mix(18.0,-7.0,smoothstep(0.0,8.0,t));\n\t\tA\n\t\tvec2 u=floor(q/2.0);\n\t\tq=mod(q,2.0)-1.0;\n\t\tq*=2.0;\n\t\ts= (e< 0.5) ? step(dF(u/5.0,S[(int(t*3.0)+1)%26]),0.1):\n\t\t\tstep(abs(sin(length(u*.2)*0.8-t*1.5)),0.1);\n\t\tx=dF(q,N[int(s)]);\n\t\tc=mix(c, mix(K.xxx/(1.0+e),K.xww,s),exp(-8.0*x));\n\t\tz=mix(25.0,99.0,step(80.0,iTime));\n\t}\n\n\tt=Q(61.0,22.0);\n\tif(t>0.0)\n    {\n\t\tp=G.yyx*6.0;\n\t\tA\n\t\tx=9.0;\n\t\tq+=vec2(9,-4.5);\n\t\tB(12)\n\t\tB(8)\n\t\tB(18)\n\t\tB(18)\n\t\tB(14)\n\t\tB(13)\n\t\tq+=vec2(12,3.5);\n\t\tB(1)\n\t\tB(20)\n\t\tB(17)\n\t\tB(13)\n\t\tq+=vec2(6,3);\n\t\tB(19)\n\t\tB(7)\n\t\tB(4)\n\t\tq.x-=2.0;\n\t\tB(19)\n\t\tB(3)\n\t\tB(5)\n\t\tq+=vec2(12,3);\n\t\tB(2)\n\t\tB(14)\n\t\tB(12)\n\t\tB(15)\n\t\tB(20)\n\t\tB(19)\n\t\tB(4)\n\t\tB(17)\n\t\tx/=sin(iTime*3.0)+2.0;\n\t\tc=mix(c, mix(K.wxw,K.xyw,step(7.6,q.y)),exp(-6.0*x));\n\t\tc=mix(c, K.xxx,exp(-10.0*x));\n\t\tz=99.0;\n\t}\n    \n\tt=Q(145.0,10.0);\n\tif(t>0.0)\n    {\n\t\tp=G.yyx*8.0;\n\t\tA\n\t\tq.x+=8.0;\n\t\tx= length(q-vec2(16,-1.5))*2.0-0.05;\n\t\tB(2)\n\t\tB(14)\n\t\tB(12)\n\t\tB(15)\n\t\tB(11)\n\t\tB(4)\n\t\tB(19)\n\t\tB(4)\n\t\tk=16541;\tx=min(x,dF(q,k)); \n\t\tx/=sin(iTime*3.0)+2.0;\n\t\tc=mix(c, K.wxw,exp(-6.0*x));\n\t\tc=mix(c, K.xxx,exp(-10.0*x));\n\t}\n\n\tt=Q(41.0,18.0);\n\tif(t>0.0){\n\t\td.zy = Rt(0.8)*d.zy;\n\t\td.xz=Rt(H(floor(t*0.5))*3.0+t*0.1)*d.xz;\n\t\tfor (float j=1.; j>0.; j-=.01) {\n\t\t\tx=dX(p+G.yxy*15.0 ,d, 5.0+3.0*(smoothstep(0.4,0.6,fract(0.3*t))*2.0-1.0)*sign(fract(0.3*t/2.0)-0.5));\n        \tif(x<.001)\n            {\n\t\t\t\tc =mix(K.wwz*0.5,K.xxy, j*j*j); \n\t\t\t\tbreak;\n\t\t\t} \n \t\t\tp += d*x;   \n     \t}\n\t\tz=30.0;\n\t\td=y;\n\t}\n\n\tt=Q(59.0,14.0);\n\ts=99.0;\n\tfor(int i=0;i<int(sign(t))*4;i++){\n\t\tp=vec3(sin(1.6*float(i)+0.1)*12.0,\n               t-5.0*float(i),cos(1.3*float(i)+0.1)*6.0);\n\t\tn=normalize(vec3(p.x,0,p.z));\n\t\tA\n\t\tk=i+int(floor(q.y/20.0))*9;\n\t\tq.y=mod(q.y,20.0)-10.0;\n\t\tif(length(max(abs(q) - vec2(5,3),0.0))==0.0){\n\t\t\tif(z<s){\n\t\t\t\ts=z;\n\t\t\t\tc=K.www;\n\t\t\t\tp=G.yyx*15.0;\n\t\t\t\tvec3 rd =  Rt(pow(K.xyz,vec3(float(i))),t*.1)*normalize(vec3(q,-2));\n\t\t\t\tp.xy*=Rt(p.z+t);\n\t\t\t\tfor (float j=1.; j>0.; j-=.01) {\n\t\t\t\t\tf=Rt(G.xxx,-iTime+float(i))*(mod(p,6.0)-3.0);\n\t\t\t\t\tx=length(max(vec2(dF(f.xy,S[k%26])-0.08, abs(f.z)-0.3),0.0))-0.05;      \n\t\t\t\t\tif(x<.001) \n           \t\t\t{\n\t\t\t\t\t\tc = j*j*j*G.xxx;\n\t\t\t\t\t\tc[k%3]*=c[k%3]*1.5;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} \n \t\t\t\t\tp +=rd*x;   \n     \t\t\t}\n\t\t\t}\n\t\t}\n\t\tz=s;\n\t}\n\n\tt=max(Q(26.2, 7.8),Q(55.0,93.0));\n\te=step(55.0,iTime)\n\t\t+step(76.0,iTime)\n\t\t+step(91.0,iTime)\n\t\t-step(92.0,iTime)\n\t\t+step(94.0,iTime)\n\t\t-step(98.0,iTime)\n\t\t+step(100.0,iTime)\n\t\t-step(114.0,iTime)\n\t\t+step(117.0,iTime)*2.0\n\t\t-step(118.0,iTime)*2.0\n\t\t+step(120.0,iTime)*2.0\n\t\t-step(122.0,iTime)*2.0\n\t\t+step(124.0,iTime)*2.0\n\t\t-step(140.0,iTime)*2.0;\n\tfor(int i=0;i<int(sign(t))*240;i++){\n\t\tmat3 m;\n\t\tswitch(int(e)){\n\t\t\tcase 0:\n\t\t\t\tp= vec3(H(float(i))*10.0,H(float(i)*18.0)*10.0,t*15.0-float(i)*0.7);\n\t\t\t\tm=Rt( vec3(H(float(i)),H(float(i)*118.0),H(float(i)*138.0)),H(float(i)+777.0)*t*10.0);\n\t\t\t\tk = S[i%26];\t\t\t\t\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\tp= vec3(H(float(i)*182.0)*25.0,mod(t*8.0-0.3*float(i),80.0)-40.0,H(float(i)*1822.0)*16.0);\n\t\t\t\tm=mat3(1);\n\t\t\t\tk =N[int(float(i)+t*3.0+H(float(i)))%10];\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\tp= (abs(fract((iTime*0.5)*vec3(H(float(i)),H(float(i)*18.0),H(float(i)*182.0)))*2.0-1.0)*2.0-1.0)*30.0;\n\t\t\t\tm=Rt(vec3(H(float(i)*3.0),H(float(i)*118.0),H(float(i)*138.0)),H(float(i)+777.0)*t*5.0);\n\t\t\t\tk=S[int(float(i)+t*3.0+H(float(i)))%26];\n\t\t\t\tbreak;\n\n\t\t\tcase 3:\n\t\t\t\ts=6.283* floor(float(i)/6.0)/20.0,g=6.283*mod(float(i),6.0)/6.0;\n\t\t\t\tif(i<120){\n\t\t\t\t\tf= Fr(s)*8.0;\n\t\t \t\t\tv = Fr(s - 0.01) - Fr(s + 0.01);\n\t\t\t\t} else {\n\t\t\t\t\tf= Fl(s)*8.0;\n\t\t \t\t\tv = Fl(s - 0.01) - Fl(s + 0.01);\n\t\t\t\t}\n\t\t \t\tu = Rt(v,g)*normalize(cross(f, v));\n\t\t\t\tp =f+u*1.8;\n\t\t\t\tm=Pa(u,v);\n\t\t\t\tk = Z[2];\t\t\t\t\n\t\t\t\tbreak;\n\n\t\t\tcase 4:\n\t\t\t\ts=6.283* floor(float(i)/6.0)/40.0,g=6.283*mod(float(i),6.0)/6.0;\n\t\t\t\tf= Fk(s)*4.0;\n\t\t \t\tv = Fk(s - 0.01) - Fk(s + 0.01);\n\t\t \t\tu = Rt(v,g)*normalize(cross(f, v));\n\t\t\t\tp =f+u*1.7;\n\t\t\t\tm=Pa(u,v);\n\t\t\t\tk = Z[2];\t\t\t\t\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif(length(cross(d,p-o))<1.45)\n\t\t{\n\t\t\ta =o+G.yyx;\n\t\t\tfor(float j=1.0; j>0.0;j-=0.05) {\n\t\t\t\tf = m*(a-p);\n\t\t\t\tx=length(max(vec2(dF(f.xy,k)-0.08, abs(f.z)-0.05),0.0))-0.05;      \n \t\t\t\tif(x<.001)\n    \t\t\t{\n\t\t\t\t\ts = dot(d,a-o);\n\t\t\t\t\tif(s<z)\n\t\t\t\t\t{\n\t\t\t\t\t\tc =mix(K.wwz*0.3,K.xxy, exp(-0.0005*s*s)*j*j*j); \n\t\t\t\t\t\tc=pow(c,vec3(1,2,3)*0.6);\n\t\t\t\t\t\tz=s;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n \t\t\t\ta += d*x;\n     \t\t}\n\t\t}\n\t}\n\n\tt=max(max(max(max(max(max(max(\n\t\tQ(15.0,8.0),\n\t\tQ(34.0,10.0)),\n\t\tQ(50.0,7.0)),\n\t\tQ(98.0,6.0)),\n\t\tQ(106.0,9.0)),\n\t\tQ(122.0,6.0)),\n\t\tQ(130.0,11.0)),\n\t\tQ(144.0,11.0));\n\te=step(34.0,iTime)+step(50.0,iTime)\n\t\t+step(98.0,iTime)\n\t\t+step(106.0,iTime)\n\t\t-step(122.0,iTime)\n\t\t+step(130.0,iTime)\n\t\t+step(144.0,iTime);\n\tfor(int i=0;i<int(sign(t))*2;i++)\n    {\n\t\tfor(int j=0;j<10;j++)\n        {\n\t\t\ts=float(j)*0.02+iTime*0.2+float(i)*0.3;\n\t\t\tp = Y(s)*4.0;\n\t\t\tp = Rt(G.xxx,0.2*t)*p;\t\n\t\t\th = cross(p, Y(s-0.01)-Y(s+0.01));\n\t\t\tn=G.yyx; \n\t\t\tA\n\t\t\ts=float[](\n\t\t\t\texp(-0.5*pow(t-3.0,2.0)),\n\t\t\t\tstep(abs(q.x+1.0),3.0)-max(0.0,1.0-float(j)*0.1),\n\t\t\t\t-float(j)*.1\n\t\t\t)[int(e)%3];\n\t\t\tk=Z[int(mod(floor(q/2.0)+float(i)*3.0+iTime,9.0))];\n\t\t\tq.x=mod(q.x,2.0)-1.0;\n\t\t\tx=dF(q, k);\n\t\t\tc = mix(c, (j==9)?K.xxx:K.xwz,s*min(1.0,0.1/x));\n\t\t}\n    }\n\n    fragColor = vec4(c, 1);\n}\n","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define A 0.120\n\nfloat F(int n){\n\treturn 440.0*exp2((float(n)-69.0)/12.0);\n}\n\nfloat N(float t){\n\treturn fract(sin(t*99.0)*5e5)*2.0-1.0;\n}\n\nfloat K(float t){\n\treturn cos(315.0*t-10.0*exp(-70.0*t))*exp(-t*1.6);\n}\n\nfloat S(float t){\n\treturn N(t)* max(0.0, 1.0 - min(0.5 ,t*5000.0)- max(0.0, t - 0.05)*10.0);\n}\n\nfloat H(float t){\n\treturn N(t)*exp(-t*150.0);\n}\n\nfloat B(float f, float t)\n{\n  \tf *= t;\n  \treturn clamp((\n        \t5.0*sin(6.283*f)\n        \t+2.0*sin(6.283*f*2.0)\n        \t+sin(6.283*f*3.0)\n    \t)/4.0,-1.0,1.0)*exp(-5.0*t);\n}\n\nfloat P(float f, float t)\n{\n  float g = 0.0, a, b = 0.0;\n  for(float j = 1.0; j < 8.0; j++){\n      b += a = exp(-j *0.5);\n      g +=  a * sin(6.283*f*j*t ) * exp(-t*1.5/(1.0-j*0.1));\n  }\n  g *= 1.0 + 1.5*exp(-5.0*t);\n  return g / b;\n}\n\nint O(int s,float t)\n{\n    int n =-1;\n    for(int i=0;i<=int(mod(t,A*16.0)/A);i++){\n        if((s>>i&1)==1)n++;\n    }\n    return n;\n}\n\nfloat Q(int s,float t)\n{\n  float n =mod(t,A);\n  for(int i=0;i<16;i++){\n    if((s>>(int(t/A)-i)%16&1)==1)break;\n    n+=A;\n  }\n  return n;\n}\n\n#define M 60+int[](0,2,4,5,7,9,11,12,14,16,17,19,21,23) \n#define Y 60 + int[](0,2,4,7,9,12,14)\n#define BN 60+int[](0,2,3,4,5,6,7,9,10,11,12) \n\nfloat C(int a, float t)\n{\n    return (\n        P(F(M[a]),t) +\n        P(F(M[a + 2]),t) +\n        P(F(M[a + 4]),t) +\n        P(F(M[a + 6]),t) \n        )/4.0;\n}\n\nfloat R(float n){\n\treturn fract(sin(n+125.)*4378.);\n}\n\nvec2 X(float t)\n{\n\tfloat i;\n\tfor(i=0.0;i<2000.0;i++){\n\t\tfloat g =float[](A*4.0,A*8.0,A*4.0,A*2.0,A*8.0,A*2.0,A*4.0,A*2.0)\n\t\t\t[int(R(i*556.0+36.0)*8.0)];\n\t\tif(t<g){break;}\n\t\tt-=g;\n\t}\n\treturn vec2(i,t);\n}\n\nfloat L(int c, float t)\n{\n\tint n= 0x1111;\n\tc+=int[](0,2,4,2,0)[O(n,t)];\n\tt=Q(n,t);\n\tfloat f = F((M[c])-24)*Q(n,t);\n  \treturn clamp((\n        5.0 * sin(6.283 * f)\n        + 2.0 * sin(6.283 * f * 2.0)\n        + sin(6.283 * f * 3.0)\n    \t)/4.0,-1.0,1.0)*exp(-5.0 * t);\n}\n\nvec2 mainSound( in int samp, float time )\n{\n    float t=time;\n\tint G=int[](1,5,6,3,4,1,4,5)[int(t/(A*16.0))&7]-1; \n\tvec2 c = X(t);\n\tvec2 gain = \n\t\t0.4 * vec2(\n\t\t\t\t\t 0.5 * K(Q(0x0581,t))  // kick\n        \t\t\t+0.3 * S(Q(0x1101,t))  // snare\n            \t\t+0.2 * H(Q(0x5555,t)))    // hat \n\t\t+0.4 * vec2(1,0.8)*C(G, Q(0x0101,t))  // chord\n\t\t+0.3 * vec2(1)*P(F(Y[int(R(c.x*12836.0)*7.0)]), c.y)  // melody \n\t\t+0.4 * vec2(0.8,1)*L(G,t)    // base\n\t\t;\n\t\t\n\tgain *=smoothstep(155.0,150.0,t);\n\tgain = clamp(gain,-1.0,1.0);\n    return gain;\n}","name":"Sound","description":"","type":"sound"}]}