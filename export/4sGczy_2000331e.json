{"ver":"0.1","info":{"id":"4sGczy","date":"1522367705","viewed":146,"name":"Biham–Middleton–Levine Traffic","username":"91isprime","description":"Click to reset. Change the density and colors in Common. I didn't try to optimize branches since it runs at 60 fps anyway. See also https://www.shadertoy.com/view/Xsyczy","likes":5,"published":1,"flags":32,"usePreview":0,"tags":["cellularautomata","traffic"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor = texelFetch(iChannel0, ivec2(fragCoord), 0);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"//Cars go down\n\n//From https://www.shadertoy.com/view/Mdj3zd\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec4 texelFetchWrap(vec2 coord){\n    coord.x = mod(coord.x, iChannelResolution[0].x);\n    coord.y = mod(coord.y, iChannelResolution[0].y);\n    return texelFetch(iChannel0, ivec2(coord.xy), 0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n    if(iFrame == 0 || iMouse.z > 0.0){\n        if (rand(fragCoord) < DENSITY/2.0){\n            fragColor = RED;\n        } else if (rand(fragCoord) > 1.0 - DENSITY/2.0) {\n            fragColor = BLUE;\n        } else {\n            fragColor = BLACK;\n        }\n        return;\n    }\n    \n    vec4 myColor = texelFetchWrap(fragCoord);\n    vec4 aboveColor = texelFetchWrap(fragCoord + vec2(0.0,1.0));\n    vec4 belowColor = texelFetchWrap(fragCoord + vec2(0.0,-1.0));\n    if(aboveColor == RED && myColor == BLACK){\n        fragColor = RED;\n    } else if (myColor == RED && belowColor == BLACK) {\n        fragColor = BLACK;\n    } else {\n        fragColor = myColor;\n    }\n}","name":"Buf A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"//Blue cars go right\n\n//From https://www.shadertoy.com/view/Mdj3zd\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec4 texelFetchWrap(vec2 coord){\n    coord.x = mod(coord.x, iChannelResolution[0].x);\n    coord.y = mod(coord.y, iChannelResolution[0].y);\n    return texelFetch(iChannel0, ivec2(coord.xy), 0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    if(iFrame == 0 || iMouse.z > 0.0){\n        if (rand(fragCoord) < DENSITY/2.0){\n            fragColor = RED;\n        } else if (rand(fragCoord) > 1.0 - DENSITY/2.0) {\n            fragColor = BLUE;\n        } else {\n            fragColor = BLACK;\n        }\n        return;\n    }\n    \n    vec4 myColor = texelFetchWrap(fragCoord);\n    vec4 leftColor = texelFetchWrap(fragCoord + vec2(-1.0,0.0));\n    vec4 rightColor = texelFetchWrap(fragCoord + vec2(1.0,0.0));\n    if(leftColor == BLUE && myColor == BLACK){\n        fragColor = BLUE;\n    } else if (myColor == BLUE && rightColor == BLACK) {\n        fragColor = BLACK;\n    } else {\n        fragColor = myColor;\n    }\n}","name":"Buf B","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"const vec4 RED   = vec4(1.0,0.0,0.0,0.0);\nconst vec4 BLUE  = vec4(0.0,0.0,1.0,0.0);\nconst vec4 BLACK = vec4(0.0,0.0,0.0,0.0);\nconst vec4 GREEN = vec4(0.0,1.0,0.0,0.0);\n\nconst float DENSITY = .3;","name":"Common","description":"","type":"common"}]}