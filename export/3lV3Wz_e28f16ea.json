{"ver":"0.1","info":{"id":"3lV3Wz","date":"1579298386","viewed":281,"name":"Trap Nation Audio Visualiser","username":"DannnYXZ","description":"Trap Nation like music visualizer.","likes":3,"published":1,"flags":96,"usePreview":0,"tags":["music","visualiser"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define S(a,b,x) smoothstep(a,b,x)\n#define PI  3.14159265\n#define PI2 6.28318530\n#define VOLUME_TESHOLD 0.75\n\nvec3 hsv2rgb( in vec3 c ) {\n    vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0);\n\treturn c.z * mix(vec3(1.0), rgb, c.y);\n}\nfloat cut(float x, float h){\n    return clamp((x-h) * 1.0 / (1.0-h), 0.0, 1.0);\n}\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = 1.5*(2.*fragCoord-iResolution.xy)/iResolution.y;\n    vec3 col = 0.5+0.5*cos(iTime+uv.xyx+vec3(0,2,4));\n    uv.x = abs(uv.x);\n    uv = -uv.yx;\n   \tvec2 pl = vec2(atan(uv.y, uv.x), length(uv))/vec2(PI2, 1.)+vec2(.5, 0);\n\tfloat R = .5, r = .45;\n    for(float i = 5.; i >= 0.; i--){\n    \tivec2 tx = ivec2(pl.x*iResolution.x, i*2.);\n        float fft = .9*texelFetch(iChannel0, tx, 0).x;\n        fft = cut(fft, VOLUME_TESHOLD);\n        float m = S(fft, fft-0.001, pl.y-R);\n        col = mix(col,\n                  (i == 0.) ? vec3(1.) : hsv2rgb(vec3(mod(i+1., 6.)/6., 1., 1.)),\n                  m);\n    }\n    col = mix(col, vec3(.5), S(r, r-.001, pl.y));\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"Ml23zh","filepath":"https://soundcloud.com/bossfightswe/elevatia","previewfilepath":"https://soundcloud.com/bossfightswe/elevatia","type":"musicstream","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":0}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"#define SMOOTH_RANGE .01\n#define SCALE .08\n#define SMOOTH_STEPS 10.\n#define fft(x) texture(iChannel1, vec2(x, 0))\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    vec2 uv = fragCoord;\n    ivec2 id = ivec2(uv);\n    if(id.y == 0){\n        uv /= iResolution.xy;\n        float avg = 0.;\n        for(float i = 0.; i < SMOOTH_RANGE; i += SMOOTH_RANGE/SMOOTH_STEPS){\n            float l = uv.x - i > 0. ? uv.x - i : i - uv.x;\n            float r = uv.x + i < 1. ? uv.x + i : 2. - (uv.x + i);\n        \tavg += fft(l*SCALE).x;\n        \tavg += fft(r*SCALE).x;\n        }\n        avg /= SMOOTH_STEPS * 2.;\n        fragColor = vec4(avg, 0., 0., 1.);\n        return;\n    }\n    float fft = texelFetch(iChannel0, id + ivec2(0, -1), 0).x;\n    fragColor = vec4(fft, 0., 0., 1.);\n}","name":"Buffer A","description":"","type":"buffer"}]}