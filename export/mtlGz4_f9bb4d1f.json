{"ver":"0.1","info":{"id":"mtlGz4","date":"1671446689","viewed":176,"name":"Terrain model","username":"gcgac","description":"Terrain. I'm not too happy with how the snow, rock and grass positioning turned out but it's alright.","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","terrain","raycasting","lighting","snow","nature"],"hasliked":0,"parentid":"dtfGz4","parentname":"terrain with lighting"},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// thanks to inigo quilez for making this site and for making the normal function\nvec3 normal;\nfloat range = 4.0;\n\nvec2 rot (float i1, float i2, float r){\n    return vec2 (cos(r)*i1-sin(r)*i2,sin(r)*i1+cos(r)*i2);\n}\n\nfloat yval(float xval,float zval){\n    vec2 rota = rot(xval,zval,iTime);\n    float x = rota.x;\n    float z = rota.y;\n    return ((sin(x*range*8.0)+sin(z*range*7.0)+sin((x*range+0.3)*10.0))/10.0)+sin(x*range)+sin(z*range)+(sin((x*range+sin(z*range)/2.0)*6.5)+cos(z*3.2*range))/10.0;\n}\n\nfloat calc_sdf(vec3 ray){\n    return abs(yval(ray.x,ray.z)-ray.y);\n}\n\nvec3 calcNormal( in vec3 p ) // for function f(p)\n{\n    const float eps = 0.0001; // or some other value\n    const vec2 h = vec2(eps,0);\n    return normalize( vec3(calc_sdf(p+h.xyy) - calc_sdf(p-h.xyy),\n                           calc_sdf(p+h.yxy) - calc_sdf(p-h.yxy),\n                           calc_sdf(p+h.yyx) - calc_sdf(p-h.yyx) ) );\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n    vec2 uv = (fragCoord/iResolution.xy)-0.5*2.0;\n    vec3 ray = vec3(3,3.0,-6);\n    vec3 light = vec3(2.0,5.0,0);\n    int steps = 0;\n    float inter = 0.0;\n    while (inter == 0.0 && steps<2500){\n        ray += normalize(vec3(uv,1.0))/200.0;\n        vec2 r = rot(ray.x,ray.z,iTime);\n        if (calc_sdf(ray)<0.1 && abs(r.x)<1.0 && abs(r.y)<1.0){\n            inter = length(vec3(2,5,0)-ray)*0.1;\n            normal = calcNormal(ray);\n        }\n        steps += 1;\n    }\n    if (inter == 0.0){\n        fragColor = vec4(0,0,0,1);\n    }else if (normal.y>=0.7 && ray.y>0.9){\n        fragColor = vec4((1.0-vec3(inter))*dot(normal,normalize(light-ray)),1.0);\n    }else if (normal.y>=ray.y*1.5){\n        fragColor = vec4(vec3(0,(1.0-inter)*dot(normal,normalize(light-ray)),0),1.0);\n    }else{\n        fragColor = vec4((1.0-vec3(inter))*dot(normal,normalize(light-ray))/2.0,1.0);\n    }\n}","name":"Image","description":"","type":"image"}]}