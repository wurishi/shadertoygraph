{"ver":"0.1","info":{"id":"7l2yDV","date":"1650291102","viewed":592,"name":"Flowering Cranktopus","username":"evvvvil","description":"Winning shader made at Revision 2022 Shader Showdown Semi-final.\nLive coded on stage in 25 minutes.  Designed beforehand in several hours.\n\n","likes":29,"published":1,"flags":0,"usePreview":1,"tags":["demoscene","flower","particles","transition","organic","morph","octopus","tentacle","squid"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsX3Rn","filepath":"/media/a/92d7758c402f0927011ca8d0a7e40251439fba3a1dac26f5b8b62026323501aa.jpg","previewfilepath":"/media/ap/92d7758c402f0927011ca8d0a7e40251439fba3a1dac26f5b8b62026323501aa.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Winning shader made at Revision 2022 Shader Showdown Semi-final\n\n// This shader was coded live on stage in 25 minutes. Designed beforehand in several hours.\n// Couldn't get the flower petals quite right within 25minutes but got away with it. \n// Respect and greetz go to blackle!\n\nfloat smin( float d1,float d2,float k){ float h=max(k-abs(d1-d2),0.);return min(d1,d2)-h*h*.25/k;}\nfloat smax( float d1,float d2,float k){ float h=max(k-abs(-d1-d2),0.);return max(-d1,d2)+h*h*.25/k;}\nmat2 r2(float r){ return mat2(cos(r),sin(r),-sin(r),cos(r));} \nvec2 z,v,e=vec2(-.001,.001);float t,tt,bb,b,g,tnoi;vec3 op,pp,rp,po,no,al,ld;\nfloat cy(vec3 p,float r){vec3 pp=abs(p)-vec3(1.-sin(rp.z*2.)*.1,10.,.1-sin(rp.z*15.)*.01-rp.z*.01);\n    return mix(length(p.xz)-r,max(max(pp.x,pp.y),pp.z),bb);}\nconst float PI = acos(-1.);\nvec2 mp( vec3 p){ \n  op=p;//op\n  bb=smoothstep(0.,1.,clamp(cos(op.y*.075-tt*.75),-.25,.25)*2.+.5); //bb\n  p.xz*=r2(sin(p.y*.1+bb*2.)+tt*.1); //rot\n  pp=p+sin(op.y*.5)-cos(op.y*.2+tt)+sin(op.z*op.y*.02); //disp\n  rp=vec3(atan(pp.x,pp.z)*10./PI,pp.y,length(pp.xz)-2.5); //proj rp\n  rp.x=mod(rp.x,4.0)-2.0; //mod rpx\n  rp.y=mod(rp.y,8.0)-4.0; //mod rpy\n  v=vec2(atan(pp.z,pp.x)/(2.*PI),pp.y*.1); //polar uv\n  tnoi=texture(iChannel0, v).r*.2; //tnoi\n  vec2 h,t=vec2(cy(pp,3.-tnoi),0); //base cyl\n  t.x=smin(t.x,cy(rp,.5+cos(rp.y*15.)*.03),1.); //side cyl\n  float bu=cos(p.y*.15)*3., //bulge \n    ta=abs(p.y)*.05, //taper\n    ex=max(0.,abs(p.y)-5.), //exp \n    wav=sin(p.y+tt*5.)*ex*.075; //wav\n  t.x=smin(t.x,cy(abs(pp)-4.+bu,1.-ta),1.); //tent\n  t.x=smin(t.x,cy(abs(abs(pp)-3.8+bu)-.4-ta-wav-ex*.1,.5-ta),.5);//side tent\n  t.x=smax(length(rp)-1.+tnoi,t.x,1.4);  //holes\n  rp.y+=sin(rp.z*.5+tt*2.)*min(rp.z-.2,1.)*.5; //rp.y wave\n  t.x=smin(cy(rp.xzy,.17-rp.z*.02),t.x,0.5);// spike\n  t.x=smin(mix(100.,length(abs(rp.xy)-vec2(0,0.2))-0.2+tnoi*.2+rp.z*.015,bb),t.x,.4);  //holes\n  pp=rp; //pp rp\n  pp.z=abs(pp.z)-8.; //z move out 8\n  t.x=smin(t.x,max(length(pp)-.1,-(length(pp)-.8)),1.); //spike pointer\n  h=vec2(length(rp)-1.1+tnoi,1); //black eye\n  h.x=0.8*smax(length(rp.xy)-.6+tnoi,h.x,.5); //black hole\n  h.x=min(h.x,length(abs(rp.xy)-.2-rp.z*.1)-.05); //black spike\n  h.x=max(h.x,abs(rp.z)-8.); //cut whole black\n  pp.xy=abs(pp.xy)-.2-rp.z*.1; //move out pp\n  bu = length(pp)-.02; //tip pp\n  g+=0.1/(0.1+bu*bu*(40.-39.*sin(op.y+tt)*sin(rp.z-tt*3.))); //glow pp\n  h.x=min(h.x,bu); //add tip to h\n  t=t.x<h.x?t:h; //merge t and h\n  t.x*=0.65;  //artifact\n  return t;\n}\nvec2 tr( vec3 ro,vec3 rd){  \n  vec2 h,t=vec2(.1);\n  for(int i=0;i<128;i++){\n    h=mp(ro+rd*t.x);\n    if(h.x<.0001||t.x>60.) break;\n    t.x+=h.x;t.y=h.y;      \n  }\n  if(t.x>60.) t.y=-1.;\n\treturn t;\n}\n#define a(d) clamp(mp(po+no*d).x/d,0.,1.)\n#define s(d) smoothstep(0.,1.,mp(po+ld*d).x/d)\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){ \n  vec2 uv=(fragCoord.xy/iResolution.xy-0.5)/vec2(iResolution.y/iResolution.x,1);   \n  tt=mod(iTime,83.7)+11.7; \n  vec3 ro=vec3(12.,cos(tt*.2)*11.,0),\n  cw=normalize(vec3(0)-ro),\n  cu=normalize(cross(cw,vec3(0,1,0))),\n  cv=normalize(cross(cu,cw)),\n  rd=mat3(cu,cv,cw)*normalize(vec3(uv,.5)),co,fo;\n  co=fo=vec3(.1,.2,.3)-length(uv)*.2-sin(uv.x*40.)*rd.y*.01;\n  ld=normalize(vec3(.2,-.2,.3));\n  z=tr(ro,rd);t=z.x;\n  if(z.y>-1.){    \n    po=ro+rd*t;\n    no=normalize(e.xyy*mp(po+e.xyy).x+e.yyx*mp(po+e.yyx).x+e.yxy*mp(po+e.yxy).x+e.xxx*mp(po+e.xxx).x);\n    al=mix(vec3(1,.3,.2),vec3(.1,.1,1),sin(tnoi*5.-3.5)*.5+.5);\n    al=mix(al,vec3(1.0,0.3+sin(op.y)*.2,.2)+b,bb);\n    if(z.y>0.) al=vec3(0);\n    float dif=max(0.,dot(no,ld)),\n    fr=pow(1.+dot(no,rd),4.),\n    sp=pow(max(dot(reflect(-ld,no),-rd),0.),100.);    \n    co=mix(sp*.5+al*(a(.05)*a(.15)+.2)*(dif+s(2.)),fo,min(fr,.5));\n    co=mix(fo,co,exp(-.00002*t*t*t));\n    co=mix(co,fo,abs(uv.y*1.7));\n  }\n  fragColor = vec4(pow(co+g*.2*vec3(1,.5,.2),vec3(.45)),1);\n}","name":"Image","description":"","type":"image"}]}