{"ver":"0.1","info":{"id":"Mcy3Rd","date":"1713159800","viewed":122,"name":"Maze runner 3","username":"ukeshet","description":"Random single-solution maze.\nRay marching version of https://www.shadertoy.com/view/McVGRy\nMouse up/down=camera height; right/left=move along path.","likes":6,"published":1,"flags":32,"usePreview":0,"tags":["3d","random","maze"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Random single-solution maze. Demo for ICP course by ukeshet.\n// Improved version of my https://www.shadertoy.com/view/McVGRy\n// Buffer A builds the maze. Image ray-marches. \n// Mouse up/down for camera height. Mouse right/left along path.\n// For documentation, see V4 (https://www.shadertoy.com/view/lfK3Rd)\n\nvoid mainImage(out vec4 Col, in vec2 Coo)\n{\n    vec4 s0=texelFetch(iChannel0,ivec2(1,h+1),0);\n    float v=8.,t=iTime,x=Coo.x,y=Coo.y,L=iResolution.x,Ly=iResolution.y,X=L/wf,Y=iResolution.y/float(h),p=mod(3.*iMouse.x/X+5.*wf+v*iTime,s0[2]+1.);\n    vec4 s1=texelFetch(iChannel0,ivec2(int(mod(p,L)),h+1+int(p/L)),0);\n    int i, xy1=floatBitsToInt(s1[0]), xy2=floatBitsToInt(s1[1]);\n    vec2 s=mix(vec2(xy1&0xFFFF,(xy1>>16)&0xFFFF),vec2(xy2&0xFFFF,(xy2>>16)&0xFFFF),fract(p)); float d=s[0];\n    vec4 M=texelFetch(iChannel0,ivec2(int(mod((x-.5*L)/X+d,float(w))),int(y/Y)),0);\n    vec2 uv=(2.*Coo-iResolution.xy)/iResolution.xy;\n    float D, r=0., H=12.; if (iMouse.z>0.) H=7.+40.*iMouse.y/iResolution.y;\n    vec3 q, q0, R, ro=vec3(0.,0.,-H), rd=normalize(vec3(uv,H)); \n    for (i=0; i<500; i++) {\n        R=ro+r*rd; D=max(0.,5.-R[2]);\n        q0=R-vec3((1.0+float(int(d+x/X))-d)*2.*X/L-1.,(1.0+float(int(y/Y)))*2.*Y/Ly-1.,0.);\n        if (M[0]==0.) {q=abs(q0)-vec3(.3*X/L,8.*Y/Ly,1.); D=min(D,length(max(q,0.0))+min(max(q.x,max(q.y,q.z)),0.0));}\n        if (M[1]==0.) {q=abs(q0)-vec3(8.*X/L,.3*Y/Ly,1.); D=min(D,length(max(q,0.0))+min(max(q.x,max(q.y,q.z)),0.0));}\n        r+=D; if (D<.001||r>(H+5.)) break;\n    }\n    Col = vec4(palette((r-H-15.5)*.1), 1.);\n    if (length(vec2((x-.5*L)/X-.4,(y/Y)-s[1]-.4))<.3) Col=vec4(1.,0,0,1.);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void mainImage(out vec4 Col, in vec2 Coo)\n{\n    vec4 prev=texelFetch(iChannel0, ivec2(Coo), 0);\n    if (iFrame!=0)\n        Col=prev;\n    else {\n        int cx=int(Coo.x),cy=int(Coo.y);\n        if (((cy<h+3+int(float(h*w)/iResolution.x))&&(cy>h))||((cy<h)&&(cx<w))) {\n            int i,k,m,tmp,p[4],q,M[w*h],d,u,go,L=int(iResolution.x);\n            for (i=0; i<h*w; i++) {\n                for (k=3;k>=0;k--) p[k]=k;\n                for (k=3;k>0;k--) {m=int(hash(5*i+3*k)*float(k+1)); q=p[k];p[k]=p[m];p[m]=q;}\n                M[i]=((p[0]&3)<<24)|((p[1]&3)<<26)|((p[2]&3)<<28)|((p[3]&3)<<30);\n            }\n            int x=0,y=h/2,j=0,s=1,sh,dx,dy,x1,y1,u1,x2,y2;\n            u=x*h+y; M[u]|=(1<<14);Col=vec4(0.,0.,0.,1.);\n            M[u]=(M[u]&~(127<<0))|((x&127)<<0); M[u]=(M[u]&~(63<<8))|((y&63)<<8);\n            while (s<w*h) {\n                go=1; u=x*h+y;\n                if ((y==h/2)&&(x==w-1)) {\n                    go=0;x1=x;y1=y;x2=w;y2=h/2; if((cx==x1)&&(cy==y1)) Col[0]=1.;\n                    for (k=j; k>=0; k--) {\n                        if ((cx==(k%L))&&(cy==h+1+k/L)) \n                            Col=vec4(intBitsToFloat((x1&0xFFFF)|((y1&0xFFFF)<<16)),intBitsToFloat((x2&0xFFFF)|((y2&0xFFFF)<<16)),float(j),1.);\n                        x2=x1;y2=y1;u1=x1*h+y1;x1=(M[u1]>>0)&127;y1=(M[u1]>>8)&63;\n                    }\n                }\n                if ((sh=(M[u]>>21)&7)<4) d=(M[u]>>(24+2*sh))&3;\n                else go=0;\n                if (go==0) {j--;x=(M[u]>>0)&127;y=(M[u]>>8)&63;}\n                else {\n                    dx=dy=0;M[u]=(M[u]&~(7<<21))|(((M[u]>>21)&7)+1)<<21;\n                    if ((d==0)&&(y<h-1)) {if(((M[x*h+y+1]>>14)&1)==0) dy=1;}\n                    else if((d==1) && (x<w-1)) {if(((M[(x+1)*h+y]>>14)&1)==0) dx=1;}\n                    else if((d==2) && (y>0)) {if(((M[x*h+y-1]>>14)&1)==0) dy=-1;}\n                    else if((d==3) && (x>0)) {if(((M[(x-1)*h+y]>>14)&1)==0) dx=-1;}\n                    if ((dx!=0)||(dy!=0)) {\n                        s++;j++;x+=dx;y+=dy;u=x*h+y;M[u]|=(1<<14);\n                        M[u]=(M[u]&int(~(127<<0)))|((x-dx)&127)|(((y-dy)&63)<<8);\n                        if ((cx==min(x,x-dx))&&(cy==min(y,y-dy))) \n                            {if (dx!=0) Col[0]=1.; if (dy!=0) Col[1]=1.;} \n                    }\n                }\n            }\n        }\n    }\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define w 35\n#define wf 24.\n#define h 16\n#define pi 3.1415926535\n#define T 4.3084699249\n// T=2*pi*wf/float(w)\n\nfloat hash(int seed) {\n    int p=23856097;\n    int q=seed*p;\n    q=(q^(q>>15))*(q|0x5D588B65);\n    return fract(float(q)/float(0x7FFFFFFF));\n}\n\nvec3 palette(float t) {\n    return .5+.5*cos(pi*(t+vec3(.2,.5,.8)));\n}\n","name":"Common","description":"","type":"common"}]}