{"ver":"0.1","info":{"id":"Wds3D4","date":"1546301699","viewed":596,"name":"CRT shadow mask filter","username":"mikewolf","description":"CRT with interlace\nfirst attempt, needs clean up","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["crt"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdfGRr","filepath":"/media/a/35c87bcb8d7af24c54d41122dadb619dd920646a0bd0e477e7bdc6d12876df17.webm","previewfilepath":"/media/ap/35c87bcb8d7af24c54d41122dadb619dd920646a0bd0e477e7bdc6d12876df17.webm","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float scale = 2.0;\nfloat overdrive = 1.3;\nfloat scanLines = 96.0;\nfloat scanLineBoost = 0.50;\nint interlaceRate = 2;\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float dotSize = 3.0 * scale;\n    float dotStep = dotSize / 3.0;\n    float dotStep2 = dotStep * 2.0;\n    float lineGapHeight = 1.0;\n    float evenDotOffset = dotSize * .5;\n    float lineGapStart = (dotSize - lineGapHeight);\n    float scanLine = iResolution.y / scanLines;\n\tfloat halfScanLine = scanLine * .5;\n    \n    int field = iFrame % (2*interlaceRate) / interlaceRate;\n    \n    vec2 fragc = vec2(fragCoord.x, fragCoord.y - float(field) * halfScanLine);\n    vec2 vUv = fragc / iResolution.xy;\n\tfloat ar = iResolution.y / iResolution.x;\n    float d = 1.0 / scanLines / 2.0;\n\tfloat v = floor( vUv.y / 2.0 / d ) * d + d * float(field) / 2.0;\n\td = ar / scanLines;\n\t//float u = floor( vUv.x / d ) * d;\n\tfloat u = vUv.x;\n    \n    vec2 uv = vec2(u,v * 2.0);\n   \tvec3 col = texture(iChannel0, uv).rgb;\n\t//col = vec3(1.0,1.0,1.0);\n    \n    float f = mod(fragCoord.x, dotSize);\n    float rf = ceil((dotStep - f) / dotStep);\n    float bf = ceil((f - dotStep2) / dotStep);\n    col *= vec3(rf, 1.0 - abs(rf), bf);\n    \n    float evenOffset = float(int(mod(fragCoord.x / dotSize, 2.0))) * evenDotOffset;\n    f = mod(fragCoord.y + evenOffset, dotSize);\n    col *= ceil((lineGapStart - f) / dotSize); \n    \n    float interlaceOffset = halfScanLine * float(field);\n    f = abs(mod(fragCoord.y + halfScanLine + interlaceOffset, scanLine) - scanLine * .5) / scanLine;\n    col *= f + scanLineBoost;\n    \n    fragColor = vec4(col.rgb * overdrive, 1.0);\n}","name":"Image","description":"","type":"image"}]}