{"ver":"0.1","info":{"id":"McscDs","date":"1721816664","viewed":71,"name":"Catching rays in the field.","username":"rikr","description":"Sorry for the messy code, made by Rik Riesmeijer. Suggestions and improvement ideas welcome.","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["3d","raymarching","sun","sdf","grass","sky","field","walking","calm","sundown","peaceful","evening"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Catching rays in the field.\n// By Rik Riesmeijer, 2024 - No rights reserved.\n\n#define n    normalize\n#define e    .01\n#define b(x) (x * sdf(p + e * x, h))\n#define s(x, z) length(p - vec3(x, 0, z))\n\nfloat sdf(vec3 p, vec3 dir) {\n    if(dir.y >= 0.0)\n        return 50. + dir.y;\n    #define rr(m) (94587u * m ^ m.yx)\n    vec2 ra = vec2(rr(rr(rr(uvec2(p.xz + 1e5)))))/vec2(-1u);\n    ra.y = -1. - ra.x;\n    vec2 xh = floor(p.xx) - ra;\n    vec2 zh = floor(p.zz) - ra;\n    return p.y - .07 + .5 * ra.x + max(max(s(xh.x, zh.x), s(xh.y, zh.x)),\n                                       max(s(xh.x, zh.y), s(xh.y, zh.y)));\n}\n\nvoid mainImage(out vec4 c, in vec2 v) {\n    vec3 a = vec3(1, -1, 0), r = iResolution, s = a.xxx;\n    vec3 k = a.zxz, q = s / 2.2, g = q, h = 0.5 * k;\n\n    vec3 o = vec3(- 3. * iTime, .3 * pow(sin(3. * iTime), 4.), 0);\n    vec3 p = o, w = n(vec3(-9e6, 2,0) -o), u = n(cross(w, k));\n    vec3 uv = vec3((v + v - r.xy) / r.y, 1);\n    mat3 cam = mat3(u, n(cross(u, w)), w);\n    vec3 rd = n(cam * uv);\n    \n    float d, t;\n    for(int i = 0; i++ < 99\n         && t < 99.\n         && e < (d = sdf(p, rd));\n            p = o + rd * t)\n            t += d;\n\n    vec3 nm = n(b(a.xyy) + b(a.yyx) + b(a.yxy) + b(s));\n\n    c = mix(vec4(1,.2,0,1), vec4(0,1,.2,1), uv.y) + pow(length(p.yz - vec2(4, 0)), -.15);\n    c = mix(c, vec4(clamp(pow(mix(vec3(1,.8,0), n(vec3(.3,.5,.3)), nm.y)\n                                  + max(0., dot(rd, nm))\n                                  * exp(-.01 * t * t)\n                                  , g), 0., 1.), 1), clamp(.5 - t / 6e1, -.2, 1.));\n}","name":"Image","description":"","type":"image"}]}