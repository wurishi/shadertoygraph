{"ver":"0.1","info":{"id":"MlyXzt","date":"1485408484","viewed":387,"name":"Simple Water Surface","username":"OmskCrow","description":"Water surface with diffuse and specular lighting","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["simple","water"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    //скорость течения\n    const float flowSpeed = 1.0;\n    \n    const float surfaceStrength = 64.0;\n    const float scale1 = 0.7;\n    const float scale2 = 0.5;\n    const vec2 offset1 = vec2(0.15,0.1);\n\tconst vec2 offset2 = vec2(0.1,0.11);\n    const vec3 lightPos = vec3(1.0, 1.0, 0.5);\n    const vec3 viewDirection = vec3(0.0,0.0,1.0);\n    const float specPow = 90.0;\n    const vec3 waterColor = vec3(0.1, 0.4, 0.7);\n    const vec3 lightColor = vec3(1.0, 1.0, 1.0);\n    \n\tvec2 screenCoord = (fragCoord - iResolution.xy*0.5)/iResolution.y;\n    \n    float sample = (texture(iChannel0, screenCoord / scale1 + iTime * offset1 * flowSpeed).x \n                  + texture(iChannel0, screenCoord / scale2 + iTime * offset2 * flowSpeed).x) *0.5;\n    \n    vec3 normal = normalize(vec3(dFdx(sample)*surfaceStrength, dFdy(sample)*surfaceStrength, 1.0)) * 0.5 + 0.5;\n \n    vec3 n = normalize(normal);\n    vec3 l = normalize(lightPos);\n    vec3 v = normalize(viewDirection);\n    float diffuse = max(0.0, dot(l,n));\n    float specular = pow(max(0.0, dot(v, reflect(-l, n))), specPow);\n\n\tfragColor.xyz = waterColor * diffuse + lightColor * specular;\n\tfragColor.w = 1.0;\n}","name":"Image","description":"","type":"image"}]}