{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"XdfGRn","filepath":"/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"// Using a sobel filter to create a normal map and then applying simple lighting.\n\n// This makes the darker areas less bumpy but I like it\n#define USE_LINEAR_FOR_BUMPMAP\n\n//#define SHOW_NORMAL_MAP\n//#define SHOW_ALBEDO\n\nstruct C_Sample\n{\n\tvec3 vAlbedo;\n\tvec3 vNormal;\n};\n\t\nC_Sample SampleMaterial(const in vec2 vUV, sampler2D sampler,  const in vec2 vTextureSize, const in float fNormalScale)\n{\n\tC_Sample result;\n\t\n\tvec2 vInvTextureSize = vec2(1.0) / vTextureSize;\n\t\n\tvec3 cSampleNegXNegY = texture(sampler, vUV + (vec2(-1.0, -1.0)) * vInvTextureSize.xy).rgb;\n\tvec3 cSampleZerXNegY = texture(sampler, vUV + (vec2( 0.0, -1.0)) * vInvTextureSize.xy).rgb;\n\tvec3 cSamplePosXNegY = texture(sampler, vUV + (vec2( 1.0, -1.0)) * vInvTextureSize.xy).rgb;\n\t\n\tvec3 cSampleNegXZerY = texture(sampler, vUV + (vec2(-1.0, 0.0)) * vInvTextureSize.xy).rgb;\n\tvec3 cSampleZerXZerY = texture(sampler, vUV + (vec2( 0.0, 0.0)) * vInvTextureSize.xy).rgb;\n\tvec3 cSamplePosXZerY = texture(sampler, vUV + (vec2( 1.0, 0.0)) * vInvTextureSize.xy).rgb;\n\t\n\tvec3 cSampleNegXPosY = texture(sampler, vUV + (vec2(-1.0,  1.0)) * vInvTextureSize.xy).rgb;\n\tvec3 cSampleZerXPosY = texture(sampler, vUV + (vec2( 0.0,  1.0)) * vInvTextureSize.xy).rgb;\n\tvec3 cSamplePosXPosY = texture(sampler, vUV + (vec2( 1.0,  1.0)) * vInvTextureSize.xy).rgb;\n\n\t// convert to linear\t\n\tvec3 cLSampleNegXNegY = cSampleNegXNegY * cSampleNegXNegY;\n\tvec3 cLSampleZerXNegY = cSampleZerXNegY * cSampleZerXNegY;\n\tvec3 cLSamplePosXNegY = cSamplePosXNegY * cSamplePosXNegY;\n\n\tvec3 cLSampleNegXZerY = cSampleNegXZerY * cSampleNegXZerY;\n\tvec3 cLSampleZerXZerY = cSampleZerXZerY * cSampleZerXZerY;\n\tvec3 cLSamplePosXZerY = cSamplePosXZerY * cSamplePosXZerY;\n\n\tvec3 cLSampleNegXPosY = cSampleNegXPosY * cSampleNegXPosY;\n\tvec3 cLSampleZerXPosY = cSampleZerXPosY * cSampleZerXPosY;\n\tvec3 cLSamplePosXPosY = cSamplePosXPosY * cSamplePosXPosY;\n\n\t// Average samples to get albdeo colour\n\tresult.vAlbedo = ( cLSampleNegXNegY + cLSampleZerXNegY + cLSamplePosXNegY \n\t\t    \t     + cLSampleNegXZerY + cLSampleZerXZerY + cLSamplePosXZerY\n\t\t    \t     + cLSampleNegXPosY + cLSampleZerXPosY + cLSamplePosXPosY ) / 9.0;\t\n\t\n\tvec3 vScale = vec3(0.3333);\n\t\n\t#ifdef USE_LINEAR_FOR_BUMPMAP\n\t\t\n\t\tfloat fSampleNegXNegY = dot(cLSampleNegXNegY, vScale);\n\t\tfloat fSampleZerXNegY = dot(cLSampleZerXNegY, vScale);\n\t\tfloat fSamplePosXNegY = dot(cLSamplePosXNegY, vScale);\n\t\t\n\t\tfloat fSampleNegXZerY = dot(cLSampleNegXZerY, vScale);\n\t\tfloat fSampleZerXZerY = dot(cLSampleZerXZerY, vScale);\n\t\tfloat fSamplePosXZerY = dot(cLSamplePosXZerY, vScale);\n\t\t\n\t\tfloat fSampleNegXPosY = dot(cLSampleNegXPosY, vScale);\n\t\tfloat fSampleZerXPosY = dot(cLSampleZerXPosY, vScale);\n\t\tfloat fSamplePosXPosY = dot(cLSamplePosXPosY, vScale);\n\t\n\t#else\n\t\n\t\tfloat fSampleNegXNegY = dot(cSampleNegXNegY, vScale);\n\t\tfloat fSampleZerXNegY = dot(cSampleZerXNegY, vScale);\n\t\tfloat fSamplePosXNegY = dot(cSamplePosXNegY, vScale);\n\t\t\n\t\tfloat fSampleNegXZerY = dot(cSampleNegXZerY, vScale);\n\t\tfloat fSampleZerXZerY = dot(cSampleZerXZerY, vScale);\n\t\tfloat fSamplePosXZerY = dot(cSamplePosXZerY, vScale);\n\t\t\n\t\tfloat fSampleNegXPosY = dot(cSampleNegXPosY, vScale);\n\t\tfloat fSampleZerXPosY = dot(cSampleZerXPosY, vScale);\n\t\tfloat fSamplePosXPosY = dot(cSamplePosXPosY, vScale);\t\n\t\n\t#endif\n\t\n\t// Sobel operator - http://en.wikipedia.org/wiki/Sobel_operator\n\t\n\tvec2 vEdge;\n\tvEdge.x = (fSampleNegXNegY - fSamplePosXNegY) * 0.25 \n\t\t\t+ (fSampleNegXZerY - fSamplePosXZerY) * 0.5\n\t\t\t+ (fSampleNegXPosY - fSamplePosXPosY) * 0.25;\n\n\tvEdge.y = (fSampleNegXNegY - fSampleNegXPosY) * 0.25 \n\t\t\t+ (fSampleZerXNegY - fSampleZerXPosY) * 0.5\n\t\t\t+ (fSamplePosXNegY - fSamplePosXPosY) * 0.25;\n\n\tresult.vNormal = normalize(vec3(vEdge * fNormalScale, 1.0));\t\n\t\n\treturn result;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\t\n\tvec2 vUV = fragCoord.xy / iResolution.xy;\n\t\n\tC_Sample materialSample;\n\t\t\n\tfloat fNormalScale = 10.0;\n\tmaterialSample = SampleMaterial( vUV, iChannel0, iChannelResolution[0].xy, fNormalScale );\n\t\n\t// Random Lighting...\n\t\n\tfloat fLightHeight = 0.2;\n\tfloat fViewHeight = 2.0;\n\t\n\tvec3 vSurfacePos = vec3(vUV, 0.0);\n\t\n\tvec3 vViewPos = vec3(0.5, 0.5, fViewHeight);\n\t\t\t\n\tvec3 vLightPos = vec3( vec2(sin(iTime),cos(iTime)) * 0.25 + 0.5 , fLightHeight);\n\t\t\n\tif( iMouse.z > 0.0 )\n\t{\n\t\tvLightPos = vec3(iMouse.xy / iResolution.xy, fLightHeight);\n\t}\n\t\n\tvec3 vDirToView = normalize( vViewPos - vSurfacePos );\n\tvec3 vDirToLight = normalize( vLightPos - vSurfacePos );\n\t\t\n\tfloat fNDotL = clamp( dot(materialSample.vNormal, vDirToLight), 0.0, 1.0);\n\tfloat fDiffuse = fNDotL;\n\t\n\tvec3 vHalf = normalize( vDirToView + vDirToLight );\n\tfloat fNDotH = clamp( dot(materialSample.vNormal, vHalf), 0.0, 1.0);\n\tfloat fSpec = pow(fNDotH, 10.0) * fNDotL * 0.5;\n\t\n\tvec3 vResult = materialSample.vAlbedo * fDiffuse + fSpec;\n\t\n\tvResult = sqrt(vResult);\n\t\n\t#ifdef SHOW_NORMAL_MAP\n\tvResult = materialSample.vNormal * 0.5 + 0.5;\n\t#endif\n\t\n\t#ifdef SHOW_ALBEDO\n\tvResult = sqrt(materialSample.vAlbedo);\n\t#endif\n\t\n\tfragColor = vec4(vResult,1.0);\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XdlGz8","date":"1362566218","viewed":4610,"name":"Emboss","username":"P_Malin","description":"Using a sobel filter to create a normal map and then applying simple lighting.\nClick mouse to move light.","likes":72,"published":1,"flags":0,"usePreview":1,"tags":["2d","sobel","postprocessing"],"hasliked":0,"parentid":"","parentname":""}}