{"ver":"0.1","info":{"id":"Md2fRh","date":"1499533256","viewed":133,"name":"revision 2017 livecoding plan","username":"lovelyH","description":"here is shader that I was planing to show on revision 2017 livecoding (except for few tricks to make it compile in webbrowser).\nUnfortunately there were some technical problems + I stress out","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["livecoding"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n#define fGlobalTime iTime\n\n/// float iTime;\n/// vec2 iResolution;\n/// sampler2D textures[];\n/// vec3 iCam;\n/// float iCamRZ;\n/// float iCamRX;\n\n#define E 0.01\n\n\nvec2 rot( vec2 p, float l){\n\tfloat sl=sin(l),cl=cos(l);\n\treturn vec2(\n\t\tcl*p.x-sl*p.y,\n\t\tsl*p.x+cl*p.y\n\t\t);\n}\n\nint matId= 0;\n\n\nfloat map(vec3 ap){\n\tvec3 p= ap;\n\tfloat r,rc,h,wi=2.0;\n\n\tmatId= 1;\n\tr= 2.1 - length(p.xz);\n\n\trc= length(p.xz-vec2(0,wi))-0.1;\n\tif( rc < r ){r= rc; matId= 2; }\n\n\tp= ap;\n\tp.y= mod( p.y, 1.0) - 0.5;\n\trc= length( vec2( length( p.xz)-wi, p.y ) )-0.1;\n\trc= max( rc, wi-length(p.xz-vec2(0,-0.1*wi)));\n\tif( rc < r ){r= rc; matId= 2; }\n\n\tp= ap;\n\trc= p.z + 1.0 - 0.4*sin(.2*fGlobalTime );\n\tif( rc < r ){r= rc; matId= 3; }\n\n\tp= ap;\n\tp.y= mod( p.y, 32.0 ) - 16.0;\n\th= mod( fGlobalTime, 4.0 ) - 2.0;\n\tp.z -= 0.5 + min( 6.0*h, -h );\n\tp.x= abs(abs(abs(p.x)-1.0)-0.5)-0.25;\n\tp.y= abs(abs(abs(p.y)-1.0)-0.5)-0.25;\n\trc= rot( vec2( length(p.xy), p.z ), 0.47*3.14 ).y;\n\tif( rc < r ){r= rc; matId= 2; }\n\n\tfor( float a=-2.0;a<4.0;a++){\n\t\tp= ap;\n\t\tp.xz= rot( p.xz, a );\n\t\tp.y -= -13.0*(fGlobalTime+a);\n\t\tp.z -= 1.0;\n\t\tp.y= mod( p.y, 100.0 + 23.0*a ) - 50.0;\n\t\trc= length(p)-0.15;\n\t\tif( rc < r ){r= rc; matId= 3; }\n\t}\n\n\treturn r;\n}\n\n\n\nvec3 render( vec3 sp, vec3 dir ){\n\tvec3 r= vec3(0);\n\tfloat power= 1.0;\n\tfloat disTotal= 0.0;\n\tfor( int i=0;i<2;i++){\n\t\tvec3 p= sp;\n\t\tfloat dis= map(p);\n\t\tdisTotal += dis;\n\t\tbool isHit = true;\n\n\t\tfor(int a=0;a<0x40;a++){\n\t\t\tp += dis * dir;\n\t\t\tdis= map(p);\n\t\t\tdisTotal += dis;\n\t\t\tif( 30.0 < disTotal ){isHit= false; break;}\n\t\t\tif( dis < E ){isHit= true; break;}\n\t\t}\n\n\t\tif( isHit ){\n\t\t\tvec3 c= vec3(1);\n\t\t\tfloat power2=0.0;\n\n            /// is there no switch on shadertoy.com ?\n\t\t\tif(matId==1){\n\t\t\t\tc= vec3(.7,.5,.1);\n\t\t\t\tvec3 ph= p;\n\t\t\t\tph.yz= rot(p.yz,0.1*3.14);\n\t\t\t\tph= mod( ph, 0.5 ) - 0.25;\n\t\t\t\tif( length(ph) < .2 )c *= 0.3;\n            }else if(matId==2){\n\t\t\t\tc= vec3(.9);\n            }else if(matId==3){\n\t\t\t\tc= vec3(.9,.1,.1); power2= 0.3;\n            }\n\n\t\t\tvec3 nor= normalize( vec3(\n\t\t\t\tmap(vec3(p.x+E,p.y,p.z))-map(vec3(p.x-E,p.y,p.z)),\n\t\t\t\tmap(vec3(p.x,p.y+E,p.z))-map(vec3(p.x,p.y-E,p.z)),\n\t\t\t\tmap(vec3(p.x,p.y,p.z+E))-map(vec3(p.x,p.y,p.z-E))\n\t\t\t\t));\n\n\t\t\tfloat cs= 1.0;\n            {\n                float a=4.0;\n\t\t\t\t//for( float a=4.0;a<16.0;a*=2.0)\n                for(int jj=0;jj<2;jj++)\n                {\n                    a *= 2.0;\n                    float s= a*0.01;\n                    cs= clamp( min(cs,map(p+nor*s)/s), 0.0, 1.0);\n                }\n            }\n\n\t\t\tr += power * c\n\t\t\t\t* clamp( 1.0-disTotal/30.0, 0.0, 1.0)\n\t\t\t\t* (0.5+0.5*dot(nor,-dir))\n\t\t\t\t* (0.8+0.2*dot(nor,vec3(0,0,1)))\n\t\t\t\t* (0.5+0.5*cs)\n\t\t\t;\n\n\t\t\tpower= power2;\n\t\t\tdir= reflect( dir, nor );\n\t\t\tsp= p + 4.0*E*dir;\n\t\t\tif( power < 0.01 )return r;\n\t\t}else{\n\t\t\treturn r;\n\t\t}\n\t}\n\treturn r;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv= 2.0 * fragCoord / iResolution.xy - vec2(1.0,1.0);\n\tuv.x *= iResolution.x / iResolution.y;\n\n\tvec3 dir= normalize( vec3( uv.x, 4, uv.y ) );\n\tdir.xy= rot( dir.xy, 0.2*sin(iTime*0.2));\n\tdir.xz= rot( dir.xz, ((iTime-4.0)*0.1) );\n\n\tfragColor = vec4( render(vec3(0,-fGlobalTime,0), dir), 1.0);\n}\n\n","name":"Image","description":"","type":"image"}]}