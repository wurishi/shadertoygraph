{"ver":"0.1","info":{"id":"4ftyz2","date":"1730904120","viewed":52,"name":"Mac OSX Safari side effects bug","username":"Jimbly","description":"On Mac OSX Safari (since circa early/mid 2024), the subsequent calls to rand() in will all return the same value instead of a different value per channel.\n\nExpected result: colored noise\nMacOS Safari result: greyscale noise\n\nSee code workarounds.","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["bug","safari"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float rnd_amount = 0.123;\nfloat rand(float co) {\n   co *= rnd_amount;\n   rnd_amount += 0.001;\n   return fract(sin(co*(91.3458)) * 47453.5453);\n}\n\nfloat rnd_amount2 = 0.123;\nfloat rand2(float co) {\n   co *= rnd_amount2;\n   return fract(sin(co*(91.3458)) * 47453.5453);\n}\n\nfloat rnd_amount3 = 0.123;\nfloat rand3(float co) {\n   co *= rnd_amount3;\n   rnd_amount3 += 0.001;\n   return fract(sin(co*(91.3458)) * 47453.5453);\n}\n\nfloat glob = -1.;\nfloat foo() {\n  glob += 1.;\n  return glob;\n}\n\nvoid mainImage( out vec4 ret, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/vec2(630.,354.);\n    float seed = uv.x + uv.y * 777.;\n    ret = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // On Mac OSX Safari (since circa early/mid 2024), the subsequent calls to rand()\n    // will all return the same value.\n    ret.rgb = vec3(rand(seed), rand(seed), rand(seed));\n\n    // Super simple example - should be green\n    if (false) {\n      ret.r = foo(); // 0\n      ret.g = foo(); // 1\n      ret.b = 0.;\n    }\n\n    // Workaround #1 on MacOS Safari, move modification up:\n    if (false) {\n      float r = rand2(seed);\n      rnd_amount2 += 0.001;\n      float g = rand2(seed);\n      rnd_amount2 += 0.001;\n      float b = rand2(seed);\n      rnd_amount2 += 0.001;\n      ret = vec4(r, g, b, 1.0);\n    }\n\n    // Workaround #2 on MacOS Safari, make any modification to the global in this scope:\n    if (false) {\n      rnd_amount3 = 0.123;\n      ret = vec4(rand3(seed), rand3(seed), rand3(seed), 1.0);\n    }\n}","name":"Image","description":"","type":"image"}]}