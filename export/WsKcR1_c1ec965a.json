{"ver":"0.1","info":{"id":"WsKcR1","date":"1602236978","viewed":166,"name":"Omnidirectional defense","username":"gaz","description":"3d","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["bokhe"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI acos(-1.)\n#define pmod(p,n) (length(p)*sin(vec2(0,PI*.5)+mod(atan(p.x,p.y),PI*2./n)-PI/n))\n\nmat3 lookat(vec3 eye, vec3 target, vec3 up){\n    vec3 w=normalize(target-eye), u=normalize(cross(w,up));\n    return mat3(u,cross(u,w),w);\n}\n\nvoid rot(inout vec3 p,vec3 a,float t){\n\ta=normalize(a);\n\tvec3 u=cross(a,p),v=cross(u,a);\n\tp=u*cos(t)+v*sin(t)+a*dot(p,a);   \n}\n\nfloat lpNorm(vec2 p, float n){\n\tp = pow(abs(p), vec2(n));\n\treturn pow(p.x+p.y, 1./n);\n}\n\nfloat map(vec3 p){\n\trot(p,vec3(1,6,-3),iTime*.3);\n\trot(p,vec3(5,2,3),iTime*.5);\n    p=abs(p);\n    if(p.x<p.z)p.xz=p.zx;\n\tif(p.y<p.z)p.yz=p.zy;\n \tif(p.x<p.y)p.xy=p.yx;\n \tvec3 nor=normalize(vec3(int(iTime*2.0)%3+3,int(iTime*1.5)%2+2,int(iTime*2.5)%3));\n \tfloat x=dot(p,nor)-.1*fract(sin(iTime+.3*sin(.5*iTime))*2.-1.3);\n \tfloat y=length(cross(p,nor));\n \treturn min(\n        length(vec2(x-clamp(x,.85,2.),y))-.1*mix(1.5,-.5,pow(max(0.,x-.8),2.)),\n \t\tlpNorm(vec2(x-1.,y-.16),5.)-.07\n    );\n}\n\nvec3 calcNormal(vec3 p){\n  vec3 n=vec3(0);\n  for(int i=0; i<4; i++){\n    vec3 e=.001*(vec3(9>>i&1, i>>1&1, i&1)*2.-1.);\n    n+=e*map(p+e);\n  }\n  return normalize(n);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 p=(2.*fragCoord-iResolution.xy)/iResolution.y;\n    vec3 bg=vec3(1,1.5,1.8)*.7;\n    vec3 ro0=vec3(0,0,3.5);\n    vec3 ta=vec3(.1,.05,0);\n    vec3 rd0=normalize(vec3(p,2.));\n    vec3 sv=normalize(cross(ta-ro0,vec3(0,1,0)))*.04;\n    float b=6.;  \n\tfor (float j=0.; j<b; j++){\n        vec3 ro = ro0+sv;\n        vec3 rd = lookat(ro,ta,vec3(0,1,0)) * rd0;\n\t\tfloat z = 0., d, i, ITR=70.;\n \t\tfor( i = 0.; i < ITR; i++){\n    \t\tz += d = map(ro + rd * z);\n    \t\tif(d < .001 || z > 30.) break;\n  \t\t}\n    \tif(d < .001){\n\t  \t\tvec3 p = ro + rd * z;\n\t \t\tvec3 nor = calcNormal(p);\n    \t\tvec3 li = normalize(vec3(1));\n        \tvec3 col = vec3(.7,.9,.8)*.9;\n        \tcol *= pow(1.-i/ITR,2.); \n       \t \tcol *= clamp(dot(nor,li),.3,.8);\n        \tcol *= max(.5+.5*nor.y,0.);\n            float rimd = pow(clamp(1.-dot(reflect(-li,nor),-rd),0.,1.),2.5);\n\t\t    float frn = rimd+2.2*(1.0-rimd);\n    \t    col *= frn*.8;\n        \tcol += pow(clamp(dot(reflect(normalize(p-ro),nor),li),0.,1.),30.);\n        \tcol *= exp(-z*z*0.08);\n         \tcol = min(vec3(1),col*2.);\n        \tbg += col;\n    \t}\n        rot(sv, normalize(ta-ro0), PI*2./b);\n\t}\n    bg = clamp(bg/b,0.,1.);\n    fragColor.xyz = pow(bg,vec3(1.5));\n}","name":"Image","description":"","type":"image"}]}