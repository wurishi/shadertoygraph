{"ver":"0.1","info":{"id":"WdtyDM","date":"1605181239","viewed":95,"name":"learn(3)","username":"saltlemon","description":"3d_learn\nlearn from: https://www.youtube.com/channel/UCcAlTqd9zID6aNX3TzwxJXg The Art of Code","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["3d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"struct ray{\n    vec3 o,d;\n};\nfloat N(float n){\n return fract(sin(2385.*n)*5812.);   \n}\nvec4 N14(float t){\n return fract(sin(t*vec4(2385.,586.,3258.,747.))*vec4(5893.,3256.,234.,5812.));   \n}\nray getRay(vec2 uv,vec3 camPos,vec3 lookat,float zoom){\n    ray a;\n    a.o=camPos;\n    vec3 f=normalize(lookat-a.o);\n    vec3 r=cross(vec3(0.,1.,0.),f);\n    vec3 u=cross(f,r);\n    vec3 c=a.o+zoom*f;\n    vec3 i=c+uv.x*r+uv.y*u;\n    a.d=normalize(i-a.o);\n    return a;\n}\nfloat dis(ray r,vec3 p){\n     vec3 ro=r.o;\n     vec3 rd=r.d;\n     return length(cross(p-ro,rd))/length(rd);   \n}\nfloat Bokeh(ray r,vec3 center,float raduis,float blur)\n{\n\n    float d=dis(r,center);\n    raduis *=length(center);\n    float sphere=smoothstep(raduis,raduis*(1.-blur),d);\n    sphere*=mix(.6,1.,smoothstep(raduis*.8,raduis,d));\n    return sphere;\n}\nvec3 strightLight(ray r,float t,vec3 color){\n    float side=step(r.d.x,0.);\n    r.d.x=abs(r.d.x);\n    \n    float d=0.;\n    for(float i=0.;i<1.;i+=.1){\n        float ti=fract(t+i+side*0.05);\n        d+=Bokeh(r,vec3(2.,2.,100.-100.*ti),.05,.1)*ti*ti*ti;\n    }\n    vec3 col=d*color;\n    return col;\n}\nvec3 headLight(ray r,float t,vec3 color){\n    t*=2.;\n    float w1=.25;\n    float w2=w1*1.2;\n    float d=0.;\n    float s=1./30.;\n    for(float i=0.;i<1.;i+=s){\n        if(N(i)>.1)continue;\n        float ti=fract(t+i);\n        float z= 100.-ti*100.;\n        float fade=ti*ti*ti*ti*ti;\n        float focus=smoothstep(.9,1.,ti);\n        \n        float size=mix(.05,.03,focus);\n        d+=Bokeh(r,vec3(-1.-w1,.15,z),size,.1)*fade;\n        d+=Bokeh(r,vec3(-1.+w1,.15,z),size,.1)*fade;\n        d+=Bokeh(r,vec3(-1.-w2,.15,z),size,.1)*fade;\n        d+=Bokeh(r,vec3(-1.+w2,.15,z),size,.1)*fade;\n        float ref=0.;\n        ref+=Bokeh(r,vec3(-1.-w2,-.15,z),size*3.,1.)*fade;\n        ref+=Bokeh(r,vec3(-1.+w2,-.15,z),size*3.,1.)*fade;\n       \n        d+=ref*focus;\n        \n        \n    }\n    vec3 col=d*color;\n    return col;\n}\nvec3 tailLight(ray r,float t,vec3 color){\n    t*=.25;\n    float w1=.25;\n    float w2=w1*1.2;\n    float d=0.;\n    float s=1./15.;\n    for(float i=0.;i<1.;i+=s){\n        float n=N(i);\n        if(n>.5)continue;\n        float lane=step(0.25,n);\n        float ti=fract(t+i);\n        float z= 100.-ti*100.;\n        float fade=ti*ti*ti*ti*ti;\n        float focus=smoothstep(.9,1.,ti);\n        \n        float laneshift=smoothstep(1.,.96,ti);\n        float blink=step(0.,sin(t*1000.))*7.*lane*step(.96,ti);\n        float size=mix(.05,.03,focus);\n        float x=1.5-lane*laneshift;\n        d+=Bokeh(r,vec3(x-w1,.15,z),size,.1)*fade;\n        d+=Bokeh(r,vec3(x+w1,.15,z),size,.1)*fade;\n        d+=Bokeh(r,vec3(x-w2,.15,z),size,.1)*fade;\n        d+=Bokeh(r,vec3(x+w2,.15,z),size,.1)*fade*(1.+blink);\n        float ref=0.;\n        ref+=Bokeh(r,vec3(x-w2,-.15,z),size*3.,1.)*fade;\n        ref+=Bokeh(r,vec3(x+w2,-.15,z),size*3.,1.)*fade*(1.+blink*.1);\n       \n        d+=ref*focus;\n        \n        \n    }\n    vec3 col=d*color;\n    return col;\n}\nvec3 envLight(ray r,float t,vec3 color){\n    float side=step(r.d.x,0.);\n    r.d.x=abs(r.d.x);\n    \n    vec3 col=vec3(0.);\n    for(float i=0.;i<1.;i+=.1){\n        float ti=fract(t+i+side*0.05);\n        \n        vec4 n=N14(i+side*123.);\n        float x=mix(2.5,10.,n.x);\n        float y=mix(.1,1.5,n.y);\n        float fade=sin(ti*3.14*20.*n.x)*0.5+0.5;\n        vec3 p=vec3(x,y,50.-50.*ti);\n        col+=Bokeh(r,p,.05,.1)*fade*n.wzy*.5;\n    }\n\n    return col;\n}\nvec2 rain(vec2 uv,float t){\n    t*=40.;\n    \n    \n    \n    vec2 a=vec2(3.,1.);\n    vec2 suv=uv*a;\n    \n    vec2 id = floor(suv);\n    suv.y+=t*.22;\n    float n=fract(sin(id.x*123.98)*965.25);\n    suv.y+=n;\n    uv.y+=n;\n    vec2 st=fract(suv)-.5;\n    \n    id = floor(suv);\n    t+=fract(sin(id.x*155.48+id.y*215.32)*9695.25)*7.576;\n    float y=-sin(t+sin(t+sin(t)*.5))*.43;\n    vec2 p1=vec2(0.,y);\n    vec2 o1=(st-p1)/a;\n    float d=length(o1);\n    float m1=smoothstep(.07,.0,d);\n   \n    vec2 o2=(fract(uv*a.x*vec2(1.,2.))-.5)/vec2(1.,2.);\n    d=length(o2);\n    float m2=smoothstep(.3*(.5-st.y),.0,d)*smoothstep(-.1,.1,st.y-p1.y);\n    //if(st.x>.46||st.y>.49) m1=1.;\n    return vec2(m1*o1*30.+m2*o2*10.);   \n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n\tuv-=.5;\n    uv.x*=iResolution.x/iResolution.y;\n    // Time varying pixel color\n   \n    vec2 m=iMouse.xy/iResolution.xy;\n    float t=iTime*.05+m.x;\n   \tvec3 camPos=vec3(0.5,.2,0.);\n    vec3 lookat=vec3(0.5,.2,1.);\n    vec2 rainDistort=rain(uv*5.,t)*.5;\n    rainDistort+=rain(uv*7.,t)*.5;\n    uv.x+=sin(uv.y*70.)*0.002;\n    uv.y+=sin(uv.x*170.)*0.0015;\n    ray r=getRay(uv-rainDistort*.5,camPos,lookat,2.);\n    \n    vec3 col=strightLight(r,t,vec3(1.,.7,.3));\n    col+=headLight(r,t,vec3(.9,.9,1.));\n    col+=tailLight(r,t,vec3(1.,.1,.03));\n    col+=envLight(r,t,vec3(0.,0.,0.));\n    col+=(r.d.y+.25)*vec3(.2,.1,.5);\n    \n    //col=vec3(rainDistort,0.);\n    fragColor = vec4(col,1.);\n}","name":"Image","description":"","type":"image"}]}