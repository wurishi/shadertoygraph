{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[{"channel":0,"type":"texture","id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define LightDir normalize(vec3(1.,.5,0.))\n#define Height .1\n#define WaterLevel .02\n#define res .001\n\nfloat terrain(vec2 p) {\n\tp*=.15;\n\tfloat h=0.;\n\th+=texture(iChannel0,p).g;\n\th+=texture(iChannel0,p*3.+.2568).r*.5;\n\th+=texture(iChannel0,p*8.+.1257).r*.25;\n\th+=texture(iChannel0,p*12.+.6542).r*.15;\n\th*=Height;\n\treturn h;\n}\nvec3 normal(vec2 p) {\n\tvec2 eps=vec2(0,res*.5);\n\tfloat d1=terrain(p+eps.xy)-terrain(p-eps.xy);\n\tfloat d2=terrain(p+eps.yx)-terrain(p-eps.yx);\n\tvec3 n1=(vec3(0.,eps.y*2.,d1));\n\tvec3 n2=(vec3(eps.y*2.,0.,d2));\n\treturn normalize(cross(n1,n2));\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 m=iMouse.xy/iResolution.xy;\n\tif (m.y<.001) m.y=.5;\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\tvec2 p2=vec2(0.);\n\tfloat terr=0.;\n\tfloat t=(iTime+5.)*.1;\n\tfloat wl=0.;\n\tfor (int l=0; l<200; l++) {\n\t\tfloat scan=uv.y-float(l)*res;\n\t\tfloat persp=(1.-(1.-scan)*.4);\n\t\tvec2 p=vec2((uv.x-.5)*persp*2.,scan*2.)+vec2(t+m.x*6.,-7.6);\n\t\tfloat h=terrain(p)/persp;\n\t\tif (scan+h>uv.y) {p2=p;terr=h*persp;wl=(WaterLevel-(.5-m.y)*.07)/persp;}\n\t}\n\tvec3 n=normal(p2);\n\tfloat gr=pow(max(0.,dot(n,normalize(vec3(0.,0.,-1.)))),4.);\n\tfloat nterr=pow(clamp(terr/Height,0.,.97),2.);\n\tvec3 col=vec3(nterr,nterr*nterr,nterr*nterr*nterr)+vec3(.0,-.1,-.3);\n\tcol=mix(col,vec3(gr*gr,gr*1.2,gr*gr*gr)*1.3,pow(max(0.,gr-nterr*.5),2.));\n\tcol*=max(0.,dot(n,LightDir))+.1;\n\tcol+=pow(max(0.,dot(n,LightDir)),4.)*.8;\n\tif (terr<wl) {\n\t\tcol*=vec3(1.,.8,1.);\n\t\tfloat nwl=(wl-terr)/wl;\n\t\tcol=mix(col,vec3(0.6,0.9,1.)*(1.-smoothstep(0.,.5,nwl)*.25)*.4,clamp(nwl*3.5,0.,1.));\n\t\tcol*=1.+max(0.,1.-abs(terr-wl)*100.);\n\t}\n\tcol*=1.-pow(uv.y,3.);\n\tcol=mix(col,vec3(length(col)),.55);\n\tcol=pow(col+.15,vec3(1.25));\n\tterr=max(wl,terr);\n\tcol=mix(col,vec3(.93,.9,.87),clamp(pow(uv.y,1.5)-terr*2.5,0.,1.));\n\tfragColor = vec4(col,1);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4lXGzj","date":"1423184256","viewed":658,"name":"Paisaje","username":"Kali","description":"A technique to generate a landscape based on a texture. No raymarching. Mouse enabled.","likes":16,"published":1,"flags":0,"usePreview":0,"tags":["landscape"],"hasliked":0,"parentid":"","parentname":""}}