{"ver":"0.1","info":{"id":"7lcczj","date":"1660460212","viewed":3945,"name":"[4k] Fantasy Escape","username":"NuSan","description":"\"Fantasy Escape\" by nusan and jeenio, PC 4k intro made for Evoke 2022 (3rd place)","likes":147,"published":1,"flags":64,"usePreview":0,"tags":["intro","4k","evoke"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"MtSSRm","filepath":"https://soundcloud.com/antoine-zanuttini/fantasy-escape","previewfilepath":"https://soundcloud.com/antoine-zanuttini/fantasy-escape","type":"musicstream","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":0}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// \"Fantasy Escape\" by nusan and jeenio\n// PC 4 kilobytes intro made for Evoke 2022 (3rd place)\n\n// Original Tools: Leviathan, 4klang, Shader Minifier, Crinkler\n// https://www.pouet.net/prod.php?which=91930\n// https://youtu.be/Fcug737CN1U\n\n// if sound doesn't start or seems desynchronised:\n// try clicking pause/start button in the \"soundcloud\" square in the bottom right\n// then press rewind just under the shader picture on the left\n\n// don't read the code, it was made in a hurry and it's bad :D\n\nfloat time;\n\nmat2 rot(float a) {return mat2(cos(a),sin(a),-sin(a),cos(a));}\n\nfloat beat;\nfloat beatid;\nfloat mesureid;\n\n// 26 letters + some numbers\nconst int Letters[31] = int[31](23535,31471,25166,31595,29391,4815,31310,23533,29847,13463,23277,29257,23423,23403,15214,5103,26474,23279,14798,9367,27501,12141,32621,23213,31213,29351,31727,448,5393,29671,31599);\n// Pico 8 palette\nconst vec3 Pal[16] = vec3[16](vec3(0),vec3(0.125,0.2,0.48),vec3(0.494,0.145,0.325),vec3(0,0.513,0.192),\n                              vec3(0.74,0.321,0.211),vec3(0.27),vec3(0.76,0.764,0.78),vec3(1,0.945,0.91),\n                              vec3(1,0,0.3),vec3(1,0.639,0),vec3(1,0.925,0.153),vec3(0,0.886,0.196),\n                              vec3(0.16,0.678,1),vec3(0.513,0.463,0.611),vec3(1,0.467,0.659),vec3(1,0.8,0.667));\n\nint textcolor=7;\n// print up to 6 characters encoded as an int (5 bits per character)\nvoid String6(inout vec3 col, inout vec2 uv, int val) {\n    float a = 0.;\n    uv = floor(uv);\n    for(int i=0; i<6; ++i) {\n        int cdig = int(val)%32;\n        if(cdig!=0) {\n\t\t\tvec2 mask = step(abs(uv-vec2(1.3,2.5)),vec2(1.5,2.5));\n\t\t\ta += float((Letters[cdig-1]>>int(uv.x+uv.y*3.))&1)*mask.x*mask.y;\n        }\n        uv.x -= 4.;\n        val/=32;\n    }\n    \n    if(a>.1) col=Pal[textcolor];\n}\n\nfloat rnd1(float t) {\n\treturn fract(sin(t*725.542)*314.324);\n}\n\n// display the blinking pico 8 carret\nvoid prompt(vec2 uv, inout vec3 col, float t) {\n    float carret=7.+floor(max(0.,t))*4.;\n    if(uv.x>carret && abs(uv.y)<3.) {\n        col=Pal[(uv.x>carret+4. || int(time*3.)%2==0)?0:8];\n    }\n}\n\nfloat box(vec3 p, vec3 s) {\n    p=abs(p)-s;\n    return max(p.x, max(p.y,p.z));\n}\n\n// SDF function for the 3D scene\nfloat map(vec3 p) {\n\n\tvec3 bp=p;\n\t\n\t// very simple kifs\n\tfloat s=step(54.,beatid)*(1.-max(0.,1.-abs(time-38.))*2.)+step(76.,beatid)*3.;\n    float d=999.;\n    for(int i=0; i<5; ++i) {\n\t\tp.xz *= rot(time*.3+float(i));\n\t\tp.yz *= rot(time*.2-float(i)*.3);\n        // the boxes\n        d=min(d, box(p, vec3(.3)));\n        // some cylinders\n\t\tif(beatid>69. && i==2) d=min(d, length(abs(p.xy)-1.)-.1);\n        p=abs(p)-0.5-(sin(time*3.1415/2.+2.5+step(beatid,75.)*2.)*.5+.2)*s;\n    }\n\n\t// simple box for the start\n\tif(beatid<48.) {\n\t\td=box(bp, vec3(2));\n\t\tvec3 d2=abs(abs(bp)-.75)-.1;\n\t\tif(beatid>39.) d=max(d, -min(min(d2.x, d2.y),d2.z));\n\t}\n\t\n    return d;\n}\n\nvoid cam(inout vec3 p) {\n\tfloat t=time*5.;\n\tp.xz *= rot(t*(.1+rnd1(mesureid)*.4));\n    p.yz *= rot(t*.3);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float musictime=iTime;// iChannelTime[0]; doesn't work well for some reason\n\ttime = min(musictime,106.);\n\n\tbeat=fract(time*2.);\n\tmesureid=floor(time/4.-.5*step(58.,time*2.));\n\tbeatid=floor(time*2.);\n\t\n\tvec2 uv = (fragCoord.xy/iResolution.xy-.5)*vec2(iResolution.x,-iResolution.y)/iResolution.y;\n    vec2 fuv = floor(uv * 128.);\n\n\tbool bay=true;\n\t// Wave that remove the resolution/palette pico 8 constraints\n\tfloat wave=(60.+sin(time*20.+sin(fuv.x/40.+time)*10.+fuv.x/10.)*40.);\n\tfloat ll=fract(time/4.-.5);\n\twave *= ll*max(0.,min(1.,2.-ll*4.));\n\tif(beatid>91. && abs(fuv.y)<wave+max(time-54.,0.)*(3.+cos(min(time,65.)*3.)*1.5)) {\n\t\tif(beatid<172.) fuv=uv * 128.;\n\t\tbay=false;\n\t}\n\t\n\t// outro wave\n\tif(time>78.) fuv.y+=sin(fuv.x/30.+time)*10.+sin(time)*20.-64.;\n\t// glitches\n\tif(abs(time-35.5)<3.5) fuv.x+=(rnd1(fuv.y+floor(time*15.)*.1)*20.-10.)*max(0.,sin(fuv.y/99.+3.*time));\n\n\t//////////////////////\n\n    vec3 s=vec3(0,0,-10);\n    vec3 r=normalize(vec3(fuv/128., 1));\n\tcam(s);\n\tcam(r);\n    \n    // basic raymarching\n    vec3 p=s;\n    for(int i=0; i<100; ++i) {\n        float d=map(p);\n        if(d<.001 || d>100.) break;\n        p+=r*d;\n    }\n    \n    fuv.x+=.5;\n\t// background colors\n    vec3 col=vec3(fuv*.01*rot(time),sin(time*1.+fuv.x/17.)*.5+.5);\n\tif(time>50.) col=abs(vec3(sin(uv.x+time),uv.y,0));\n\tif(beatid>75.) col=vec3(1);\n\t\t\t\n\tfloat depth=length(p-s);\n    if(depth<100.)\n    col = vec3(map(p-r)); // simplest shading\n    \n\tif(beatid>75.) {\n\t\t// palette colors in the background \n\t\tcol=pow(col,vec3(bay?2:4)) * (.7+depth/300.) * Pal[int(mesureid+(bay?9.:0.))%8+8];\n\t}\n\n\tif(bay) {\n\t\t// randomized bayern pattern\n\t\tint val = 0;\n\t\tint curdiv = 8;\n\t\tint scale = 1;\n\t\tfor(int i=0;i<4;++i) {\n\t\t\tvec2 rrr=floor(fuv/float(curdiv*2));\n\t\t\tivec2 pos = ((ivec2(abs(fuv))/curdiv)%2 + ivec2(fract(sin(rrr.xy*457.519+rrr.yx*542.517)*327.233)*2.))%2;\n\t\t\tval += int[4](0,2,3,1)[(pos.x+pos.y*2)%4] * scale;\n\t\t\tcurdiv /= 2;\n\t\t\tscale *= 4;\n\t\t}\n\t\tcol+=((float(val)/256.)*.2+.1)*step(40.,beatid);\n\t\tfloat dist=999.;\n\t\tint best=0;\n\t\t// finding closest color from the palette\n\t\tfor(int i=0;i<16; ++i) {\n\t\t\tfloat cur=length(max(col,0.)-Pal[i]);\n\t\t\tif(cur<dist) {\n\t\t\t\tdist=cur;\n\t\t\t\tbest=i;\n\t\t\t}\n\t\t}\n\t\tcol = Pal[best];\n\t}\n    \n\t\t\t\n\t//////////////////////\n\tfuv+=64.;\n    \n\tif(time>70.) col*=0.;\n\n\t// cute circles for intro/outro\n\tif(beatid<32. || beatid>171.) {\n\t\tif(beatid<32.)col=Pal[1];\n\t\tif(beatid>16.+fuv.y*.06 && beatid<32.) col=Pal[int(fuv.x/4.+(sin(fuv.y*.03+time+beatid)*10.+fuv.y/2.)*step(24.,beatid))%16];\n\t\tif(beatid>15.) {\n\t\t\tfor(float i=0.;i<15.; ++i) {\n\t\t\t\tfloat ct=i*7.37+beatid*12.7;\n\t\t\t\tvec2 pos=vec2(abs(fract(ct)-.5),abs(fract(ct*.7)-.5));\n\t\t\t\tif(beatid>23.) pos.y=pos.y*0.2+.2+sin(time*.7+i*.7)*.1-step(80.,time)*.3;\n\t\t\t\tpos=fuv-pos*212.-12.;\n\t\t\t\tfloat size=floor(rnd1(beatid+i*.1)*12.);\n\t\t\t\t// circfill\n\t\t\t\tif(length(pos)-size<0.) col=Pal[int(i)];\n\t\t\t\t// circ\n\t\t\t\tif(abs(length(pos)-size+0.1)<.5) col=Pal[7];\n\t\t\t}\n\t\t}\n\t}\n    \t\n\n\tvec2 baseuv=fuv-2.;\n    vec2 suv = baseuv;\n\t// intro\n\tif(time<7.5) {\n\t\tcol*=0.;\n\t\tvec2 suv2 = baseuv*.7;\n\t\t\n\t\tString6(col, suv2, 935824688);\n\t\tsuv.y-=16.;\n    \n\t\tif(time>1.) {\n\t\t\ttextcolor=6;\n\t\t\tString6(col, suv, 935824688);\n\t\t\tString6(col, suv, 54985920);\n\t\t\tString6(col, suv, 485589811);\n\t\t\tString6(col, suv, 176627);\n\t\t\tsuv.x=baseuv.x;\n\t\t\tsuv.y-=6.;\n\t\t\tString6(col, suv, 660013858);\n\t\t\tString6(col, suv, 336462273);\n\t\t\tString6(col, suv, 16038053);\n\t\t}\n\t\tif(time>1.2) {\n\t\t\tsuv.x=baseuv.x;\n\t\t\tsuv.y-=14.;\n\t\t\tString6(col, suv, 604160820);\n\t\t\tString6(col, suv, 16384469);\n\t\t\tString6(col, suv, 15026);\n\t\t}\n\t\tif(time>1.6) {\n\t\t\tsuv.x=baseuv.x;\n\t\t\tsuv.y-=14.;\n\n\t\t\ttextcolor=7;\n\t\t\tString6(col, suv, 15386653);\n\t\t\tbaseuv.y-=52.;\n\t\t\tprompt(baseuv, col, min(time-2.9,3.));\n\t\t}\n\t\tif(time<.8)\n\t\t{ col=Pal[abs(int(uv.x*.05+uv.y*floor(time*10.)*7.7))%16]; }\n\t\tif(time<0.4) col*=0.;\n\t}\n        \n\t// outro\n\tif(time>70.) {\n\t\tif(time<78.) {\n\t\t\ttextcolor=14;\n\t\t\tString6(col, suv, 446315186);\n\t\t\tString6(col, suv, 522785797);\n\t\t\tString6(col, suv, 18);\n\t\t\tsuv.x=baseuv.x;\n\t\t\tsuv.y-=6.;\n\t\t\ttextcolor=6;\n\t\t\tString6(col, suv, 550687361);\n\t\t\tString6(col, suv, 168284180);\n\t\t\tString6(col, suv, 136376);\n\t\t\tsuv.x=baseuv.x;\n\t\t\tsuv.y-=6.;\n\t\t\tString6(col, suv, 211437600);\n\t\t\tString6(col, suv, 12625001);\n\t\t\tString6(col, suv, 658814252);\n\t\t\tsuv.x=baseuv.x;\n\t\t\tsuv.y-=6.;\n\t\t\ttextcolor=13;\n\t\t\tString6(col, suv, 52560329);\n\t\t\tString6(col, suv, 182759447);\n\t\t\tString6(col, suv, 913248);\n\t\t\tsuv.x=baseuv.x;\n\t\t\tsuv.y-=6.;\n\t\t}\n\t\ttextcolor=7;\n\t\tString6(col, suv, 553689117);\n\t\tString6(col, suv, 385553433);\n\t\tString6(col, suv, 1039136773);\n\t\tsuv.x=baseuv.x;\n\t\tsuv.y-=2.;\n\t\tif(time<78.)\n\t\t{ prompt(suv, col, min((time-70.2)*2.2,16.)); }\n\n\t\tif(beatid>187. && abs(wave-abs(fuv.y-4.5)+6.)<2.) col = Pal[abs(int(fuv.x/4.-time*10.))%16];\n\t}\n\t\n\t// final rainbow filter on text\n\tif(time>78. && beatid<172.) col=step(.7,col.y)*Pal[abs(int(time*4.+floor((fuv.x-1.)/4.)))%8+6];\n\t\n\t// letterboxing\n\tfloat anim=max(0.,time-38.)*99.*step(time,78.);\n\tif(depth>100. || time<32. || time>78.)\n    { col *= step(-anim,fuv.x)*step(fuv.x,128.+anim); }\n\t\n\t//////////////////////\n\n    fragColor = vec4(col-max(musictime-107.,0.),1);\n}","name":"Image","description":"","type":"image"}]}