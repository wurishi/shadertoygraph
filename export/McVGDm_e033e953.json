{"ver":"0.1","info":{"id":"McVGDm","date":"1712879258","viewed":109,"name":"Maze runner","username":"ukeshet","description":"Demo for ICP course","likes":10,"published":1,"flags":32,"usePreview":1,"tags":["random","demo","maze"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Random single-solution maze. Demo for ICP course by ukeshet.\n// For documentation, see V4 (https://www.shadertoy.com/view/lfK3Rd)\n\n#define w 24\n#define wf 24.\n#define h 16\n\nvoid mainImage(out vec4 Col, in vec2 Coo)\n{\n    float fx=iResolution.x/wf, fy=iResolution.y/float(h);\n    float v=12., t=iTime;\n    vec4 s0=texelFetch(iChannel0,ivec2(1,h+1),0);\n    float pos=mod(1.+v*iTime,s0[2]+1.);\n    vec4 s1=texelFetch(iChannel0,ivec2(int(mod(pos,iResolution.x)),h+1+int(pos/iResolution.x)),0);\n    vec4 s2=texelFetch(iChannel0,ivec2(int(mod(pos+1.,iResolution.x)),h+1+int((pos+1.)/iResolution.x)),0);\n    vec4 s=mix(s1,s2,fract(pos));\n    vec4 m=texelFetch(iChannel0,ivec2(int(mod((Coo.x-.5*iResolution.x)/fx+s[0],float(w))),int(Coo.y/fy)),0);\n    Col=vec4(0.,0.,0.,1.);\n    if ( (mod(Coo.x+s[0]*fx,fx)>.8*fx) && (m[1]==0.) ) Col[1]=1.;\n    if ( (mod(Coo.y,fy)>.8*fy) && (m[0]==0.) ) Col[1]=1.;\n    if ( length(vec2((Coo.x-.5*iResolution.x)/fx-.4,(Coo.y/fy)-s[1]-.4))<.3 ) Col[0]=1.;\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"#define w 24\n#define h 16\n\nfloat hash(int seed) {\n    int p=23856097;\n    int q=seed*p;\n    q=(q^(q>>15))*(q|0x5D588B65);\n    return fract(float(q)/float(0x7FFFFFFF));\n}\n\nvoid mainImage(out vec4 Col, in vec2 Coo)\n{\n    vec4 prev=texelFetch(iChannel0, ivec2(Coo), 0);\n    if (iFrame==0) {\n        int i,k,m,tmp,per[4],M[w*h],dir,ind,go;\n        for (i=0; i<h*w; i++) {\n            per[0]=0;per[1]=1;per[2]=2;per[3]=3; // Now permute these:\n            for (k=3;k>0;k--) {m=int(hash(5*i+3*k)*float(k+1));tmp=per[k];per[k]=per[m];per[m]=tmp;}\n            M[i]=((per[0]&3)<<24)|((per[1]&3)<<26)|((per[2]&3)<<28)|((per[3]&3)<<30);\n        }\n        int x=0,y=h/2,j=0,s=1,cx=int(Coo.x),cy=int(Coo.y),shf,dx,dy,x1,y1,ind1;\n        ind=x*h+y; M[ind]|=(1<<13);Col=vec4(0.,0.,0.,1.);\n        M[ind]=(M[ind]&~(127<<0))|((x&127)<<0); M[ind]=(M[ind]&~(31<<8))|((y&31)<<8);\n        while (s<w*h) {\n            go=1; ind=x*h+y; \n            if ((y==h/2)&&(x==w-1)) {\n                go=0; x1=x; y1=y; if ((cx==x1)&&(cy==y1)) Col[1]=1.;\n                if ((cx==(j+1)%int(iResolution.x))&&(cy==h+1+(j+1)/int(iResolution.x))) {Col=vec4(float(w),float(h/2),float(j),1.);}\n                for (k=j; k>=0; k--) {\n                    if ((cx==(k%int(iResolution.x)))&&(cy==h+1+k/int(iResolution.x))) {Col=vec4(float(x1),float(y1),float(j),1.);}\n                    ind1=x1*h+y1;x1=(M[ind1]>>0)&127;y1=(M[ind1]>>8)&31;\n                }\n            }\n            if ((shf=(M[ind]>>21)&7)<4) dir=(M[ind]>>(24+2*shf))&3;\n            else go=0;\n            if (go==0) {j--;x=(M[ind]>>0)&127;y=(M[ind]>>8)&31;}\n            else {\n                dx=dy=0;M[ind]=(M[ind]&~(7<<21))|(((M[ind]>>21)&7)+1)<<21;\n                if ((dir==0)&&(y<h-1)) {if(((M[x*h+y+1]>>13)&1)==0) dy=1;}\n                else if((dir==1) && (x<w-1)) {if(((M[(x+1)*h+y]>>13)&1)==0) dx=1;}\n                else if((dir==2) && (y>0)) {if(((M[x*h+y-1]>>13)&1)==0) dy=-1;}\n                else if((dir==3) && (x>0)) {if(((M[(x-1)*h+y]>>13)&1)==0) dx=-1;}\n                if ((dx!=0)||(dy!=0)) {\n                    s++;j++;x+=dx;y+=dy;ind=x*h+y;M[ind]|=(1<<13);\n                    M[ind]=(M[ind]&int(~(127<<0)))|((x-dx)&127)|(((y-dy)&31)<<8);\n                    if ((cx==min(x,x-dx))&&(cy==min(y,y-dy))) {\n                        if (dy!=0) Col[0]=float(abs(dy));\n                        if (dx!=0) Col[1]=float(abs(dx));\n                    }\n                }\n            }\n        }\n    }\n    else Col=prev;\n}","name":"Buffer A","description":"","type":"buffer"}]}