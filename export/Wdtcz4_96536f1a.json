{"ver":"0.1","info":{"id":"Wdtcz4","date":"1605186059","viewed":70,"name":"learn(2)","username":"saltlemon","description":"smileface\nlearn from  https://www.youtube.com/channel/UCcAlTqd9zID6aNX3TzwxJXg The Art of Code","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["learn"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define s(a,b,t) smoothstep(a,b,t)\n#define sat(x)  clamp(x,0.,1.)\nfloat remap01(float a,float b,float t){\n     return sat((t-a)/(b-a));   \n}\nfloat remap(float a,float b,float c,float d,float t){\n     return sat((t-a)/(b-a))*(d-c)+c;\n}\nvec2 within(vec2 uv,vec2 left_bottom,vec2 right_top){\n \t return (uv-left_bottom)/(right_top-left_bottom);   \n}\nvec4 Eye(vec2 uv,float side,vec2 myMouse,float smile){\n    uv-=.5;\n    uv.x*=side;\n    float d=length(uv);\n    vec4 iriscol=vec4(.1,.5,1.,1.);\n    vec4 col =mix(vec4(1.),iriscol,s(0.1,.7,d)*0.5);\n    col.a=s(.5,.48,d);\n    col *=(1.-s(.45,.5,d)*.5*sat(-(uv.x*side)-uv.y));\n    \n    d=length(uv-myMouse*0.5);\n    col.rgb=mix(col.rgb,vec3(0.),s(0.3,0.28,d));\n    \n    iriscol*=(1.+s(0.3,0.05,d));\n    float irisMask=s(0.28,0.25,d);\n    col.rgb=mix(col.rgb,iriscol.rgb,irisMask);\n    \n    d=length(uv-myMouse*0.6);\n    float pupilSize=mix(0.4,0.16,smile);\n    float pupilMask=s(pupilSize,pupilSize*0.85,d);\n    pupilMask*=irisMask;\n    col.rgb=mix(col.rgb,vec3(0.),pupilMask);\n    \n    float t = iTime*3.;\n    vec2 offs = vec2(sin(t+uv.y*25.), sin(t+uv.x*25.));\n    offs *= .01*(1.-smile);\n    \n    uv += offs;\n    float highlight=s(0.1,0.08,length(uv-vec2(-.15,.15)));\n    highlight+=s(0.07,0.05,length(uv-vec2(0.08,-.08)));\n    col.rgb=mix(col.rgb,vec3(1.),highlight);\n    \n    \n    return col;\n}\nvec4 Face(vec2 uv){\n    vec4 col=vec4(.9,.65,.1,1.);\n    float d=length(uv);\n    col.a=s(0.5,0.49,d);\n    \n    float faceshade=remap01(.35,.5,d);\n    faceshade*=faceshade;\n    col.rgb*=(1.-faceshade*.5);\n    \n    col.rgb=mix(col.rgb,vec3(0.6,.3,.1),s(0.47,0.48,d));\n    \n    float highlight=s(0.41,0.405,d)*0.75;\n    highlight*=remap(-.1, .41, 0., .75, uv.y);\n    highlight*=s(0.1,0.22,length(uv-vec2(.2,.12)));\n    col.rgb=mix(col.rgb,vec3(1.),highlight);\n    \n    d=length(uv-vec2(.25,-.2));\n    float cheek=s(0.2,0.01,d)*0.4;\n    cheek*=s(0.18,0.17,d);\n    col.rgb=mix(col.rgb,vec3(1.,0.1,0.1),cheek);\n    \n    return col;\n}\nvec4 Mouth(vec2 uv,float smile){\n    uv-=.5;\n    vec4 col=vec4(.5,.18,.05,1.);\n    uv.y*=1.5;\n    uv.y -= uv.x*uv.x*2.*smile;\n    \n    uv.x *= mix(2.5, 1., smile);\n  \n    \n    vec2 tuv=uv;\n    tuv.y+=(abs(uv.x)*0.5+0.1)*(1.-smile);\n    float td=length(tuv-vec2(0.,0.6));\n    vec4 toothcol=vec4(1.)*(1.-s(0.35,0.6,td));\n    col=mix(col,toothcol,s(0.4,0.37,td));\n    \n    float d=length(uv);\n    vec4 mouthshade=vec4(1.,.5,.5,1.);\n    col=mix(col,mouthshade,s(0.5,0.1,length(uv-vec2(0.,-0.5))));\n    col.a=s(0.5,0.48,d);\n    \n    \n    return col;\n}\nvec4 Brow(vec2 uv,float smile){\n    float offset=mix(.2,0.,smile);\n    uv.y+=offset;\n    float y=uv.y;\n    uv.y += uv.x*mix(.5, .8, smile)-mix(.1, .3, smile);\n    uv.x -= mix(.0, .1, smile);\n    uv-=.5;\n    float d=length(uv);\n    vec4 col= vec4(0.);\n    \n    float blur=.1;\n    float s1=s(0.45,0.45-blur,d);\n    float s2=s(0.5,0.5-blur,length(uv-vec2(0.07,-0.14)));\n    float browMask=sat(s1-s2);\n    float highlight=remap01(.7,.8,y)*0.75;\n    highlight*=s(.7,.9,browMask);\n    highlight *= smile;\n    vec4 browCol = mix(vec4(.4, .2, .2, 1.), vec4(1., .75, .5, 1.), highlight);\n    col = mix(col, browCol, s(.2, .4, browMask));\n\n    uv.y+=.15-offset*.5;\n    blur += mix(.0, .1, smile);\n    s1=s(0.45,0.45-blur,length(uv));\n    s2=s(0.5,0.5-blur,length(uv-vec2(0.07,-0.14)));\n    float shadowMask=sat(s1-s2);\n    \n    col = mix(col, vec4(0.,0.,0.,1.), s(0., 1., shadowMask)*.5);\n    col = mix(col, browCol, s(.2, .4, browMask));//防止阴影覆盖\n    return col;\n}\nvec4 Smiley(vec2 uv,vec2 myMouse,float smile){\n    vec4 col=vec4(.0);\n    float side=sign(uv.x);\n    uv.x=abs(uv.x);\n    vec4 face=Face(uv);\n    col=mix(col,face,face.a);\n    \n    vec4 eye=Eye(within(uv,vec2(.03,-.1),vec2(.37,.25)),side,myMouse,smile);\n    col=mix(col,eye,eye.a);\n    \n    vec4 mouth=Mouth(within(uv,vec2(-.3,-.4),vec2(.3,-.1)),smile);\n    col=mix(col,mouth,mouth.a);\n    \n    vec4 brow=Brow(within(uv,vec2(.03,.2),vec2(.4,.45)),smile);\n    col=mix(col,brow,brow.a);\n    return col;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n\tuv-=0.5;\n    uv.x*=iResolution.x/iResolution.y;\n    \n    vec2 myMouse=iMouse.xy/iResolution.xy;\n    myMouse-=0.5;\n    // Time varying pixel color\n    uv-=myMouse*(0.25-dot(uv,uv));\n    float smile=0.5*sin(iTime)+0.5;\n    vec4 col = Smiley(uv,myMouse,smile);\n\n    // Output to screen\n    fragColor = col;\n}","name":"Image","description":"","type":"image"}]}