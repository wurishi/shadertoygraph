{"ver":"0.1","info":{"id":"4flcW7","date":"1721200214","viewed":30,"name":"another bilateral filter","username":"aksel","description":"more learning\n\nunfiltered on the left","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["imageprocessing","blurring"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdXGzr","filepath":"/media/a/8979352a182bde7c3c651ba2b2f4e0615de819585cc37b7175bcefbca15a6683.jpg","previewfilepath":"/media/ap/8979352a182bde7c3c651ba2b2f4e0615de819585cc37b7175bcefbca15a6683.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Based on https://en.wikipedia.org/wiki/Bilateral_filter\nvec4 bilateral(vec2 fragCoord, int d, float sigmaColor, float sigmaSpace)\n{\n    vec2 p = fragCoord / iResolution.xy;\n    vec4 I = texture(iChannel0, p);\n    \n    vec4 w  = vec4(0.0);\n    vec4 Wp = vec4(0.0); // Total weight\n    vec4 Wi = vec4(0.0); // Total weight intensities (color)\n    for (int i = -d; i < d; ++i) {\n        for (int j = -d; j < d; ++j) {\n            vec2 dp = vec2(float(i), float(j));\n            vec2 pi = (fragCoord + dp) / iResolution.xy;\n            vec4 Ipi = texture(iChannel0, pi);\n            vec4 Iw = (I-Ipi)*255.0; // Sometimes custom images want the 255.0 scalar to be removed?\n            float ss = (pow(p.x-pi.x,2.) - pow(p.y-pi.y,2.))/(2.*pow(sigmaSpace,2.));\n            vec4 sc = (Iw*Iw)/(2.*pow(sigmaColor,2.));\n            w = vec4(exp(ss - sc));\n            \n            Wi += w*Ipi;\n            Wp += w;\n        }\n    }\n    \n    vec4 ID_p = Wi/Wp; // Normalize summed weights\n    return ID_p;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{    \n    const int dimensions = 14;\n    // kernel is a square, so divide dimensions\n    const int d = dimensions/2 + 1;\n    \n    vec4 result;\n    vec2 uv = fragCoord/iResolution.xy;\n    if (uv.x<0.5) {\n        result = texture(iChannel0, uv);\n    }\n    else {\n        result = bilateral(fragCoord, d, 20.0, 15.0);\n    }\n    fragColor = result;\n}","name":"Image","description":"","type":"image"}]}