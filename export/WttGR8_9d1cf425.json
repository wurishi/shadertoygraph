{"ver":"0.1","info":{"id":"WttGR8","date":"1575589786","viewed":217,"name":"Neon kifs","username":"ad_lucem","description":"Glowing kaleidoscope","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["kifs","neon"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define R iResolution\n#define T iTime\n#define PI 3.14159265359\n#define DtR PI/180.\n\nfloat boxSDF(vec3 p, vec3 s, float r)\n{\n  vec3 q = abs(p) - s;\n  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n}\n\nfloat sphereSDF(vec3 p, float r)\n{\n  return length(p)-r;\n}\n\nmat2 rot(float a)\n{\n  float ca = cos(a); float sa = sin(a);\n  return mat2(ca, sa, -sa, ca);\n}\n\nfloat kifs(vec3 p)\n{\n  float d = 10000.;\n  p.y-=2.;\n  \n //d = boxSDF(p,vec3(1.,1.,1.),1.);\n  \n  p.y+=2.2;\n  for(int i = 0; i < 5; ++i)\n  {\n    p-=.2;\n    \n    p.xy*=rot(T*.4);\n    p.xz*=rot(T*.5);\n    p-=.4;\n    p=abs(p);\n      d = min(d, boxSDF(p,vec3(.5,.5,.5),1.));    \n  }\n \n  return d;\n}\n\nfloat map(vec3 p)\n{\n  //p = mod(p-5.,10.)-5.;\n  float s1 = kifs(p);\n  \n  return s1;\n}\n\nvec3 getNormal(vec3 p)\n{\n  vec2 e = vec2(0.001, 0);\n  return normalize(vec3(map(p+e.xyy) - map(p-e.xyy),\n                        map(p+e.yxy) - map(p-e.yxy),\n                        map(p+e.yyx) - map(p-e.yyx))) * .5 + .5;\n}\n\nvoid mainImage( out vec4 O, in vec2 U )\n{  \n  vec2 uv = (2.*U-R.xy)/R.y;\n  vec3 t = vec3(0);\n  \n  float th = 45.*DtR;\n  float ph = 1.;\n  \n  float r = 5.+sin(T*.5)*2.;\n  vec3 p = vec3(r*sin(th)*cos(ph),r*cos(th)*sin(ph),r*cos(th));\n  \n  p.xz*=rot(-T*0.3);\n  \n  vec3 cz = normalize(t-p);\n  vec3 cx = normalize(cross(cz, vec3(0,-1,0)));\n  vec3 cy = normalize(cross(cz, cx));\n  \n  vec3 dir = normalize(vec3(uv.x*cx + uv.y*cy + cz));\n  \n  float d, att;\n  for(int i = 0; i < 256; ++i)\n  {\n    d = map(p);\n    if(d <.001) break;\n    if(d > 1000.0)break;\n    p+=d*dir;\n    att+=0.2/(abs(d)+0.2);\n  }\n    \n  // shade \n  vec3 n = getNormal(p);\n  vec3 color = mix(vec3(0.), n, att*.06);\n  \n  if(d < 1000.)\n  {\n    color.rgb = n*n*vec3(.65,.52,0.61)-att*0.04;\n  }\n  \n  color = pow(color, vec3(1.3));\n  O.rgb = color;\n}","name":"Image","description":"","type":"image"}]}