{"ver":"0.1","info":{"id":"wlsXDM","date":"1569635498","viewed":1360,"name":"Waterfall flow","username":"clay","description":"Messing around trying to make a waterfall. The spray seemed to double as some kind of lighting effect that I thought looked neat so I just left it.","likes":28,"published":1,"flags":0,"usePreview":0,"tags":["noise","fbm","flow","waterfall"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sfGRn","filepath":"/media/a/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg","previewfilepath":"/media/ap/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGzn","filepath":"/media/a/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","previewfilepath":"/media/ap/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// https://www.shadertoy.com/view/XdS3RW\nvec3 screen_blend(vec3 s, vec3 d) {\n\treturn s+d - s*d;\n}\n\nfloat get_mask(vec2 uv) {\n    uv.x *= iResolution.x / iResolution.y;\n    uv.x += sign(uv.x)*uv.y*.2;\n    uv.x = abs(uv.x);\n\treturn clamp(1.-(smoothstep(0.2, .6, uv.x)), 0., 1.);\n}\n\n// https://catlikecoding.com/unity/tutorials/flow/texture-distortion/\nvec2 flow(vec2 uv, vec2 flowmap, float phase, float t, out float weight) {\n\tfloat progress = fract(t + phase);\n\tvec2 displacement = flowmap * progress;\n    weight = 1. - abs(progress*2.-1.);\n\treturn uv + displacement;\n}\n\n// https://thebookofshaders.com/13/\nfloat fbm(sampler2D sampler, vec2 p) {\n\t// Initial values\n\tfloat value = 0.;\n\tfloat amplitude = .5;\n\tfloat frequency = 1.;\n\t// Loop of octaves\n\tfor (int i = 0; i < 5; i++) {\n        value += amplitude * (texture(sampler, p*frequency).r);\n\t\tfrequency *= 2.;\n\t\tamplitude *= .5;\n\t}\n\treturn value;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    uv.x = uv.x*2.-1.;\n    \n    vec2 flowuv = uv*.03 + vec2(0., iTime*0.01);\n    float noise = fbm(iChannel0, flowuv);\n    vec2 flowmap = vec2(0., smoothstep(0.2, 1., noise)) * .006;\n\tfloat weightA, weightB;\n    float t = iTime * .8;\n    vec2 uvA = flow(flowuv, flowmap, 0.0, t, weightA);\n    vec2 uvB = flow(flowuv, flowmap, 0.5, t, weightB);\n    float flowA = fbm(iChannel0, uvA) * weightA;\n    float flowB = fbm(iChannel0, uvB) * weightB;\n    float flow = (flowA + flowB);\n    \n    float waterfall_mask = get_mask(uv);\n    float spray_mask = 1.-length(vec2(uv.x*.8, pow(uv.y, .5))*1.7);\n    uv.y += .5;\n    vec2 radial_uv = 0.01*vec2(atan(uv.x, uv.y), length(uv)) + vec2(0., -iTime*0.002);\n    float spray = fbm(iChannel0, radial_uv);\n\n    vec3 background = texture(iChannel1, uv).rgb;\n    \n    vec3 blue = vec3(0.6, .6, .9);\n    vec3 waterfall = ((1.-flow)*blue + smoothstep(0., 1.,flow)) * waterfall_mask;\n    vec3 col = mix(background, waterfall, waterfall_mask);\n    col += vec3(spray_mask*spray*(1.-waterfall_mask));\n    spray_mask = clamp(spray_mask, 0., 1.);\n    col = screen_blend(vec3(spray*spray_mask*2.5), col);\n\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}