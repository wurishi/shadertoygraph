{"ver":"0.1","info":{"id":"lsdXRl","date":"1460997021","viewed":244,"name":"cylindrical image mapping","username":"bimbochobot","description":"wraping image into clindrical panorama","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["panoramacylinder"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sXGRn","filepath":"/media/a/95b90082f799f48677b4f206d856ad572f1d178c676269eac6347631d4447258.jpg","previewfilepath":"/media/ap/95b90082f799f48677b4f206d856ad572f1d178c676269eac6347631d4447258.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float cyl_radius = 820.;\n//uniform mat4 imageW2N;\n#define M_PI 3.1415926535897932384626433832795\n\n\nmat4 myW2N(float ax, float ay, float zNear, float zFar) {\n    float cx = 1.0 / ax;\n    float cy = 1.0 / ay;\n    float z0 = -zNear;\n    float z1 = -zFar;\n    float az = (z0 + z1) / (z0 - z1);\n    float bz = (1. - az) * z0;\n    return mat4(\n        cx, 0, 0, 0,\n        0, cy, 0, 0,\n        0, 0, az, bz,\n        0, 0, -1, 0\n    );\n}\n\nmat3 rotationW2R() {\n    return mat3.transpose( 0.,1.,0., 0.,0.,1., 1.,0.,0. );\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{   \n    \n    float a = iResolution.x;\n    float z = iResolution.y;\n    vec3 d =  rotationW2R() * cyl_radius * vec3(cos(a), sin(a), z);\n\n    float hFOV=0.739; \t\t//TODO: based on EXIF\n    float aspectRatio=1.5;\t//TODO: based on EXIF\n    float ax = tan(hFOV * M_PI);\n    float ay = ax / aspectRatio;\n     \n    vec4 q1 = myW2N(ax,ay,1,2) * vec4(d,1);  //TODO: change myW2N based on user interaction (use uniform mat4 imageW2N)\n\n    if (q1.w < 0.) discard;\n    vec2 p = q1.xy / q1.w;\n    p = 0.5 * (p + 1.0);\n    if (any(lessThan(p, vec2(0.0,0.0))) || any(greaterThan(p, vec2(1.0,1.0)))) discard; \n    vec4 c = texture(iChannel0, p);\n    gl_FragColor = vec4(c.rgb, 1.0);\n}","name":"Image","description":"","type":"image"}]}