{"ver":"0.1","info":{"id":"XdBBRG","date":"1500783312","viewed":104,"name":"ray march + lighting + camera","username":"rjoudrey","description":".","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["raymarch"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float EPSILON = 0.0001;\n\nfloat opRep( vec3 p)\n{\n    vec3 c = 5.0 * vec3(1.0, 1.0, 1.0);\n    vec3 q = mod(p,c)-0.5*c;\n\t// distance to sphere surface\n    return length(q) - 1.0;\n}\n\nfloat sdf(vec3 p) \n{\n\treturn opRep(p);\n}\n\nbool rayMarch(vec3 start, vec3 direction, inout vec3 intersection)\n{ \t\n    vec3 current = start;\n    for (int i = 0; i < 64; ++i) \n    {\n        float d = sdf(current);\n        if (d <= EPSILON)\n        {\n\t\t\tintersection = current;\n            return true;\n        }\n        current += direction * d;\n    }\n    return false;\n}\n\nvec3 normal(vec3 p)    \n{\n    return normalize(\n        vec3(\n        \tsdf(vec3(p.x + EPSILON, p.y, p.z)) - sdf(vec3(p.x - EPSILON, p.y, p.z)),\n\t        sdf(vec3(p.x, p.y + EPSILON, p.z)) - sdf(vec3(p.x, p.y - EPSILON, p.z)),\n\t        sdf(vec3(p.x, p.y, p.z + EPSILON)) - sdf(vec3(p.x, p.y, p.z - EPSILON))\n    ));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 a = fragCoord.xy / iResolution.xy;\n    // (0...1, 0...1) -> (-1...1, -1...1)\n    vec2 b = a * 2.0 - 1.0;\n    // change aspect ratio from 1:1 to x:y\n\tfloat ratio = iResolution.x / iResolution.y;\n    vec2 c = vec2(b.x * ratio, b.y);\n    float rayDistance = -10.0 * iTime;\n    vec3 rayOrigin = vec3(0.0, 0.0, -rayDistance);\n    vec3 rayDirection = normalize(vec3(c, -rayDistance + 2.0) - rayOrigin);\n    vec3 intersection;\n    float col = 0.0;\n    if (rayMarch(rayOrigin, rayDirection, intersection))\n    {\n        vec3 n = normal(intersection);\n        vec3 l = vec3(0.0, 0.0, -1.0);\n        col = dot(n, l) * .9 + .1;\n    }\n\tfragColor = vec4(col, col, col, 0.0);\n}","name":"Image","description":"","type":"image"}]}