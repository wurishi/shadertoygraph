{"ver":"0.1","info":{"id":"wsGcRG","date":"1603100512","viewed":69,"name":"Example 46 - raytrace waffles","username":"jt","description":"Simple & inefficient way to raytrace a heightmap-function with normals.","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["raytracing","example","waffles"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define pi 3.1415926\n\nvec2 lookup(vec2 p)\n{\n    return (p + vec2(iTime, 0.0));\n}\n\nfloat heightmap(vec2 p)\n{\n    vec2 l = lookup(p);\n    //return 0.5 * (0.5 + 0.5 * sin(l.x * 2.0 * pi) * sin(l.y * 2.0 * pi)); // waves\n    return 0.5 * (1.0 - abs(sin(l.x * 2.0 * pi)) * abs(sin(l.y * 2.0 * pi))); // waffles\n    //return 0.5 * ((1.0 - abs(sin(l.x * 2.0 * pi))) * (1.0 - abs(sin(l.y * 2.0 * pi)))); // spikes\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec3 d = vec3(2.0 * fragCoord/iResolution.xy - 1.0, 1.0);\n    \n    fragColor = vec4(0.0, 0.0, 0.5, 1.0);\n    \n    float s = 0.001;\n    s /= abs(d.y); // larger step-size for shallow rays\n    for(vec3 q = vec3(0.0); abs(q.y) < 1.0; q += d * s)\n    {\n        float c = heightmap(q.xz);\n        float h = 1.0 * c - 1.0;\n        if(q.y < h)\n        {\n            float W = heightmap(q.xz + vec2(-1.0,0.0)/iResolution.xy);\n            float O = heightmap(q.xz + vec2(+1.0,0.0)/iResolution.xy);\n            float S = heightmap(q.xz + vec2(0.0,-1.0)/iResolution.xy);\n            float N = heightmap(q.xz + vec2(0.0,+1.0)/iResolution.xy);\n            vec3 n = normalize(vec3(O - W, N - S, 0.01));\n            //fragColor = vec4(c);\n            //fragColor = vec4(n.z);\n            float brightness = dot(n, normalize(vec3(1.0, 0.0, 1.0))); // lighting\n            fragColor = vec4(brightness); \n            break;\n        }\n    }\n}\n","name":"Image","description":"","type":"image"}]}