{"ver":"0.1","info":{"id":"dltfD4","date":"1701317938","viewed":39,"name":"[zznewclear13] Barrel Distortion","username":"zznewclear13","description":"Barrel distortion. Interactable with iMouse.x.","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["2d","antialiasing","barreldistortion"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dX3Rn","filepath":"/media/a/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","previewfilepath":"/media/ap/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// [zznewclear13] Barrel Distortion\n// https://www.shadertoy.com/view/dltfD4\n// Barrel distortion. Interactable with iMouse.x.\n\nvec2 barrelDistortion(vec2 uv, float strength)\n{\n    vec2 center = vec2(0.5f, 0.5f);\n    vec2 d = uv - center;\n    float r2 = d.x * d.x + d.y * d.y;\n    float rr = 0.5f * 0.5f;\n    float k1 = 0.1f;\n    float k2 = 0.2f;\n    float k3 = -0.3f;    \n    float s = pow(1.0f + k1 * r2 + k2 * r2 * r2 + k3 * r2 * r2 * r2, strength);\n    float sr = pow(1.0f + k1 * rr + k2 * rr * rr + k3 * rr * rr * rr, strength);\n    return d * s / sr + center;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec4 color = vec4(0.0f);\n    vec2 uv = fragCoord / iResolution.xy;\n    float distortStrength = cos(iTime * 0.5f);\n    if(iMouse.z > 0.0f)\n    {\n        distortStrength = 1.0f - (iMouse.x / iResolution.x) * 2.0f;\n    }\n    vec2 distortedUV = barrelDistortion(uv, distortStrength * 10.0f);\n    vec4 mainTex = texture(iChannel0, distortedUV);\n    \n    vec2 prop = vec2(1.0f, iResolution.y / iResolution.x);\n    float fw = length(fwidth(distortedUV));\n    float sd = sdBox(distortedUV * prop - 0.5f * prop, 0.5f * prop);\n    mainTex.a = smoothstep(fw, 0.0f, sd);\n        \n    color.rgb = mix(color.rgb, mainTex.rgb, mainTex.a);\n    color.a = color.a * (1.0f - mainTex.a) + mainTex.a;\n    fragColor = color;\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"// https://iquilezles.org/articles/distfunctions2d/\n\nfloat sdBox( in vec2 p, in vec2 b )\n{\n    vec2 d = abs(p)-b;\n    return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdRoundedBox( in vec2 p, in vec4 b, in float r )\n{\n    vec2 q = abs(p-b.xy)-b.zw+r;\n    return min(max(q.x,q.y),0.0) + length(max(q,0.0)) - r;\n}","name":"Common","description":"","type":"common"}]}