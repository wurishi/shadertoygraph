{"ver":"0.1","info":{"id":"sl2yz3","date":"1650463203","viewed":43,"name":"zyq_ball","username":"zhouyongqiang","description":"ball","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["ball"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//http://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/\n\nfloat EPSILON = 0.0001;\nvec3 ballColor = vec3(0.5,0.1,0.7);\nvec3 lightColor = vec3(0.0, 1.0, 1.0);\n\n\nfloat sceneSDF(vec3 pos)\n{\n    vec3 center = vec3(0.0, -0.0, 0.0);\n    float radiu = 0.3;\n   \n    vec3 d = pos - center;\n    \n    \n    return sqrt(dot(d,d)) - radiu;\n}\n\nvec3 appleLight(vec3 pos, vec3 normal, vec3 light)\n{\n    \n    return dot(normal, pos - light) * lightColor * 0.4 + vec3(0.5,0.5,0.5);\n}\n\n//获取法线\nvec3 estimateNormal(vec3 p) {\n    return normalize(vec3(\n        sceneSDF(vec3(p.x + EPSILON, p.y, p.z)) - sceneSDF(vec3(p.x - EPSILON, p.y, p.z)),\n        sceneSDF(vec3(p.x, p.y + EPSILON, p.z)) - sceneSDF(vec3(p.x, p.y - EPSILON, p.z)),\n        sceneSDF(vec3(p.x, p.y, p.z  + EPSILON)) - sceneSDF(vec3(p.x, p.y, p.z - EPSILON))\n    ));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    //uv转化为y = [-1,1]\n    vec2 uv = fragCoord/iResolution.xy * 2.0 - 1.0;\n    uv.x *= iResolution.x / iResolution.y;\n    \n    //摄像机,暂时未实现,因为不会\n    vec3 eye = vec3(0.0, 0.0, -5.0);\n    vec3 lookat = vec3(0.0, 0.0, -5);\n    \n    //当前像素的世界空间,简易处理\n    vec3 curPixelWorldPos = vec3(uv, 0.0);\n    \n    //判断点是否在屏幕里面\n    float step = 0.1;\n    int n = 300;\n    vec3 pos = eye;\n    vec3 dir = normalize(curPixelWorldPos - eye);\n    for(int i = 0; i < n; i += 1)\n    {\n        pos += dir * step;\n        \n        float sdf = sceneSDF(pos);\n        if(sdf <= 0.0)//在里面了\n        {\n            vec3 normal = estimateNormal(curPixelWorldPos);\n            \n            \n            fragColor.xyz = appleLight(curPixelWorldPos, normal, eye);\n            //fragColor.r = 1.0;\n            break;\n        }\n            \n    }\n}\n\n","name":"Image","description":"","type":"image"}]}