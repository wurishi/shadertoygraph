{"ver":"0.1","info":{"id":"7sKSDz","date":"1634508950","viewed":69,"name":"Hard 2D Tile Shadows","username":"jetp250","description":"Playground for later messing","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["2d","shadows","tile","hard"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float rand(vec2 co){\n    co.x += iTime * 0.0000001;\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nbool getVoxel(ivec2 c) {\n\tvec2 p = vec2(c);\n    ivec2 a = abs(c);\n    return a.x < 5 && a.y < 5 && rand(p) < 0.3;\n}\n\nivec3 raycast(vec2 from, vec2 to) {\n    vec2 rayDir = to - from;\n    \n    ivec2 startPos = ivec2(floor(from));\n    ivec2 endPos = ivec2(floor(to));\n    ivec2 mapPos = startPos;\n    \n    ivec2 d = abs(endPos - mapPos);\n    int maxSteps = min(d.x + d.y + 1, 50);\n\n\tvec2 deltaDist = abs(vec2(length(rayDir)) / rayDir);\n\tivec2 rayStep = ivec2(sign(rayDir));\n\tvec2 sideDist = (sign(rayDir) * (vec2(mapPos) - from) + (sign(rayDir) * 0.5) + 0.5) * deltaDist; \n\t\n\tfor (int i = 0; i < maxSteps; i++) {\n\t\tif (getVoxel(mapPos)) {\n            return ivec3(1, mapPos);\n        }\n\n        if (sideDist.x < sideDist.y) {\n            sideDist.x += deltaDist.x;\n            mapPos.x += rayStep.x;\n        } else {\n            sideDist.y += deltaDist.y;\n            mapPos.y += rayStep.y;\n\t\t}\n\t}\n    \n    return ivec3(-1);\n}\n\nfloat sdBox( in vec2 p, in vec2 b )\n{\n    vec2 d = abs(p)-b;\n    return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n\tfloat RES = 16.0;\n    \n    vec2 screenPos = RES*(fragCoord.xy - 0.5* iResolution.xy) / iResolution.y;\n    vec2 mouse = RES*(iMouse.xy - 0.5* iResolution.xy) / iResolution.y;\n\n    vec3 color = vec3(0.93);\n    if (getVoxel(ivec2(floor(screenPos)) + ivec2(0, 1))) {\n        color *= sqrt(1.0 - max(fract(screenPos.y), 0.0));\n    }\n    \n    if (getVoxel(ivec2(floor(screenPos)))) color = vec3(0.3);\n    \n    ivec3 rt = raycast(mouse, screenPos);\n    if (rt.x != -1) {\n        color = mix(color, vec3(0.0), sqrt(length(screenPos-mouse))/RES);\n    }\n    \n\tfragColor.rgb = color;\n}","name":"Image","description":"","type":"image"}]}