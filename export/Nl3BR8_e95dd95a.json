{"ver":"0.1","info":{"id":"Nl3BR8","date":"1662850828","viewed":21,"name":"Optical Ray Tracer (temp. name)","username":"artefox","description":"Optical Ray Tracer (temp. name)","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["raytracer","ray","optical","pathtracer","tracer"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Thanks to umsoea/georg240p for providing the sphere intersection https://www.youtube.com/watch?v=ZpsGVsv94zQ\nfloat sphere(vec3 ro, vec3 rd, vec3 center, float radius) {\n    float len = dot(center - ro, rd);\n    float b = distance(rd * vec3(len) + ro, center);\n    if (b > radius || distance(ro, center) <= radius) {\n        return 10000.0;\n    }\n    float a = sqrt(radius * radius - b * b);\n    float d = len - a;\n\n    if (d < 0.0) {\n        return 10000.0;\n    }\n\n    return d;\n}\n\nfloat addSphere(vec3 ro, vec3 rd, vec3 center, float radius, out float dist, out vec3 normal) {\n    float d = sphere(ro, rd, center, radius);\n    dist = min(dist, d);\n    \n    vec3 hit = rd * vec3(dist) + ro;\n    if (d == dist) {\n        normal = normalize(hit - center);\n    }\n    \n    return 0.0;\n}\n\nfloat plane(vec3 ro, vec3 rd) {\n    float d = ro.y / (rd.y * -1.0);\n    if (d < 0.0) {\n        return 10000.0;\n    }\n    return d;\n}\n\nfloat addPlane(vec3 ro, vec3 rd, out float dist, out vec3 normal) {\n    float d = plane(ro, rd);\n    dist = min(dist, d);\n    \n    vec3 hit = rd * vec3(dist) + ro;\n    hit.y *= 0.005;\n    if (d == dist) {\n        normal = hit;\n    }\n    \n    return 0.0;\n}\n\nfloat ray(vec3 ro, vec3 rd, out float dist, out vec3 normal, out vec3 hit) {\n    //addPlane(ro, rd, dist, normal);\n    addSphere(ro, rd, vec3(0.7, 0.5, 1.5), 0.5, dist, normal);\n    addSphere(ro, rd, vec3(0.0, 0.5, 2.0), 0.5, dist, normal);\n    addSphere(ro, rd, vec3(0.0, -10000.0, 0.0), 10000.0, dist, normal);\n\n    hit = rd * vec3(dist) + ro;\n    \n    return 0.0;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    float fov = 90.0;\n    float aspect = iResolution.x / iResolution.y;\n    vec2 uv = (2.0 * fragCoord / iResolution.xy - 1.0) * tan(radians(fov / 2.0));\n    uv.x *= aspect;\n    \n    vec3 ro = vec3(0.0, 0.5, -2.0);\n    vec3 rd = normalize(vec3(uv, 1.0));\n    \n    vec3 col;\n    vec3 hit;\n    float dist = 10000.0;\n    vec3 normal = vec3(0.0);\n    \n    ray(ro, rd, dist, normal, hit);\n    \n    vec3 light = vec3((2.0 * iMouse.xy / iResolution.xy - 1.0) * 4.0, -1.0);\n    vec3 vtol = normalize(light - hit);\n    float ld = distance(light, hit);\n    \n    if (dist < 10000.0) {\n        vec3 shade = vec3(max(dot(normal, vtol), 0.0) / (ld * ld));\n        ray(hit, vtol, dist, normal, hit);\n        if (dist > ld) {\n            col = shade;\n        } else {\n            col = vec3(0.0, 0.0, 0.0);\n        }\n    } else {\n        col = mix(vec3(0.6, 0.7, 1.0), vec3(0.3, 0.4, 0.7), rd.y);\n    }\n    \n\n    // gamma\n    col = pow(col, vec3(1.0 / 2.2));\n    \n    // output to screen\n    fragColor = vec4(col, 1.0);\n}","name":"Image","description":"","type":"image"}]}