{"ver":"0.1","info":{"id":"MlSBWz","date":"1515329136","viewed":201,"name":"Tracking","username":"gaz","description":"3d","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["3d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"mat3 lookat(vec3 d, vec3 up)\n{\n\tvec3 w = normalize(d),u = normalize(cross(w,up));\n    return (mat3(u,cross(u,w),w));\n}\n\nvec2 rayCastPlane(vec3 ro, vec3 rd, vec3 pos, vec3 nor, vec3 up)\n{\n\tfloat z = dot(pos-ro,nor)/dot(rd,nor);\n    vec3 p=ro+rd*z, a=p-pos, u=normalize(cross(nor,up)), v=normalize(cross(u,nor));\n    return vec2(dot(a,u),dot(a,v));\n}\n\nvec3 hsv(float h, float s, float v)\n{\n    return mix(vec3(1),clamp((abs(fract(h+vec3(3,2,1)/3.)*6.-3.)-1.),0.,1.),s)*v;\n}\n\nvec3 knot(float t)\n{\n    t *= radians(360.);\n    return vec3(sin(t)+2.*sin(2.*t),cos(t)-2.*cos(2.*t),-sin(3.*t));\n}\n\nfloat de(vec2 p)\n{\n    return abs(length(p)-0.1);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 p = (fragCoord*2.-iResolution.xy)/iResolution.y;\n    float t = iTime*0.05;\n    vec3 ro = knot(t);\n    ro += normalize(ro).zxy*0.5;\n    vec3 ta = knot(t+0.05);    \n    ta += normalize(ta).zxy*0.3;\n    vec3 rd = lookat(ta-ro,ro.xzy)*normalize(vec3(p,2));\t\n    vec3 col = vec3(0.3,0.3,0.5)*p.y*p.y;\n    const int s = 200;\n    for(int i=0;i<s;i++)\n    {\n        float t = float(i)/float(s);\n        vec3 d = normalize(knot(t-0.001)-knot(t+0.001));\n        vec2 b = rayCastPlane(ro,rd,knot(t),d,d.yzx);\n        col = mix(col,hsv(float(i)/float(s),0.8,1.0),smoothstep(0.01,0.0,de(b)));\n    }\n    vec3 d = normalize(knot(t-0.001)-knot(t+0.001));\n    vec2 b = rayCastPlane(ro,rd,ta,ta-rd,(ta-rd).yzx);\n    col = mix(col,hsv(fract(0.5+t),0.8,1.0),smoothstep(0.035,0.0,min(de(b),de(b*2.))));\n    \n    fragColor = vec4(col, 1.0);\n}","name":"Image","description":"","type":"image"}]}