{"ver":"0.1","info":{"id":"wdGcDt","date":"1604158979","viewed":317,"name":"Jzazbz","username":"thepheer","description":"Jzazbz uniform color space implementation.\n\nhttps://observablehq.com/@jrus/jzazbz\nhttps://doi.org/10.1364/OE.25.015131","likes":2,"published":3,"flags":0,"usePreview":0,"tags":["jzazbz"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define rep(m, x) (mod(x, 2.0*(m)) - (m))\n#define sdf(w, d) smoothstep(1.5*(w), 0.0, d)\n#define plot(w, x, y) sdf(w, abs((x) - (y)))\n#define range(x, a, b) ((a) <= (x) && (x) < (b))\n\nvoid mainImage(out vec4 rgba, vec2 xy) {\n    vec2 px = 1.0/iResolution.xy;\n    vec2 uv = xy*px;\n    \n\tfloat tau = radians(360.0);\n    float J = 0.50 + 0.49*sin(tau*(0.2*uv.x - 0.1*iTime));\n    float C = J*(1.0 - J);\n    float h = tau*(fract(uv.x + 0.5*iTime) - 0.5);\n\n    // JzCzhz → Jzazbz → sRGB → Jzazbz → sRGB\n    vec3 Jab1 = JCh_to_Jab(vec3(0.167*J, 0.15*C, h));\n    vec3 sRGB1 = XYZ_D65_TO_sRGB*Jab_to_XYZ_D65(Jab1);\n    vec3 Jab2 = XYZ_D65_to_Jab(sRGB_TO_XYZ_D65*sRGB1);\n    vec3 sRGB2 = XYZ_D65_TO_sRGB*Jab_to_XYZ_D65(Jab2);\n\n    float dashed = sdf(1.0, abs(rep(6.0, xy.x)) - 4.0);\n    float dotted = sdf(1.0, abs(rep(2.0, xy.x)));\n    vec3 split = 0.025*vec3(-1.0, 0.0, 1.0);\n    \n    vec3 plots =\n        plot(px.y, uv.y, 0.500)*dotted*0.1 +\n        plot(px.y, uv.y, 0.100)*dotted*0.1 +\n        plot(px.y, uv.y, 0.775 + 5e2*(Jab2 - Jab1) - split) +\n       \tplot(px.y, uv.y, 0.625 + 5e1*(sRGB2 - sRGB1) - split) +\n        plot(px.y, uv.y, 0.100 + 0.4*sRGB1)*0.5 +\n        plot(px.y, uv.y, 0.100 + 0.4*sRGB2)*0.5*dashed;\n\n    vec3 rgb =\n        range(uv.y, px.y + 0.95, 1.00) ? sRGB1 :\n        range(uv.y, px.y + 0.90, 0.95) ? sRGB2 :\n    \tplots;\n\n    rgba = vec4(sRGB_OETF(rgb), 1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define diag3(v) mat3((v).x, 0.0, 0.0, 0.0, (v).y, 0.0, 0.0, 0.0, (v).z)\n#define xy_to_XYZ(x, y) vec3(x/y, 1.0, (1.0 - x - y)/y)\n\nconst vec3 D65 = xy_to_XYZ(0.31271, 0.32902);\nconst mat3 sRGB = mat3(xy_to_XYZ(0.64, 0.33), xy_to_XYZ(0.30, 0.60), xy_to_XYZ(0.15, 0.06));\nconst mat3 sRGB_TO_XYZ_D65 = sRGB*diag3(inverse(sRGB)*D65);\nconst mat3 XYZ_D65_TO_sRGB = inverse(sRGB_TO_XYZ_D65);\n\nvec3 sRGB_OETF(vec3 c) {\n    vec3 a = 12.92*c;\n    vec3 b = 1.055*pow(c, vec3(1.0/2.4)) - 0.055;\n    return mix(a, b, greaterThan(c, vec3(0.00313066844250063)));\n}\n\nvec3 sRGB_EOTF(vec3 c) {\n    vec3 a = c/12.92;\n    vec3 b = pow((c + 0.055)/1.055, vec3(2.4));\n    return mix(a, b, greaterThan(c, vec3(0.0404482362771082)));\n}\n\nconst float b = 1.15;\nconst float g = 0.66;\nconst float c1 = 3424.0/exp2(12.0);\nconst float c2 = 2413.0/exp2(7.0);\nconst float c3 = 2392.0/exp2(7.0);\nconst float n = 2610.0/exp2(14.0);\nconst float p = 1.7*2523.0/exp2(5.0);\nconst float d = -0.56;\nconst float d0 = 1.6295499532821566e-11;\n\nconst mat3 XYZ_D65_TO_LMS = 1e2/1e4*mat3(\n    +0.41478972, -0.20151000, -0.01660080,\n    +0.57999900, +1.12064900, +0.26480000,\n    +0.01464800, +0.05310080, +0.66847990\n)*mat3(b, 1.0-g, 0.0, 0.0, g, 0.0, 1.0-b, 0.0, 1.0);\n\nconst mat3 LMS_TO_Iab = mat3(\n    +0.5, +3.524000, +0.199076,\n    +0.5, -4.066708, +1.096799,\n    +0.0, +0.542708, -1.295875\n);\n\nvec3 XYZ_D65_to_Jab(vec3 XYZ) {\n    vec3 LMS = XYZ_D65_TO_LMS*XYZ;\n    vec3 LMSpp = pow(LMS, vec3(n));\n    vec3 LMSp = pow((c1 + c2*LMSpp)/(1.0 + c3*LMSpp), vec3(p));\n    vec3 Iab = LMS_TO_Iab*LMSp;\n    float J = (1.0 + d)*Iab.x/(1.0 + d*Iab.x) - d0;\n    return vec3(J, Iab.yz);\n}\n\nvec3 Jab_to_XYZ_D65(vec3 Jab) {\n    float I = (Jab.x + d0)/(1.0 + d - d*(Jab.x + d0));\n    vec3 LMSp = inverse(LMS_TO_Iab)*vec3(I, Jab.yz);\n    vec3 LMSpp = pow(LMSp, vec3(1.0/p));\n    vec3 LMS = pow((c1 - LMSpp)/(c3*LMSpp - c2), vec3(1.0/n));\n    return inverse(XYZ_D65_TO_LMS)*LMS;\n}\n\nvec3 JCh_to_Jab(vec3 JCh) {\n    return vec3(JCh.x, JCh.y*vec2(cos(JCh.z), sin(JCh.z)));\n}\n\nvec3 Jab_to_JCh(vec3 Jab) {\n    return vec3(Jab.x, length(Jab.yz), atan(Jab.z, Jab.y));\n}","name":"Common","description":"","type":"common"}]}