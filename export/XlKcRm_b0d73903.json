{"ver":"0.1","info":{"id":"XlKcRm","date":"1535565752","viewed":1044,"name":"Volumetric Kaleidoscope","username":"efairbanks","description":"Playing around with KIFS and volumetric lighting.","likes":17,"published":1,"flags":0,"usePreview":0,"tags":["raymarch","lighting","volumetric","kaleidoscope"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec2 c2p(vec2 p){return vec2(atan(p.y,p.x),length(p));}\nvec2 p2c(vec2 p){return vec2(cos(p.x),sin(p.x))*p.y;}\nvec2 _min(vec2 a, vec2 b) {return a.x<b.x?a:b;}\nvec3 look(vec2 xy, vec3 origin, vec3 target)\n{\n\tvec3 up=normalize(vec3(0.,1.,0.));\n    vec3 fwd=normalize(target-origin);\n    vec3 right=normalize(cross(fwd,up));\n    up=normalize(cross(fwd,right));\n    return normalize(fwd+right*xy.x+up*xy.y);\n}\n#define LUM 1.\n#define MAX_DISTANCE 20.\n#define MAX_STEPS 70\n#define EPSILON .001\nfloat box(vec3 p, vec3 d)\n{\n    p=abs(p)-d;\n    return max(p.x,max(p.y,p.z));\n}\nfloat map(vec3 p)\n{\n    p=p*0.8;\n    p=p+2.;\n    for(int i=0;i<5;i++)\n    {\n        p=p-vec3(1.,2.,3.);\n    \tp=p*1.5;\n        p.xz=c2p(p.xz);\n        p.x+=iTime/2.;\n        p.xz=p2c(p.xz);\n        p.xy=c2p(p.xy);\n        p.x-=iTime/3.34;\n        p.xy=p2c(p.xy);\n        p=abs(p);\n    }\n\tfloat d=box(p,vec3(0.5));\n    return d;\n}\nfloat march(vec3 origin,vec3 ray)\n{\n    float t=0.;\n    for(int i=0;i<MAX_STEPS; i++)\n    {\n        float len=float(i)*MAX_DISTANCE/float(MAX_STEPS);\n        t+=pow(2.1/max(map(origin+ray*len),1.),1.);\n    }\n    return t/float(MAX_STEPS);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv=(fragCoord/iResolution.xy-.5)*2.;\n\tuv.x=uv.x*iResolution.x/iResolution.y;   \n    vec3 camera=vec3(1.2);\n    camera=vec3(sin(iTime/1.567),sin(iTime)*.2-.2,cos(iTime/1.567))*10.;\n    vec3 ray=look(uv,camera,vec3(0.));\n    // --- //\n    vec3 pos=camera;\n    vec3 dir=ray;\n\tfloat result=march(camera,ray);\n    fragColor = vec4(vec3(.7,.8,1.)*atan(vec3(pow(result*2.8,2.))),1.0);\n}","name":"Image","description":"","type":"image"}]}