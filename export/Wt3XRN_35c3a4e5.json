{"ver":"0.1","info":{"id":"Wt3XRN","date":"1580502555","viewed":481,"name":"Mirror Reflections","username":"kstyler","description":"Practicing reflections, learned from yx. Thanks Luna.","likes":7,"published":3,"flags":0,"usePreview":0,"tags":["raymarching","reflections","mirror"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"int mat;\nfloat random(vec2 p){\n\treturn(fract(sin(p.x*431.+p.y*707.)*7443.));\n}\nmat2 rot(float a){\n    return mat2(cos(a),-sin(a),\n                sin(a),cos(a));\n}\nfloat sdBox( vec3 p, vec3 b )\n{\n  vec3 q = abs(p) - b;\n  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n}\n\nfloat map(vec3 p ){\n    \n    float ink = length((p))-1.;\n\n\n    float gold = (length((p+vec3(0)))-2.);\n   \n    float b1 = sdBox(p,vec3(2.));\n\n    p.xz*=rot(0.9);\n   \n    gold = max(-b1,sdBox(p,vec3(2.)));\n    float outer1 = sdBox(p,vec3(20));\n    p.yz*=rot(3.+iTime);\n\n    float outer=max(-outer1,sdBox(p,vec3(21)));\n    \n    float best = min(outer,min(ink,gold));\n    \n    if(best == gold){\n        mat=1;\n    }else if(best ==ink){\n        mat = 0;\n    }else{mat = 2;}\n    return best;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n    vec2 uv = (fragCoord.xy-0.5*iResolution.xy)/iResolution.x;\n    vec3 ro = vec3(0,-0.2,-10);\n    vec3 rd = normalize(vec3(uv+random(uv)/iResolution.x,1));\n    ro.zy*=rot(-0.1);\n    rd.zy*=rot(-0.1);\n    ro.zx*=rot(iTime/5.);\n    rd.zx*=rot(iTime/5.);\n    float tot = 0.;\n    float dist = 0.;\n    vec3 p;\n    vec3 color = vec3(1);\n    \n    for(int i = 0; i<200;i++){\n        p = ro+rd*tot;\n        dist = map(p);\n        tot+=dist;\n        if(abs(dist)<0.0001){\n            vec2 e = vec2(0.001,0.);\n            vec3 n = normalize(vec3(map(p+e.xyy)-map(p-e.xyy),\n                        map(p+e.yxy)-map(p-e.yxy),\n                        map(p+e.yyx)-map(p-e.yyx)));\n            if(mat == 0){\n                float fresnel = pow(1.-dot(- rd,n),5.);\n                color*=fresnel;  \n\n            } else if(mat == 1){\n                color*=vec3(1.0,0.5,0.1);\n               \n            }else if(mat == 2){\n                color*=vec3(0.5,0.4,0.5);\n               \n            }\n            ro = p+n*0.01;\n            rd = reflect(rd,n);\n            tot = 0.;\n\n        }\n    }\n                        \n   \n    color = pow(color,vec3(0.25));\n    fragColor = vec4(color,1.0);\n}","name":"Image","description":"","type":"image"}]}