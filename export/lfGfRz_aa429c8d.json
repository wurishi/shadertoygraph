{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[],"code":"#define vc3 vec3\n#define vc2 vec2\n#define time iTime\n#define px2 p.x * p.x\n#define ss(x, y) sin((time + x) * y)\n#define _f(x) * x + x\n#define mx mix(col,\n#define f1(x,y) f += x*ns(p); p *= y\n#define area(v0, v1) dot(v0, vc2(v1.y, -v1.x))\n#define IsIn(b) all(greaterThanEqual(b, vc3(0.))) && all(lessThanEqual(b, vc3(1.)))\n#define smst smoothstep\n#define snow(p)         smst(p.y, p.y + .005, sin(p.x + .2) * .2 - .25)\n#define moon(p,pp,rad)  smst(.97, 1., distance(p, pp) / rad)\n#define h(n) fract(sin(n)*753.5453)\n#define flt float\n#define fori(x) for(flt i = 0.; i < x; i++)\n#define pa(x,y) pow(abs(x),y)\n#define cmix col = mix\n#define rres return f\n#define clp clamp\n\nfloat gir(vc2 p, vc2 pp, flt rad )\n{    \n    return smst(.95, 1., 1.- distance(p, pp) / rad);    \n}\n\nconst flt PI = 3.141593;\nconst flt stp = PI * .4;\nconst flt deg45 = PI / 4.;\n\nflt ns(vc2 x )\n{\n    vc2 p = floor(x);\n    vc2 f = fract(x);\n    f = f*f*(3. - f - f);\n\t\n    flt n = p.x + p.y*157. + 113.;\n    return mix(mix( h(n+ 0.), h(n+ 1.),f.x),\n               mix( h(n+63.), h(n+64.),f.x),f.y);\n}\n\nflt fbm(vc2 p)\n{\n    flt f = 0.;\n    f1(   .5,2.02);\n    f1(  .25,2.03);\n    f1( .125,2.01);\n    f1(.0625,2.04);\n    f /= .9375;\n    rres;    \n}\n\nvc3 baryc(vc2 p0, vc2 p1, vc2 p2, vc2 p )\n{\n\tvc2 e0 = p1 - p0;\n\tvc2 e1 = p2 - p1;\n\n\tvc2 v0 = p0 - p;\n\tvc2 v1 = p1 - p;\n\tvc2 v2 = p2 - p;\n    \n    flt a = area(e0, e1);\n\tflt a1 = area(v1, v2);\n\tflt a2 = area(v2, v0);\n\tflt a3 = area(v0, v1);\n\n\treturn vc3(a1 / a, a2 / a, a3 / a);\n}   \n\nflt es( vc2 p0, vc2 p1, vc2 p2, vc3 _avec, vc2 p)\n{\n    flt f = 0.;\n    vc2 _p = p + (p - p2) * (px2 * 1.25 + fbm(p*100.)*.055 + fbm(p*200.)*.035);\n    _p.x -= sign(_p.x)*fbm(p*700.)*(px2 *.5);\n    vc3 bar = baryc( p0, p1, p2, _p);\n    if(IsIn(bar))    \n\t   f = dot(bar, _avec);    \n    rres;    \n}\n\nflt star(vc2 sp, vc2 p, flt or, flt ir)\n{\n    flt f = 0.;\n    flt ang = PI * .5 + ss(0., 1.5)*.05; \n    vc3 clr = vc3(1., .2, .2);\n        \n    fori(5.)\n    {\n        vc2 op = vc2(sp.x + cos(ang) * or, sp.y + sin(ang) * or);\n        vc2 p1 = vc2(sp.x + cos(ang + deg45) * ir, sp.y + sin(ang + deg45) * ir);\n        vc3 b = baryc(sp, op, p1, p);\n        if(IsIn(b))\n    \t{\n\t   \t\tf = dot(b, clr);\n            break;\n    \t}\n        \n        vc2 p2 = vc2(sp.x + cos(ang - deg45) * ir, sp.y + sin(ang - deg45) * ir);\n        \n        b = baryc(sp, op, p2, p);\n        if(IsIn(b))\n    \t{\n\t   \t\tf = dot(b, clr);\n            break;\n    \t}\n        ang += stp;\n    }    \n    rres;    \n}\n\nfloat sphere(vec3 p, vec3 center, float radius) {\n    return length(p - center) - radius;\n}\n\nfloat cylinder(vec3 p, vec3 c1, vec3 c2, float r) {\n    vec3 ca = c2 - c1;\n    vec3 pa = p - c1;\n    float h = clamp(dot(pa, ca) / dot(ca, ca), 0.0, 1.0);\n    return length(pa - h * ca) - r;\n}\n\nfloat snowmanSDF(vec3 p) {\n    float d = 1e10;\n\n    vec3 snowmanBase = vec3(1.4, -0.5, -1.0);\n\n    d = min(d, sphere(p, snowmanBase + vec3(0.0, 0.0, 0.0), 0.3));\n    d = min(d, sphere(p, snowmanBase + vec3(0.0, 0.4, 0.0), 0.2)); \n    d = min(d, sphere(p, snowmanBase + vec3(0.0, 0.65, 0.0), 0.15));\n\n\n    d = min(d, sphere(p, snowmanBase + vec3(-0.05, 0.7, 0.13), 0.03)); \n    d = min(d, sphere(p, snowmanBase + vec3(0.05, 0.7, 0.13), 0.03)); \n\n    vec3 noseTip = snowmanBase + vec3(0.0, 0.65, 0.2);\n    vec3 noseBase = snowmanBase + vec3(0.0, 0.65, 0.15);\n    d = min(d, cylinder(p, noseBase, noseTip, 0.02));\n\n    vec3 leftHand = snowmanBase + vec3(-0.4, 0.4, 0.0);\n    vec3 rightHand = snowmanBase + vec3(0.4, 0.4, 0.0);\n    d = min(d, cylinder(p, snowmanBase + vec3(-0.2, 0.4, 0.0), leftHand, 0.02)); \n    d = min(d, cylinder(p, snowmanBase + vec3(0.2, 0.4, 0.0), rightHand, 0.02));\n\n    return d;\n}\n\nfloat sceneSDF(vec3 p) {\n    float d = 1e10;\n\n    d = min(d, snowmanSDF(p));\n\n    return d;\n}\n\nvec3 estimateNormal(vec3 p) {\n    float eps = 0.001;\n    return normalize(vec3(\n        sceneSDF(p + vec3(eps, 0.0, 0.0)) - sceneSDF(p - vec3(eps, 0.0, 0.0)),\n        sceneSDF(p + vec3(0.0, eps, 0.0)) - sceneSDF(p - vec3(0.0, eps, 0.0)),\n        sceneSDF(p + vec3(0.0, 0.0, eps)) - sceneSDF(p - vec3(0.0, 0.0, eps))\n    ));\n}\n\nvoid mainImage( out vec4 fragColor, in vc2 fragCoord )\n{\n    flt t =  ss( 0.,  1.);    \n    flt t2 = ss( 0.,  3.) _f(.5);\n    flt t3 = ss(-PI,  3.) _f(.5);\n    flt t4 = t2 * .02;\n    flt t5 = ss( 0., .75) * .03;\n    \n    flt a = 0.;\n    flt ab = 0.;\n\tvc2 p = (2.*fragCoord.xy-iResolution.xy)/iResolution.y;\n    vc3 snc = vc3(.81, .73, .83);\n    \n    vc3 avec = vc3(.045, .36,  1.); \n    vc3 davec = vc3(.02,.01,0.);\n    vc2 dp = vc2(.01, .05 - t4);    \n    \n\tvc2 v1 = vc2(-.5,-.8); vc2 v2 = vc2(.5,-.8); vc2 v3 = vc2(0.,-t4);\n\tvc3 col = vc3(.1, .1, .11);\n    vc3 wt = vc3(1.);\n    vc3 girc = vc3(.1, .9, .17);\n    \n    if(t <= 0.)\n        girc = mix(girc.yxz, girc, t + 1.);        \n    else\n        girc = mix(girc, girc.zxy, t);\n    \n    ab = es(v1, v2, v3, avec, p);\n    if(ab > 0.) a = ab;\n    \n    fori(8.)\n    {    \n        v1 += vc2(.04, .15 - t4*.3); v2 += vc2(-.04, .15 - t4*.3); v3 += vec2(.0, .1 - t4*.2);    \n        avec += davec;\n\n        ab = es(v1, v2, v3, avec, p + dp);\n        if(ab > 0.) a = mix(a, 0., .3);    \n        ab = es(v1, v2, v3, avec, p);\n        if(ab > 0.) a = ab;\n        dp += vc2(0., -.0035);\n    }       \n     \n    if(a > .1)\n    {\n        col = mix(vc3(0.), vc3(.18, .53, .26), a * (1. + fbm(p*150.)*.45));\n        col += girc * t2 * .02;\n        col += girc.zyx * t3 * .02;\n        col = col + vc3(1., 0., 0.) * pow(clp(p.y - t4 + .1, 0., 1.), 2.) * 1.3 * t;\n        \n        flt kf = 1.;\n        flt kk = 0.;\n        \n        for(flt k = -.75; k < .4; k += .15)\n        {\n            for(flt j = -.34; j < .58; j += .12)\n            { \n                flt jj = j * kf;\n                flt rg = gir(p,vc2(jj, k + kk + jj / 4. + pa(p.x, 2.)), .3) * t2;\n                flt gg = gir(p,vc2(jj + .06 * kf, k + kk + (jj + .06 * kf) / 4. + pa(p.x, 2.)), .3) * t3;\n                \n                cmix(mx girc, rg), wt, pow(rg, 8.));\n                cmix(mx girc.zyx, gg), wt, pow(gg, 8.));\n                kf -= .011111;\n            }   \n            kk -= t4 * .25;\n        }        \n    }\n    else\n    {\n        vc2 mlt = vc2(.8, .7 + t5);\n        vc2 msd = vc2(.9, .7 - t5);\n        \n        flt l = length(mlt);\n        flt an = atan(mlt.y, mlt.x) + mod(time *.1, PI);\n        \n        mlt = vc2(l * cos(an) * 2.1, l * sin(an) *.9 - .4);   \n        msd += mlt - vc2(.8, .7 + t5);\n        \n        vc3 sky = vc3(.01+(-p.x * 1. - p.y) * .07, (p.x * 1. - p.y) * .1, .17+(p.x * 1. - p.y) * .07);\n        \n        flt snw = snow(p);\n        \n        col = mx sky, clp(p.y + .3, 0., 1.));\n        \n        if(snw > 0.) \n        {\n            col = mx vc3(.81, .73, .83), snw * (1. - fbm(p * 150.) * .06 + p.y * .55));  \n            if(es(vc2(-.5,-.8), vc2(.5,-.8), vc2(0.,-t4), avec, p + vec2(0., 0.05)) <= 0.01)\n            {\n                vc2 pp = vc2(p.x, p.y * 3. + 1.6);\n            \tflt aa = (1. - clp(distance(pp, vc2(0., -.5)) / 1.5, 0., 1.)) / 4.;\n          \n                col += girc * t2 * aa;\n                col += girc.zyx * t3 * aa;\n            }\n        }\n  \t\telse   \n        {\n            fori(25.)\n            {\n                flt a1 = ss(i, .3) _f(.5);\n                col = mx snc, a1 * gir(p, vc2(mod(h(i*72.04) * 6. - time * .02, 4.) - 2. ,h(mod(i,30.) * 200.) * 2. - 1.),.125 + a1*.05));                \n            }\n            col = mx vc3(.87, .8, .6), clp(moon(p,mlt, .24) - moon(p,msd, .2), 0., 1.));  \n        }\n    }\n    \n    v3 += vc2(.0,.035);\n    \n    a = star(v3, p, .13, .06);\n    if(a > 0.)\n    \tcmix(vc3(.6 + .35 * t, .11, .14), vec3(1., .7, .7), star(v3, p, .115, .055) * (t _f(.5)) * .9); \n\n    fori(70.){\n        flt a2 = ss(i + h(i), .3) _f(.5);\n        col = mx snc*1.35, gir(p, vc2(h(i*72.04) *  4. - 2. + a2 ,mod((h(mod(i ,30.) * 200.) - time *.1) * 2., 2.) - 1.)*1.1,.35 + a2 *.25));\n    }\n    vec2 uv = (fragCoord.xy - 0.5 * iResolution.xy) / iResolution.y;\n    vec3 ro = vec3(0.0, 0.0, 3.0);\n    vec3 rd = normalize(vec3(uv, -1.0));\n    vec3 lightDir = normalize(vec3(-0.5, 1.0, -1.0));\n\n    t = 0.0;\n    for (int i = 0; i < 100; i++) {\n        vec3 p = ro + t * rd;\n        float d = sceneSDF(p);\n        if (d < 0.001) {\n            // Удар об'єкта у сцені\n            vec3 normal = estimateNormal(p);\n            float diff = max(dot(normal, lightDir), 0.0);\n\n            vec3 ambientColor = vec3(0.2, 0.2, 0.2);\n            vec3 snowmanColor = vec3(0.9, 0.9, 0.9);\n\n            col = snowmanColor * (ambientColor + diff);\n            break;\n        }\n        t += d * 0.5;\n        if (t > 10.0) break;\n    }\n\n    \n\tfragColor = vec4(col,1.);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"lfGfRz","date":"1734035833","viewed":46,"name":"Lab5 Christmas","username":"sytya","description":"some description","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["sometag"],"hasliked":0,"parentid":"","parentname":""}}