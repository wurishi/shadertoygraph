{"ver":"0.1","info":{"id":"mtcBW7","date":"1701360671","viewed":28,"name":"lod 101","username":"huangziji","description":"2d","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["2d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"mat2 rotate(float a)\n{\n    float s=sin(a), c=cos(a);\n    return mat2(c,s,-s,c);\n}\n\nfloat sdBox( in vec2 p, float b )\n{\n    vec2 d = abs(p)-b;\n    return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdSegment( in vec2 p, in vec2 a, in vec2 b )\n{\n    vec2 pa = p-a, ba = b-a;\n    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length( pa - ba*h );\n}\n\nfloat map(vec2 pos)\n{\n    ivec2 ipos = ivec2(floor(pos));\n    float r = 160.;\n    float t = iTime * 6.28 / 50.;\n    vec2 sph = vec2(sin(t), cos(t))*100.;\n    int size = 32;\n    for (; size>1;size>>=1)\n    {\n        vec2 ce = vec2(ipos-ipos%size) + vec2(size>>1);\n        float d1 = sdBox(ce-sph, float(size>>1)) - r;\n        float d2 = length(ce-sph) + float(size) - r;\n        if (d1 > 0. || d2 < 0.) break;\n    }\n    return float(size);\n}\n\nvoid mainImage( out vec4 fragColor, vec2 uv )\n{\n    uv = (2.0*uv-iResolution.xy)/iResolution.y;\n    uv *= 90.;\n\n    float size = map(uv);\n    vec3 col = vec3(0.1,0.5,0.8);\n    col = mix(vec3(0.9,0.9,0.2),col,float(size)/32.);\n\n\n    // cast ray\n    {\n        vec2 ro = vec2(-1.4, 1.6);\n        vec2 rd = normalize(vec2(0.1,-0.6))*rotate(iTime*.1);\n        float d = sdSegment(uv, ro, ro+rd*200.);\n\n        vec2 deltaDist = abs(vec2(length(rd)) / rd)*sign(rd);\n        vec2 pos = ro;\n        for (int i=0; i<30; i++) {\n            float size = map(pos);\n            vec2 sideDist = (max(sign(rd),0.0)*size - mod(pos,size)) *deltaDist;\n            vec2 mask = step(sideDist.xy, sideDist.yx);\n            float t = min(sideDist.x, sideDist.y);\n            pos += rd*t + sign(rd)*mask*0.00001;\n\n            float d2 = length(uv-pos)-0.8; d = min(d, d2);\n        }\n\n        col = mix(col, vec3(0.8,0.2,0.7), 1.-smoothstep(0.0,1.0,d));\n    }\n\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}