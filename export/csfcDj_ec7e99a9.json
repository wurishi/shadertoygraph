{"ver":"0.1","info":{"id":"csfcDj","date":"1687196307","viewed":43,"name":"voronoi_differential","username":"pik","description":"sample","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["voronoi"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec2 hash(vec2 p){\n    p*=mat2(86.,-78.,-781.,538.);\n    return fract(sin(p)*176575.);\n}\n\nfloat norm(vec2 p,float n){\n    p=pow(p,vec2(n));\n    return pow(p.x+p.y,1./n);\n}\n\nvec3 voronoi(vec2 p){\n    vec2 n=floor(p);\n    vec2 f=p-n;\n    vec2 res=vec2(10.);\n    vec2 point;\n    for(float i=-1.;i<=1.;i++){\n        for(float j=-1.;j<=1.;j++){\n            vec2 b=vec2(i,j);\n            point=hash(n+b);\n            vec2 l=point+b-f;\n            float g=norm(l,8.);\n            if(g<res.x){\n                res.y=res.x;\n                res.x=g;\n            }\n            else if(g<res.y){\n                res.y=g;\n            }   \n        }\n    }\n    return vec3(res.x,point);\n}\n\nvec2 voronoidifferential(vec2 p,float n){\n    float eps=0.01;\n    return vec2(voronoi((p+vec2(eps,0.))*n).x-voronoi(p*n).x,\n                 voronoi((p+vec2(0.,eps))*n).x-voronoi(p*n).x);\n}\n\nfloat sphere(vec3 p){\n    return length(p)-2.;\n}\nvec3 bg(vec3 rd){\n    return mix(vec3(0.2,0.3,0.8),vec3(0.7,0.1,0.2),(rd.x*rd.x*(-rd.x)*(-rd.y)+1.));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy*2.-1.;\n    uv.x*=iResolution.x/iResolution.y;\n    vec3 col;\n    //differential\n    float st=voronoi(uv*6.).x;\n    float eps=0.01;\n    vec2 ff=voronoidifferential(uv,6.);\n    float d=smoothstep(0.06,0.0,length(ff))*step(0.4,st);\n    \n    //cam\n    vec3 rd=normalize(vec3(uv.x,uv.y,1.));\n    vec3 ro=vec3(0.,0.,-3.);\n    vec3 p=ro;\n    float l=0.;\n    for(int i=0;i<30;i++){\n        p=ro+rd*l;\n        float d=sphere(p);\n        if(d<eps)break;\n        l+=d;\n    }\n    if(l<10.){\n        vec2 ffxy=voronoidifferential(p.xy,6.);\n        float stxy=voronoi(p.xy*6.).x;\n        float o=smoothstep(0.06+pow(sin(iTime+hash(vec2(iTime,-iTime)).x),32.)*0.06,0.,length(ffxy));\n        col=vec3(o*o*o,o,o*o)*5.;\n    }\n    else col=vec3(1.-d)*bg(rd);\n    col=pow(col,vec3(1./2.2));\n    \n    // Output to screen\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}