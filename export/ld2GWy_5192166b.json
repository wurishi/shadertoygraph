{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"texture","id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":2,"type":"texture","id":"4sXGRn","filepath":"/media/a/95b90082f799f48677b4f206d856ad572f1d178c676269eac6347631d4447258.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"float sdrBox(vec3 p, vec3 b, float r) {\n    vec3 d = abs(p) - b;\n    return min(max(d.x,max(d.y,d.z)),0.0) + length(max(d,0.0)) - r;\n}\n\nfloat sdCylinder(vec3 p, vec2 h) {\n    return max( length(p.xz)-h.x, abs(p.y)-h.y );\n}\n\n\n\n/***********************************************/\nfloat terrain(vec3 p) {\n    float q=smoothstep(0.1, 0.6, texture(iChannel0, p.xz*0.002).x)*0.22;\n    float h= q + texture(iChannel0, p.xz*1.6 ).x*0.02;\n    return min(p.y+2.7 +h,p.y+7.0 +h-exp(length(p.xz*0.07)));   \n}\n/***********************************************/\n\nfloat ruins(vec3 p) {\n    vec3 q=p;\n    \n    //bumps\n    float o= texture(iChannel0, p.xy*0.1 ).x*texture(iChannel0, p.yz*0.1 ).x*0.005;\n\n    //pillars bottom\n    p.x=clamp(p.x,-8.0,8.0);                                     //limit x\n    if ((p.z<2.0 && p.z>-2.0) && (p.x<0.0 && p.x>-4.0)) p.x=0.0; //chop hole in middle \n\n    p.x=mod(p.x,2.0)-0.5*2.0;                                    //rep x\n\n    p.z=clamp(p.z,-4.0,4.0);                                     //limit z\n    if (q.x>2.0 || q.x<-6.0) p.z=clamp(p.z,-2.0,2.0);\n    p.z=mod(p.z,2.0)-0.5*2.0;                                    //rep z\n\n    float r= 0.5-clamp( sin(p.y*1.2+1.58)*0.5, 0.0,0.05);\n    float d=sdCylinder(p, vec2(r,1.5)) -o;\n\n    //pillars top\n    p.y-=2.8;\n    r= 0.4-clamp( sin(p.y*1.8+0.8)*0.5, 0.0,0.05);\n    \n    float h=1.5;\n    if (q.x>2.0) { p.y-=0.5; h=2.0; r=0.4-clamp( sin(p.y*1.15+1.1)*0.5, 0.0,0.05); } //pull first 3x2 pillars up\n    float t=sdCylinder(p, vec2(r,h)) -o;    \n\n    //mid platform\n    q.y-=1.8;\n    float c=sdrBox(q, vec3(7.45,0.25,1.45), 0.05) -o;\n    q.x+=2.0;\n    c=min(c, sdrBox(q, vec3(3.45,0.25,3.45), 0.05) -o);\n\n    //bottom platform\n    q.y+=3.55;\n    c=min(c, sdrBox(q, vec3(3.65,0.2,3.65), 0.05) -o);\n    q.x-=2.0;\n    c=min(c, sdrBox(q, vec3(7.65,0.2,1.65), 0.05) -o);\n    \n    //ground platform\n    q.x+=2.0;\n    q.y+=0.8;\n    c=min(c, sdrBox(q, vec3(4.65,0.6,4.65), 0.05) -o);\n    q.x-=2.0;\n    c=min(c, sdrBox(q, vec3(8.65,0.6,2.65), 0.05) -o);\n    \n    //top part\n    q.y-=8.0;\n    q.x-=5.0;\n    c=min(c, sdrBox(q, vec3(2.45,0.15,1.45), 0.05) -o);\n    c=max(c, -sdrBox(q, vec3(1.45,0.25,0.45), 0.05) -o);    //left hole\n    \n    //top right part\n    q.y+=1.0;\n    q.x+=6.0;\n    c=min(c, sdrBox(q, vec3(4.50,0.15,1.65), 0.05) -o);\n    q.x+=1.0;\n    q.z-=0.85;\n    c=min(c, sdrBox(q, vec3(3.45,0.15,2.5), 0.05) -o);\n    q.z+=0.85;\nc=max(c, -sdrBox(q, vec3(2.25,4.5,2.25), 0.05) -o);    \n    \n    d=min(min(c,d),t);\n\t\n    return d;\n}\n/***********************************************/\nvec2 opU(vec2 a, vec2 b) {\n\treturn mix(a, b, step(b.x, a.x));\n}\n\n/***********************************************/\n#define pi 3.14\n#define pi2 pi*0.5\n\nvec2 trees(vec3 p){\n    float l=8.0;\n    float s=4.0;\n    \n    p.y-=4.0;\n    \n    //bumps\n    float o= texture(iChannel2, p.xy*0.1 ).x*2.2;\n    \n   \tfloat r=1./l;\n\tfloat ofs=s+s/(r*2.0);\n\n\tfloat a= mod( atan(p.x, p.z) + pi2*r, pi*r) -pi2*r;\n\tp.xz=vec2(sin(a),cos(a))*length(p.xz) -ofs;\n\tp.x+=ofs;\n\n    vec2 q=vec2(length(p)-s -o ,3.0);\n    \n    p.y+=6.0;\n    return opU(q, vec2(sdCylinder(p,vec2(0.7,2.0)),4.0));\n\n}\n\n/***********************************************/\nvec2 DE(vec3 p) {\n\n\tvec2 r=vec2( ruins(p), 1.0); \n//\tvec2 r=vec2( length(p)-1.0, 1.0);\n\t\n    vec2 t=vec2( terrain(p),2.0);\n    vec2 b=trees(p);\n\n\treturn opU(opU(r,t),b);\n}\n/***********************************************/\nvec3 normal(vec3 p) {\n\tvec3 e=vec3(0.01,-0.01,0.0);\n\treturn normalize( vec3(\te.xyy*DE(p+e.xyy).x +\te.yyx*DE(p+e.yyx).x +\te.yxy*DE(p+e.yxy).x +\te.xxx*DE(p+e.xxx).x));\n}\n/***********************************************/\nvoid rot( inout vec3 p, vec3 r) {\n\tfloat sa=sin(r.y); float sb=sin(r.x); float sc=sin(r.z);\n\tfloat ca=cos(r.y); float cb=cos(r.x); float cc=cos(r.z);\n\tp*=mat3( cb*cc, cc*sa*sb-ca*sc, ca*cc*sb+sa*sc,\tcb*sc, ca*cc+sa*sb*sc, -cc*sa+ca*sb*sc,\t-sb, cb*sa, ca*cb );\n}\n/***********************************************/\nvec3 tex3D(vec3 pos, vec3 nor, sampler2D s) {\n\treturn texture( s, pos.yz).xyz*abs(nor.x)+\n\t       texture( s, pos.xz).xyz*abs(nor.y)+\n\t       texture( s, pos.xy).xyz*abs(nor.z);\n}\nfloat csh( vec3 ro, vec3 rd, float mint, float maxt, float k ) {\n    float res = 1.0;\n    float dt = 0.02;\n    float t = mint;\n    for( int i=0; i<10; i++ ) {\n        float h = DE( ro + rd*t ).x;\n        res = min( res, k*h/t );\n        t += max( 0.05, dt )*8.0;\n    }\n    return clamp( res, 0.0, 1.0 );\n}\n/***********************************************/\nvec3 fog(vec3 col, float d, vec3 p ) {\n    p.y-=1.5;\n\tfloat n=smoothstep(-2.5,0.5,terrain(p));\n\tfloat fog=exp(-0.05 * d*d);\n\treturn mix(vec3(0.6), col, n*fog);\n}\n/***********************************************/\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    vec2 p = -1.0 + 2.0 * fragCoord.xy / iResolution.xy;\n    p.x *= iResolution.x/iResolution.y;\t\n\tvec3 ta = vec3(0.0, 0.0, 0.0);\n\tvec3 ro =vec3(0.0, 0.0, -14.0);\n\tvec3 lig=normalize(vec3(-2.0, 6.0, -4.0));\n\t\n\tvec2 mp=iMouse.xy/iResolution.xy;\n\trot(ro,vec3(mp.x,mp.y,0.0));\n\trot(lig,vec3(mp.x,mp.y,0.0));\n\n    /* animate camera */\n    rot(ro,vec3(iTime*0.2, \n     (sin(iTime*0.2)*0.3+0.3) + (cos(2.24+iTime*0.1)*0.5+0.5),\n    0.0));\n    \n\n\tvec3 cf = normalize( ta - ro );\n    vec3 cr = normalize( cross(cf,vec3(0.0,1.0,0.0) ) );\n    vec3 cu = normalize( cross(cr,cf));\n\tvec3 rd = normalize( p.x*cr + p.y*cu + 2.5*cf );\n\n\tvec3 col=vec3(0.0);\n\t/* trace */\n\tvec2 r=vec2(0.0);\t\n\tfloat f=0.0;\n\tvec3 ww;\n\tfor(int i=0; i<90; i++) {\n\t\tww=ro+rd*f;\n\t\tr=DE(ww);\t\t\n\t\tif( r.x<0.0 ) break;\n\t\tf+=r.x;\n\t}\n\t/* draw */\n\tif( f<50.0 ) {\n\t\tvec3 nor=normal(ww);\n\n\t\tif (r.y==1.0) {\n\t\t\tcol=vec3(1.5)*tex3D(ww*0.3, nor, iChannel1)*(DE(ww+nor).x*.5+.5)*(DE(ww+nor*.5).x+.5);\n//\t\t    col=vec3(1.5)*tex3D(ww*0.3, nor, iChannel1);\n\t\t        //add moss\n\t\t        vec3 m=tex3D(ww*0.1, nor, iChannel2);\n\t\t        col=mix(col,(vec3(0.1,1.0,0.3)-m)*0.2,sin(m.y));\n\t\t}\n\t\tif (r.y==2.0) {\n\t\t    col=vec3(0.55,1.0,0.65)*texture( iChannel2, ww.xz*0.02).xyz*0.7;\n\t\t}\n\t\tif (r.y==3.0) {\n\t\t    col=vec3(0.15,0.45,0.25)*tex3D(ww*0.4, nor, iChannel2);\n\t\t}\n\t\tif (r.y==4.0) {\n\t\t    col=vec3(0.4,0.2,0.1)*tex3D(ww*0.4, nor, iChannel2);\n\t\t}\n\t\t\n\t\t\tfloat amb =0.3;//0.1*ww.y/2.0;\n\t\t\tfloat dif =0.7*clamp(dot(lig, nor), 0.0,1.0);\n\t\t\tfloat bac =0.2*clamp(dot(nor,-lig), 0.0,1.0);\n\t\t\tfloat sh=csh(ww, lig, 0.05, 2.0, 8.0);\n\t\tcol*=(amb+dif+bac+sh);\n\n\tcol=fog(col,1./f,ww);\n\n\tcol*=exp(.06*-f); col*=2.0;\t\n\tcol*=exp(.01*-f); col*=0.9;\t\n\t\n\n\t} else {\n\n\tcol=vec3(0.7,0.8,1.0)*texture( iChannel2, rd.yx*0.1).xyz*2.2;\n\t    \n\t}\n\t\n\t\n\tfragColor = vec4( col, 1.0 );\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"ld2GWy","date":"1393116925","viewed":1873,"name":"Temple ruins","username":"avix","description":"Really old abandoned temple somewhere in the woods...\nUse mouse to adjust view\ni know..camera path suxxx...","likes":36,"published":1,"flags":0,"usePreview":0,"tags":["procedural","3d","raymarch","fog"],"hasliked":0,"parentid":"","parentname":""}}