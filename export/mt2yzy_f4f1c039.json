{"ver":"0.1","info":{"id":"mt2yzy","date":"1691960462","viewed":57,"name":"another automata 2","username":"jonasfrey","description":"i dont know why the sudden color invert happens...","likes":1,"published":1,"flags":32,"usePreview":0,"tags":["sand"],"hasliked":0,"parentid":"dtScW1","parentname":"another automata 1 "},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 o_trn_pixel = fragCoord;\n    vec4 o_col_last = texelFetch(iChannel0, ivec2(o_trn_pixel.xy), 0);\n    //fragColor = (iFrame % 2 == 0 ? o_col_last : 1.-o_col_last);\n    fragColor = o_col_last;\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"float f_n_rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\n#define n_tau 6.2831\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    \n\n    vec2 o_trn_pixel = fragCoord;\n    vec2 o_trn_mouse = iMouse.xy; \n    \n    vec2 o_trn_pixel_nor = f_o_trn_nor(o_trn_pixel, iResolution);\n    vec2 o_trn_mouse_nor = f_o_trn_nor(o_trn_mouse, iResolution);\n    float n_t = iTime*5.;\n    if(iMouse.w == 0.){\n        o_trn_mouse_nor = vec2(sin(n_t/2.)*2., cos(n_t*2.))*.2;\n    }\n    //fragColor = vec4(o_trn_mouse_nor.xy, o_trn_mouse_nor.xy);\n    vec4 o_col_last = texelFetch(iChannel0, ivec2(o_trn_pixel_nor.xy), 0);\n    //fragColor = vec4(abs(o_trn_mouse_nor.xy), o_col_last.y, o_col_last.z);\n    \n    //return;\n    float n_rnd_fixed = f_n_rand(o_trn_pixel_nor);\n    float n_rnd = f_n_rand(o_trn_pixel_nor+sin(iTime));\n\n    vec4 o_col_last_sum = vec4(0);\n    vec4 o_col_last_min = vec4(1.);\n    ivec2 o_scl_krn = ivec2(9.);\n    float n_min = 4.;\n    float n_summands = 0.;\n    for(int n_x = 0; n_x < o_scl_krn.x; n_x+=1){\n        for(int n_y = 0; n_y < o_scl_krn.x; n_y+=1){\n            ivec2 o_trn = ivec2(o_trn_pixel.xy)+ivec2(n_x, n_y)-ivec2(o_scl_krn/2);\n            float n_rnd_current = f_n_rand(vec2(o_trn));\n            if(n_rnd_current > n_rnd_fixed*.5+.4){\n                continue;\n            }\n            vec2 o_trn_nor = (vec2(n_x, n_y)-vec2(o_scl_krn)*.5)/ vec2(o_scl_krn);\n            float n_dist = length(o_trn_nor);\n            if(n_dist > (0.2+n_rnd)){\n                continue;\n            }\n            o_trn += ivec2(round(o_trn_mouse_nor*2.));\n            n_summands +=1.;\n            vec4 o_col_last = texelFetch(iChannel0, o_trn, 0);\n            float n = o_col_last.x + o_col_last.y + o_col_last.z + o_col_last.w;\n            if(n < n_min){\n                n_min = n; \n                o_col_last_min = o_col_last;\n            }\n            o_col_last_sum+=o_col_last;\n        }\n    }\n    \n    vec2 o_diff = o_trn_mouse_nor.xy-o_trn_pixel_nor.xy;\n    float n_dist = 1.-length(o_diff);\n    float n_ang = atan(o_diff.y, o_diff.x)/n_tau+.5;\n\n    vec4 o_col_last_sum_nor = o_col_last_sum / n_summands;\n    float n_min_nor = n_min / 4.;\n    //fragColor = vec4(n_rnd);\n    //return;\n    if(o_col_last_sum_nor.x > 0.5 ){\n        fragColor = vec4(1.+(n_rnd-.5)*.2);\n    }\n\n    if(n_dist > 0.9){\n        fragColor = vec4(n_rnd);\n    }\n    \n    //fragColor = clamp(fragColor, vec4(0), vec4(1));\n    \n}\n\n","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"vec2 f_o_trn_nor( vec2 o , vec3 iResolution)\n{\n    return ((o.xy-iResolution.xy*.5) / iResolution.y);\n}","name":"Common","description":"","type":"common"}]}