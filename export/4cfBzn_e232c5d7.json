{"ver":"0.1","info":{"id":"4cfBzn","date":"1724614517","viewed":35,"name":"xo raymarching 2","username":"x_540","description":"it works now :D (thanks spalmer!)","likes":1,"published":3,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const int mainSdfLength = 2;\n\nvec4 add(vec4 a, vec4 b) {\n    return(vec4(a.xyz,min(a.w,b.w)));\n}\n\nvec4[mainSdfLength] mainSdf(vec3 pos) {\n    vec4 col[mainSdfLength];\n    col[0] = vec4(0.9,0.0,1.0,distance(pos,vec3(0.0,0.0,5.0)) - 2.0);\n    col[1] = vec4(0.9,0.9,0.9,pos.y+2.0);\n    return col;\n}\n\nvec4 getMinW(vec4[mainSdfLength] array) {\n    vec4 minDist = vec4(0.0,0.0,0.0,900000.0);\n\n    for(int i = 0; i < array.length(); i++) {\n        if (minDist.w > array[i].w) {\n            minDist = array[i];\n        }\n    }\n    \n    return(minDist);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    const float fov = 2.094395;\n    vec3 origin = vec3(0.0);\n    const float epsilon = 0.01;\n    const float infinity = 5000.0;\n    const int maxBounces = 50;\n    const int maxItters = 10000;\n    int debugMode = 0;\n    \n    vec2 angle = (fragCoord/iResolution.xy - 0.5) * vec2(fov,fov * iResolution.y/iResolution.x);\n    vec3 dir = vec3(sin(angle.x) * cos(angle.y),sin(angle.y),cos(angle.x)*cos(angle.y));\n    vec3 col = vec3(1.0);\n    \n    \n    int itter;\n    \n    \n    for(int bounce = 0; bounce < maxBounces + 1; bounce++) {\n        float dist;\n        \n        if(bounce == 0) {\n            dist = 0.0;\n        } else {\n            dist = 2.0 * epsilon;\n        }\n        bool hit = false;\n        \n        for(itter = 0; itter < maxItters; itter++) {\n            vec4[mainSdfLength] distances = mainSdf(dir * dist + origin);\n\n            vec4 minDist = getMinW(distances);\n            dist += minDist.w;\n            \n            if(minDist.w >= infinity) {\n                col *= vec3(0.8,0.9,0.9);\n                \n                break;\n            }\n\n            if(minDist.w <= epsilon) {\n                col *= minDist.xyz;\n                hit = true;\n                break;\n            } \n        }\n        \n        if(!hit) {\n            break;\n        }\n        \n        origin = (dir * dist) + origin;\n        \n        vec3 normal = normalize(vec3(\n        getMinW(mainSdf(origin + vec3(epsilon,0.0,0.0))).w - getMinW(mainSdf(origin - vec3(epsilon,0.0,0.0))).w,\n        getMinW(mainSdf(origin + vec3(0.0,epsilon,0.0))).w - getMinW(mainSdf(origin - vec3(0.0,epsilon,0.0))).w,\n        getMinW(mainSdf(origin + vec3(0.0,0.0,epsilon))).w - getMinW(mainSdf(origin - vec3(0.0,0.0,epsilon))).w));\n        \n        dir = reflect(dir,normal);\n        \n        if(debugMode == 1) {\n            col = normal/2.0+vec3(0.5);\n            break;\n        }\n        if(debugMode == 2) {\n            col = dir/2.0+vec3(0.5);\n            break;\n        }\n    }\n    \n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}