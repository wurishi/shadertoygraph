{"ver":"0.1","info":{"id":"cdt3zl","date":"1677694974","viewed":72,"name":"Golfed marched cube","username":"ianertson","description":"Just wanted to try some golfing.\nTried to fit shadows, specular highlights and some kind of \"sky\" in as few lines of code as I could without things being ridiculous.","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["raymarch","cube","march","golf"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","previewfilepath":"/media/ap/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","type":"texture","channel":3,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsfGRn","filepath":"/media/a/1f7dca9c22f324751f2a5a59c9b181dfe3b5564a04b724c657732d0bf09c99db.jpg","previewfilepath":"/media/ap/1f7dca9c22f324751f2a5a59c9b181dfe3b5564a04b724c657732d0bf09c99db.jpg","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define R (iResolution.xy)\n#define T (iTime)\n#define M_PI (3.14159265359)\n#define TAU (M_PI * 2.0)\n#define ZERO (min(0, int(iTime)))\n#define NEAR 0.009\n#define FAR 64.\n#define STEPS 96\n#define BY (0.5 + 0.06 + (0.5+(0.5*sin(T))))\nmat2 rot(in float a) { float c = cos(a); float s = sin(a); return mat2(c, s, -s, c); }\nfloat boxSDF(in vec3 p, in vec3 s) {p = abs(p) - s; return length(max(p, 0.0)) + min(max(p.x, max(p.y, p.z)), 0.);}\nfloat sdf(in vec3 p, inout int id, int s) { float a = boxSDF(p - vec3(0, BY, 0), vec3(0.5)) - 0.05; float b = p.y; id = (a < b && s != 0) ? 0 : 1; return min(a+(100.0*float(s == 0)), b+(100.0*float(s == 1)));}\nvec3 tex(in int id, in vec2 uv) { return id == 0 ? texture(iChannel3, uv).rgb : texture(iChannel2, uv).rgb; }\n\nvoid mainImage( out vec4 O, in vec2 fc )\n{\n    vec3 col = vec3(0.0); vec3 ro = vec3(0, 0.5, -4.);\n    vec3 rd = normalize(vec3(((fc-0.5*R.xy)/R.y).xy, 1.0));\n    vec4 m = vec4((iMouse.xy-0.5*R.xy)/R.y, iMouse.zw);\n    float c = float(m.z < 0.01);\n    float ry = mix(m.y*TAU, 0.0, c); float rx = mix(m.x*TAU, T*0.2, c);\n    ro.yz *= rot(ry);ro.xz *= rot(rx);rd.yz *= rot(ry);rd.xz *= rot(rx);\n    ro.y = max(0.8, ro.y);\n    float d, h = 0.0;\n    float k = 100.;\n    const vec3 L = normalize(vec3(1, 2, -3.));\n    for (int i = ZERO; i < STEPS; i++) {\n        int id = 0;\n        float next = sdf(ro+rd*d, id, -1);d += next;\n        if (abs(d) >= FAR) break;\n        if (abs(next) <= (NEAR * (1.0 + (abs(d)/2.)))) {\n            h = 1.0;\n            k = d;\n            vec3 p = ro+rd*d;\n            vec2 e = vec2(0.001, 0.0);\n            vec3 n = normalize(sdf(p, id, -1) - vec3(sdf(p - e.xyy, id, -1),sdf(p - e.yxy,id, -1),sdf(p - e.yyx,id, -1)));\n            vec3 ro2 = p+(n*NEAR*2.);vec3 rd2 = L;float d2 = 0.0;\n            float s = 1.0;\n            for (int j = ZERO; j < STEPS; j++) {\n               int id2 = 0;\n               float next = sdf(ro2+rd2*d2, id2, id); d2 += next;\n               if (abs(d2) >= FAR) break;\n               if (abs(next) <= NEAR) {\n                   s = clamp(d2/(1.0+d2), 0.1, 0.9);\n                   break;\n               }\n            }\n            p -= vec3(0,BY,0)*float(id==0);\n            col += ((tex(id,mix(mix(p.xy, p.xz, round(abs(dot(n, vec3(0, 1, 0))))),p.yz, round(abs(dot(n, vec3(1, 0, 0)))))).rgb / M_PI)\n                + (pow(max(0.0, dot(reflect(L, n), rd)), 64.0)*s*s*s)) * max(0.1, dot(n, L)) * s;\n            break;\n        }\n    }\n    float du = max(0.0, dot(rd, vec3(0, 1, 0)));\n    col += pow(vec3(0.26, 0.66, 0.9), vec3(1.0+du)) * max(0.0, 1.0-h);\n    col += pow((k / FAR), 2.)*max(0.0, 1.0-smoothstep(0.0, 0.5, du));\n    O = vec4(pow(col / (vec3(1.0) + col), vec3(1.0 / (2.2))), 1.0);\n}","name":"Image","description":"","type":"image"}]}