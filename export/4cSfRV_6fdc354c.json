{"ver":"0.1","info":{"id":"4cSfRV","date":"1725168076","viewed":12,"name":"colored diffuse lighting","username":"dragonmuffin","description":"colored diffuse lighting","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["3d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const int MAX_STEPS = 1000;\nconst float FAR = 80.;\nconst float EPS = 0.0001;\nconst vec3 CAM_POS = vec3(0.);\nconst vec3 RED = vec3(1.,0.,0.);\nconst vec3 BLUE = vec3(0.,0.,1.);\nconst vec3 BACKGROUND = vec3(0.,.5,.5);\nconst vec3 LGRAY = vec3(.8);\nconst vec3 DGRAY = vec3(.1);\nconst float AMBIENT = .4;\nconst float DIFFUSE = 1. - AMBIENT;\n//const vec3 LIGHT_POS = vec3(2., 0., 0.);\n\nfloat SphereSdf(in vec3 center, in float radius, in vec3 crd) {\n    return length(crd-center)-radius;\n}\n\nfloat FloorSdf(in vec3 crd) {\n    return abs(crd.z+3.);\n}\n\nvec4 colmin(vec4 a,vec4 b) {// minimum with color\n    return (a.x < b.x)?a:b;\n}\n\nvec4 SceneSdf(in vec3 crd) {\n    vec4 d = vec4(SphereSdf(vec3(0.,1.,0.), .1, crd),RED);\n    d = colmin(d,vec4(FloorSdf(crd),(mod(floor(crd.x)+floor(crd.y),2.0) > 0. ? LGRAY : DGRAY)));\n    return d;\n}\n\nvec3 calc_norm(in vec3 p) {\n    const float eps = 0.001;\n    const vec2 h = vec2(eps,0);\n    return normalize(vec3(SceneSdf(p + h.xyy).x - SceneSdf(p - h.xyy).x,\n                          SceneSdf(p + h.yxy).x - SceneSdf(p - h.yxy).x,\n                          SceneSdf(p + h.yyx).x - SceneSdf(p - h.yyx).x));\n}\n\nfloat RayMarch(in vec3 start, in vec3 orientation) {\n    vec3 pos = start;\n    float dist;\n    float depth = 0.;\n    for(int i=0;i<MAX_STEPS;i++) {\n        dist = SceneSdf(pos).x;\n        if(dist<EPS || depth>FAR) {\n            break;\n        }\n        depth += dist;\n        pos = start + orientation * depth;\n    }\n    return depth;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    vec3 LIGHT_POS = vec3(3.*sin(iTime*3.),3.*cos(iTime*3.),0.);\n    vec2 uv = fragCoord/iResolution.xy-0.5;\n    uv.x *= iResolution.x/iResolution.y;\n    vec3 orientation = normalize(vec3(uv.x,1.,uv.y));\n    float dpt = RayMarch(CAM_POS,orientation);\n    if(dpt>FAR) {\n        fragColor = vec4(BACKGROUND,1.);\n        return;\n    }\n    vec3 pos = CAM_POS + orientation * dpt;\n    vec3 norm = calc_norm(pos);\n    vec3 lo = normalize(LIGHT_POS - pos); // light orientation\n    float k = AMBIENT + DIFFUSE * max(dot(norm,lo),0.);\n    vec3 col = SceneSdf(pos).yzw * k;\n    col = vec3(pow(col.x,1./2.2),pow(col.y,1./2.2),pow(col.z,1./2.2));\n    fragColor = vec4(col,1.);\n}\n\n","name":"Image","description":"","type":"image"}]}