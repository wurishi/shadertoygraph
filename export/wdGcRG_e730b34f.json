{"ver":"0.1","info":{"id":"wdGcRG","date":"1603099050","viewed":152,"name":"Example 45 - raytracinglandscape","username":"jt","description":"Simple & inefficient way to raytrace a heightmap with normals.","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["raytracing","example","heightmap"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec2 lookup(vec2 p)\n{\n    return (p + vec2(iTime, 0.0)) / 5.0;\n}\n\nfloat heightmap(vec2 p)\n{\n    return texture(iChannel0, lookup(p)).x;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec3 d = vec3(2.0 * fragCoord/iResolution.xy - 1.0, 1.0);\n    \n    fragColor = vec4(0.0, 0.0, 0.5, 1.0);\n    \n    float s = 0.001;\n    s /= abs(d.y); // larger step-size for shallow rays\n    bool hit = false;\n    vec3 q;\n    for(q = vec3(0.0); abs(q.y) < 1.0; q += d * s)\n    {\n        float c = heightmap(q.xz);\n        float h = 1.0 * c - 1.0;\n        if(q.y < h)\n        {\n            hit = true;\n            break;\n        }\n    }\n    if(hit)\n    {\n        float W = heightmap(q.xz + vec2(-1.0,0.0)/iResolution.xy);\n        float O = heightmap(q.xz + vec2(+1.0,0.0)/iResolution.xy);\n        float S = heightmap(q.xz + vec2(0.0,-1.0)/iResolution.xy);\n        float N = heightmap(q.xz + vec2(0.0,+1.0)/iResolution.xy);\n        vec3 n = normalize(vec3(O - W, N - S, 0.01));\n        //fragColor = vec4(c);\n        //fragColor = vec4(n.z);\n        float brightness = dot(n, normalize(vec3(1.0, 0.0, 1.0))); // lighting\n        fragColor = vec4(brightness); \n    }\n}\n","name":"Image","description":"","type":"image"}]}