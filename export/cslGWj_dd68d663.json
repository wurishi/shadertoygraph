{"ver":"0.1","info":{"id":"cslGWj","date":"1666861303","viewed":198,"name":"singing in the rain","username":"Mojomajor","description":"an example i found and cleaned up a bit for use in a game or so\n\noriginal:\nhttps://www.shadertoy.com/view/Mstczs","likes":1,"published":1,"flags":0,"usePreview":1,"tags":["rainnoisergba"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","previewfilepath":"/media/ap/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define saturate(x) clamp(x,0.,1.)\n#define rgb(r,g,b) (vec3(r,g,b)/255.)\n#define time iTime*1.5\n#define LIGHTNING 0\n#define LIGHTNING_DETAIL 10\n#define LAYERS 3\n// PI this with sine\n#define DIRECTION .11 \n#define DROP_VISIBILITY .55\n\n//----------------------------------------------------------------------------------------\n\nfloat hash(float x) {\n\treturn fract(21654.6512 * sin(385.51 * x));\n}\n\nfloat hash( in vec2 p ) {\n    return fract(sin(p.x*15.32+p.y*35.78) * 43758.23);\n}\n\nvec2 hash2(vec2 p) {\n\treturn vec2(hash(p*.754),hash(1.5743*p.yx+4.5891))-.5;\n}\n\nvec2 hash2b(vec2 p) {\n\treturn vec2(hash(p*.754),hash(1.5743*p+4.5476351));\n}\n\nvec2 add = vec2(1.0, 0.0);\n\nvec2 noise2(vec2 x) {\n    vec2 p = floor(x);\n    vec2 f = fract(x);\n    f = f*f*(3.0-2.0*f);\n\n    vec2 res = mix(mix( hash2(p),          hash2(p + add.xy),f.x),\n                    mix( hash2(p + add.yx), hash2(p + add.xx),f.x),f.y);\n    return res;\n}\n\nvec2 fbm2(vec2 x) {\n    vec2 r = vec2(0.0);\n    float a = 1.0;\n\n    for (int i = 0; i < LIGHTNING_DETAIL; i++)\n    {\n        r += abs(noise2(x)+.5 )* a;\n        x *= 2.;\n        a *= .5;\n    }\n\n    return r;\n}\n\nfloat dseg( vec2 ba, vec2 pa ) {\n\tfloat h = clamp( dot(pa,ba)/dot(ba,ba), -0.2, 1. );\n\treturn length( pa - ba*h );\n}\n\nfloat arc(vec2 x,vec2 p, vec2 dir) {\n    vec2 r = p;\n    float d=10.;\n    for (int i = 0; i < 5; i++)\n    {\n        vec2 s= noise2(r+time)+dir;\n        d=min(d,dseg(s,x-r));\n        r +=s;\n    }\n    return d*3.;\n}\n\nfloat thunderbolt(vec2 x,vec2 tgt) {\n    vec2 r = tgt;\n    float d=1000.;\n    float dist=length(tgt-x);\n\n    for (int i = 0; i < 19; i++) {\n        if(r.y>x.y+.5)break;\n        vec2 s= (noise2(r+time)+vec2(0.,.7))*2.;\n        dist = dseg(s,x-r);\n        d=min(d,dist);\n\n        r +=s;\n        if(i-(i/5)*5==0){\n            if(i-(i/10)*10==0)d=min(d,arc(x,r,vec2(.3,.5)));\n            else d=min(d,arc(x,r,vec2(-.3,.5)));\n        }\n    }\n    return exp(-5.*d)+.2*exp(-1.*dist);\n}\n\n\n//----------------------------------------------------------------------------------------\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord.xy / iResolution.xy;\n\tvec3 col = vec3(0.0);\n\tvec2 q = fragCoord.xy/iResolution.xy;\n\tfloat dis = 1.;\n    //col = vec3(0.0,0.0,0.0);\n    col = mix(rgb(151., 176., 201.), rgb(105, 117, 135), uv.y); //sky gradient\n    float dir = sin(time/2.)*3.14/20.; // DIRECTION\n\tfor (int i = 0; i < LAYERS; i++) {\n\t\tfloat f = float(i);\n\n\t\tvec2 st =  f * (q * vec2(-3.5, .05)+vec2(-time*.1+q.y*dir, time*.07));//y*.2风大小\n        // vec2 st =  f * (q * vec2(1.5, .05)+vec2(-time*.1+q.y*.2, time*.12));\n\t\tf = (texture(iChannel0, st * .5, -99.0).x + texture(iChannel0, st*.5, -99.0).y);\n\t\t//f = clamp(pow(abs(f+fract(float(i)))*.5, 25.0) * 10.0, 0.00, q.y*.4+.05);//y方向越下到底部，透明度降低\n        \n        // pow is too slow\n        float by25 = abs(f)*.5;\n        float by25ed = by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25*by25;\n        f = clamp(\n            //pow(abs(f)*.5, 25.0)\n            by25ed\n            * 10.0, 0.00, \n            q.y*.4+.05\n        );//y方向越下到底部，透明度降低\n        //f = clamp(pow(abs(f)*.5, 29.0) * 140.0, 0.00, q.y*.4+.05);//29.0能见度\n\n\t\tvec3 bri = vec3(DROP_VISIBILITY);//雨可见度\n\t\tcol += bri*f;\n\t}\n\n#if LIGHTNING == 1\n    vec2 p = 2.*fragCoord.xy/iResolution.yy-1.;\n    vec2 d;\n    vec2 tgt = vec2(1., -8.);\n    float c=0.;\n\n    float t = hash(floor(5.*time));\n    tgt+=8.*hash2b(tgt+t);\n    if(hash(t+2.3)>.8)\n\t{\n\t\tc= thunderbolt(p*10.+2.*fbm2(5.*p),tgt);\n\t\tcol+=clamp(1.7*vec3(0.8,.7,.9)*c,0.,1.);\n\t}\n#endif\n\n\tfragColor = vec4(col, .0);\n}\n","name":"Image","description":"","type":"image"}]}