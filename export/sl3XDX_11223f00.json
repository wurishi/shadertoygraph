{"ver":"0.1","info":{"id":"sl3XDX","date":"1639896769","viewed":253,"name":"SpherePack","username":"komrad36","description":"CLICK VIEWPORT to focus\nI and O to zoom in and out\nR to reset zoom\nCLICK AND DRAG to rotate","likes":12,"published":1,"flags":48,"usePreview":0,"tags":["voronoi","sphere","packing"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const int kN = 7000;\nconst float kRotationSpeed = 0.5;\nconst int kNumColors = 33;\n\nconst float kPi = 3.141592654;\nconst float kS = 2.0 / float(kN - 1);\n\nfloat Sdf(in vec3 ro, in vec3 rd)\n{\n    float a = dot(rd, rd);\n    float b = 2.0 * dot(rd, ro);\n    float c = dot(ro, ro) - 1.0;\n    float discr = b * b - 4.0 * a * c;\n    return discr < 0.0 ? -1.0 : (-b - sqrt(discr))/(2.0 * a);\n}\n\nvec3 BgColor(in vec3 rd)\n{\n    return mix(vec3(0.01), vec3(0.33, 0.45, 0.66), 1.0 - pow(abs(rd.z + 0.25), 1.3));\n}\n\nvec3 Idx2Cell(in int i)\n{\n    float u = kS * float(i) - 1.0;\n    float t = mod(10.166407384630519 * float(i), 2.0 * kPi);\n    float r = sqrt(1.0-u*u);\n    return vec3(r*cos(t), r*sin(t), u);\n}\n\nvec3 Idx2Color(in int i)\n{\n    float h = fract(sin(mod(float(i % kNumColors) * 4.960957, 2.0 * kPi)) * 47451.0);\n    vec3 c = clamp(abs(mod(6.0 * h + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);\n    return c * c * (3.0 - 2.0 * c);\n}\n\nvec3 CellColor(in vec3 p)\n{\n    const int kScanRange = max(100, kN / 50);\n    float bestD = 0.0;\n    int bestI = 0;\n    for (int j = 0, testI = int((p.z + 1.0) / kS); j <= 2 * kScanRange; ++j)\n    {\n        int i = clamp(testI - kScanRange + j, 0, kN - 1);\n        float d = dot(Idx2Cell(i), p);\n        bestI = d > bestD ? i : bestI;\n        bestD = max(bestD, d);\n    }\n    vec3 r = Idx2Cell(bestI) - p;    \n    return dot(r, r) < 2e-6 ? vec3(1.0) : Idx2Color(bestI);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    float mY = (1.0 - 1.15 * iMouse.y / iResolution.y) * 0.5 * kPi;\n    float mX = -2.0 * kPi - 0.25 * iTime * kRotationSpeed - iMouse.x / iResolution.x * 2.0 * kPi;\n    float camZ = 0.4 * texelFetch(iChannel0, ivec2(0), 0).x;\n    vec3 cam = camZ * vec3(cos(mX) * cos(mY), sin(mX) * cos(mY), sin(mY));\n    vec3 w = normalize(-cam);\n    vec3 u = iMouse.y == 0.0 ? vec3(sin(mX), -cos(mX), 0.0) : normalize(cross(w, vec3(0.0, 0.0, 1.0)));\n    vec3 v = iMouse.y == 0.0 ? vec3(cos(mX), sin(mX), 0.0) : cross(u, w);\n    vec2 uv = (fragCoord - 0.5 * iResolution.xy) / iResolution.x;\n    vec3 rd = normalize(w + uv.x * u + uv.y * v);\n    float t = Sdf(cam, rd);\n    fragColor = vec4(t > 0.0 ? CellColor(cam + t * rd) : BgColor(rd), 1.0);\n}\n","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":1,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    if (uvec2(fragCoord) != uvec2(0))\n        return;\n    float x = iFrame == 0 || texelFetch(iChannel1, ivec2(82, 1), 0).x != 0.0\n        ? 10.0 : texelFetch(iChannel0, ivec2(0), 0).x;\n    x += texelFetch(iChannel1, ivec2(79, 1), 0).x;\n    x -= texelFetch(iChannel1, ivec2(73, 1), 0).x;\n    fragColor = vec4(clamp(x, 3.0, 10.0), 0.0, 0.0, 1.0);\n}\n","name":"Buffer A","description":"","type":"buffer"}]}