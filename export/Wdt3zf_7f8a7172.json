{"ver":"0.1","info":{"id":"Wdt3zf","date":"1569114865","viewed":127,"name":"star and planet","username":"shiinamiyuki","description":"new to raymarching","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["sdf"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sf3Rn","filepath":"/media/a/0a40562379b63dfb89227e6d172f39fdce9022cba76623f1054a2c83d6c0ba5d.png","previewfilepath":"/media/ap/0a40562379b63dfb89227e6d172f39fdce9022cba76623f1054a2c83d6c0ba5d.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGzn","filepath":"/media/a/a6a1cf7a09adfed8c362492c88c30d74fb3d2f4f7ba180ba34b98556660fada1.mp3","previewfilepath":"/media/ap/a6a1cf7a09adfed8c362492c88c30d74fb3d2f4f7ba180ba34b98556660fada1.mp3","type":"music","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec3 center = vec3(0,0,1);\nfloat sphere1(vec3 p){\n    return length(p - vec3(0,0,1)) - 1.0f;\n}\nvec3 sphere2Center(){\n\treturn vec3(sin(iTime) * 3.7f, 0, cos(iTime)* 3.7f);\n}\nfloat sphere2(vec3 p){\n\treturn length(p - sphere2Center()) -0.3f;\n}\nfloat map(vec3 p){\n\treturn min(sphere1(p),sphere2(p));\n}\n\nvec3 norm(vec3 p){\n\tvec3 eps = vec3(0.0001f,0,0);\n    return normalize(\n    \tvec3(\n        \tmap(p + eps) - map(p - eps),\n            map(p + eps.yxy) - map(p - eps.yxy),\n            map(p + eps.yyx) - map(p - eps.yyx)\n        )\n    );\n}\n\n\n\nconst vec3 starColor = vec3(0.8f,0.4f,0.2f);\n\nvec3 star(vec3 p){\n    p = normalize(p - vec3(0,0,1));\n\tfloat u = asin(p.y);\n    float v = atan(p.z,p.x) + iTime * 0.2f;\n    float brightness1 = max(0.2f, texture(iChannel0, 0.4f * vec2(u,v)).r * 1.5f);\n    float brightness2 = max(0.2f, texture(iChannel0, 0.4f * vec2(u,v + 0.5f)).r * 1.5f);\n    float brightness = mix(brightness1, brightness2, sin(iTime) * 0.5 + 0.5);\n    return starColor * brightness;\n}\n\n\nvec3 planet(vec3 p){\n\tp = normalize(p - sphere2Center());\n    float u = asin(p.y);\n    float v = atan(p.z,p.x) + iTime;\n    v += sin(u) * 2.0f;\n    float brightness = texture(iChannel1, vec2(u,v)).r;\n    brightness = pow(brightness, 4.0f);\n    return vec3(122, 182, 214)/255.0 * 0.4f + vec3(brightness) * max(1.0f, 0.3 + sin(iTime));\n    \n}\n\nvec3 trace(vec3 o, vec3 d){\n\tfloat t = 0.0f;\n    float minDist = 1e12;\n    vec3 col = vec3(0);\n    float glow = minDist;\n    for(int i = 0;i<30;i++){\n        vec3 p =  o + t * d;\n    \tfloat dist = map(p);\n        \n        minDist = min(sphere1(p), minDist);\n        float alpha = 1.0f;\n        glow = alpha * minDist + (1.0 - alpha) * glow;\n        if(dist < 1e-5){\n            if(sphere1(p) < 1e-5){\n            \tcol +=  star(p);break;\n            }else{\n                vec3 light = -normalize(p - vec3(0,0,1));\n                vec3 n = norm(p);\n            \tcol += (vec3(0.2) + max(0.0f, dot(light, n)) * vec3(0.7) * starColor * 10.0f)*  planet(p);\n                break;\n            }\n        }\n        t += dist + 0.01;\n    }\n    return col + min(1.50f, texture(iChannel2, vec2(0.3)).r * pow(glow - -0.1f, -0.6f)) * starColor;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n\t\n\n    uv.x = 2.0f * uv.x -1.0f;\n    uv.y = 2.0f * (uv.y) - 1.0f;\n    uv.x *= iResolution.x / iResolution.y;\n    vec3 o = vec3(0,0,-6);\n    vec3 d = vec3(uv, 0) - vec3(0,0, -2);\n    d = normalize(d);\n\tvec3 col = trace(o, d);\n    // Output to screen\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}