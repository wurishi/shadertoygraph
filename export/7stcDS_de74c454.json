{"ver":"0.1","info":{"id":"7stcDS","date":"1654079997","viewed":155,"name":"Lightning Simulation 1","username":"niels747","description":"Red and blue indicate positive and negative charge\nYellow / White indicates temperature\n\nPlease play arround with the parameters to try and make it better, cause it's still far from actual lightning.","likes":5,"published":1,"flags":32,"usePreview":0,"tags":["simulation","lightning"],"hasliked":0,"parentid":"fsGXzy","parentname":"Lightning simulation possible?"},"renderpass":[{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n\n    vec4 t = texture(iChannel1,uv);\n    \n    vec4 image = texture(iChannel3,uv + t.xy/100.0);\n    \n    vec2 normMouse = iMouse.xy / iResolution.xy;\n    \n    float light = 0.0;\n    \n    vec2 lightAngle = vec2(-0.5+normMouse.x,-0.5+normMouse.y);\n    light += pow(max(length(lightAngle) - length(t.xy - lightAngle),0.0)/(length(lightAngle)+0.02),4.0); // light reflection\n    \n    float L = t.w*0.1; // temperature\n    \n    float B = length(t.xy);\n\n    fragColor = vec4(t.z +L, L,-t.z +L, 1.0); // charges and temperature\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"/*\nx = horizontal current\ny = vertical current\nz = charge\nw = temperature\n*/\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 center =  fragCoord/iResolution.xy;\n    vec2 right  = (fragCoord + vec2(1,0))/iResolution.xy;\n    vec2 up     = (fragCoord + vec2(0,1))/iResolution.xy;\n    \n    vec4 t = texture(iChannel0,center);\n    \n    // current changes proportional to charge gradient across point\n    float Xvolt = texture(iChannel0,center).z - texture(iChannel0,right).z;\n    float Yvolt = texture(iChannel0,center).z - texture(iChannel0,up).z;\n    \n    t.x += Xvolt;\n    t.y += Yvolt;\n    \n    \n   // t.w = t.w*(1. - tempSmooth*2.) + texture(iChannel0,right).w*tempSmooth + texture(iChannel0,up).w*tempSmooth; // smooth temperature\n   \n    t.w *= tempDecay;\n    \n   // t.z *= 1.0 - max(t.w - 10.0, 0.)*0.001; // drain charge when hot\n    \n    t.w += (t.x * t.x + t.y * t.y) * heatingMult; // heating proportional to square of current\n    \n    float resistance = clamp(1. - (t.w - conductThresh) * conductMult , minResistance, maxResistance);\n    \n    if(sqrt(Xvolt*Xvolt + Yvolt*Yvolt) > breakdownVolt){\n        resistance = minResistance*5.;\n        t.w += 2.5;\n        }\n   \n    t.xy *= 1. - resistance; // resistance reduces current\n    \n    \n    // mouse adds positive charge\n    if(length(iMouse.xy - fragCoord) < 20.1 && iMouse.z > 0.5){\n        t.z += 0.05;\n    }\n    \n    if(iFrame < chargingTime){ // create charge fields\n\n        if(length(vec2(250,220) - fragCoord) < 135.0){ //  left \n            t.z -= chargingRate;\n        }\n        if(length(vec2(525,220) - fragCoord) < 135.0){ //  right \n            t.z += chargingRate;\n        }\n    }\n\n    fragColor = t;\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"/*\nx = horizontal current\ny = vertical current\nz = charge\nw = temperature\n*/\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 center =  fragCoord/iResolution.xy;\n    vec2 left   =  (fragCoord + vec2(-1,0))/iResolution.xy;\n    vec2 down   = (fragCoord + vec2(0,-1))/iResolution.xy;\n\n    vec4 t = texture(iChannel0,center);\n   \n   // charge changes proportional to the net inflow - outflow of the cell\n   t.z += (texture(iChannel0,left).x - texture(iChannel0,center).x + texture(iChannel0,down).y - texture(iChannel0,center).y) *0.5; // multiplier has to be < 0.5\n   \n   fragColor = t;\n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define chargingTime 600\n#define chargingRate 0.025\n\n#define tempSmooth        0.255 // 0.005 heat spreading out. makes the edges smoother and grows very hot paths\n#define tempDecay         0.555 // 0.970 temperature cooling down to 0\n\n#define maxResistance     0.800 // 0.970 resistance of cold air\n#define minResistance     0.015 // 0.005 min resistance of hot air\n\n#define conductThresh     0.30  // 0.20  temperature where conductivy starts to increase\n#define conductMult       0.20  // 0.30  temperature increase increases conductivity\n\n#define heatingMult       0.35  // 0.15  current heating air\n\n#define breakdownVolt     0.80\n\n\n// ***** Buffer C and D are copies of A and B to make it run twice as fast!","name":"Common","description":"","type":"common"}]}