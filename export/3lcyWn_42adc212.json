{"ver":"0.1","info":{"id":"3lcyWn","date":"1653939598","viewed":91,"name":"Caleidoscope1","username":"3ncryp73d","description":"Simple caleidoscope effect","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["reflection","caleidoscope"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xsf3Rr","filepath":"/media/a/79520a3d3a0f4d3caa440802ef4362e99d54e12b1392973e4ea321840970a88a.jpg","previewfilepath":"/media/ap/79520a3d3a0f4d3caa440802ef4362e99d54e12b1392973e4ea321840970a88a.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec4 texLookup(vec2 coord)\n{    \n    float t = iTime * 0.2;\n    vec2 uv = (vec2(t, 0.5) + coord) * 0.5; // + vec2(uv.x * sin(t) + uv.y * cos(t), uv.x * cos(t) - uv.y * sin(t));\n    \n    //uv = floor(uv);\n    \n    return texture(iChannel0, uv); vec4(fract((uv.x - uv.y) / 2.));\n}\n\nvoid vertPlaneIntersect(inout vec3 o, inout vec3 d, in float r, in float alpha)\n{\n    float s_a = sin(alpha);\n    float c_a = cos(alpha);\n    \n    float t = (r - o.x*s_a - o.y*c_a)/(d.x*s_a + d.y*c_a);\n    \n    vec3 nrm = vec3(s_a, c_a, 0.);\n    \n    o = (t > 0.01 && t*d.z + o.z < 5.) ? t*d + o : d * 1e4;\n\n    d = (o.z < 5.) ? d - 2. * nrm * dot(d, nrm) : d;\n}\n\nvoid multiIntersect(inout vec3 o, inout vec3 d, inout vec4 col, in int n)\n{\n    vec3 o_new = d * 1e4;\n    vec3 d_new = d;\n    vec4 c_new = col;\n    \n    for (int i = 0; i<n; i++)\n    {\n        vec3 o_tmp = o;\n        vec3 d_tmp = d;\n        vertPlaneIntersect(o_tmp, d_tmp, 1., 3.14159265359 * 2. / float(n) * float(i) + iTime * 0.05);\n        \n        d_new = o_tmp.z < o_new.z ? d_tmp : d_new;\n        c_new = o_tmp.z < o_new.z ? vec4(0.8, 0.85, 0.9, 1.) * col : c_new;\n        o_new = o_tmp.z < o_new.z ? o_tmp : o_new;\n    }\n    \n    o = o_new;\n    d = d_new;\n    col = c_new;\n}\n\n\nvec4 bounceRay(inout vec3 o, inout vec3 d)\n{\n    vec4 col = vec4(1.);\n    \n    for (int i = 0; i < 8; i++)\n    {\n        multiIntersect(o, d, col, 5);\n    }\n    \n    return col * texLookup(o.xy / o.z);\n}\n\nfloat rand(vec2 c){\n\treturn fract(sin(dot(c.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n\nvec2 rand2(vec2 c){\n\treturn vec2(rand(c.xy), rand(c.yx));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = 2. * (fragCoord-iResolution.xy*0.5)/iResolution.yy;\n    \n    vec4 col = vec4(0.);\n    \n    for (int i = 0; i < 16; i++)\n    {\n        vec3 o = vec3(rand2(vec2(float(i) + iTime + uv.x,float(16-i)+uv.y))-vec2(0.5,0.5), 0.)*0.3;\n        vec3 d = vec3(uv, 1.5);\n        vec4 c_tmp = bounceRay(o, d);\n        col += c_tmp*c_tmp;\n    }\n    \n    \n    //multiIntersect(o, d, col, 5);\n    \n    fragColor = sqrt(col/8.);// vec4(d.xy, 0., 1.);\n\n}","name":"Image","description":"","type":"image"}]}