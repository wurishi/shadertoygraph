{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[],"code":"struct Car{vec3 pos;vec2 size;};\nstruct House{vec3 pos;vec3 size;};\nfloat r(vec2 co){return fract(sin(dot(co.xy,vec2(1,0)))*4.5);}\nfloat r(float c){return r(vec2(c))+0.2;}\nvec4 snow(vec2 uv){\n  const float rad=(1.0/(50.*2.0))*0.5;\n  vec2 pos=vec2((floor(uv.x*50.)+0.5)/50.,1.0-mod(iTime*0.3*r(floor(uv.x*50.))-0.25*0.2,2.0));\n  float sz=rad*r(floor(uv.x*50.));\n  return vec4(max(sz-distance(uv,pos),0.0)/sz);\n}\nfloat sdCar(vec3 p,Car car){\n  vec3 d=abs(p-car.pos)-vec3(car.size.x,0.5,car.size.y);\n  return length(max(d,0.0))+min(max(d.x,max(d.y,d.z)),0.0);\n}\nfloat sdHouse(vec3 p,House house){\n  vec3 d=abs(p-house.pos)-house.size;\n  return length(max(d,0.0))+min(max(d.x,max(d.y,d.z)),0.0);\n}\nfloat sdLamp(vec3 p){\n  vec3 size=vec3(0.01,2.0,0.01);\n  vec3 d=abs(p)-size;\n  return length(max(d,0.0))+min(max(d.x,max(d.y,d.z)),0.0);\n}\nfloat sdS(vec3 p){\n  float r1=0.15;float r2=0.1;float r3=0.07;\n  vec3 s1=vec3(0.0,0.0,0.0);vec3 s2=vec3(0.0,0.2,0.0);vec3 s3=vec3(0.0,0.35,0.0);\n  float d1=length(p-s1)-r1;float d2=length(p-s2)-r2;float d3=length(p-s3)-r3;\n  return min(d1,min(d2,d3));\n}\nfloat map(vec3 p,out vec3 color){\n  vec3 q=p;\n  Car cars[6];\n  vec2 s=vec2(0.07,0.1);\n  float md=mod(iTime*2.0,20.0);\n  cars[0]=Car(vec3(2.0,-0.4,-5.0+md),s);\n  cars[1]=Car(vec3(2.0,-0.4,-15.0+md),s);\n  cars[2]=Car(vec3(2.0,-0.4,-50.0+md),s);\n  cars[3]=Car(vec3(1.0,-0.4,35.0-md),s);\n  cars[4]=Car(vec3(1.0,-0.4,8.0-md),s);\n  cars[5]=Car(vec3(1.0,-0.4,20.0-md),s);\n  float cdist[6];\n  for(int i=0;i<6;i++){\n    cdist[i]=sdCar(q,cars[i]);\n  }\n  House houses[8];\n  vec3 s1=vec3(0.65,2.5,0.55);\n  vec3 s2=vec3(0.75,2.5,0.85);\n  vec3 s3=vec3(0.75,2.9,0.62);\n  houses[0]=House(vec3(-1.0,0.5,0.0),s1);\n  houses[1]=House(vec3(4.0,0.5,0.0),s1);\n  houses[2]=House(vec3(-0.5,1.5,2.0),s2);\n  houses[3]=House(vec3(3.5,1.5,2.0),s2);\n  houses[4]=House(vec3(-1.5,0.05,-1.5),s3);\n  houses[5]=House(vec3(4.5,0.05,-1.5),s3);\n  float hdist[8];\n  for(int i=0;i<8;i++){\n    hdist[i]=sdHouse(q,houses[i]);\n  }\n  vec3 lampPos1=vec3(0.5,-1.0,0.0);\n  vec3 lampPos2=vec3(2.5,-1.0,0.0);\n  float lamp1=sdLamp(q-lampPos1);\n  float lamp2=sdLamp(q-lampPos2);\n  float ground=p.y;\n  if(ground<0.01){\n    if(abs(p.x-1.5)<0.8){\n      color=vec3(0.6,0.6,0.65);\n      if(abs(p.x-1.5)<0.05){color=vec3(1.0);}\n    }else{color=vec3(0.85,0.85,0.88);}\n  }\n  float dist=ground;\n  for(int i=0;i<6;i++){\n    dist=min(min(dist,cdist[i]),hdist[i]);\n  }\n  dist=min(dist,min(lamp2,lamp1));\n  dist=min(dist,sdS(q-vec3(0.2,0.0,0.8)));\n  if(dist==sdS(q-vec3(0.2,0.0,0.8))){color=vec3(0.8,0.8,0.8);}\n  if(dist==hdist[0]||dist==hdist[1]||dist==hdist[2]||dist==hdist[3]||dist==hdist[4]||dist==hdist[5]){\n    vec3 coord=mod(p,0.3)-0.1/1.0;\n    bool win=(coord.z>0.0&&coord.y>0.0&&coord.z<0.1&&coord.y<0.1);\n    color=win?vec3(0.8,0.8,0.6):vec3(0.38,0.39,0.44);\n  }\n  color=(dist==cdist[0]||dist==cdist[4])?vec3(0.4,0.35,0.4):color;\n  color=(dist==cdist[3]||dist==cdist[1])?vec3(0.5,0.5,0.6):color;\n  if(dist==lamp1||dist==lamp2)color=vec3(0.2,0.2,0.2);\n  return dist;\n}\nvoid mainImage(out vec4 fClr,in vec2 fCrd){\n  vec2 uv=(fCrd*2.-iResolution.xy)/iResolution.y;\n  float zPos=0.7+1.3*sin(iTime*0.2);\n  vec3 ro=vec3(1.5,1.4,zPos-2.1);\n  vec3 rd=normalize(vec3(uv,1));\n  vec3 col=vec3(0);\n  float t=0.;\n  vec3 color;\n  for(int i=0;i<300;i++){\n    vec3 p=ro+rd*t;\n    float d=map(p,color);\n    t+=d;\n    col=color;\n    if(d<.001)break;\n    if(t>100.)break;\n  }\n  vec3 sky=mix(vec3(0.7,0.55,0.6),vec3(0.3,0.3,0.5),uv.y);\n  if(t>=100.0){col=sky;}\n  vec3 light1=vec3(0.5,1.3,0.0);\n  vec3 light2=vec3(2.5,1.3,0.0);\n  vec3 dir1=normalize(light1-(ro+rd*t));\n  float ldist1=length(light1-(ro+rd*t));\n  vec3 dir2=normalize(light2-(ro+rd*t));\n  float ldist2=length(light2-(ro+rd*t));\n  float diff1=max(dot(normalize(vec3(0.0,1.0,0.0)),dir1),0.0)/(ldist1*ldist1);\n  float diff2=max(dot(normalize(vec3(0.0,1.0,0.0)),dir2),0.0)/(ldist2*ldist2);\n  col*=(0.35+diff1+diff2);\n  fClr=vec4(col+snow(uv).rgb,1.0)+vec4(clamp(fClr.rgb,0.0,1.0),1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XfdBWf","date":"1734115891","viewed":32,"name":"Городская жизнь","username":"yulia_shv","description":":)","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["iiz"],"hasliked":0,"parentid":"","parentname":""}}