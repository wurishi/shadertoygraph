{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"#ifdef GL_ES\nprecision mediump float;\n#endif\n\nfloat PI=3.14159265;\n#define STEP1 128\n#define STEP2 64\n\nvec2 dist_floor(in vec3 p)\n{\n\treturn vec2(sin(p.x*0.1)*2.0+\n\t\t    sin(p.y*0.1)*2.0+\n\t\t    p.y+10.0,0);\n}\n\nvec2 sphere(in vec3 p,in vec3 sh_p,in float size,in float id)\n{\n\tfloat d = length(p - sh_p)-size;\n\treturn vec2(d,id);\n}\n\nvec2 cylinder(in vec3 p,in vec3 cy_p,in float size,in float id)\n{\n\treturn vec2(length(p.xz-cy_p.xz)-size,id);\n}\n\nvec2 dist_gass(in vec3 p)\n{\n\tp.x += sin(iTime+p.y*0.5);\n\tif(sin(p.x*10.5) > 0.9 && sin(p.z*1.5) > 0.6 )\n\t{\n\t\tvec2 floor_d = dist_floor(p);\n\t\treturn vec2(floor_d.x+p.y*13.0,0);\n\t}\n\treturn vec2(1000,0);\n}\n\n//select short dist\nvec2 uni(in vec2 obj0, in vec2 obj1)\n{\n\tif (obj0.x < obj1.x)\n    \treturn obj0;\n\telse\n    \treturn obj1;\n}\n\n//distance field scene\nvec2 scene(in vec3 p)\n{\n\tvec2 dist = vec2(1000,0);;\n\tdist = uni( dist , sphere(p,vec3(sin(iTime)*5.0,4,15),2.0,1.0) );\n\tdist = uni( dist , sphere(p,vec3(cos(iTime)*10.0,-4,25),2.0,2.0) );\n\tdist = uni( dist , sphere(p,vec3(sin(iTime)*-10.0,12,55),2.0,3.0) );\n\tdist = uni( dist , dist_gass(p) );\n\treturn dist;\n}\n\nvec3 select_material(in vec3 p,in float id)\n{\n\tif(id == 0.0)\n    \t\treturn vec3(1);\n\tif(id == 1.0)\n    \t\treturn vec3(0.1,0.1,0.8);\n\tif(id == 2.0)\n   \t\treturn vec3(0.8,0.1,0.1);\n\tif(id == 3.0)\n    \t\treturn vec3(0.1,0.8,0.1);\n\tif(id == 4.0)\n    \t\treturn vec3(0.8,0.8,0.8);\n\treturn vec3(0);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 vPos = fragCoord.xy/iResolution.xy - 0.5;\n\t// Camera up vector.\n\tvec3 vuv=vec3(0,1.0,0);\n    \n\t// Camera lookat.\n\tvec3 cpos=vec3(0,13,50);\n\tfloat mx=4.8+iMouse.x/iResolution.x*1.0;\n\tfloat my=0.0+iMouse.y/iResolution.y*1.0;\n\tvec3 prp=vec3(cos(my)*cos(mx),sin(my),cos(my)*sin(mx))*12.0;\n\n    \t// Camera setup.\n\tvec3 vpn=normalize(cpos-prp + vec3((iMouse.x/iResolution.x-0.5)*1.0,0,1));\n\tvec3 u=normalize(cross(vuv,vpn));\n\tvec3 v=cross(vpn,u);\n\tvec3 vcv=(prp+vpn);\n\tvec3 scrCoord=vcv+vPos.x*u*iResolution.x/iResolution.y+vPos.y*v;\n\tvec3 scp=normalize(scrCoord-prp);\n\t\n\tvec3 L = vec3(0,15,35);\n\t// Raymarching.\n\tconst vec3 e=vec3(0.02,0,0);\n\tconst float maxd=100.0;//Max depth\n\tvec2 d=vec2(0.1,0.0);\n\tvec3 p,N;\n\t\n\tfloat volLight = 0.0;\n\tvec2 dl=vec2(0.1,0.0);\n\tvec3 pl;\n\tfloat f=1.0;\n\tfor(int m_c=STEP1;m_c>0;m_c--)\n\t{\n\t\tif ((abs(d.x) < .001) || (f > maxd))\n\t\t\tbreak;\n\t\n\t\tf+=min(d.x,1.0);\n\t\n\t\tp=prp+scp*f;\n\t\td = scene(p);\n\t\n\t\tfloat fl=1.0;\n       \t\tdl=vec2(0.1,0.0);\n\t\tfor(int j=0;j<STEP2;j++)\n\t\t{\n\t\t\tif ((abs(dl.x) < 0.01))\n\t\t\tbreak;\n\t\n\t\t\tfl+=dl.x;\n\t\t\tpl=p+normalize(L-p)*fl;\n\t\t\tdl = scene(pl);\n\t\t\n\t\t\tif( abs(dl.x) >= length(L-pl)  || (fl > maxd))\n\t\t\t{\n\t\t\tfl = maxd + 1.0;\n\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif(fl > maxd)\n\t\t{\n\t\t\tvolLight += 0.7/pow(length(L-p),1.5);\n\t\t}\n\n\t\tif(m_c == 0)\n\t\t{\n\t\t\tf = maxd+1.0;\n\t\t\tbreak;\n\t\t}        \n\t}\n    \n    \tvolLight = pow(volLight,2.0);\n    \n\tif (f < maxd)\n\t{\n\t\tvec3 col = select_material(p,d.y);\n\t\tvec3 n = vec3(d.x-scene(p-e.xyy).x,\n\t\t\t\td.x-scene(p-e.yxy).x,\n\t\t\t\td.x-scene(p-e.yyx).x);\n\t\tN = normalize(n);\n    \t\tfloat b=dot(N,normalize(prp-p+L));\n    \t\tfragColor=vec4((b*col)*(1.0-f*.01),1.0)+volLight;\n\t}\n\telse\n\t{\n\t\tfragColor= vec4(volLight,volLight,volLight,1);//background color\n\t}\n}\n\n\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4lf3DB","date":"1424687862","viewed":384,"name":"inaho","username":"jirohcl","description":"power style volume light!(TDF2015)","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["tdf2015"],"hasliked":0,"parentid":"","parentname":""}}