{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"cubemap","id":"XdX3zn","filepath":"/media/a/488bd40303a2e2b9a71987e48c66ef41f5e937174bf316d3ed0e86410784b919.jpg","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"texture","id":"XsX3Rn","filepath":"/media/a/92d7758c402f0927011ca8d0a7e40251439fba3a1dac26f5b8b62026323501aa.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":2,"type":"texture","id":"XsfGRn","filepath":"/media/a/1f7dca9c22f324751f2a5a59c9b181dfe3b5564a04b724c657732d0bf09c99db.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define time iTime\n#define EPSILON .0001\nconst float PI=3.14159265;\nconst int MAX_ITER = 150;\nvec3 lightDir    = normalize(vec3(1., 1., -1.));\nvec3 colorChessboard = vec3(0.);\nstruct mat\n{\n  float typeMat;        \n     \n};\nmat materialMy = mat(0.0);\n//-----------------------------\nvec3 getNormal(in vec3 p);\nfloat renderFunction(in vec3 pos);\nfloat render(in vec3 posOnRay, in vec3 rayDir);\nvec4 getColorPixel(inout vec3 ro, vec3 rd, inout vec3 normal, float dist, float typeColor);\n//-----------------------------\nvec3 rotationCoord(vec3 n )\n{\n vec3 result;\n //--------------------------------------------\n   float t = time * 0.05;//tmpTime;//\n   vec2 sc = vec2(sin(t), cos(t));\n   mat3 rotate;\n   mat3 rotate_x = mat3(  1.0,  0.0,  0.0,\n                          0.0, sc.y,-sc.x,\n                          0.0, sc.x, sc.y);\n   mat3 rotate_y = mat3( sc.y,  0.0, -sc.x,\n                         0.0,   1.0,  0.0,\n                         sc.x,  0.0,  sc.y);\n   mat3 rotate_z = mat3( sc.y, sc.x,  0.0,\n                        -sc.x, sc.y,  0.0,\n                         0.0,  0.0,   1.0);\n   rotate = rotate_z * rotate_y * rotate_z;                \n\n  result = n * rotate;\n  return result;\n}\n//----------------------------------------------------\nfloat smin( float a, float b, float k ) \n{\n   float h = clamp( 0.5+0.5*(b-a)/k, 0.0, 1.0 );\n   return mix( b, a, h ) - k*h*(1.0-h);\n}\n//------------------------------------------\n//------------------------------------------\nvec2 rot(vec2 p,float r){\n  vec2 ret;\n  ret.x=p.x*cos(r)-p.y*sin(r);\n  ret.y=p.x*sin(r)+p.y*cos(r);\n  return ret;\n}\n//------------------------------------------\nvec2 rotsim(vec2 p,float s)\n{\n  vec2 ret=p;\n  ret=rot(p,-PI/(s*2.0));\n  ret=rot(p,floor(atan(ret.x,ret.y)/PI*s)*(PI/s));\n  return ret;\n}\n//ÐŸÑ€Ð¸Ð¼Ð¸Ñ‚Ð¸Ð²Ñ‹\n//------------------------------------------\nfloat udRoundBox( vec3 p, vec3 b, float r )\n{\n  return length(max(abs(p)-b,0.0))-r;\n}\n//----------------------------------------------------\nfloat udRoundBox2( vec2 p, vec2 b)\n{\n  return length(max(abs(p)-b,0.0));  \n}\n//----------------------------------------------------Ð¢Ð¾Ñ€\nfloat dTorus(vec3 p, vec2 t)\n{\n   vec2 q = vec2(length(p.xz) - t.x, p.y);\n   return length(q) - t.y;\n}\n//----------------------------------------------------Ð¨Ð°Ñ€\nfloat dSphere(vec3 p, float r)\n{\n   return length(p) - r;\n}\n//--------------------------------------------------Ð¡ÐºÑ€ÑƒÐ³Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ñ†ÐµÐ»Ð¸Ð½Ð´Ñ€\n// capsule in Y axis\nfloat capsuleY(vec3 p, float r, float h)\n{\n    p.y -= clamp(p.y, 0.0, h);\n    return length(p) - r;\n}\n//----------------------------------------------------Ð¦ÐµÐ»Ð¸Ð½Ð´Ñ€\nfloat yCylinder(vec3 p, vec2 h) \n{\n    return max( length(p.xz)-h.x, abs(p.y)-h.y );\n}\n//--------------------------------------------------ÐžÐ±Ñ€ÐµÐ·Ð°Ð½Ð½Ñ‹Ð¹ ÐºÐ¾Ð½ÑƒÑ\nfloat yCone( in vec3 p, in vec2 h, in float plane )\n{\n\n    p.y = - p.y;\n    vec2 c = normalize( h );\n    float q = length(p.xz);\n    float t = max( dot(c,vec2(q,p.y)), -(p.y +  h.x) );\n\n    t = max(t, -(-p.y - plane));\n    return t;\n}\n//--------------------------------------------------ÐžÑÐ½Ð¾Ð²Ð° Ð´Ð»Ñ ÑˆÐ°Ñ…Ð¼Ð°Ñ‚Ð½Ñ‹Ñ… Ñ„Ð¸Ð³ÑƒÑ€\nfloat dBasis(in vec3 p, in float r)\n{\n float d = 1.;\n float k = r * 0.3;\n float r10 = r * 0.10,\n       r25 = r * 0.25,\n       r40 = r * 0.4,\n       r50 = r * 0.5,\n       r60 = r * 0.6;\n  d = min(d,  dSphere(p, r));\n  d = max(d, abs(p.y) - 0.1 ); \n  d = smin(d,  dTorus(p + vec3(0., -r25, 0.),vec2(r50, r25)), k);\n  d = smin(d, yCylinder(p + vec3(0., -(r + r25), 0.), vec2(r40, r)), k); \n  d = smin(d, dTorus(p + vec3(0., -(r + r), 0.),vec2(r60, r10)),k); \n  return d;\n}\n//--------------------------------------------------Ð¤Ð¾Ð½Ð°Ñ€ÑŒ\nfloat dLantern(in vec3 pos, in vec2 size, in float r)\n{\n      \n vec3 p = pos - vec3(\n         r * sin(atan(pos.x, pos.y)),\n         0.0,\n         r * sin(atan(pos.z, pos.y)));\n return  yCylinder(p , size); \n}\n//--------------------------------------------------ÐŸÐµÑˆÐºÐ°\nfloat dPawn(in vec3 p, in float r)\n{\n float d = 1.;\n float r50 = r * 0.50,\n       r80 = r * 0.8;\n float k = r * 0.3;\n  d = dBasis(p, r);\n  d = smin(d, dSphere(p + vec3(0., -(r + r + r80), 0.), r50), k);  \n  return d;\n}\n//--------------------------------------------------Ð›Ð°Ð´ÑŒÑ\nfloat dRook(in vec3 p, in float r)\n{\n  float d = 1.;\n  float r10 = r * 0.10, \n        r40 = r * 0.4,\n        r50 = r * 0.5,\n        r60 = r * 0.6,\n        r75 = r * 0.75;\n  float k = r * 0.3;\n  d = dBasis(p, r);\n  d = smin(d, yCylinder(p + vec3(0., -(r + r + r60), 0.), vec2(r75, r40)), k);  \n  p.xz =  rotsim( p.xz,5.);\n  float d1 = udRoundBox( p + vec3(0., -(r * 3.), 0.), vec3(0., r50, r), r10 );\n  d = max(d, -d1);\n  return d;\n}\n//--------------------------------------------------Ð¡Ð»Ð¾Ð½ \nfloat dElephant(in vec3 p, in float r)\n{\n float d = 1.;\n float r10 = r * 0.10,\n       r25 = r * 0.25,\n       r70 = r * 0.7,       \n       r80 = r * 0.8;\n  float k = r * 0.3;\n  d = dBasis(p, r);\n  d = smin(d, dTorus(p + vec3(0., -(r + r + r80), 0.), vec2(-r25, r80)),k);  \n  d = smin(d, dTorus(p + vec3(0., - (r * 3. +r70 ), 0.), vec2(r10)), k);  \n  return d;       \n}\n//--------------------------------------------------Ð¤ÐµÑ€Ð·ÑŒ\nfloat dQueen(in vec3 p, in float r)\n{\n  float d = 1.;\n  float r10 = r * 0.10,\n        r25 = r * 0.25,\n        r50 = r * 0.5,\n        r60 = r * 0.6,\n        r35r =  r * 3. + r50,   \n        r70 = r * 0.7;\n  float k = r * 0.3; \n  d = dBasis(p, r);\n  d = smin(d, yCone(p , vec2(r35r, r60), r + r + r25 ), k); \n  p.xz =  rotsim( p.xz,4.);\n  d = max(d, -(udRoundBox( p + vec3(0., -(r35r), 0.), vec3(-r10, r10, r50), r25 )));  \n  d = min(d, max(dSphere(p + vec3(0., -(r35r), 0.), r50), -p.y + r35r));\n  d = smin(d, dTorus(p + vec3(0., -(r35r + r70), 0.), vec2(r10)), k);    \n  return d;       \n}\n//--------------------------------------------------ÐšÐ¾Ñ€Ð¾Ð»ÑŒ\nfloat dKing(in vec3 p, in float r)\n{\n  float d = 1.;\n  float r10 = r * 0.10,\n        r25 = r * 0.25,\n        r40 = r * 0.4,        \n        r50 = r * 0.5,\n        r60 = r * 0.6,\n        r35r = r * 3. + r50,   \n        r70 = r * 0.7;\n  float k = r * 0.3; \n  d = dBasis(p, r);\n  d = smin(d, yCone(p , vec2(r35r, r60), r *2. +r25 ), k); \n  d = smin(d, dLantern(p + vec3(0.0, -(r35r + r50), 0.), vec2(r50 * 0.1, r + r10), r25), k);   \n  return d;       \n}\n//--------------------------------------------------ÐšÐ¾Ð½ÑŒ\nfloat dHorse(in vec3 p, in float r)\n{\n p.xz = rot(p.xz, 4.7);\n float d = 1.;\n vec3 p1 = p;\n float k = r * 0.3;\n float r10 = r * 0.10,\n       r25 = r * 0.25,\n       r40 = r * 0.4,\n       r50 = r * 0.5,\n       r60 = r * 0.6,\n       r70 = r * 0.7,\n       r80 = r * 0.8;\n  d = min(d,  dSphere(p, r));\n  d = max(d, abs(p.y) - 0.1 ); \n  d = smin(d,  dTorus(p + vec3(0., -r25, 0.),vec2(r50, r25)), k);\n  d = smin(d, yCylinder(p + vec3(0., -(r + r25), 0.), vec2(r40, r)), k); \n //-------------------------\n d = smin(d,  dSphere(p + vec3(0., -(r + r10), -r25), r50), k);\n//---------------------Ð“Ð¾Ð»Ð¾Ð²Ð°\n float d1 = dSphere(p1 + vec3(0., -(r*2. + r70), 0.), r60); \n p1 += vec3(0., -(r * 2. + r60), 0.); \n p1.zy = rot(p1.zy, 1.85); \n d1 = smin(d1,capsuleY(p1+vec3(0., -(r10*3.), r10) , r40, r), r70);\n d = smin(d,  d1, k); \n //-------------------Ð£ÑˆÐ¸\n p1 = p;\n p1.x = abs(p1.x);\n d1 =  dTorus(p1 + vec3(-r40, -(r*3.+r25), 0.) ,vec2(-r60, r80));\n d1 = max(d1, -dTorus(p1 + vec3(-r60, -(r*3.+r25), 0.),vec2(-r60, r80)));\n d = min(d, d1);\n //-------------------Ð“Ð»Ð°Ð·Ð°\n  p1 += vec3(-r50, -(r*3.), -r60);\n  p1.zy = rot(p1.zy, 1.85);   \n  d = max(d, -dTorus(p1 ,vec2(-r10*2., r40)));  \n  p1 = p;\n  p1.x = abs(p1.x);\n  d = min(d, dSphere(p1 + vec3(-r40, -(r*3.), -r50), r * 0.15));  \n //-------------------ÐÐ¾Ñ Ð¸ Ñ€Ð¾Ñ‚\n  d = smin(d, dSphere(p1 + vec3(-(r*0.15), -(r*2.+r50), -(r+r50)), r10), k);  \n  d = max(d, -dSphere(p1 + vec3(-(r*0.15), -(r*2.+r60), -(r+r60)), r10));  \n  p1 = p + vec3(0., -(r*2. + r10), -(r + r50));\n  d = max(d, -udRoundBox(p1, vec3(r40, -0.07, r40), 0.1 ));   \n //-------------------Ð“Ñ€Ð¸Ð²Ð°\n p1 = p + vec3(0., -(r*2.+r25), r40);\n vec3 p2 = p1 + vec3(0.0, cos(p1.y * r80) * (-r50), sin(p1.y * (r*2.+r80) + r50) * k);\n float width = r10 * pow(sin(p2.y * (r*30.)),2.0) + r10;\n d = smin(d, yCylinder(p2, vec2(width, r)), r25);\n width = r10 * pow(sin(p1.y * (r*30.)),2.0) + r10;\n d = smin(d, yCylinder(p1 + vec3(0., r80, r10), vec2(width, r80)), r25); \n return d;      \n}\n//--------------------------------------------------Ð¨Ð°Ñ…Ð¼Ð°Ñ‚Ð½Ñ‹Ðµ Ñ„Ð¸Ð³ÑƒÑ€Ñ‹\nfloat dChessmen(in vec3 pos, in float r)\n{\n//----------------------ÐŸÐµÑˆÐºÐ¸\n   vec3 q = pos;\n   float d = 1.;\n   float offX = -10.5;\n   q.x = abs(q.x);\n   q.x -= 7.5; \n   q.z = mod(q.z,3. ) -3. * 0.5;  \n   d =  dPawn(q, r);\n   d = max(d, abs(pos.z) - 12.);\n//----------------------Ð›Ð°Ð´ÑŒÑ\n   q = pos;\n   q.xz = abs(q.xz); \n   d = min(d, dRook(q + vec3(offX, 0., -10.5), r + 0.1));  \n//----------------------ÐšÐ¾Ð½ÑŒ      \n   d = min(d, dHorse(q + vec3(offX, 0., -7.5), r + 0.1));  \n//----------------------Ð¡Ð»Ð¾Ð½\n   d = min(d, dElephant(q + vec3(offX, 0., -4.3), r + 0.1));  \n//----------------------Ð¤ÐµÑ€Ð·ÑŒ\n   q = pos;\n   q.x = abs(q.x); \n   d = min(d, dQueen(q + vec3(offX, 0., 1.4), r + 0.2));  \n//----------------------ÐšÐ¾Ñ€Ð¾Ð»ÑŒ              \n   d = min(d, dKing(q + vec3(offX, 0., -1.5), r + 0.3));  \n//---------------------------------\n   return d;\n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° o\nfloat letter_O(in vec2 uv, in vec2 r)\n{\n   float d = length(uv) - r.x;\n   return max(d, -(length(uv)) + r.y) ; \n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° a\nfloat letter_A(in vec2 uv, in vec2 r)\n{\n   float d = letter_O(uv, r);\n   return min(d,   udRoundBox2(uv + vec2(0., 0.5), vec2(0.5, 0.1)));\n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° b\nfloat letter_B(in vec2 uv, in vec2 r)\n{\n   float d = letter_O(uv, r);\n   return min(d,   udRoundBox2(uv - vec2(0., 0.5), vec2(0.5, 0.1)));\n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° c\nfloat letter_C(in vec2 uv, in vec2 r)\n{\n   float d = letter_O(uv, r);\n   return max(d, -(udRoundBox2(uv - vec2(0., -0.5), vec2(0.1, 0.3)) - 0.01));\n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° d\nfloat letter_D(in vec2 uv, in vec2 r)\n{\n   float d = letter_O(uv, r);\n   return min(d,   udRoundBox2(uv + vec2(-0.12, 0.5), vec2(0.6, 0.1)));\n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° e\nfloat letter_E(in vec2 uv, in vec2 r)\n{\n   float d = letter_O(uv, r);\n   d =  max(d, -(udRoundBox2(uv - vec2(0., -0.5), vec2(0.1, 0.3)) - 0.01));\n   return min(d, udRoundBox2(uv - vec2(0.08, -0.1), vec2(0.1, 0.4)));\n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° f\nfloat letter_F(in vec2 uv, in vec2 r)\n{\n   float d = letter_O(uv, r);\n   d = max(d, -(length(uv+ vec2(0.5, 0.04)) - 0.7));\n   d = min(d, udRoundBox2(uv - vec2(-0.2, 0.4), vec2(0.4, 0.1)));\n   return min(d, udRoundBox2(uv - vec2(0., 0.4), vec2(0.1, 0.3)));   \n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° g\nfloat letter_G(in vec2 uv, in vec2 r)\n{\n   uv.x += 0.33;\n   float d = letter_O(uv, r);\n   d = max(d, -(length(uv - vec2(0.5, 0.2)) - 0.7));\n   return min(d, letter_A(uv - vec2(0.4, 0.1), r));\n}\n//--------------------------------------------------Ð‘ÑƒÐºÐ²Ð° h\nfloat letter_H(in vec2 uv, in vec2 r)\n{\n   uv.x += 0.4;\n   float d = letter_O(uv, r);\n   d = max(d, (udRoundBox2(uv - vec2(0.3, 0.), vec2(0.4, 0.6))));\n   return min(d,   udRoundBox2(uv - vec2(0.35, 0.4), vec2(0.5, 0.1)));\n}\n//--------------------------------------------------\nfloat numeric_1(in vec2 uv, in vec2 r)\n{\n  float d = udRoundBox2(uv , vec2(r.x, r.y));//letter_O(uv, r);;\n  uv = rot(uv, 1.);\n  return min(d, udRoundBox2(uv +  vec2(0.06, -0.36), vec2(r.x * 0.5, r.y)));\n}\n//--------------------------------------------------\nfloat numeric_2(in vec2 uv, in vec2 r)\n{\n  float d = letter_O(uv, r);\n  d = max(d, udRoundBox2(uv -  vec2(0.25, 0.), vec2(r.x)));\n  d = min(d, udRoundBox2(uv +  vec2(0.9, 0.01), vec2(0.1, r.x))); \n  uv.x += 0.5;\n  uv = rot(uv, -1.);  \n  return min(d, udRoundBox2(uv , vec2(0.1, 0.5)));   \n}\n//--------------------------------------------------\nfloat numeric_3(in vec2 uv, in vec2 r)\n{\n  uv.x = abs(uv.x);\n  uv.x -= 0.23;\n  float d = letter_O(uv , r);\n  uv -= vec2(0.1, -0.2);\n  uv = rot(uv, 0.8);  \n  return max(d, udRoundBox2(uv , vec2(0.3, 0.6))); \n}\n//--------------------------------------------------\nfloat numeric_4(in vec2 uv, in vec2 r)\n{\n  vec2 p = uv;\n  float d = udRoundBox2(uv , vec2(r.x, r.y));//letter_O(uv, r);;\n  p.y -= r.x * 0.5;\n  d = min(d, udRoundBox2(p , vec2( r.y, r.x * 0.5)));\n  return min(d, udRoundBox2(uv - vec2(r.x * 0.5, r.x), vec2(r.x * 0.5, r.y)));   \n}\n//--------------------------------------------------\nfloat numeric_5(in vec2 uv, in vec2 r)\n{\n  uv.x += 0.22;\n  float d = letter_O(uv , r);\n  d = max(d, -(udRoundBox2(uv - vec2(0.1, 0.3), vec2(0.2)) - 0.01));\n  d = min(d, udRoundBox2(uv - vec2(0.5, 0.2), vec2(0.3, 0.1)));\n  return min(d, udRoundBox2(uv - vec2(0.9, 0.), vec2(0.1, 0.3)));  \n\n}\n//--------------------------------------------------\nfloat numeric_6(in vec2 uv, in vec2 r)\n{\n  uv.x += 0.22;\n  float d = letter_O(uv - vec2(0.5, 0.), r);\n  d = max(d, -(length(uv + vec2(0., 0.5)) - 0.7));\n  d = min(d, letter_O(uv, r));\n  return min(d, udRoundBox2(uv - vec2(0.3), vec2(0.2, 0.1)));   \n}\n//--------------------------------------------------\nfloat numeric_7(in vec2 uv, in vec2 r)\n{\n  float d = udRoundBox2(uv - vec2(0.5, 0.), vec2(r.y,r.x * 0.5));    \n  uv +=vec2(0., 0.1);\n  uv = rot(uv, 0.2);\n  return  min(d, udRoundBox2(uv, vec2(r)));     \n}\n//--------------------------------------------------\nfloat numeric_8(in vec2 uv, in vec2 r)\n{\n  uv.x = abs(uv.x);\n  uv.x -= 0.23;\n  return letter_O(uv , r);\n}\n//--------------------------------------------------Ð¨Ð°Ñ…Ð¼Ð°Ñ‚Ð½Ð°Ñ Ð´Ð¾ÑÐºÐ°\n//https://www.shadertoy.com/view/4dj3zy\nvec3 colChessboard(in vec2 uv)\n{\n  vec2 pos = uv;\n  vec3 texColor = texture( iChannel2, 0.15 * uv ).xyz; \n  vec3 baseColor = vec3(0.2969,0.0570, 0.0391 ) * texColor, color = baseColor;\n  float t1 =6.;//80.0;\n  float t2= t1/2.0;\n  if((mod(uv.x,t1)<t2==mod(uv.y,t1)<t2))  color = texColor;  \n //----------------------\n  vec2 r = abs(uv);\n  float maxR = max(r.x, r.y);\n  vec3 colFrame = vec3(step(12.,maxR));\n  if(colFrame == vec3(1.)) color = texColor;  \n  colFrame = vec3(colFrame * step(maxR,12.2));\n  if(colFrame == vec3(1.))  color = baseColor;  \n //----------------------Ð‘ÑƒÐºÐ²Ñ‹\n float d = 1.;\n pos += vec2(13., -11.0);  \n d = letter_A(pos, vec2(0.5, 0.3));\n d = min(d, letter_B(pos + vec2(0., 3.2), vec2(0.5, 0.3)));\n d = min(d, letter_C(pos + vec2(0., 6.2), vec2(0.5, 0.3)));\n d = min(d, letter_D(pos + vec2(0., 9.2), vec2(0.5, 0.3)));\n d = min(d, letter_E(pos + vec2(0., 12.2), vec2(0.5, 0.3)));\n d = min(d, letter_F(pos + vec2(0., 15.2), vec2(0.5, 0.3)));\n d = min(d, letter_G(pos + vec2(0., 18.2), vec2(0.5, 0.3)));\n d = min(d, letter_H(pos + vec2(0., 21.2), vec2(0.5, 0.3)));\n //----------------------Ð¦Ð¸Ñ„Ñ€Ñ‹\n pos = uv + vec2(10.5, -13.0); \n d = min(d, numeric_1(pos , vec2(0.6, 0.1)));\n d = min(d, numeric_2(pos - vec2(3.2, 0.), vec2(0.35, 0.15)));\n d = min(d, numeric_3(pos - vec2(6.2, 0.), vec2(0.4, 0.2))); \n d = min(d, numeric_4(pos - vec2(9.2, -0.2), vec2(0.6, 0.1))); \n d = min(d, numeric_5(pos - vec2(12.2,0.), vec2(0.4, 0.2))); \n d = min(d, numeric_6(pos - vec2(15.2,0.), vec2(0.4, 0.2))); \n d = min(d, numeric_7(pos - vec2(18.2,0.), vec2(0.6, 0.1)));  \n d = min(d, numeric_8(pos - vec2(21.2,0.), vec2(0.4, 0.2)));  \n\n if(d < 0.01)      \n        color = baseColor;  \n  return color;\n}\n//--------------------------------------------------\n\nfloat distMat(inout float curDist, float dist, in float typeMat)\n{\n   float res = curDist;\n   if (dist < curDist) \n   {\n      materialMy.typeMat     = typeMat;\n      res                    = dist;\n     return res;\n   }\n   return curDist;\n}\n\n//--------------------------------------------------\nfloat myObject(in vec3 p)\n{\n   float d =  1.0, d1 = d;\n   float r = 1.;\n   materialMy.typeMat = 0.0;\n   vec3 pos = p;\n   vec3 q = p;\n   d1 =  distMat(d1,   udRoundBox( pos, vec3(16, 0.3, 16 ), 0.5),  1.0);    \n   pos.y -= 1.5;\n\n   d = dChessmen(pos, r);\n   if(pos.x < 0.)\n      d1 = distMat(d1, d, 5.);\n   else\n      d1 = distMat(d1, d, 6.);  \n\n   //----------------------------------   \n   pos.y += 0.5;   \n   d1 =  distMat(d1,   udRoundBox( pos, vec3(14., 0.5, 14. ), 0.0),  4.0);      \n   colorChessboard = colChessboard(pos.xz);\n   return d1; \n}\n//-------------------------------------------------\n// Ð²Ñ‹Ð²Ð¾Ð´ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°\nfloat renderFunction(in vec3 pos)\n{\n    return  myObject(pos);    \n}\n//------------------------------------------------- \nvec3 getNormal(in vec3 p)\n{\n\nconst float precis = 0.001;\n    vec3  eps = vec3(precis,0.0,0.0);\n    vec3 nor;\n    nor.x = renderFunction(p+eps.xyy) - renderFunction(p-eps.xyy);\n    nor.y = renderFunction(p+eps.yxy) - renderFunction(p-eps.yxy);\n    nor.z = renderFunction(p+eps.yyx) - renderFunction(p-eps.yyx);\n    return normalize(nor);\n\n}\n//------------------------------------------------- \nfloat shadow(in vec3 ro, in vec3 rd, in float mint, in float maxt, in float k)\n{\n   float res = 1.0;\n   float t = mint;\n   for(int i=0; i<20; i++)\n   {\n      if(t<maxt)\n      {\n         float h = renderFunction(ro + rd*t);\n         res = min(res, k*h/t);\n         t += 0.02;\n      }\n   }\n   return clamp(res,0.0,1.0);\n}\n//-------------------------------------------------\nvec3 getLighting(in vec3 ro, in vec3 rd ,in vec3 norm, in vec3 lightDir, in vec3 color)\n{\n    vec3 col = color;//vec3(1.);\n    vec3 ref = reflect( rd, norm );\n    col *= 1.0 + 1.5*vec3(0.7,0.5,0.3)*pow( clamp( 1.0 + dot(norm,rd), 0.0, 1.0 ), 2.0 );\n    col += 27. *clamp(0.3 + 2. * norm.y, 0.0,1.0)* pow(texture( iChannel0, ref ).xyz,vec3(2.2));//*(rim);\n    col = pow( col, vec3(0.5) );\n\n    vec2 q =  gl_FragCoord.xy / iResolution.xy ;    \n    col *= -0.16 + 0.68 * pow( 16.0*q.x*q.y*(1.0-q.x)*(1.0-q.y), 0.15 );  \n \n    return col ; \n}\n//----------------------------------------------------------------------\nvec3 getLightingFigure(in vec3 ro, in vec3 rd ,in vec3 norm, in vec3 lightDir, in vec3 color)\n{\n   vec3 col = color;\n   float sh = 1.;//shadow(ro,lightDir,0.02,7.0,4.0); \n   float dif = clamp(dot(norm,lightDir),0.0,1.0) * sh;\n   float spec = clamp(dot(reflect(rd,norm),lightDir ),0.0,1.0);\n   float lum = pow(clamp(1.+dot(norm,rd),0.0,1.0),2.0);\n   col = col*dif+lum*(0.5+0.5*col);\n   col += pow(spec,24.)*sh;\n   return col ;  \n}\n//----------------------------------------------------------------------\nvec4 getColorPixel(inout vec3 ro, vec3 rd, inout vec3 normal, float dist, float typeColor)\n{\n\n  vec3 color = vec3(1.);\n  vec3 hitPos = ro + rd * dist;\n  normal = normalize(getNormal(hitPos)); \n//----------------------------------\n   if (materialMy.typeMat == 0.0) \n      color = texture( iChannel0, rd ).xyz;\n   else if (materialMy.typeMat == 1.0)    \n        color = texture( iChannel1, 0.15 * hitPos.xz ).xyz;\n   else if (materialMy.typeMat == 4. )\n      color = colorChessboard;\n   else if (materialMy.typeMat == 5. )\n      color = vec3(0.3, 0.1, 0.04);   \n   else\n        color = vec3(1.);\n   if(materialMy.typeMat !=0. )\n   {\n      if (materialMy.typeMat == 1.0)\n         color =  getLighting(hitPos, rd, normal, lightDir, color);\n      else\n         color =  getLightingFigure(hitPos, rd, normal, lightDir, color);\n   }  \n    ro = hitPos;\n  return vec4(color, 1.);\n\n}\n\n//-------------------------------------------------\nfloat render(in vec3 posOnRay, in vec3 rayDir)\n{ \n  float t = 0.0;\n  float maxDist =55.;\n  float d = 0.1;  \n  for(int i = 0; i <= MAX_ITER; ++i)\n  {\n    if (abs(d) <EPSILON || t > maxDist) \n         break;\n    t += d;\n    vec3 ro = posOnRay + t*rayDir;\n    d = renderFunction(ro);     \n  }\n\n   return t;\n}\n//------------------------------------------\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 pos     =  fragCoord.xy / iResolution.xy * 2. - 1.;//gl_FragCoord.xy / iResolution.xy * 2. - 1.;\n    pos.x *= iResolution.x / iResolution.y;  \n\n    float t = time* 0.1;\n    vec3 camPos = vec3(0., 8., 28);\n    vec3 camP = rotationCoord(camPos); ;//camPos;//vec3(0., 0, 10.);\n    vec3 camUp = vec3(0. , 1., 0.);\n    vec3 camDir = normalize(-camP);\n    vec3 u = normalize(cross(camUp,camDir));\n    vec3 v = cross(camDir,u);\n    vec3 rayDir = normalize(camDir * 2. + pos.x * u + pos.y * v);  \n\n   vec4 color    = vec4(1.0);\n    vec3 normal   = vec3(1.0);\n    vec3 posOnRay = camP; \n    float path = 0.;\n  //--------------------------- \n     path =  render(posOnRay, rayDir);  \n     color = getColorPixel(posOnRay, rayDir, normal, path, materialMy.typeMat); \n    // ----------------------------------------------------------------------\n//    float sha=shadow(posOnRay,lightDir,0.02,7.0,4.0);\n//    color.rgb *= sha;//pow(vec3(sha),vec3(1.0,1.2,2.0));\n    // POST PROCESSING\n    // Gamma correct\n     color.rgb = pow(color.rgb , vec3(0.45));\n    // Contrast adjust - cute trick learned from iq\n     color.rgb  = mix( color.rgb , vec3(dot(color.rgb ,vec3(0.333))), -0.6 );\n     color.a = 1.;\n     fragColor =  color;\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XlB3R1","date":"1426778956","viewed":621,"name":"My chess","username":"Lio","description":"chess, lighting simple. temporarily :)","likes":13,"published":1,"flags":0,"usePreview":1,"tags":["raymarching","chess3d"],"hasliked":0,"parentid":"","parentname":""}}