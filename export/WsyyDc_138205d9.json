{"ver":"0.1","info":{"id":"WsyyDc","date":"1603865998","viewed":251,"name":"CartoonSketch","username":"shiyuugo","description":"refer to https://www.shadertoy.com/view/MlVGzm\ntest with webcamera","likes":6,"published":1,"flags":0,"usePreview":0,"tags":["simple","cartoon","edgedetection"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdfGRr","filepath":"/media/a/35c87bcb8d7af24c54d41122dadb619dd920646a0bd0e477e7bdc6d12876df17.webm","previewfilepath":"/media/ap/35c87bcb8d7af24c54d41122dadb619dd920646a0bd0e477e7bdc6d12876df17.webm","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nvec3 stepColor(vec3 col){\n\tvec3 hsv = rgb2hsv(col);\n    hsv.z = hsv.z <= 0.20 ? hsv.z = 0.1 :\n    \t\t//hsv.z <= 0.33 ? hsv.z = 0.25 :\n    \t\thsv.z <= 0.67 ? hsv.z = 0.72 :    \t\t\n    \t\thsv.z <= 0.80 ? hsv.z = 0.85 :  \t\t\n    \t\t//hsv.z <= 0.90 ? hsv.z = 0.92 :\n    \t\t\t\t\t\thsv.z = 0.9;\n    //float stp = 0.25;\n    //hsv.z =  clamp(floor(hsv.z/stp) * stp  ,0.0,1.0);\n    return hsv2rgb(hsv);\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    \n    //--- outline\n    vec3 sx = vec3(0);\n    vec3 sy = vec3(0);  \n    for(int i=0; i<=2; i++){\n        for(int j=0; j<=2; j++){\n            vec2 p = vec2(int(fragCoord.x)+i-1, int(fragCoord.y)+j-1);\n            vec3 rgb = texture(iChannel0, p/iResolution.xy).xyz;\n        \tsx += rgb * sobelX[i][j];\n            sy += rgb * sobelY[i][j];\n        }\n    }\n    float finalLum = pow(lum(sx*sx + sy*sy), 0.5);\n\tfinalLum = finalLum < 0.4 ? smoothstep(0.0,1.0,finalLum) : 1.0;\n\n\tvec4 outline = vec4(vec3(1.0 - finalLum), 1.0);\n    \n    //--- step color\n    vec4 tex = texture(iChannel0, uv);\n\tvec4 color = vec4(stepColor(tex.rgb),1.0);\n    \n    vec3 res = min(outline.rgb, color.rgb);\n    \n\tfragColor = vec4(res,1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"vec3 rgb2hsv(vec3 c){\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n    vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n\n///outlines\nmat3 sobelX = mat3(-1.0, -2.0, -1.0,\n                    0.0,  0.0,  0.0,\n                    1.0,  2.0,  1.0);\nmat3 sobelY = mat3(-1.0,  0.0,  1.0,\n                   -2.0,  0.0,  2.0,\n                   -1.0,  0.0,  1.0);\n\nfloat lum(vec3 rgb){\n\treturn (0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b);\n}\n\n","name":"Common","description":"","type":"common"}]}