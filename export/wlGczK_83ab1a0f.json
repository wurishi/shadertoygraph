{"ver":"0.1","info":{"id":"wlGczK","date":"1614338263","viewed":430,"name":"Chaos construction shader jam","username":"louis_C","description":"Visual livecoded during the shader jamChaos contruction demoparty.\nvideo of the event : \nhttps://www.youtube.com/watch?v=vWWlE5sc-WY&ab_channel=havoc242\n","likes":24,"published":1,"flags":40,"usePreview":0,"tags":["livecoding","demoparty"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;    \n    fragColor = texture(iChannel0,uv);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define PI 3.1415927\nfloat hash(float x){return fract(sin(x) * 897612.531);}\nfloat voc(float t, float f, float ft){float x = fract(t * f) / f;\nfloat a=(sin(x*6.5*ft)*.4+sin(x*13.*ft)+sin(x*24.*ft)*.2);\n   return a* min(x * 1000., 1.) * exp(x * -200.);}\nvec2 t1(float t, float var){\n    vec2 v = vec2(0., 0.);\n    for(int i = 0; i < 16; ++i){\n        float h = float(i);\n       \tfloat m = voc(t + h / 3., 40. + pow(2.01, (h - 8.) * .2), var);\n        float pan = hash(h);\n        v.x += m * pan;\n        v.y += m * (1. - pan);\n    }\n    return v * .1;\n   \n}\n\nfloat rand(float st){return fract(sin(st*42151.5524124));}\nfloat rd (float t){return fract(sin(dot(floor(t),45.))*7845.236);}\nfloat no(float t){return mix(rd(t),rd(t+1.),smoothstep(0.,1.,t));}\nfloat it(float t){float r=0.;\n  float a = 0.5; for(int  i = 0 ; i <4 ; i++){r += no(t/a)*a; a*=0.5;}\n  return r;}\nvec2 hash22(vec2 p){p  = fract(p * vec2(5.3983, 5.4427));p += dot(p.yx, p.xy +  vec2(21.5351, 14.3137));\nreturn fract(vec2(p.x * p.y * 95.4337, p.x * p.y * 97.597));}\nvec2 noise(float t){return hash22(vec2(t, t * 1.423)) * 2.0 - 1.0;}\nvec2 lpnoise(float t, float fq){\n    t *= fq;\n    float tt = fract(t);\n    float tn = t - tt;\n    tt = smoothstep(0.0, 1.0, tt);\n    vec2 n0 = noise(floor(tn + 0.0) / fq);\n    vec2 n1 = noise(floor(tn + 1.0) / fq);\n    return mix(n0, n1, tt);}\n\nfloat sine(float x){    return sin(2.0 * PI * x);}\nvec2 sine(vec2 v) { return vec2(sine(v.x), sine(v.y)); }\nvec2 amp  (float t , float f0 , vec2 w,float f) {\n  vec2 r = lpnoise(t, 100.0)+lpnoise(t,  550.0)*0.2+ lpnoise(t, 1050.0) * 0.1 * exp(-t * 5.0);\n        w += sine(t * f0 + r * 0.1) * exp(-t * 2.0)*f;\n    \tw -= sine(t * f0          ) * exp(-t * 2.0)*f;\n        return w;}\nfloat t1 ( float t ) {\n   float vrf = 0.5+step(0.5,fract(t*0.1))*2.;\n   float vf = floor(fract(t*vrf)*3.+1.);\n    float nv1 = step(0.5,no(t+59.236))*5.;\n    return mod((t*5.+nv1), vf);}  \nvec2 sou(float t) {\n   vec2 s = vec2(0.);\n   float n1 = smoothstep(0.1,0.3,no(t*0.2));\n   float b1 = t1(t);\n   float b2 = sin(pow(b1,0.2)*200.);\n   float b3 = sin(pow(b1,0.2)*400.);\n   vec2 ba2  = amp ( b1 , 200. , vec2(b2),0.2*n1);\n   vec2 ba3  = amp ( b1 , 400. , vec2(b3),0.2*n1);\n   s += b2;\n   s *= 0.3;\n   s += b3 *0.1*no(t*0.3);\n   \n\n   return clamp(s,-1.,1.);\n}\n\nvec2 ech(float t) {\nfloat n1 = smoothstep(0.1,0.3,no(t*0.2));\n\tvec2 s = vec2(0);\n    vec2 ec = vec2(0.);\n    float fb = 0.5, tm = 0.1, cf = 0.9, ct = tm;\n    for ( int i = 0 ; i < 6 ; i ++) \n    {\n    float ci = t - (ct + float(i) * tm);\n    \n    ec += amp(t1(ci),200.,sou(ci),0.2*n1)*cf;\n    cf *= fb;\n    }  \n    s += amp(t1(t),200.,sou(t),0.2*n1);\n    s += clamp(ec,-0.,0.5) * 0.6;\n    return clamp(s,-1.,1.);\n}\n\nvec2 rev(float t) {\nfloat n1 = smoothstep(0.1,0.3,no(t*0.2));\n\tvec2 s = vec2(0);    \n    vec2 reverb = vec2(0);\n    float ta = t1 (t);\n    float st = 0.1; float it = 50.;\n    for (float i = 0.; i < it; i++)\n    {\n        float t2 =  i*st +rd(i+t)*0.0005;\n        float am = exp2(-t2*3.);\n    \treverb += ((amp(t1(t-t2),200.,ech(t -t2),1.*n1))/it) *am;     \n    }\n    s += amp(t1(t),200.,ech(t),0.7*n1);\n    s += reverb*10.;\n\treturn clamp(s,-1.,1.);\n}\nfloat t2 (float t) {  float vs = floor(fract(t*5.)*5.+1.);\n   float td = floor(pow(fract(t*0.5),0.4)*3.)*5.;\n   return clamp(mod((t*td), vs),0.,1.);}\nvec2 cli (float t) {\nvec2 s = vec2(0.);\n   float s1 = t2(t);\n   vec2 r1  =vec2(it(fract(t)*1000.)*step(s1,0.2));\n   float va = (no (t))*300.;\n   vec2 sh = amp(s1,300.+va,r1,1.);\n   s += sh*0.2;\n   return s;\n   }\nvec2 ech2(float t) {\n\tvec2 s = vec2(0);\n    vec2 ec = vec2(0.);\n    float fb = 0.9, tm = 0.015, cf = 0.9, ct = tm;\n    for ( int i = 0 ; i < 10 ; i ++) \n    {\n    float ci = t -(ct + float(i) * tm);\n    ec +=cli(ci)*cf;\n    cf *= fb;\n    }  \n    s += cli(t);\n    s += clamp(ec,-0.,0.5) * 0.6;\n    return clamp(s,-1.,1.);\n}\nvec2 rev2(float t) {\n\tvec2 s = vec2(0);    \n    vec2 reverb = vec2(0);\n    float st = 0.02; float it = 40.;\n    for (float i = 0.; i < it; i++)\n    {\n        float tf  =  i*st +rd(i+t)*0.5;\n        float am = exp2(-tf*5.);\n    \treverb += ((amp(t2(t-tf),300.,ech2(t -tf),0.9))/it) *am;     \n    }\n    s += ech2(t);\n    s += reverb*10.;\n\treturn clamp(s,-1.,1.);\n}\nvec2 rev3(float t,float f) {\n\tvec2 s = vec2(0);    \n    vec2 reverb = vec2(0);\n    float st = 0.02; float it = 40.;\n    for (float i = 0.; i < it; i++)\n    {\n        float tf  =  i*st +rd(i+t)*0.5;\n        float am = exp2(-tf*5.);\n    \treverb += ((t1(t-tf,f))/it) *am;     \n    }\n    s += t1(t,f);\n    s += reverb*10.;\n\treturn clamp(s,-1.,1.);\n}\n\nvec2 mainSound( in int samp, float time )\n{\n    vec2 s = vec2(0);  \n    float t =time;\n    float ta = clamp(time*0.5,0.,1.);\n    float tb = clamp(time*0.1,0.,1.);\n    float n1 = smoothstep(0.1,0.3,no(t*0.2));\n   s += amp(t1(t),200.,rev(t),0.7*n1)*ta;\n   s += amp(t2(t),100.,rev2(t),0.3)*tb;\n    \n  float ttr =no(time*0.7);\n  // *= 1.-ttr*0.5;\n  float trr = ((sin(time*0.25)*0.5+0.5)*10.)*0.5+0.2;\n   s += t1(t,trr*50.)*ttr*2.;\n   \n    return clamp(s,-1.,1.);\n}","name":"Sound","description":"","type":"sound"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"\nfloat np(vec2 p){vec2 f =floor(p); p =  smoothstep(0.,1.,fract(p));\n  vec2 se = vec2(45.,78.);\n  vec2 v1 = dot(f,se)+vec2(0.,se.y);\n  vec2 v2 = mix(fract(sin(v1)*7845.236),fract(sin(v1+se.x)*7845.236),p.x);\n  return mix(v2.x,v2.y,p.y);}\n float it(vec2 t){float r=0.;\n  float a = 0.5; for(int  i = 0 ; i <4 ; i++){r += np(t/a)*a; a*=0.5;}\n  return r;}\nmat2 rot( float t){ float c =cos(t); float s = sin(t); return mat2(c,-s,s,c);}\nfloat rd (float t){return fract(sin(dot(floor(t),45.))*7845.236);}\nfloat no(float t){return mix(rd(t),rd(t+1.),smoothstep(0.,1.,t));}\nfloat it(float t){float r=0.;\n  float a = 0.5; for(int  i = 0 ; i <4 ; i++){r += no(t/a)*a; a*=0.5;}\n  return r;}\n  float box(vec3 p, vec3 b){vec3 q = abs(p)-b;\n    return length(max(vec3(0.),q))+min(0.,max(q.x,max(q.y,q.z)));}\n    float zl1 ; float bl1;\nfloat map(vec3 p,vec4 ta){\n  p.y += sin(iTime*2.);\n  p.xy *= rot(iTime);\n  p = abs(p);\n  if(p.x>p.z)p.xz=p.zx;\n  vec3 pb = p;\n  vec3 pb2 = p;\n  pb.xz *= rot(iTime);\n   pb2.xy *= rot(iTime);\n  vec3 rb = vec3(2.);\n  pb = mod(pb,rb)-0.5*rb;\n   \n  vec3 rb2 = vec3(1.);\n  pb2 = mod(pb2,rb2)-0.5*rb2;\n  float d1 = box(p,vec3(ta.x*0.8,ta.y*20.,ta.x*2.));\n  float d2 = box(pb,vec3(0.5));\n  float d4 = box(pb2,vec3(0.5,0.3,0.3));\n  float d3 = max(min(d2,d4),d1);\n  float dl = max(d2,d1);\n  zl1 = dl;\n  float fl1 = 0.1;\n  bl1 += fl1/(fl1+d2);\n  return d3;}\n  vec3 nor(vec3 p,vec4 ta){vec2 e =vec2(0.01,0.);return normalize(map(p,ta)-vec3(map(p-e.xyy,ta),map(p-e.yxy,ta),map(p-e.yyx,ta)));}\n  float ev(vec3 r){ return clamp(pow(np(r.xz),2.),0.,0.5);}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\nfloat time = iTime;\n vec2 uv = fragCoord/iResolution.xy;\n vec2 uc = uv;\n\tuv -= 0.5;\n  uv *= 2.;\n  uv.x *= iResolution.x/iResolution.y;\n  float tl = smoothstep(0.88,0.95,fract(time*0.07));\n  vec2 vu2 = mix(vec2(5.),vec2(3.,5.),tl);\n  vec2 tu = vec2(np(uv*vu2+time),np(uv*vu2-time+47.));\n  vec2 tu2 = tu*0.5+(vec2(it(uv*vec2(3.,5.)+time),np(uv*vec2(3.,5.)-time+47.))-0.5)*0.5;\n  vec4 ta = vec4(it(time*2.)*2.+1.5,it(time*3.+45.),0.,0.);\n  vec3 p = vec3(0.,0.,-10.);\n  vec3 r = normalize(vec3(uv+tu2*tl,1.));\n  float tt = time+it(time)*12.;\n  p.xz *= rot(tt);\n  r.xz*=rot(tt);\n  float dd;\n  int mv= int(mix(64.,0.,tl));\n  for(int  i = 0 ; i< 64 ; i++){\n    float d = map(p,ta);\n    if(dd>40.){dd=40.;break;}\n    if(d<0.001){break;}\n    p += r*d;\n    dd +=d;\n  }\n  float s = smoothstep(40.,0.,dd);\n  float l1= smoothstep(0.01,0.,zl1)*2.+smoothstep(0.2,0.,zl1)*0.5+smoothstep(0.3,0.,zl1)*0.2;\n  vec3 n = nor(p,ta);\n  float dao = 0.9;\n  float ao = mix(0.,1.,clamp(map(p+n*dao,ta)/dao,0.,1.));\n  float ld = clamp(dot(n,-r),0.,1.);\n  float fres = pow(1.-ld,2.)*0.9;\n  float spec = pow(ld,9.)*0.2;\n  float ref = clamp(ev(reflect(n,r)),0.,1.);\n  float r0 = mix(ev(r),(l1+fres+spec+ref*0.5)*ao,s)+bl1*0.003;\n  \n  float bb = clamp(smoothstep(0.51,1.,texture(iChannel0,uc+tu*0.01).a),0.,0.5);\n  float r2 = r0;\n  r2 = r2 + bb*0.9;\n  float b = sqrt(32.);\n  float c=0.;\n  float d = pow(length(uv.y),1.5)*0.005+0.0005;\n  for(float j = -0.5*b; j <=0.5*b; j+=1.)\n  for(float k = -0.5*b; k <=0.5*b; k+=1.){\n    c += texture(iChannel0,uc+vec2(j,k)*d).a;\n  }\n  c/= 32.;\n    float rc = r2*2.*it(time+16.);\n  float rl = mix(texture(iChannel0,uc+tu2*0.01).a,rc,smoothstep(0.5,1.,it(uv*5.)));\n  float rcl = mix(rc,rl,tl);\n  \n  vec2 ul = uc;\n  vec2 um = uv*(0.001+fract(time*7.)*0.002);\n  float vi = 0.;\n    int mv2= int(mix(0.,30.,tl));\n  for(int k = 0 ; k < mv2 ; k++){\n    float d = float(k) / float(mv2);\n    ul -= um;\n    vi = texture(iChannel0,ul).a;\n    if(d>dot(vi,1.)){break;}\n  }\n  float vc = mix(c,mix(vi,c,pow(length(uv.y),1.5)),tl);\n  float ttr = smoothstep(0.3,0.8,no(time*0.7))*0.5;\n  float trr = floor((sin(time*0.25)*0.5+0.5)*10.)*0.1+0.2;\n  float tr = smoothstep(0.5-ttr,0.5+ttr,mod(time,trr)/trr);\n  vec3 r1 =mix(vec3(1.),3.*abs(1.-2.*fract(vc*0.9+0.1+0.5*tr+vec3(0.,-1./3.,1./3.)))-1.,mix(0.15,0.3,length(uv.y)))*vc;\n  vec3 r3 = pow(r1,mix(vec3(0.5),vec3(1.5),length(uv.y)));\n  vec3 r4 = mix(r3,1.-r3,tr);\n  vec4 rf = smoothstep(-0.1,1.1,vec4(r4,rcl));\n    fragColor = rf;\n}","name":"Buffer A","description":"","type":"buffer"}]}