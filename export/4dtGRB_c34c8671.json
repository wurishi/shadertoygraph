{"ver":"0.1","info":{"id":"4dtGRB","date":"1450477597","viewed":197,"name":"LineCircleReflection","username":"jt","description":"Visualization of a line reflected at a circle. Use mouse to position line.","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["reflection","visualization","line","circle"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[],"code":"// Line Circle Reflection - written 2015 by JT\n\nfloat PointLineDistance(vec2 a, vec2 u, vec2 c)\n{\n    return length(c - a - u * dot(u, c - a) / dot(u, u));\n}\n\nvec4 LineCircleIntersections(vec2 a, vec2 u, vec2 c, float r)\n{\n    u = normalize(u);\n    vec2 v = a + u * dot(u, c - a);\n    float t = sqrt(r * r - dot(v - c, v - c));\n    return vec4(v + u * t, v - u * t);\n}\n\n#define draw(q) O *= smoothstep(0.0, 0.01, abs(q))\n#define draw_(q,c) O = mix(c, O, smoothstep(0.0, 0.01, abs(q)))\n\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    vec2 R = iResolution.xy; \n    I = (I+I-R)/R.y;\n\n    //vec2 a = vec2(0.25,0.75);\n    vec2 u = vec2(3,2);\n    \n    vec2 m = vec2(0.1,0.2);\n    float r = 0.5;\n    \n    vec2 a = (2.*iMouse.xy-R)/R.y;\n\n    vec4 i = LineCircleIntersections(a, u, m, r);\n\n    O = vec4(1);\n    draw(PointLineDistance(a, u, I)); // line\n    draw(length(I - m) - r); // circle\n    draw(length(I - m)-.01); // center \n    if(PointLineDistance(a, u, m) < r)\n    {\n        draw_(length(I - i.xy)-.02,vec4(0,1,0,1)); // Intersection\n        draw_(length(I - i.zw)-.02,vec4(1,0,0,1)); // Intersection\n        vec2 n0 = normalize(i.xy - m);\n        vec2 n1 = normalize(i.zw - m);\n        //draw(PointLineDistance(m, n0, I)/step(length(I-m),r)); // normal\n        //draw(PointLineDistance(m, n1, I)/step(length(I-m),r)); // normal\n        draw(PointLineDistance(i.xy, u - 2. * dot(u, n0) * n0, I)); // reflected line\n        draw(PointLineDistance(i.zw, u - 2. * dot(u, n1) * n1, I)); // reflected line\n        O.b += 1.0;\n    }\n    //draw(length(I - a - u * (fract(iDate.w * .1)-.5))-.02);\n}\n","name":"","description":"","type":"image"}]}