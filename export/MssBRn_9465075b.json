{"ver":"0.1","info":{"id":"MssBRn","date":"1494686002","viewed":604,"name":"nwep","username":"w23","description":"Online unobfuscated shader port of 4k intro nwep by s.k.o.y.p and YOLP; final version.\nTook 9th place at Revision 2017.\nPouet prod page: http://www.pouet.net/prod.php?which=69746\nMusic by keen","likes":20,"published":1,"flags":96,"usePreview":0,"tags":["raymarching","dof","bokeh","revision","4kintro"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"MdfXzH","filepath":"https://soundcloud.com/keensky/nwep","previewfilepath":"https://soundcloud.com/keensky/nwep","type":"musicstream","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":0}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec3 V, C, A, D;\nfloat T;\n\nvoid updateTimeline() {\n\tV.xy = iResolution.xy;\n    float t = V.z = T = iTime;\n    \tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(63.500000,63.500000,63.500000), vec3(40.000000,1.500000,-1.000000), k);\n\t\tA = mix(vec3(63.500000,63.500000,63.500000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 18.260317) {\n\t\t float k = t / 18.260317;\n\t\tC = mix(vec3(40.000000,1.500000,-1.000000), vec3(19.000000,1.500000,1.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,4.000000), vec3(0.000000,1.440000,6.000000), k);\n\t\treturn;\n\t}\n\tt -= 18.260317;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(19.000000,1.500000,1.000000), vec3(17.000000,1.500000,1.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,6.000000,-10.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,6.000000), vec3(0.000000,1.440000,20.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 1.304308) {\n\t\t float k = t / 1.304308;\n\t\tC = mix(vec3(17.000000,1.500000,1.000000), vec3(16.000000,1.500000,1.000000), k);\n\t\tA = mix(vec3(0.000000,6.000000,-10.000000), vec3(0.000000,5.000000,-8.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,20.000000), vec3(0.000000,1.440000,20.000000), k);\n\t\treturn;\n\t}\n\tt -= 1.304308;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(16.000000,1.500000,1.000000), vec3(14.000000,1.500000,2.000000), k);\n\t\tA = mix(vec3(0.000000,5.000000,-8.000000), vec3(0.000000,8.000000,10.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,20.000000), vec3(0.000000,1.440000,20.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 1.304308) {\n\t\t float k = t / 1.304308;\n\t\tC = mix(vec3(14.000000,1.500000,2.000000), vec3(13.000000,1.500000,3.000000), k);\n\t\tA = mix(vec3(0.000000,8.000000,10.000000), vec3(0.000000,7.000000,11.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,20.000000), vec3(0.000000,1.440000,10.000000), k);\n\t\treturn;\n\t}\n\tt -= 1.304308;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(13.000000,1.500000,3.000000), vec3(12.000000,1.500000,5.000000), k);\n\t\tA = mix(vec3(0.000000,7.000000,11.000000), vec3(0.000000,2.000000,10.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,10.000000), vec3(0.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(12.000000,1.500000,5.000000), vec3(11.000000,1.500000,6.000000), k);\n\t\tA = mix(vec3(0.000000,2.000000,10.000000), vec3(0.000000,2.000000,4.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,4.000000), vec3(0.000000,1.440000,16.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(11.000000,1.500000,6.000000), vec3(9.000000,1.500000,8.000000), k);\n\t\tA = mix(vec3(0.000000,2.000000,4.000000), vec3(0.000000,-3.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,16.000000), vec3(0.000000,1.440000,16.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(9.000000,1.500000,8.000000), vec3(8.000000,1.500000,9.000000), k);\n\t\tA = mix(vec3(0.000000,-3.000000,0.000000), vec3(-2.000000,3.000000,-2.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,16.000000), vec3(0.000000,1.440000,16.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(8.000000,1.500000,9.000000), vec3(7.000000,1.500000,10.000000), k);\n\t\tA = mix(vec3(-2.000000,3.000000,-2.000000), vec3(3.000000,3.000000,-1.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,16.000000), vec3(0.000000,1.440000,16.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(7.000000,1.500000,10.000000), vec3(6.000000,1.500000,11.000000), k);\n\t\tA = mix(vec3(3.000000,3.000000,-1.000000), vec3(2.000000,3.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,16.000000), vec3(0.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 0.652154) {\n\t\t float k = t / 0.652154;\n\t\tC = mix(vec3(6.000000,1.500000,11.000000), vec3(6.000000,1.500000,11.000000), k);\n\t\tA = mix(vec3(2.000000,3.000000,0.000000), vec3(2.000000,3.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,4.000000), vec3(1.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.652154;\n\tif (t < 1.956463) {\n\t\t float k = t / 1.956463;\n\t\tC = mix(vec3(6.000000,1.500000,11.000000), vec3(5.000000,1.500000,12.000000), k);\n\t\tA = mix(vec3(2.000000,3.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(1.000000,1.440000,4.000000), vec3(2.000000,3.000000,12.000000), k);\n\t\treturn;\n\t}\n\tt -= 1.956463;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(5.000000,1.500000,12.000000), vec3(7.000000,1.500000,13.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(2.000000,3.000000,12.000000), vec3(3.000000,3.000000,12.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 5.217234) {\n\t\t float k = t / 5.217234;\n\t\tC = mix(vec3(7.000000,1.500000,13.000000), vec3(8.000000,1.500000,13.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,4.000000,0.000000), k);\n\t\tD = mix(vec3(3.000000,3.000000,12.000000), vec3(4.000000,2.000000,12.000000), k);\n\t\treturn;\n\t}\n\tt -= 5.217234;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(8.000000,1.500000,13.000000), vec3(10.000000,10.000000,10.000000), k);\n\t\tA = mix(vec3(0.000000,4.000000,0.000000), vec3(7.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,2.000000,12.000000), vec3(4.000000,1.440000,12.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(10.000000,10.000000,10.000000), vec3(-10.000000,-10.000000,10.000000), k);\n\t\tA = mix(vec3(7.000000,0.000000,0.000000), vec3(0.000000,2.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,12.000000), vec3(4.000000,0.800000,2.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(-10.000000,-10.000000,10.000000), vec3(10.000000,10.000000,10.000000), k);\n\t\tA = mix(vec3(0.000000,2.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,0.800000,2.000000), vec3(4.000000,1.000000,1.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(10.000000,10.000000,10.000000), vec3(-10.000000,-10.000000,10.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.000000,1.000000), vec3(4.000000,1.440000,20.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(-10.000000,-10.000000,10.000000), vec3(4.000000,2.000000,4.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(1.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,20.000000), vec3(4.000000,1.440000,3.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(4.000000,2.000000,4.000000), vec3(5.000000,2.000000,4.000000), k);\n\t\tA = mix(vec3(1.000000,0.000000,0.000000), vec3(2.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,3.000000), vec3(4.000000,1.440000,8.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(5.000000,2.000000,4.000000), vec3(3.000000,-8.000000,2.000000), k);\n\t\tA = mix(vec3(2.000000,0.000000,0.000000), vec3(0.000000,-5.000000,3.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,8.000000), vec3(4.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(3.000000,-8.000000,2.000000), vec3(3.000000,8.000000,4.000000), k);\n\t\tA = mix(vec3(0.000000,-5.000000,3.000000), vec3(0.000000,5.000000,2.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,4.000000), vec3(4.000000,1.440000,7.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(3.000000,8.000000,4.000000), vec3(2.000000,2.000000,2.000000), k);\n\t\tA = mix(vec3(0.000000,5.000000,2.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,7.000000), vec3(4.000000,1.440000,8.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(2.000000,2.000000,2.000000), vec3(2.000000,2.000000,2.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,8.000000), vec3(4.000000,1.440000,1.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(2.000000,2.000000,2.000000), vec3(0.000000,1.000000,0.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(-5.000000,1.000000,10.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,1.000000), vec3(4.000000,1.440000,2.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(0.000000,1.000000,0.000000), vec3(0.000000,1.000000,0.000000), k);\n\t\tA = mix(vec3(-5.000000,1.000000,10.000000), vec3(5.000000,5.000000,10.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,2.000000), vec3(4.000000,2.000000,2.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\t\t float k = t / 15.651701;\n\t\tC = mix(vec3(0.000000,1.000000,0.000000), vec3(0.000000,1.000000,0.000000), k);\n\t\tA = mix(vec3(5.000000,5.000000,10.000000), vec3(5.000000,7.000000,10.000000), k);\n\t\tD = mix(vec3(4.000000,2.000000,2.000000), vec3(4.000000,16.000000,1.000000), k);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    updateTimeline();\n\n\tvec2 uv = fragCoord.xy / V.xy, pixel = .002 * vec2(V.y/V.x, 1.), angle = vec2(0.,1.1);\n\tvec4 color = vec4(0.);\n\n\tfloat rad = 0.;\n\tmat2 rot = mat2(cos(2.4),sin(2.4),-sin(2.4),cos(2.4));\n\tfor (int i = 0; i < 256; i++) {\n\t\tvec4 sample_ = texture(iChannel0, uv + pixel * rad * angle);\n\n\t\tif (abs(50. * (D.z - sample_.w) / sample_.w / (D.z - .5)) > rad)\n\t\t\tcolor += vec4(sample_.xyz, 1.);\n\n\t\trad += 1. / (rad + 1.);\n\t\tangle *= rot;\n\t}\n\n\tfragColor = vec4(pow(color.xyz / (color.xyz + color.w), vec3(1./2.2)), 1.);\n}\n","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[{"id":"4dXGR8","channel":0}],"code":"vec3 V, C, A, D;\nfloat T;\n\nvoid updateTimeline() {\n\tV.xy = iResolution.xy;\n    float t = V.z = T = iTime;\n    \tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(63.500000,63.500000,63.500000), vec3(40.000000,1.500000,-1.000000), k);\n\t\tA = mix(vec3(63.500000,63.500000,63.500000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 18.260317) {\n\t\t float k = t / 18.260317;\n\t\tC = mix(vec3(40.000000,1.500000,-1.000000), vec3(19.000000,1.500000,1.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,4.000000), vec3(0.000000,1.440000,6.000000), k);\n\t\treturn;\n\t}\n\tt -= 18.260317;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(19.000000,1.500000,1.000000), vec3(17.000000,1.500000,1.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,6.000000,-10.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,6.000000), vec3(0.000000,1.440000,20.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 1.304308) {\n\t\t float k = t / 1.304308;\n\t\tC = mix(vec3(17.000000,1.500000,1.000000), vec3(16.000000,1.500000,1.000000), k);\n\t\tA = mix(vec3(0.000000,6.000000,-10.000000), vec3(0.000000,5.000000,-8.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,20.000000), vec3(0.000000,1.440000,20.000000), k);\n\t\treturn;\n\t}\n\tt -= 1.304308;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(16.000000,1.500000,1.000000), vec3(14.000000,1.500000,2.000000), k);\n\t\tA = mix(vec3(0.000000,5.000000,-8.000000), vec3(0.000000,8.000000,10.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,20.000000), vec3(0.000000,1.440000,20.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 1.304308) {\n\t\t float k = t / 1.304308;\n\t\tC = mix(vec3(14.000000,1.500000,2.000000), vec3(13.000000,1.500000,3.000000), k);\n\t\tA = mix(vec3(0.000000,8.000000,10.000000), vec3(0.000000,7.000000,11.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,20.000000), vec3(0.000000,1.440000,10.000000), k);\n\t\treturn;\n\t}\n\tt -= 1.304308;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(13.000000,1.500000,3.000000), vec3(12.000000,1.500000,5.000000), k);\n\t\tA = mix(vec3(0.000000,7.000000,11.000000), vec3(0.000000,2.000000,10.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,10.000000), vec3(0.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(12.000000,1.500000,5.000000), vec3(11.000000,1.500000,6.000000), k);\n\t\tA = mix(vec3(0.000000,2.000000,10.000000), vec3(0.000000,2.000000,4.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,4.000000), vec3(0.000000,1.440000,16.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(11.000000,1.500000,6.000000), vec3(9.000000,1.500000,8.000000), k);\n\t\tA = mix(vec3(0.000000,2.000000,4.000000), vec3(0.000000,-3.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,16.000000), vec3(0.000000,1.440000,16.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(9.000000,1.500000,8.000000), vec3(8.000000,1.500000,9.000000), k);\n\t\tA = mix(vec3(0.000000,-3.000000,0.000000), vec3(-2.000000,3.000000,-2.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,16.000000), vec3(0.000000,1.440000,16.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(8.000000,1.500000,9.000000), vec3(7.000000,1.500000,10.000000), k);\n\t\tA = mix(vec3(-2.000000,3.000000,-2.000000), vec3(3.000000,3.000000,-1.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,16.000000), vec3(0.000000,1.440000,16.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(7.000000,1.500000,10.000000), vec3(6.000000,1.500000,11.000000), k);\n\t\tA = mix(vec3(3.000000,3.000000,-1.000000), vec3(2.000000,3.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,16.000000), vec3(0.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 0.652154) {\n\t\t float k = t / 0.652154;\n\t\tC = mix(vec3(6.000000,1.500000,11.000000), vec3(6.000000,1.500000,11.000000), k);\n\t\tA = mix(vec3(2.000000,3.000000,0.000000), vec3(2.000000,3.000000,0.000000), k);\n\t\tD = mix(vec3(0.000000,1.440000,4.000000), vec3(1.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.652154;\n\tif (t < 1.956463) {\n\t\t float k = t / 1.956463;\n\t\tC = mix(vec3(6.000000,1.500000,11.000000), vec3(5.000000,1.500000,12.000000), k);\n\t\tA = mix(vec3(2.000000,3.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(1.000000,1.440000,4.000000), vec3(2.000000,3.000000,12.000000), k);\n\t\treturn;\n\t}\n\tt -= 1.956463;\n\tif (t < 2.608617) {\n\t\t float k = t / 2.608617;\n\t\tC = mix(vec3(5.000000,1.500000,12.000000), vec3(7.000000,1.500000,13.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(2.000000,3.000000,12.000000), vec3(3.000000,3.000000,12.000000), k);\n\t\treturn;\n\t}\n\tt -= 2.608617;\n\tif (t < 5.217234) {\n\t\t float k = t / 5.217234;\n\t\tC = mix(vec3(7.000000,1.500000,13.000000), vec3(8.000000,1.500000,13.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,4.000000,0.000000), k);\n\t\tD = mix(vec3(3.000000,3.000000,12.000000), vec3(4.000000,2.000000,12.000000), k);\n\t\treturn;\n\t}\n\tt -= 5.217234;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(8.000000,1.500000,13.000000), vec3(10.000000,10.000000,10.000000), k);\n\t\tA = mix(vec3(0.000000,4.000000,0.000000), vec3(7.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,2.000000,12.000000), vec3(4.000000,1.440000,12.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(10.000000,10.000000,10.000000), vec3(-10.000000,-10.000000,10.000000), k);\n\t\tA = mix(vec3(7.000000,0.000000,0.000000), vec3(0.000000,2.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,12.000000), vec3(4.000000,0.800000,2.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(-10.000000,-10.000000,10.000000), vec3(10.000000,10.000000,10.000000), k);\n\t\tA = mix(vec3(0.000000,2.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,0.800000,2.000000), vec3(4.000000,1.000000,1.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(10.000000,10.000000,10.000000), vec3(-10.000000,-10.000000,10.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.000000,1.000000), vec3(4.000000,1.440000,20.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(-10.000000,-10.000000,10.000000), vec3(4.000000,2.000000,4.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(1.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,20.000000), vec3(4.000000,1.440000,3.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(4.000000,2.000000,4.000000), vec3(5.000000,2.000000,4.000000), k);\n\t\tA = mix(vec3(1.000000,0.000000,0.000000), vec3(2.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,3.000000), vec3(4.000000,1.440000,8.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(5.000000,2.000000,4.000000), vec3(3.000000,-8.000000,2.000000), k);\n\t\tA = mix(vec3(2.000000,0.000000,0.000000), vec3(0.000000,-5.000000,3.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,8.000000), vec3(4.000000,1.440000,4.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(3.000000,-8.000000,2.000000), vec3(3.000000,8.000000,4.000000), k);\n\t\tA = mix(vec3(0.000000,-5.000000,3.000000), vec3(0.000000,5.000000,2.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,4.000000), vec3(4.000000,1.440000,7.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(3.000000,8.000000,4.000000), vec3(2.000000,2.000000,2.000000), k);\n\t\tA = mix(vec3(0.000000,5.000000,2.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,7.000000), vec3(4.000000,1.440000,8.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(2.000000,2.000000,2.000000), vec3(2.000000,2.000000,2.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(0.000000,0.000000,0.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,8.000000), vec3(4.000000,1.440000,1.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\tif (t < 0.000000) {\n\t\t float k = t / 0.000000;\n\t\tC = mix(vec3(2.000000,2.000000,2.000000), vec3(0.000000,1.000000,0.000000), k);\n\t\tA = mix(vec3(0.000000,0.000000,0.000000), vec3(-5.000000,1.000000,10.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,1.000000), vec3(4.000000,1.440000,2.000000), k);\n\t\treturn;\n\t}\n\tt -= 0.000000;\n\tif (t < 10.434467) {\n\t\t float k = t / 10.434467;\n\t\tC = mix(vec3(0.000000,1.000000,0.000000), vec3(0.000000,1.000000,0.000000), k);\n\t\tA = mix(vec3(-5.000000,1.000000,10.000000), vec3(5.000000,5.000000,10.000000), k);\n\t\tD = mix(vec3(4.000000,1.440000,2.000000), vec3(4.000000,2.000000,2.000000), k);\n\t\treturn;\n\t}\n\tt -= 10.434467;\n\t\t float k = t / 15.651701;\n\t\tC = mix(vec3(0.000000,1.000000,0.000000), vec3(0.000000,1.000000,0.000000), k);\n\t\tA = mix(vec3(5.000000,5.000000,10.000000), vec3(5.000000,7.000000,10.000000), k);\n\t\tD = mix(vec3(4.000000,2.000000,2.000000), vec3(4.000000,16.000000,1.000000), k);\n}\n\nconst vec3 E = vec3(.0,.001,1.);\nconst float PI = 3.141593;\n\nfloat hash1(float v){return fract(sin(v)*43758.5); }\nfloat hash2(vec2 p){return fract(sin(17.*hash1(p.x)+54.*hash1(p.y)));}\nfloat noise2(vec2 p){\n\tvec2 P=floor(p);p-=P;\n\t//p*=p*(3.-2.*p);\n\treturn mix(mix(hash2(P), hash2(P+E.zx), p.x), mix(hash2(P+E.xz), hash2(P+E.zz), p.x), p.y);\n}\nfloat noise(float p){\n\tfloat P = floor(p); p -= P;\n\t//p*=p*(3.-2.*p);\n\treturn mix(hash1(P), hash1(P+1.), p);\n}\nvec3 noise13(float p) { return vec3(noise(p), noise(p+13.), noise(p+29.)); }\n\nfloat box3(vec3 p, vec3 s) { p = abs(p) - s; return max(p.x, max(p.y, p.z)); }\nmat3 RY(float a){\tfloat s=sin(a),c=cos(a); return mat3(c,0.,s,0.,1.,0,-s,0.,c); }\n\nfloat ball(vec3 p, float r) { return length(p) - r; }\nvec3 rep3(vec3 p, vec3 r) { return mod(p,r) - r*.5; }\nfloat ring(vec3 p, float r, float R, float t) {\n\tfloat pr = length(p);\n\treturn max(abs(p.y)-t, max(pr - R, r - pr));\n}\nfloat vmax(vec2 p) { return max(p.x, p.y); }\n\nfloat F4(vec3 p) {\n\t//p = RY(T*.1) * p;\n\tconst float S = 2.8;\n\tconst int N = 5;\n\tvec3 C = vec3(1.1,.9,1.9);\n\tfor (int i = 0; i < N; ++i) {\n\t\tp = p * RY(.1+T*.3);\n\t\tp = abs(p);\n\t\tp.xy += step(p.x, p.y)*(p.yx - p.xy);\n\t\tp.xz += step(p.x, p.z)*(p.zx - p.xz);\n\t\tp.yz += step(p.y, p.z)*(p.zy - p.yz);\n\t\tp = p * RY(.7);\n\t\tp.xy = p.xy * S - (S - 1.) * C.xy;\n\t\tp.z = S * p.z;\n\t\tif (p.z > .5 * C.z * (S - 1.))\n\t\t\tp.z -= C.z * (S - 1.);\n\t}\n\t//return (length(p) - 2.) * pow(S, -float(N));\n\treturn box3(p, E.zzz) * pow(S, -float(N));\n}\n\nint mindex = 0;\nvoid PICK(inout float d, float dn, int mat) { if (dn<d) {d = dn; mindex = mat;} }\n\nfloat path(vec3 p) {\n\tfloat flr = vmax(abs(p.xy) - vec2(2.,.1));\n\tflr = flr+max(0.,.2*box3(rep3(p,vec3(.15)), vec3(.01)));\n\tp.x = abs(p.x)+.02;\n\tfloat rls = vmax(abs(p.xy-vec2(2.,1.)) - vec2(.02));\n\tfloat rlst = max(abs(mod(p.z,.4)-.2)-.02, max(abs(p.y-.5)-.5, abs(p.x-2.)-.02));\n\treturn min(flr, min(rls, rlst));\n}\nfloat hole(vec3 p) { return box3(p-vec3(33.,1.6,0.), vec3(20.,1.5,1.96)); }\n\n#define LN 5\nvec3 LP[LN], LC[LN];\n\nfloat W(vec3 p) {\n\tfloat w = 1e5;\n\t\tfor (int i = 0; i < LN; ++i)\n\t\t\tPICK(w, length(p - LP[i]) - .1, i+100);\n\n\tfloat r2 = length(p.xz), a2 = atan(p.x, p.z);\n\tfloat r3 = length(p);\n\n\tfloat holes = -min(hole(vec3(abs(p.x), p.yz)), hole(vec3(abs(p.z), p.yx)));;\n\tfloat plates = max(-ball(p,19.), box3(rep3(p, vec3(2.)), vec3(.8)));\n\tfloat extwall = -ball(p,20.);\n\tPICK(w, extwall, 1);\n\tPICK(w, plates, 2);\n\tw = max(holes, w);\n\n\tfloat rings = ball(p,9.);\n\trings = max(rings, abs(abs(p.y)-3.)-.5);\n\trings = min(rings, box3(rep3(p,vec3(11.8)), vec3(.1, 100., .1)));\n\trings = max(rings, -ball(p,8.9));\n\n\tfloat paths = path(vec3(r2-13., p.y, a2*10.));\n\tpaths = min(paths, max(15.-r2, min(path(p.zyx), path(p))));\n\tpaths = max(paths, holes);\n\n\tPICK(w, rings, 3);\n\tPICK(w, paths, 4);\n\tif (r3 < 2. * D.x)\n\t\tPICK(w, F4(p/D.x)*D.x, 5);\n\telse\n\t\tw = min(w, r3 + 1.);\n\n\treturn w;\n}\n\nfloat DistributionGGX(float NH, float r) {\n\tr *= r; r *= r;\n\tfloat denom = NH * NH * (r - 1.) + 1.;\n\tdenom = PI * denom * denom;\n\treturn r / denom;\n}\nfloat GeometrySchlickGGX(float NV, float r) {\n\tr += 1.; r *= r / 8.;\n\treturn NV / (NV * (1. - r) + r);\n}\n\nvec3 trace(vec3 o, vec3 d, float maxl) {\n\tfloat l = 0., minw = 1e3;\n\tint i;\n\tfor (i = 0; i < 128; ++i) {\n\t\tvec3 p = o+d*l;\n\t\tfloat w = W(p);\n\t\tl += w;\n\t\tminw = min(minw, w);\n\t\tif (w < .002*l || l > maxl) break;\n\t}\n\treturn vec3(l, minw, float(i));\n}\n\nmat3 lookat(vec3 p, vec3 a, vec3 y) {\n\tvec3 z = normalize(p - a);\n\tvec3 x = normalize(cross(y, z));\n\ty = cross(z, x);\n\treturn mat3(x, y, z);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    updateTimeline();\n\n\tvec2 uv = fragCoord.xy / V.xy * 2. - 1.;\n\tuv.x *= V.x / V.y;\n\n\tLP[0] = vec3(11., 6.,11.);\n\tLP[1] = vec3(11., 6.,-11.);\n\tLP[2] = vec3(-11., 6.,-11.);\n\tLP[3] = vec3(-11., 6.,11.);\n\tLP[4] = E.xxx;\n\n\tLC[0] = vec3(.7,.35,.45);\n\tLC[1] = vec3(.7,.35,.15);\n\tLC[2] = vec3(.3,.35,.75);\n\tLC[3] = vec3(.7,.35,.15);\n\tLC[4] = vec3(D.x);\n\n\tvec3 origin = C + .1 * noise13(T*3.);\n\tmat3 LAT = lookat(origin, A, E.xzx);\n\tvec3 ray = - LAT * normalize(vec3(uv, -D.y));\n\n\tvec3 tr = trace(origin, -ray, 40.);\n\tvec3 p = origin - tr.x * ray;\n\n\tvec3 color = E.xxx, albedo = E.xxx;\n\tfloat metallic = 0., roughness = 0.;\n\n\tfloat w=W(p);\n\tvec3 normal = normalize(vec3(W(p+E.yxx),W(p+E.xyx),W(p+E.xxy))-w);\n\n\tif (mindex == 1) {\n\t\talbedo = vec3(.5);\n\t\troughness = .4;\n\t\tmetallic = .99;\n\t} else if (mindex == 2) {\n\t\talbedo = vec3(.56, .57, .58);\n\t\troughness = mix(.15, .5, step(box3(rep3(p, vec3(2.)), vec3(.6)), 0.));\n\t\tmetallic = .8;\n\t} else if (mindex == 3) {\n\t\tfloat stripe = step(0., sin(atan(p.x,p.z)*60.));\n\t\talbedo = vec3(mix(1., .1, stripe));\n\t\troughness = mix(.9, .2, stripe);\n\t\tmetallic = .1;\n\t} else if (mindex == 4) {\n\t\talbedo = vec3(.56, .57, .58);\n\t\troughness = .2 + .6 * pow(noise2(p.xz*4.+40.),4.);\n\t\tmetallic = .8;\n\t} else if (mindex == 5) {\n\t\talbedo = vec3(1., 0., 0.);\n\t\troughness = .2;\n\t\tmetallic = .8;\n\t} else {\n\t\tfor (int i = 0; i < LN; ++i)\n\t\t\tif (mindex == 100 + i)\n\t\t\t\tcolor = LC[i] * 30.;\n\t}\n\n\tfor(int i = 0; i < LN; ++i) {\n    vec3 L = LP[i] - p; float LL = dot(L,L), Ls = sqrt(LL);\n\t\tL = normalize(L);\n\n\t\tvec3 tr = trace(p + .02 * L, L, Ls);\n\t\tif (tr.x + .2 < Ls ) continue;\n\n    vec3 H = normalize(ray + L), F0 = mix(vec3(.04), albedo, metallic);\n\t\tfloat HV = max(dot(H, ray), .0), NV = max(dot(normal, ray), .0), NL = max(dot(normal, L), 0.), NH = max(dot(normal, H), 0.);\n\t\tvec3 F = F0 + (1. - F0) * pow(1. - HV, 5.);\n\t\tfloat G = GeometrySchlickGGX(NV, roughness) * GeometrySchlickGGX(NL, roughness);\n\t\tvec3 brdf = DistributionGGX(NH, roughness)* G * F / (4. * NV * NL + .001);\n\t\tcolor += 30. * (.7 + .3 * noise(T*20. + float(i))) * ((vec3(1.) - F) * (1. - metallic)* albedo / PI + brdf) * NL * LC[i] / LL;\n\t}\n\n\tfragColor = vec4(color, tr.x);\n}\n","name":"Buf A","description":"","type":"buffer"}]}