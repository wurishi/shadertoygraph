{"ver":"0.1","info":{"id":"wt2SWK","date":"1567163775","viewed":115,"name":"LiveCodingPractice009(40min)","username":"Hirai_worthless","description":"test","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float PI = 3.14159265;\n\nmat2 genRot(float v){\n\treturn mat2(cos(v),-sin(v),sin(v),cos(v));\n}\n\nfloat stime(){\n\tfloat a = floor(iTime);\n\tfloat b = smoothstep(0.,1.,fract(iTime));\n\treturn a + b;\n}\n\nfloat map(vec3 p){\n\t//p = (fract(p / 2. + 0.5) - 0.5) * 2.;\n\tp.xz *= genRot(stime() * PI/1.5);\n\tp.xy *= genRot(stime() * PI/1.5);\n\tp = (fract(p / 2. + 0.5) - 0.5) * 2.;\n\tvec3 q = abs(p);\n\tfloat c = max(q.x,max(q.y,q.z)) - 0.5;\n\tfor(int i = 0; i < 3; i ++){\n\t\tq.xz *= genRot(stime() * PI / 6.);\n\t\tp.yz *= genRot(stime() * PI / 3.);\n\t\tp.xy *= genRot(stime() * PI /4.);\n\t\tq *= 3.0;\n\t\tfloat pole = abs(q.x) - 0.5;\n\t\tpole = min(pole,abs(q.y) - 0.5);\n\t\tpole = min(pole,abs(q.z) - 0.5);\n\t\tc = max(c, -pole);\n\t\tq -= 1.;\n\t\tq = abs(q);\n\t}\n\treturn c;\n}\nvec3 getNormal(vec3 p){\n\tvec3 x = dFdx(p);\n\tvec3 y = dFdy(p);\n\treturn normalize(cross(x,y));\n}\nvec4 trace(vec3 o,vec3 r){\n\tvec4 d;\n\tfloat t = 0.;\n\tfor(int i = 0; i < 256; i++){\n\t\tvec3 p = o + r * t;\n\t\tfloat d = map(p);\n\t\tt += d * 0.1;\n\t}\n\tvec3 p = o + r * t;\n\tvec3 n = getNormal(p);\n\treturn vec4(n,t);\n}\n\nvec3 getColor(vec3 o,vec3 r,vec4 d){\n\tfloat t = d.w;\n\tvec3 n = d.xyz;\n\tfloat a = dot(r,n);\n\tvec3 bc = vec3(1. + a);\n\tvec3 cc;\n\tvec3 p = o + r * t;\n\tcc = sin(p) * 0.5 + 0.5;\n\tbc *= cc;\n\tfloat fog = 1./(1. + t * t * 0.1);\n\treturn vec3(bc * fog);\n}\n\nvec3 cam(){\n\tvec3 c = vec3(0.,0.,-1.5);\n\treturn c;\n}\n\nvec3 ray (vec2 uv,float z){\n\tvec3 r = normalize(vec3(uv,z));\n\treturn r;\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\n\tvec2 uv = (fragCoord.xy * 2.- iResolution.xy) / iResolution.y;\n\tvec3 o = cam();\n\tvec3 r = ray(uv,1.5);\n\tvec4 d = trace(o,r);\n\tvec3 color = getColor(o,r,d);\n\tfragColor = vec4( color, 1.0 );\n\n}","name":"Image","description":"","type":"image"}]}