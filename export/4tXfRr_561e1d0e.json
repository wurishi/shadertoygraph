{"ver":"0.1","info":{"id":"4tXfRr","date":"1510714537","viewed":328,"name":"MeshFromPlanes","username":"MrShoor","description":"small sample of raycasts to planes","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["raytrace"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define planes_cnt  80\nvec4 planes[planes_cnt];\n\nvoid init_planes(){\nplanes[ 0 ] = vec4( 0.54464017315 , -0.81413923881 , -0.201356354805 , -0.943523476532 );\nplanes[ 1 ] = vec4( 0.940030081246 , -0.339036050957 , 0.0373898716834 , -0.943522897356 );\nplanes[ 2 ] = vec4( 0.210969315095 , -0.899183404549 , -0.383355126575 , -0.943522843872 );\nplanes[ 3 ] = vec4( 0.191103708694 , -0.681940395046 , -0.706000474595 , -0.943522854432 );\nplanes[ 4 ] = vec4( 0.51249698306 , -0.46263317111 , -0.723406795201 , -0.943523515601 );\nplanes[ 5 ] = vec4( 0.9672732032 , -0.0159771640312 , 0.253233648238 , -0.943522045293 );\nplanes[ 6 ] = vec4( 0.223392303424 , -0.754384288562 , 0.617252155883 , -0.94352133689 );\nplanes[ 7 ] = vec4( -0.617239817425 , -0.779532176567 , -0.106511001694 , -0.943521849828 );\nplanes[ 8 ] = vec4( -0.392886504299 , -0.0566671399175 , -0.917839326894 , -0.943521100907 );\nplanes[ 9 ] = vec4( 0.586396852264 , 0.4152335237 , -0.695499714199 , -0.943521492953 );\nplanes[ 10 ] = vec4( 0.797757057719 , -0.0861272896318 , 0.596796252368 , -0.943521097419 );\nplanes[ 11 ] = vec4( -0.164627101792 , -0.742831132347 , 0.648922049381 , -0.943521514501 );\nplanes[ 12 ] = vec4( -0.818899282682 , -0.498171366121 , -0.285007464464 , -0.943522997753 );\nplanes[ 13 ] = vec4( -0.260878351176 , 0.309737320856 , -0.91433324229 , -0.943521502657 );\nplanes[ 14 ] = vec4( 0.738270785188 , 0.564393687874 , -0.369345384194 , -0.943521120671 );\nplanes[ 15 ] = vec4( 0.0864553115838 , 0.294679500373 , 0.951677188525 , -0.943521936839 );\nplanes[ 16 ] = vec4( -0.69419416658 , -0.041678980738 , 0.718580073235 , -0.943522583511 );\nplanes[ 17 ] = vec4( -0.940030081246 , 0.339036050957 , -0.0373898716834 , -0.943522897356 );\nplanes[ 18 ] = vec4( -0.311323244067 , 0.910690313294 , -0.271516097084 , -0.943522483652 );\nplanes[ 19 ] = vec4( 0.323087362833 , 0.88327574782 , 0.339762430664 , -0.943522830784 );\nplanes[ 20 ] = vec4( -0.210969316635 , 0.899183463939 , 0.383354986426 , -0.943522821645 );\nplanes[ 21 ] = vec4( 0.0471338065867 , 0.973883074805 , 0.222103941623 , -0.934172769829 );\nplanes[ 22 ] = vec4( 0.0223478911823 , 0.995734562625 , -0.0895167724674 , -0.943521881356 );\nplanes[ 23 ] = vec4( -0.544640090428 , 0.814139314409 , 0.20135627289 , -0.943523450529 );\nplanes[ 24 ] = vec4( -0.564252373405 , 0.818055676839 , -0.111374003693 , -0.934173197453 );\nplanes[ 25 ] = vec4( -0.753680118405 , 0.608837357822 , -0.247554743123 , -0.943522553468 );\nplanes[ 26 ] = vec4( -0.730989639978 , 0.544338757965 , 0.411520914197 , -0.943523907839 );\nplanes[ 27 ] = vec4( -0.90570749993 , 0.323690648444 , 0.273712054319 , -0.934173756305 );\nplanes[ 28 ] = vec4( -0.91268748288 , 0.0400266617521 , 0.406693281163 , -0.943522930686 );\nplanes[ 29 ] = vec4( -0.51249692643 , 0.462633145411 , 0.723406851756 , -0.943523499855 );\nplanes[ 30 ] = vec4( -0.505355830051 , 0.173983823021 , 0.845189395556 , -0.934173244497 );\nplanes[ 31 ] = vec4( -0.23493837827 , 0.0753715401824 , 0.969083633824 , -0.943522510519 );\nplanes[ 32 ] = vec4( -0.19110371034 , 0.681940326138 , 0.706000540709 , -0.943522839495 );\nplanes[ 33 ] = vec4( 0.0835341491243 , 0.575822725969 , 0.813295908134 , -0.934172796884 );\nplanes[ 34 ] = vec4( 0.342952874182 , 0.666033238885 , 0.662407012939 , -0.943522824942 );\nplanes[ 35 ] = vec4( 0.61723981945 , 0.779532174756 , 0.106511003214 , -0.943521848824 );\nplanes[ 36 ] = vec4( 0.58611618715 , 0.783791498097 , -0.205277136262 , -0.934171247427 );\nplanes[ 37 ] = vec4( 0.316501024118 , 0.891990949157 , -0.322768103061 , -0.943521101105 );\nplanes[ 38 ] = vec4( -0.223392308181 , 0.754384287977 , -0.617252154876 , -0.943521335972 );\nplanes[ 39 ] = vec4( -0.403133426416 , 0.531661207055 , -0.7448622701 , -0.934171364222 );\nplanes[ 40 ] = vec4( -0.665748942334 , 0.45253209033 , -0.593290024358 , -0.943521476812 );\nplanes[ 41 ] = vec4( -0.9672732032 , 0.0159771640312 , -0.253233648238 , -0.943522045293 );\nplanes[ 42 ] = vec4( -0.955624671829 , -0.268240484645 , -0.121772447576 , -0.934172584634 );\nplanes[ 43 ] = vec4( -0.939930613317 , -0.283031959581 , 0.190849029352 , -0.943522047872 );\nplanes[ 44 ] = vec4( -0.586396852264 , -0.4152335237 , 0.695499714199 , -0.943521492953 );\nplanes[ 45 ] = vec4( -0.307836092953 , -0.510476351341 , 0.802901509898 , -0.934171366418 );\nplanes[ 46 ] = vec4( -0.127141289939 , -0.298183957307 , 0.946002864688 , -0.943521328004 );\nplanes[ 47 ] = vec4( 0.392886505185 , 0.0566671430578 , 0.917839326321 , -0.943521100287 );\nplanes[ 48 ] = vec4( 0.645012967097 , 0.139716928764 , 0.751290524427 , -0.934171238614 );\nplanes[ 49 ] = vec4( 0.649383422732 , 0.428020722167 , 0.628569353115 , -0.943521846976 );\nplanes[ 50 ] = vec4( 0.164627100239 , 0.742831130405 , -0.648922051997 , -0.943521511372 );\nplanes[ 51 ] = vec4( 0.307836092953 , 0.510476351341 , -0.802901509898 , -0.934171366418 );\nplanes[ 52 ] = vec4( 0.127141289305 , 0.298183956536 , -0.946002865016 , -0.943521328352 );\nplanes[ 53 ] = vec4( -0.797757057719 , 0.0861272896318 , -0.596796252368 , -0.943521097419 );\nplanes[ 54 ] = vec4( -0.645012967097 , -0.139716928764 , -0.751290524427 , -0.934171238614 );\nplanes[ 55 ] = vec4( -0.649383422732 , -0.428020722167 , -0.628569353115 , -0.943521846976 );\nplanes[ 56 ] = vec4( -0.738270785188 , -0.564393687874 , 0.369345384194 , -0.943521115168 );\nplanes[ 57 ] = vec4( -0.58611618715 , -0.783791498097 , 0.205277136262 , -0.934171247427 );\nplanes[ 58 ] = vec4( -0.316501043777 , -0.891990944717 , 0.322768096054 , -0.943521094035 );\nplanes[ 59 ] = vec4( 0.260878349338 , -0.309737320916 , 0.914333242794 , -0.943521503014 );\nplanes[ 60 ] = vec4( 0.403133426416 , -0.531661207055 , 0.7448622701 , -0.934171364222 );\nplanes[ 61 ] = vec4( 0.665748942334 , -0.45253209033 , 0.593290024358 , -0.943521476812 );\nplanes[ 62 ] = vec4( 0.818899287367 , 0.498171367532 , 0.285007448535 , -0.943522994632 );\nplanes[ 63 ] = vec4( 0.955624671829 , 0.268240484645 , 0.121772447576 , -0.934172584634 );\nplanes[ 64 ] = vec4( 0.939930610839 , 0.283031959617 , -0.190849041505 , -0.943522054825 );\nplanes[ 65 ] = vec4( 0.69419416658 , 0.041678980738 , -0.718580073235 , -0.943522583511 );\nplanes[ 66 ] = vec4( 0.505355843426 , -0.173983810055 , -0.845189390228 , -0.934173247954 );\nplanes[ 67 ] = vec4( 0.234938372959 , -0.0753715184715 , -0.969083636801 , -0.943522514743 );\nplanes[ 68 ] = vec4( -0.0864553356722 , -0.294679483775 , -0.951677191476 , -0.943521942346 );\nplanes[ 69 ] = vec4( -0.0835342038274 , -0.575822746717 , -0.813295887825 , -0.934172806665 );\nplanes[ 70 ] = vec4( -0.342952874182 , -0.666033238885 , -0.662407012939 , -0.943522824942 );\nplanes[ 71 ] = vec4( -0.323087360526 , -0.883275755633 , -0.339762412547 , -0.943522827063 );\nplanes[ 72 ] = vec4( -0.0471339128539 , -0.973883058465 , -0.22210399072 , -0.934172790916 );\nplanes[ 73 ] = vec4( -0.0223479772943 , -0.995734554412 , 0.0895168423356 , -0.943521902186 );\nplanes[ 74 ] = vec4( 0.91268748288 , -0.0400266617521 , -0.406693281163 , -0.943522930686 );\nplanes[ 75 ] = vec4( 0.905707491462 , -0.323690645086 , -0.273712086312 , -0.934173760017 );\nplanes[ 76 ] = vec4( 0.730989639978 , -0.544338757965 , -0.411520914197 , -0.943523907839 );\nplanes[ 77 ] = vec4( 0.311323230701 , -0.910690291665 , 0.271516184956 , -0.943522504829 );\nplanes[ 78 ] = vec4( 0.564252478034 , -0.81805560055 , 0.11137403396 , -0.934173213706 );\nplanes[ 79 ] = vec4( 0.753680118405 , -0.608837357822 , 0.247554743123 , -0.943522553468 );\n}\n\nstruct hit_test {\n    vec4 p;\n    float t;\n};\n\nhit_test h_t(vec3 ro, vec3 rd, vec4 p) {\n    hit_test Out;\n    float dp = dot(rd, p.xyz);\n    float t = (-p.w - dot(p.xyz, ro))/dp;\n    Out.t = t;\n    Out.p = p;\n    return Out;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{    \n    init_planes();\n    \n    vec3 rd;\n    rd.xy = 2.0*fragCoord.xy/iResolution.xy - 1.0;\n    rd.x *= iResolution.x/iResolution.y;\n    rd.z = 1.0;\n    vec3 ro = vec3(0.0,0.0,-2.0);\n    \n    fragColor = vec4(-normalize(rd).y);\n    \n    float fi = iTime*0.5;\n    vec2 a = vec2(cos(fi), sin(fi));\n    mat2 rot = mat2(a, -a.y, a.x);    \n    ro.xz = rot*ro.xz;\n    rd.xz = rot*rd.xz;\n\n    hit_test res = h_t(ro, rd, planes[0]);\n    hit_test h;\n    bool inited = false;\n    for (int i=0; i < planes_cnt; i++) {\n        if (dot(rd, planes[i].xyz) < 0.0) {\n            h = h_t(ro, rd, planes[i]);\n            if (h.t > 0.0) {\n                if (!inited||(h.t > res.t)) {\n                    res = h;\n                    inited = true;\n                }\n            }\n        }\n    }\n    \n    for (int i=0; i < planes_cnt; i++) {\n        if (dot(rd, planes[i].xyz) > 0.0) {\n            h = h_t(ro, rd, planes[i]);\n            if (h.t < res.t) return;\n        }\n    }\n    \n    if (!inited) return;\n    \n    fragColor=vec4(vec3(-dot(res.p.xyz, rd)),1.0);\n}","name":"Image","description":"","type":"image"}]}