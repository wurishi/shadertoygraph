{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"4dfGRn","filepath":"/media/a/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"// ====\n//note: period of 2, [-1;1]=/\\ \nfloat sawtooth( float t ) {\n\treturn abs(mod(abs(t), 2.0)-1.0);\n}\n\n//note: from https://iquilezles.org/articles/smin\n//      polynomial smooth min (k = 0.1);\nfloat smin_cubic( float a, float b, float k )\n{\n    float h = max( k-abs(a-b), 0.0 )/k;\n    return min( a, b ) - h*h*h*k*(1.0/6.0);\n}\n\n\n// Given a vec2 in [-1,+1], generate a texture coord in [0,+1]\nvec2 barrelDistortion( vec2 p, vec2 amt )\n{\n    p = 2.0 * p - 1.0;\n\n    /*\n    const float maxBarrelPower = 5.0;\n\t//note: http://glsl.heroku.com/e#3290.7 , copied from Little Grasshopper\n    float theta  = atan(p.y, p.x);\n    vec2 radius = vec2( length(p) );\n    radius = pow(radius, 1.0 + maxBarrelPower * amt);\n    p.x = radius.x * cos(theta);\n    p.y = radius.y * sin(theta);\n\n\t/*/\n    // much faster version\n    //const float maxBarrelPower = 5.0;\n    //float radius = length(p);\n    float maxBarrelPower = sqrt(5.0);\n    float radius = dot(p,p); //faster but doesn't match above accurately\n    \n    radius = -smin_cubic(-radius,0.00, 1.0);\n    \n    p *= pow(vec2(radius), maxBarrelPower * amt);\n\t/* */\n\n    return p * 0.5 + 0.5;\n}\n\n//note: from https://www.shadertoy.com/view/MlSXR3\nvec2 brownConradyDistortion(vec2 uv, float dist)\n{\n    uv = uv * 2.0 - 1.0;\n    // positive values of K1 give barrel distortion, negative give pincushion\n    float barrelDistortion1 = 0.1 * dist; // K1 in text books\n    float barrelDistortion2 = -0.025 * dist; // K2 in text books\n\n    float r2 = dot(uv,uv);\n    uv *= 1.0 + barrelDistortion1 * r2 + barrelDistortion2 * r2 * r2;\n    //uv *= 1.0 + barrelDistortion1 * r2;\n    \n    // tangential distortion (due to off center lens elements)\n    // is not modeled in this function, but if it was, the terms would go here\n    return uv * 0.5 + 0.5;\n}\n\nfloat remap( float t, float a, float b )\n{\n    return (t-a)/(b-a);\n}\nvec2 remap( vec2 t, vec2 a, vec2 b )\n{\n    return vec2( remap( t.x, a.x, b.x ),\n                 remap( t.y, a.y, b.y ) );\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\t\n    float distpow = 5.0;\n    if ( iMouse.z > 0.5 )\n        distpow = (1.2-iMouse.x / iResolution.x) * 10.0;\n    \n\t//note: domain distortion\n\t//const vec2 ctr = vec2(0.5,0.5);\n\t//vec2 ctrvec = ctr - uv;\n\t//float ctrdist = length( ctrvec );\n\t//ctrvec /= ctrdist;\n\t//uv += ctrvec * max(0.0, pow(ctrdist, distpow)-0.0025);\n    \n    //uv = barrelDistortion(uv, vec2(0.05) );\n    \n    uv = brownConradyDistortion( uv, distpow );\n    vec2 minuv = brownConradyDistortion( vec2(0,0), distpow );\n    vec2 maxuv = brownConradyDistortion( vec2(1,1), distpow );\n    uv = remap( uv, minuv, maxuv );\n\t\n\t//note: lines\n\tvec2 div = 40.0 * vec2(1.0, iResolution.y / iResolution.x );\n\tfloat lines = 0.0;\n\tlines += smoothstep( 0.2, 0.0, sawtooth( uv.x*2.0*div.x ) );\n\tlines += smoothstep( 0.2, 0.0, sawtooth( uv.y*2.0*div.y ) );\n\tlines = clamp( lines, 0.0, 1.0 );\n\t\n\tvec3 outcol = vec3(0.0);\n\toutcol += texture( iChannel0, vec2(0,1)+vec2(1,-1)*uv ).rgb;\n\toutcol *= vec3(1.0-lines); //black\n\t//outcol += vec3(lines); //white\n\n\t//note: force black outside valid range\t\n\tvec2 valid = step( vec2(0.0), uv ) * step( uv, vec2(1.0) );\n\toutcol *= valid.x*valid.y;\n\t\n\tfragColor = vec4(outcol,1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XdfGzH","date":"1362154661","viewed":2655,"name":"post: Screen Distort","username":"hornet","description":"warps outwards radially while leaving center untouched","likes":32,"published":1,"flags":0,"usePreview":1,"tags":["domain","distortion","screen","post"],"hasliked":0,"parentid":"","parentname":""}}