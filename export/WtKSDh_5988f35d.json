{"ver":"0.1","info":{"id":"WtKSDh","date":"1582655254","viewed":108,"name":"Mandelbrot sphere","username":"nturton","description":"A Mandelbrot set on a sphere.","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["fractal","simple","sphere"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float sphere(vec3 ro, vec3 rd, vec4 sph)\n{\n    vec3 oc = sph.xyz-ro;\n    float b = dot(rd, oc);\n    float d2 = dot(oc,oc) - b*b;\n    float h2 = sph.w*sph.w-d2;\n    if (h2 <= 0.0) {\n        return -1.0;\n    }\n    return b - sqrt(h2);\n}\n\nint mandelbrot(vec2 z, vec2 c)\n{\n    int i;\n    for(i=0; i<50; i++) {\n        if (z.x*z.x+z.y*z.y >= 4.0)\n            return i;\n        z = vec2(z.x*z.x - z.y*z.y + c.x, 2.*z.x*z.y + c.y);\n    }\n    return -1;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 xy = (2.0*fragCoord - iResolution.xy)/min(iResolution.x,iResolution.y);\n\n    vec3 ro = vec3(0.0, 0.0, 0.0);\n    vec3 rd = normalize(vec3(xy, 4.0));\n    vec4 sph = vec4(0.0, 0.0, 5.0, 1.0);\n    vec3 illum = normalize(vec3(1.0, 2.0, -2.0));\n\n    mat3 rot = mat3( \n        vec3(+cos(iTime),  0.0, +sin(iTime)),\n        vec3(+0.0,        +1.0, 0.0),\n        vec3(-sin(iTime),  0.0, +cos(iTime))\n    );\n\n    vec3 col = vec3(float(0.0));\n    float d_sph = sphere(ro, rd, sph);\n    if (d_sph >= 0.0) {\n        vec3 n = normalize(ro + d_sph*rd - sph.xyz);\n        vec2 z = vec2(0.0);\n        vec3 c3 = rot*n-vec3(0.0,0.0,0.0);\n        vec2 c = 1.0*c3.xy/c3.z;\n        int i = mandelbrot(z, c);\n        vec3 m_col = vec3(0.0, 0.0, 0.0);\n        if (i >= 0) {\n            m_col = 0.5-0.5*cos(vec3(1.0,2.0,3.0)*float(i));\n        }\n        float b0 = clamp(dot(illum, n),0.0,1.0);\n        vec3 reflect = illum - 2.*n*dot(n,illum);\n        float b1 = pow(clamp(dot(reflect,rd),0.0,1.0), 5.0);\n        col = m_col*(0.3+b0*0.3)+b1*0.4;\n    }\n\n    // Output to screen\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}