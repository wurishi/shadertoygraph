{"ver":"0.1","info":{"id":"ssycDc","date":"1656111729","viewed":96,"name":"Haru86_GlowCave","username":"Haru86_","description":"Haru86_GlowCave","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"NddXWH","parentname":"Haru86_Ray"},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define time iTime\n#define resolution iResolution\n\n#define PI 3.14159265\n#define rot(a) mat2(cos(a),sin(a),-sin(a),cos(a))\n\nvec2 pmod(vec2 p,float n){\n  float a=atan(p.x,p.y)+PI/n;\n  float num=2.0*PI/n;\n  a=floor(a/num)*num;\n  return rot(-a)*p;\n}\n\nfloat Torus(vec3 p,vec2 size)\n{\n    return length(vec2(length(p.xy)-size.x,p.z))-size.y;\n}\n\nfloat Box(vec3 p,vec3 size)\n{\n    return length(max(abs(p)-size,0.0));\n}\n\nfloat flower(vec3 p)\n{\n    p.xy*=rot(iTime);\n    p.xz*=rot(iTime);\n    p.yz*=rot(iTime);\n\n    vec3 pos=p*1.25;\n    float r=floor(time)+pow(fract(time),.1);\n    r*=0.75;\n    //float r=3.75;\n    pos=abs(pos);\n    for(int i=0;i<6;i++)\n    {\n        pos=abs(pos)-0.01;\n        if(pos.x<pos.y)pos.xy=pos.yx;\n        if(pos.x<pos.z)pos.xz=pos.zx;\n        if(pos.y<pos.z)pos.yz=pos.zy;\n        pos-=0.01;\n        \n        pos.xy*=rot(r);\n        pos.xz*=rot(r);\n        pos.yz*=rot(r);\n        pos-=0.01;\n        \n        //pos.yz*=rot(PI/3.);\n    }\n\n    return Box(pos,vec3(0.1,0.1,4.0));\n    \n}\n\nfloat c(vec3 p,vec3 s){\n  return length(max(abs(p)-s,0.));\n}\n\nvec3 trs(vec3 p){\n  vec3 pos=p;\n  pos.z-=iTime*6.;\n  float k=8.;\n  pos=mod(pos,k)-k*.5;\n\n pos.xy=pmod(pos.xy,6.);\n pos.yz=pmod(pos.yz,5.);\n\npos.xz=pmod(pos.xz,12.);\n  pos=abs(pos)-.15;\n  pos.z=abs(pos.z)-.12;\n  pos.z=abs(pos.z)-.182;\n\n\n  return pos;\n}\n\nfloat m1m(vec3 p){\n  p=trs(p);\n\n  p=abs(p);\n   vec3 o=p*1.5;\n  float s=1.;\n\n  \n  for(int i=0;i<5;i++){\n\n    if(p.x<p.y)p.xy=p.yx;\n    if(p.x<p.z)p.xz=p.zx;\n    if(p.y<p.z)p.yz=p.zy;\n\n    p.xy=pmod(p.xy,3.0*.25);\n    p.yz=pmod(p.yz,6.*.8);\n  p.xz=pmod(p.xz,4.*.85);\n\n     float r=0.55*clamp(5.38*max(dot(p,p)*3.2,5.01),.1,.98)*9.;\n\n     s*=r;\n     p*=r;\n     p=abs(p)-o;\n\n     p=abs(p)-0.5;\n     p.z=abs(p.z)-0.92;\n     p.x=abs(p.x)-0.45;\n    p.z-=0.12;\n    p.z-=0.8;\n    p=abs(p)-0.5;\n     p.xz=pmod(p.xz,12.);\n     p.xy=pmod(p.xy,6.);\n\n     p=abs(p)-0.15;\n     p.y=abs(p.y)-.6;\n\n     p.xy*=rot(0.23);\n     p.yz*=rot(0.74);\n     p.xz*=rot(0.623);\n\n     p.z-=0.3;\n     p.z-=0.1;\n     p.z=abs(p.z)-0.5;\n\n\n    p=abs(p)-0.25;\n\n    if(p.x<p.y)p.xy=p.yx;\n    if(p.x<p.z)p.xz=p.zx;\n    if(p.y<p.z)p.yz=p.zy;\n\n\n\n  }\n  p/=s;\n\np.xz=pmod(p.xz,12.);\np.z=abs(p.z)-.45;\np.z=abs(p.z)-0.12;\np.xy=pmod(p.xy,2.);\np.z=abs(p.z)-0.231;\np.xy=pmod(p.xy,3.);\n\n  float m=c(p,vec3(1.,1.,.3));\n  return m;\n}\n\nfloat map(vec3 p,out float m1,out float m2){\n  \n  m1=m1m(p);\n  m2=flower(p);\n  return min(m1,m2);\n}\n\nvec3 gn(vec3 p){\n  vec2 e=vec2(0.001,0.);\n  float num1=0.0,num2=0.0;\n  \n  return normalize(vec3(\n    map(p+e.xyy,num1,num2)-map(p-e.xyy,num1,num2),\n    map(p+e.yxy,num1,num2)-map(p-e.yxy,num1,num2),\n    map(p+e.yyx,num1,num2)-map(p-e.yyx,num1,num2)\n    ));\n}\n\nvec3 hsv2rgb2(vec3 c, float k) {\n    return smoothstep(0. + k, 1. - k,\n        .5 + .5 * cos((vec3(c.x, c.x, c.x) + vec3(3., 2., 1.) / 3.) * radians(360.)));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n  vec2 st=(fragCoord.xy*2.-iResolution.xy)/min(iResolution.x,iResolution.y);\nst*=rot(iTime*0.5);\n float radius=0.5+(sin(iTime*0.5)+1.0)*0.5;\n   float phi=iTime;\n   \n  // vec3 ro=vec3(0.0,0.0,1.0);\n   vec3 ro=vec3(radius*cos(phi),radius*sin(phi),1.0);\n   //vec3 rd=normalize(vec3(uv.xy,-3.0));\n   vec3 ta=vec3(0.0,0.0,0.0);\n   \n   vec3 cDir=normalize(ta-ro);\n   vec3 side=cross(cDir,vec3(0.0,1.0,0.0));\n   vec3 up=cross(cDir,side);\n   float fov=1.0;\n   \n   vec3 rd=normalize(vec3(st.x*side+st.y*up+cDir*fov));\n\n  float d,t,acc=0.,pi=0.0,m1=0.0,m2=0.0;\n  for(int i=0;i<128;i++){\n    d=map(ro+rd*t,m1,m2);\n    // d=min(d,.5);\n     d=min(abs(d),.2);\n     pi=float(i);\n    if(abs(d)<0.001||t>1000.0)break;\n    t+=d;\n    acc+=exp(-6.*d);\n  }\n\n\nvec3 n=gn(ro+rd*t);\n  float acc2=0.0;\nt=0.1;\nvec3 refro=ro+rd*t;\nrd=reflect(rd,n);\nro=refro;\n\nfloat num1=0.0,num2=0.0;\nfor(int i=0;i<64;i++){\n  d=map(ro+rd*t,num1,num2);\n //  d=min(abs(d),.5);\n  if(d<0.001||t>1000.0)break;\n  t+=d;\n  acc2+=exp(-6.*d);\n}\n  vec3 col=vec3(0.0);\n\n  if(m1<0.001)\n  {\n      vec3 p=ro+rd*t;\n      float flash =1.0- abs(sin(p.z*0.1+iTime*4.0));\n      flash += .15;\n      flash = clamp(flash,0.0, 1.0);\n      float H = mod(iTime*0.1, 1.0);\n      col=vec3(.9,.8,.7)*10./pi+hsv2rgb2(vec3(H,1.0,1.0),2.2)*acc2*0.015*flash;\n  }\n  else if(m2<0.001)\n  {\n      vec3 p=ro+rd*t;\n      float flash =1.0- abs(sin(p.z*0.1+iTime*4.0));\n      flash += .15;\n      flash = clamp(flash,0.0, 1.0);\n      float H = mod(iTime*0.1, 1.0);\n      col=vec3(.9,.8,.7)*5./pi+hsv2rgb2(vec3(H,1.0,1.0),2.2)*acc2*0.2*flash;\n  }\n\n  fragColor=vec4(col,1);\n}\n","name":"Image","description":"","type":"image"}]}