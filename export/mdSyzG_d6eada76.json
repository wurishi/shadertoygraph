{"ver":"0.1","info":{"id":"mdSyzG","date":"1687821926","viewed":37,"name":"Fork Torus - in goooo 870","username":"goooo","description":"Analytic intersection of a torus. From Antonalog's shader (XdSGWy), simplified the geometrically impossible cases, and optimized coefficients. One can probably do better than this (in terms of big picture and math I mean, not saving individual muls/adds)","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["3d","raytracing","torus","intersection","analyticall"],"hasliked":0,"parentid":"4sBGDy","parentname":"Torus - intersection"},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float iT(vec3 r,vec3 d,vec2 t){float p=1.,a=t.x*t.x,b=t.y*t.y,m=dot(r,r),n=dot(r,d);{if(n*n-m+(t.x+t.y)*(t.x+t.y)<0.)return -1.;}float k=(m-b-a)/2.,k3=n,k2=n*n+a*d.z*d.z+k,k1=k*n+a*r.z*d.z,k0=k*k+a*r.z*r.z-a*b;if(abs(k3*(k3*k3-k2)+k1)<0.01){p=-1.;float tmp=k1;k1=k3;k3=tmp;k0=1./k0;k1*=k0;k2*=k0;k3*=k0;}float c2=2.*k2-3.*k3*k3,c1=k3*(k3*k3-k2)+k1,c0=k3*(k3*(-3.*k3*k3+4.*k2)-8.*k1)+4.*k0;c2/=3.;c1*=2.;c0/=3.;float Q=c2*c2+c0,R=3.*c0*c2-c2*c2*c2-c1*c1,h=R*R-Q*Q*Q,z=0.;if(h<0.){float sQ=sqrt(Q);z=2.*sQ*cos(acos(R/(sQ*Q))/3.);}else{float sQ=pow(sqrt(h)+abs(R),1./3.);z=abs(sQ+Q/sQ)*sign(R);}z=c2-z;float d1=z-3.*c2,d2=z*z-3.*c0;if(abs(d1)<1.e-4){if(d2<0.)return -1.;d2=sqrt(d2);}else{if(d1<0.)return -1.;d1=sqrt(d1/2.);d2=c1/d1;}float res=1e20;h=d1*d1-z+d2;if(h>0.){h=sqrt(h);float t1=-d1-h-k3;t1=(p<0.)?2./t1:t1;float t2=-d1+h-k3;t2=(p<0.)?2./t2:t2;if(t1>0.)res=t1;if(t2>0.)res=min(res,t2);}h=d1*d1-z-d2;if(h>0.){h=sqrt(h);float t1=d1-h-k3;t1=(p<0.)?2./t1:t1;float t2=d1+h-k3;t2=(p<0.)?2./t2:t2;if(t1>0.)res=min(res,t1);if(t2>0.)res=min(res,t2);}return res;}vec3 nT(vec3 p,vec2 t){return normalize(p*(dot(p,p)-t.y*t.y-t.x*t.x*vec3(1.,1.,-1.)));}void mainImage(out vec4 c,in vec2 d){float an=.5*iTime;vec3 f=vec3(2.5*cos(an),1.,2.5*sin(an)),g=vec3(0.,.1,0.),h=normalize(g-f),i=normalize(cross(h,vec3(0.,1.,0.))),j=normalize(cross(i,h)),k=vec3(0.);vec2 o=(-iResolution.xy+2.*d)/iResolution.y;vec3 l=normalize(o.x*i+o.y*j+1.5*h);vec2 t=vec2(1.,.5);float m=iT(f,l,t);vec3 n=vec3(.08)*(1.-.3*length(o))+.02*l.y;if(m>0.){vec3 p=f+m*l,q=nT(p,t),r=normalize(vec3(.7,.6,.3)),s=normalize(-l+r);float dif=clamp(dot(q,r),0.,1.),amb=clamp(.5+.5*q.y,0.,1.),wi=smoothstep(-1.,-.98,cos(o.x*3.14159*4.))*smoothstep(-1.,-.98,cos(o.y*3.14159*4.));n=vec3(.15,.25,.35)*amb+1.05*vec3(1.,.9,.7)*dif;n+=wi*.3*pow(clamp(dot(s,q),0.,1.),32.)*dif;}k+=sqrt(n);k+=fract(sin(d.x*vec3(13,1,11)+d.y*vec3(1,7,5))*158.391832)/255.;c=vec4(k,1.);}","name":"Image","description":"","type":"image"}]}