{"ver":"0.1","info":{"id":"ttcGzr","date":"1575456172","viewed":1208,"name":"Lens blur (sample pattern)","username":"Txoka","description":"lens blur","likes":12,"published":3,"flags":32,"usePreview":1,"tags":["lensblur","goldenangle"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float pi=4.*atan(1.);\nconst float ang=(3.-sqrt(5.))*pi;\nfloat gamma=1.8;\n\nconst float SAMPLES=150.;\nvec3 bokeh(sampler2D samp,vec2 uv,vec2 radius,float lod){\n\tvec3 col = vec3(0);\n    for(float i=0.;i<SAMPLES;i++){\n        float d=i/SAMPLES;\n    \tvec2 p=vec2(sin(ang*i),cos(ang*i))*sqrt(d)*radius;\n        col+=pow(texture(samp,uv+p,lod).rgb,vec3(gamma));\n    }\n    return pow(col/SAMPLES,vec3(1./gamma));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n\tvec2 uv = fragCoord/iResolution.xy;\n\t\n\tvec2 pix=1./iResolution.xy;\n\t\n\tfloat r=sin(iTime);\n\tr*=r*20.;\n    if(iMouse.z>0.)r=iMouse.x/iResolution.y*100.;\n\tfloat lod=log2(r/SAMPLES*pi*5.);\n\t//lod=0.;\n\tvec3 col = bokeh(iChannel0,uv,r*pix,lod);\n\t\n\tfragColor = vec4(col,1.0);\n\t\n\tif(SAMPLES==0.)fragColor=texture(iChannel0,uv);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"XdfGRn","filepath":"/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","previewfilepath":"/media/ap/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"#define BRIGHT_SPOTS\nfloat BRIGHT_SPOT_TRESHOLD=0.5;\n\nvec3 BriSp(vec3 p){\n    if(p.x+p.y+p.z>BRIGHT_SPOT_TRESHOLD*3.)p=(1./(1.-p)-1.)*(1.-BRIGHT_SPOT_TRESHOLD);\n    p=clamp(p,0.,100.);\n    return p;\n}\n \n\nvec3 color(vec2 n){\n    vec3 p=texture(iChannel0,n).rgb;\n    #ifdef BRIGHT_SPOTS\n    \n    p=BriSp(p);\n    #endif\n    return p;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n    fragColor = vec4(color(fragCoord/iResolution.xy),0.);\n}","name":"Buffer A","description":"","type":"buffer"}]}