{"ver":"0.1","info":{"id":"3dGyWt","date":"1603960330","viewed":83,"name":"Sine Ring","username":"gaz","description":"raycast","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["raycast"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI acos(-1.)\n#define TAU PI*2.\n\nvec3 lookat(vec3 p, vec3 eye, vec3 target, vec3 up)\n{\n\tvec3 w=normalize(target-eye), u=normalize(cross(w,up));\n\treturn vec3(dot(p,u), dot(p,cross(u,w)), dot(p,w));\n}\n\nvec2 rotate(vec2 p, float a)\n{\n    return p*cos(a)+vec2(-p.y, p.x)*sin(a);\n}\n\nvec3 func(vec3 p, vec3 nor, float r, float t)\n{\n    t*=TAU;\n    vec2 uv=vec2(cos(t),sin(t))*r*(1.+sin(t*6.)*.15);\n    vec3 u=normalize(cross(nor,vec3(0,1,0)));\n    vec3 v=normalize(cross(nor,u));\n    return uv.x*u+uv.y*v+p;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor=vec4(0);\n    vec2 uv=(fragCoord*2.-iResolution.xy)/iResolution.y;\n    vec3 ro=vec3(0,0,10);\n    ro.xz=rotate(ro.xz, iTime);\n    vec3 ta=vec3(.1,.2,.1);\n    vec3 rd=lookat(normalize(vec3(uv,2)),ro,ta,vec3(0,1,0));\n\n    float R=.5;\n    \n    vec3 nor;\n \tfloat ITR=150.,pitch=1.,t=.5,de=R+1.,z=1e10;   \n    for(int j=0;j<2;j++)\n    {\n        float t0=t-pitch*.5;\n        pitch/=ITR;\n        for(float i=0.;i<ITR;i++)\n        {\n            t0+=pitch;\n            vec3 p=func(vec3(.2,.1,.1),normalize(vec3(3,2,-2)),3.,t0);\n            float de0=length(cross(p-ro,rd));\n            if(de0<=R){\n                de=de0;\n                float z0=dot(p-ro,rd)-sqrt(R*R-de*de);\n                if(z>z0){\n                    z=z0;\n                    nor=normalize(ro+rd*z-p);\n                    t=t0;\n                }\n                \n            }\n        }\n    }\n    if(de<=R)\n    {\n\t\tfragColor+=max(dot(nor,normalize(vec3(1))),.2);\n    }\n}","name":"Image","description":"","type":"image"}]}