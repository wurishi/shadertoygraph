{"ver":"0.1","info":{"id":"wlVGzV","date":"1579428021","viewed":97,"name":"Level curves metaballs","username":"arkan","description":"distance field, metaball, level curves (left click to move ball)","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["distancefield","metaball"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float level_curves_greyscale(float f, float scale)\n{\n    float opacity = cos(f * 3.141592 * scale);\n    opacity *= opacity;\n    opacity  = 1.f - opacity;\n    opacity *= opacity;\n    opacity *= opacity;\n    opacity  = 1.f - opacity;\n    return opacity;\n}\n\n//------------------------------------------------------------------------\n\nvec4 level_curves_color(float f, float iso_level, float scale)\n{\n\tfloat opacity = level_curves_greyscale(f, scale);\n\tvec4 color;\n\n\t     if(f <  iso_level) color = vec4(0.9f, 0.2f, 0.1f, 1.0f); // Inside red\n    else if(f >= iso_level) color = vec4(0.1f, 0.2f, 0.9f, 1.0f); // Outside blue\n\n\tif(true)\n    {        \n    \t     if(f >= 1.0f    ) color = vec4(1.0f, 0.75f, 0.5f, 1.0f);\n        else if(f <  0.0f    ) color = vec4(0.9f, 0.90f, 0.2f, 1.0f);\n\t\telse if( isnan(f)    ) color = vec4(1.0f, 1.0f, 0.0f, 1.0f); // yellow\n\n        // Color strip that belong to iso-surface\n        if( abs(f-iso_level) < (1.f/scale) * 0.5f )\n            color = vec4(0.2f, 0.9f, 0.1f, 1.0f); // greenish\n            //color = Vec3(0.5f); // grey\n\t}\n\n    float eps = 1e-4f;\n    if( f < (1.f + eps) && f > (1.f - eps)) \n        return vec4(0.0,0.0,0.0,1.0); // black\n    if( f < (eps*10.0) && f > 0.0 ) \n        return vec4(0.0,0.0,0.0,1.0); // black\n\n    color = vec4(1.0, 1.0, 1.0, 1.0) * opacity + color * (1.f - opacity);\n    color.a = 1.f - opacity;\n    return color;\n}\n\n//------------------------------------------------------------------------\n\nfloat sphere(vec3 p){    \n    vec3 c = vec3(iResolution.x/2.0, iResolution.y/2.0, 0);\n    c -= vec3(-50,0,0);\n    return length( c - p ) - 100.0;    \n}\n\nfloat dist_metaball(float d){\n    float radius = 100.0;\n    if(d > radius) \n        return 0.0;    \n    d = d / radius;    \n    d = 1.0 - d*d;\n    return d*d;\t\n}\n\nvec3 get_goal(){\n\tfloat dx = iMouse.x ;    \n    float dy = iMouse.y;\n    return vec3(dx, dy, 0);\n}\n\n\nfloat metaball(vec3 p){\n    vec3 c = vec3(iResolution.x/2.0, iResolution.y/2.0, 0);\n    c -= vec3(50,0,0);\n    \n    c = get_goal();\n    \n    return dist_metaball( length( c - p ) );\n}\n\nfloat metaball2(vec3 p){\n    vec3 c = vec3(iResolution.x/2.0, iResolution.y/2.0, 0);\n    c -= vec3(-50,0,0);\n    return dist_metaball( length( c - p ) );\n}\n\n//------------------------------------------------------------------------\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord; // /iResolution.xy\n\n    vec3 pos = vec3(uv.xy, 0.0);\n    float field_value = max(metaball(pos), metaball2(pos));\n    // Output to screen\n    fragColor = level_curves_color(field_value, 0.5/*iso*/, 15.0/*scale*/ );\n} ","name":"Image","description":"","type":"image"}]}