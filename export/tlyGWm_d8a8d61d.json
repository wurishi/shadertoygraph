{"ver":"0.1","info":{"id":"tlyGWm","date":"1579332750","viewed":349,"name":"Connected","username":"rory618","description":"Fork of https://www.shadertoy.com/view/ttyGWw, with simpler behavior but drawing a sort of generalized multi voronoi diagram that is related to various boundaries that arise when selecting the closest 2,3 etc points. Mouse to interact","likes":33,"published":1,"flags":32,"usePreview":0,"tags":["2d","voronoi","particles"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    O = texture(iChannel2, I/R.xy);\n\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"vec4 A(int i){\n    return texture(iChannel0, (vec2((i-1)%int(R.x),(i-1)/int(R.x))+.5)/R.xy);\n}\n\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    O = texture(iChannel0, I/R.xy);\n    \n    O.xy = mod(O.xy,R.xy);\n    vec4 r = rand4(int(I.x) + int(I.y)*2048 + iFrame*2048*2048);\n    if(iFrame<3){\n        O.xy = r.xy*R.xy;\n        O.zw = .25*cos(6.283*(vec2(0,.25)+r.z));\n        \n    }\n    \n    vec4 a = texture(iChannel1, (O.xy)/R.xy);\n    \n    vec2 ns = vec2(0);\n    vec2 df = vec2(0);\n    for(int i = 0; i < 4; i++){\n        vec4 n = A(cvt(a[i]));\n        ns += n.zw/4.;\n        vec2 D = O.xy-n.xy;\n        if(length(D)>.005&&length(D)<10.){\n        \tdf += normalize(D)*(1./(length(D)+.03));\n        }\n    }\n    O.zw+=df/25.;\n    O.zw = mix(O.zw,ns,.1);\n    O.zw += randn(r.xy)/1e2;\n    if(iMouse.z>0.){\n        vec2 D = O.xy-iMouse.xy;\n        O.zw -= normalize(D)*(30./(length(D)+.03));\n    }\n    O.xy += O.zw/4.;\n    \n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"vec4 A(int i){\n    return texture(iChannel0, (vec2((i-1)%int(R.x),(i-1)/int(R.x))+.5)/R.xy);\n}\n\n\n\nvoid list_insert(inout ivec4 i, inout vec4 s, int i_, float s_){\n\tivec4 ri;\n    vec4 rs;\n    if(i_ == 0) return;\n    if(any(equal(ivec4(i_),i))) return;\n    if(s_<s[0]) {\n        i = ivec4(i_,i.xyz);\n        s = vec4(s_,s.xyz);\n    } else if(s_<s[1]) {\n        i = ivec4(i.x,i_,i.yz);\n        s = vec4(s.x,s_,s.yz);\n    } else if(s_<s[2]) {\n        i = ivec4(i.xy,i_,i.z);\n        s = vec4(s.xy,s_,s.z);\n    } else if(s_<s[3]) {\n        i = ivec4(i.xyz,i_);\n        s = vec4(s.xyz,s_);\n    }\n}\n\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    \n    int j = 1;//+(iFrame%5);j  *= j ;       //using a variable offset each frame prevents most fast moving particles from getting lost\n    \t\t\t\t\t\t\t\t\t\t//letting them get lost looks nicer here\n    \n    #define score(e) dot2(  mod(A(e).xy-I +R.xy/2.,R.xy)-R.xy/2. )\n    O = texture(iChannel1, I/R.xy);\n    vec4 a = texture(iChannel1, fract((I+vec2(j,0))/R.xy));\n    vec4 b = texture(iChannel1, fract((I+vec2(0,j))/R.xy));\n    vec4 c = texture(iChannel1, fract((I-vec2(j,0))/R.xy));\n    vec4 d = texture(iChannel1, fract((I-vec2(0,j))/R.xy));\n    ivec4 i = ivec4(0);\n    ivec4 i0 = ivec4(cvt(O.x),cvt(O.y),cvt(O.z),cvt(O.w));\n    ivec4 ia = ivec4(cvt(a.x),cvt(a.y),cvt(a.z),cvt(a.w));\n    ivec4 ib = ivec4(cvt(b.x),cvt(b.y),cvt(b.z),cvt(b.w));\n    ivec4 ic = ivec4(cvt(c.x),cvt(c.y),cvt(c.z),cvt(c.w));\n    ivec4 id = ivec4(cvt(d.x),cvt(d.y),cvt(d.z),cvt(d.w));\n    vec4 s = vec4(1e9);\n    vec4 s0 = vec4(score(i.x),score(i.y),score(i.z),score(i.w));\n    for(int k = 0; k < 4; k++){\n        list_insert(i, s, i0[k], score(i0[k]));\n        list_insert(i, s, ia[k], score(ia[k]));\n        list_insert(i, s, ib[k], score(ib[k]));\n        list_insert(i, s, ic[k], score(ic[k]));\n        list_insert(i, s, id[k], score(id[k]));\n    }\n    int r = IHash(int(I.x) + int(I.y)*2048 + iFrame*2048*2048);\n    int i_ = 1+r%(int(R.x)*int(R.y)/100);\t\t\t\t//Modify max number of particles here\n    list_insert(i, s, i_, score(i_));\n    O = vec4(cvt(i.x),cvt(i.y),cvt(i.z),cvt(i.w));\n    \n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define R iResolution\n\nint IHash(int a){\n\ta = (a ^ 61) ^ (a >> 16);\n\ta = a + (a << 3);\n\ta = a ^ (a >> 4);\n\ta = a * 0x27d4eb2d;\n\ta = a ^ (a >> 15);\n\treturn a;\n}\n\nfloat Hash(int a){\n\treturn float(IHash(a)) / float(0x7FFFFFFF);\n}\nvec4 rand4(int seed){\n    return vec4(Hash(seed^0x34F85A93),\n                Hash(seed^0x85FB93D5),\n                Hash(seed^0x6253DF84),\n                Hash(seed^0x25FC3625));\n}\nvec3 rand3(int seed){\n    return vec3(Hash(seed^0x348CD593),\n                Hash(seed^0x8593FD5),\n                Hash(seed^0x62A5D384));\n}\nvec2 rand2(int seed){\n    return vec2(Hash(seed^0x348C5F93),\n                Hash(seed^0x8593D5BB));\n}\n\n\nvec2 randn(vec2 randuniform){\n    vec2 r = randuniform;\n    r.x = sqrt(-2.*log(1e-9+abs(r.x)));\n    r.y *= 6.28318;\n    r = r.x*vec2(cos(r.y),sin(r.y));\n    return r;\n}\n\nfloat dot2(vec2 x){\n    return dot(x,x);\n}\n\nint cvt(float x){\n    return int(x);\n    //return floatBitsToInt(x) ^ 0x8593D5BB ;\n}\n\nfloat cvt(int x){\n    return float(x);\n    //return intBitsToFloat(x ^ 0x8593D5BB);\n}","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4sXGR8","channel":0}],"code":"bool keyIsDown( float key ) {\n    return texture( iChannel3, vec2(key,0.75) ).x > .5;\n}\n\nvec4 A(int i){\n    return texture(iChannel0, (vec2((i-1)%int(R.x),(i-1)/int(R.x))+.5)/R.xy);\n}\n\nvoid vline(inout float d, vec2 a, vec2 b, vec2 I){\n    vec2 Ip = I-a;\n    vec2 bp = b-a;\n    bp = mod(bp + R.xy/2.,R.xy)-R.xy/2.;\n    Ip = mod(Ip + R.xy/2.,R.xy)-R.xy/2.;\n    \n    vec2 mp = bp/2.;\n    vec2 norm = normalize(bp);\n    float dist = abs(dot(norm,Ip-mp));\n    d = max(d,1.-dist);\n}\n\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    O = vec4(0);\n    vec4 t = texture(iChannel1, I/R.xy);\n    vec4 a = A(cvt(t.x));\n    vec4 b = A(cvt(t.y));\n    vec4 c = A(cvt(t.z));\n    vec4 d = A(cvt(t.w));\n    float z = 0.;\n    vline(O.z,a.xy,b.xy,I);\n    vline(O.x,b.xy,c.xy,I);\n    vline(O.y,c.xy,d.xy,I);\n    O = mix(O,texture(iChannel2, I/R.xy),.8);\n\n}","name":"Buffer C","description":"","type":"buffer"}]}