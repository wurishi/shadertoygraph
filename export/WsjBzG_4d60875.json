{"ver":"0.1","info":{"id":"WsjBzG","date":"1590283750","viewed":115,"name":"Outline 2020 shader showdown 2","username":"lovelyH","description":"Coded live in 25min during shader showdown final at Outline 2020 demoparty in round me agains Evvvvil.\n","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["showdown"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//#version 410 core\n#define E 0.0001\n#define INF 10000.0\n//#define iTime fGlobalTime\n\nvec2 rot( vec2 p, float l ){\n  return vec2(\n    p.x*cos(l) - p.y*sin(l),\n    p.x*sin(l) + p.y*cos(l)\n  );\n}\n\n//uniform float fGlobalTime; // in seconds\n//uniform vec2 v2Resolution; // viewport resolution (in pixels)\n//uniform sampler1D texFFT; // towards 0.0 is bass / lower freq, towards 1.0 is higher / treble freq\n//uniform sampler1D texFFTSmoothed; // this one has longer falloff and less harsh transients\n//uniform sampler1D texFFTIntegrated; // this is continually increasing\n//uniform sampler2D texChecker;\n//uniform sampler2D texNoise;\n//uniform sampler2D texTex1;\n//uniform sampler2D texTex2;\n//uniform sampler2D texTex3;\n//uniform sampler2D texTex4;\n//layout(location = 0) out vec4 out_color; // out_color must be written in order to see anything\n\nint mmid;\nvec3 mlight;\n\nfloat map(vec3 p){\n  mmid= 0;\n  mlight= vec3(INF);\n  float rc,r;\n  vec3 ph;\n  r= 5.0 - abs(p.z);\n  r= min( r, 60.0 - length(p.xy) );\n  r= min( r, 50.0 - max( abs(p.x), abs(p.y) ) );\n  r= min( r, max( 4.8 - abs(p.z), 2.1 - length(p.xy) ) );\n  \n  //p\n  for( int a=0;a<2;a++){\n    ph= p;\n    ph.xy= rot( ph.xy, 0.1*p.z+4.0*iTime );\n    if( a==1)ph.x *= -1.0;\n    ph.x -= 1.0;\n    //ph.z= mod( ph.z, 1.0 ) - 0.5;\n    ph.z= mod( ph.z, 2.0 ) - 1.0;\n    rc= length(ph)-0.4;\n    rc= min( rc, length(ph.xy)-0.1 );\n    if( rc < r ){r= rc; mmid= 1+a;}\n    mlight= min( mlight, a==0 ? vec3(rc,INF,INF) : vec3(INF,rc,INF) );\n  }\n  \n  //b\n  ph= p;\n  float l= atan( ph.x, ph.y );\n  float rad= length(ph.xy);\n  //ph.z -= sin(iTime+4.0*l) * texture( texFFT, 0.1).x * 300.0;\n  ph.z -= sin(iTime+4.0*l);\n  l= mod( l, 0.1*3.14 ) - 0.05 * 3.1415;\n  ph.x= rad*sin(l);\n  ph.y= rad*cos(l);\n  ph.y -= 10.0;\n  rc= length(ph);\n  r= min( r, rc );\n  mlight= min( mlight, vec3(INF,INF,rc) );\n  \n  \n  return r;\n}\n\n\n\nvec3 render( vec3 sp, vec3 dir ){\n  float rp=1.0, nrp=0.0;\n  vec3 r= vec3(0);\n  for( int ra=0;ra<4;ra++){\n    vec3 p= sp;\n    float t=0.0;\n    float dis= map(p);\n    vec3 light= vec3(INF);\n    for( int a=0;a<0x200;a++){\n      t += dis;\n      p= sp + t*dir;\n      dis= map(p);\n      light= min( light, mlight );\n      if( dis < E )break;\n    }\n    vec3 plight= mlight;\n    vec3 nor;\n    int matId= mmid;\n    nrp= 0.0;\n    \n    if( dis < E ){\n      nor= normalize(vec3(\n        map(vec3(p.x+E,p.y,p.z))-map(vec3(p.x-E,p.y,p.z)),\n        map(vec3(p.x,p.y+E,p.z))-map(vec3(p.x,p.y-E,p.z)),\n        map(vec3(p.x,p.y,p.z+E))-map(vec3(p.x,p.y,p.z-E))\n      ));\n      \n      vec3 color= vec3(1);\n      switch(matId){\n        case 0: nrp= 0.5; break;\n        case 1: color=vec3(1,0,0); break;\n        case 2: color=vec3(0,1,0); break;\n        case 3: color=vec3(1,1,0); break;\n      }\n      \n      r += rp * color\n        * (0.6+0.4*dot(nor,-dir))\n        * (0.6+0.4*dot(nor,vec3(0,0,1)))\n        * (1.0 / (1.0 + 0.1*t) )\n      ;\n      r += rp * (1.0 / (1.0 + 10.0*plight));\n    }\n    r += rp * (1.0 / (1.0 + 10.0*light));\n    \n    rp *= nrp;\n    if( rp < 0.01)break;\n    dir= reflect( dir, nor );\n    sp = p + 20.0*E*dir;\n  }\n  return r;\n}\n\n\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n  vec2 uv = vec2(fragCoord.x / iResolution.x, fragCoord.y / iResolution.y);\n  uv -= 0.5;\n  uv /= vec2(iResolution.y / iResolution.x, 1);\n  \n  vec3 dir= normalize(vec3(uv.x,4,uv.y));\n  vec3 cam= vec3(0,-45,0);\n  float ra= iTime;\n  dir.xy= rot( dir.xy, ra );\n  cam.xy= rot( cam.xy, ra );\n\n  fragColor.xyz= render( cam, dir );\n}","name":"Image","description":"","type":"image"}]}