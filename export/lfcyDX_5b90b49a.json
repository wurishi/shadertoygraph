{"ver":"0.1","info":{"id":"lfcyDX","date":"1731254935","viewed":48,"name":"a quartic truchet test","username":"chenxianming","description":"a quartic truchet test","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["truchet","quartic"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define h( a ) fract( sin( dot( a, vec2( 12.345, 54.321 ) ) ) * 9876.5432 )\n#define I iResolution\n#define S smoothstep\n#define A min( I.x, I.y )\n#define rot( a ) mat2( cos(a), sin(a), -sin(a), cos(a) )\n#define sl( a ) S( .1, .9, sin( a * .5 ) / .5 )\n\nfloat type( vec2 u, int a ){\n\n    switch( a ){\n        case 0 :\n            u += u.x + u.y > 0. ? -.2 : .2;\n        break ;\n        \n        case 1 :\n            u.y -= .2, u.x = abs( u.x ) - .2;\n        break ;\n        \n        case 2 :\n            u -= .2;\n    }\n    \n    return length( u ) - .2;\n}\n\n/*\nfloat signRound( vec2 u, float s ){\n    \n    vec2 t =  round( u / s / 4. );\n    \n    u -= s * 4. * t;\n    \n    return mod( t.x * t.y, 2. ) > 0. ? 1. : length(u) - s;\n}\n*/\n\nfloat signRound( vec2 u, float s, int a ){\n\n    vec2 t = round( u / .2 );\n    \n    u -= .2 * clamp( round( u / .2 ), -1., 1. );\n    \n    if( t == vec2(0) )\n        return 0.;\n    \n        \n    return S( 1. / A, -1. / A, length(u) - s * ( 1.5 - .21 * (max(I.x, I.y) / min( I.x, I.y )) ) );\n}\n\nfloat signRound2( vec2 u, float s ){\n\n    vec2 t = round( u / .2 );\n    \n    float p;\n    \n    u -= .2 * clamp( round( u / .2 ), -1., 1. );\n    \n    \n    if( t != vec2(0) )\n    p += S( 5. / A, 0., length(u) - s );\n    \n    return p;\n\n}\nfloat ft2( vec2 u, float s, int a ){\n    float c = type( u, a );\n    return S( 2. / A, 0., abs( c ) - s ) * step( max( abs(u.x), abs( u.y ) ) - .2, 0. );\n}\n\n\nfloat fractalEl( vec2 u, vec2 j, vec2 t ){\n    \n    u += j;\n    \n    vec2 tt = round( u / .4 );\n    u -= .4 * clamp( tt, -2., 2. );\n    \n    if( h(tt) * h(t) > .3 )\n        u.x *= sl( iTime * 2. ) > 0. ? 1. : -1.;\n        \n    if( h(tt) * h(t) < .6 )\n        u.y *= sl( iTime + 6. ) > 0. ? -1. : 1.;\n    \n    return ft2( u, .06, 0 );\n}\n\nfloat fractalEl2( vec2 u, vec2 j ){\n\n    \n    float p;\n    \n    for( float i; i < 3.; i++ )\n        mod( i, 2. ) > 0. ? j.x += .4 : j.y += .4,\n        p += ft2( u + j, .06, int( i * round( h(j - 5.) ) ) ),\n        p += signRound2( u + j, .06 );\n    \n\n    return p;\n}\n\n\nfloat ft( vec2 u, float s, int a, vec2 t ){\n    if( a <= 2 ){\n        float c = type( u, a );\n        return S( 5. / A, 0., abs( c ) - s ) * step( max( abs(u.x), abs( u.y ) ) - .2, 0. );\n    }\n    else if( a == 3 ){\n        return ( 1. - fractalEl( u * 2., vec2(-.2, .2), t ) );\n    }else if( a == 4 ){\n        \n        int r;\n        \n        if( h(t+A) > .5 ){\n            u.x *= sl( iTime + 50. ) > 0. ? 1. : -1.;\n            r = 1;\n        }\n            \n            \n        if( h( abs( t - A ) ) > .5 ){\n            u.y *= sl( iTime - 5. ) > 0. ? -1. : 1.;\n            r = 2;\n        }\n        \n        return \n            ( 1. - fractalEl2( u * 2., vec2(-.2, -.6) ) ) * step( 0., max( abs(u.x - .2), abs(u.y+.2) ) - .2)\n            + fractalEl2( u * 4., vec2(-.6, -.2) ) * step( 0., max(abs(u.x), abs(u.y)) - .025 )\n            + ft2( u * 4. + vec2( -.6, .6 ), .06, r ) \n            - step( min( length(u + vec2( -.2, .1 ) ) - .025, length(u + vec2( -.1, 0.2 ) ) - .025 ), .0)\n            \n            ;\n    }else{\n        return ( fractalEl( u * 4., vec2(-.2, .2), t ) );\n    }\n}\n\n\nvoid mainImage( out vec4 U, in vec2 V )\n{\n    vec2 u = ( V * 2. - I.xy ) / A - iTime * .2;\n\n    vec3 c;\n    float p, r;\n    \n    \n    vec2 t = round( u / .4 );\n    u -= .4 * t;\n    \n    r = h( t );\n    \n    int ir = int( r * 6. );\n    \n    if( r < .5 )\n        u.x *= sl( iTime ) > 0. ? 1. : -1.;\n    \n    if( r < .2 )\n        u.y *= sl( iTime + 20. ) > 0. ? -1. : 1.;\n    \n    c = mix(\n        c,\n        vec3(1.),\n        clamp( ft( u, .06, ir, t ) * 5., 0., 1. )\n    );\n    \n    c = mix(\n        c,\n        vec3(1.),\n        clamp( signRound( u, .06, ir ) * 5., 0., 1. )\n    );\n\n    c += p;\n;\n\n    U = vec4(c,1.0);\n}","name":"Image","description":"","type":"image"}]}