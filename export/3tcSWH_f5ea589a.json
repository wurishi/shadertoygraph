{"ver":"0.1","info":{"id":"3tcSWH","date":"1580825173","viewed":916,"name":"Art : Boids","username":"Gijs","description":"testing 50000 interacting particles. takes a while to load completely.","likes":59,"published":1,"flags":48,"usePreview":0,"tags":["voronoi","simulation","particles","art","boids"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"ivec4 getClosest(ivec2 xy){\n    return ivec4(texelFetch(iChannel1, xy, 0));\n}\n\nivec2 locFromID(int id){\n    int width = int(iResolution.x);\n    return ivec2( id % width, id / width);\n}\n\nvec4 getParticle(int id){\n    return texelFetch(iChannel0, locFromID(id), 0);\n}\n\nvoid mainImage( out vec4 fragColor, vec2 fragCoord ){\n    \n    fragColor = vec4(0);\n\n    ivec4 ids = getClosest(ivec2(fragCoord));\n\n    for(int i = 0; i < 4; i++){\n        int id = ids[i];\n        vec2 pos = getParticle(id).xy;\n        float d = distance(fragCoord,pos);\n        fragColor += .25/(d);\n    }\n\n    vec2  p1 = getParticle(ids.x).xy;\n    vec2  p2 = getParticle(ids.y).xy;\n    float r = dot(fragCoord-(p1+p2)/2.,normalize(p2-p1));\n    fragColor.g += smoothstep(2.,0.,abs(r))*.1;\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"//amount of particles\nconst int PARTICLES = 50000; \n\n//\nconst float SEPERATION = .1;\n\n//\nconst float ALIGNMENT = .1;\n\n//\nconst float COHESION = 0.001;\n\n//percentage of maximum allowed speed\nconst float SPEED = .5;\n\n//hashing noise by IQ\nfloat hash( int k ) {\n    uint n = uint(k);\n\tn = (n << 13U) ^ n;\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\n    return uintBitsToFloat( (n>>9U) | 0x3f800000U ) - 1.0;\n}\n\n\n#define key(k,mode) ( texelFetch( iChannel3, ivec2(k,mode), 0 ).x > .5 )\n#define keyDown(k) key(k,0)\n#define keyHit(k)  key(k,1)\n#define keyFlip(k) key(k,2)","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"ivec4 getClosest(ivec2 xy){\n    return ivec4(texelFetch(iChannel1, xy, 0));\n}\n\nivec2 locFromID(int id){\n    int width = int(iResolution.x);\n    return ivec2( id % width, id / width);\n}\n\nvec4 getParticle(int id){\n    return texelFetch(iChannel0, locFromID(id), 0);\n}\n\nvoid mainImage( out vec4 fragColor, vec2 fragCoord ){\n    ivec2 iFragCoord = ivec2(fragCoord);\n    \n    int id = iFragCoord.x + iFragCoord.y*int(iResolution.x);\n    if(id>=PARTICLES) return;\n    \n    vec4 prev = texelFetch( iChannel0, ivec2(fragCoord), 0 );\n    vec2 pos = prev.xy;\n    vec2 vel = prev.zw;\n     \n    if(iFrame==0 || keyDown(32)){\n        float h1 = hash(id);\n        float h2 = hash(int(h1*41343.));\n        pos = vec2(h1,h2)*iResolution.xy;\n    }\n\n    vec2 force = vec2(0);\n    \n        if(iMouse.z > 0.){\n            vec2 delta = pos-iMouse.xy;\n            float dis = length(delta);\n            force += delta/(dis*dis*dis) * 100.;\n        }\n\n        ivec4 closest = getClosest(ivec2(pos));\n        for(int i = 0; i < 4; i++){\n            int cid = closest[i];\n            if(cid==id) continue;\n            \n            vec4 part = getParticle(cid);\n            vec2 delta = part.xy-pos;\n            float dis = length(delta);\n            force += -delta /(dis*dis*dis) * SEPERATION;\n            \n            force += delta * COHESION;\n            \n            force += (part.zw-vel)/(dis+1.) * ALIGNMENT;\n        }\n    \n    \tvec2 dis = max(iResolution.xy-pos, vec2(1));\n    \tforce -= 1./(dis*dis)*20.;\n    \t     dis = max(pos, vec2(1));\n    \tforce += 1./(dis*dis)*20.;\n\n    vel += force;\n\n    vel = normalize(vel)* SPEED; \n    \n    pos += vel;\n    \n    fragColor = vec4(pos,vel);\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"ivec4 getClosest(ivec2 xy){\n    return ivec4(texelFetch(iChannel1, xy, 0));\n}\n\nivec2 locFromID(int id){\n    int width = int(iResolution.x);\n    return ivec2( id % width, id / width);\n}\n\nvec4 getParticle(int id){\n    return texelFetch(iChannel0, locFromID(id), 0);\n}\n\nfloat distance2Particle(int id, vec2 fragCoord){\n    if(id==-1) return 1e20;\n    vec2 delta = getParticle(id).xy-fragCoord;\n    return dot(delta, delta);\n}\n\nvoid insertion_sort(inout ivec4 i, inout vec4 d, int i_, float d_){\t\n    if(any(equal(ivec4(i_),i))) return;\n    if     (d_ < d[0])             \n        i = ivec4(i_,i.xyz),    d = vec4(d_,d.xyz);\n    else if(d_ < d[1])             \n        i = ivec4(i.x,i_,i.yz), d = vec4(d.x,d_,d.yz);\n    else if(d_ < d[2])            \n        i = ivec4(i.xy,i_,i.z), d = vec4(d.xy,d_,d.z);\n    else if(d_ < d[3])           \n        i = ivec4(i.xyz,i_),    d = vec4(d.xyz,d_);\n}\n\nvoid mainImage( out vec4 fragColor, vec2 fragCoord ){\n   \tivec2 iFragCoord = ivec2(fragCoord);\n\n    ivec4 new = ivec4(-1);\n    vec4 dis = vec4(1e20);\n\n    ivec4 old   = getClosest( iFragCoord + ivec2( 0, 0) );            \n    ivec4 east  = getClosest( iFragCoord + ivec2( 1, 0) );\n\tivec4 north = getClosest( iFragCoord + ivec2( 0, 1) );\n    ivec4 west  = getClosest( iFragCoord + ivec2(-1, 0) );\n    ivec4 south = getClosest( iFragCoord + ivec2( 0,-1) );\n    ivec4[5] candidates = ivec4[5](old, east, north, west, south); \n    \n    for(int i=0; i<5; i++){\n        for(int j=0; j<4; j++){\n            int id = candidates[i][j];\n            float dis2 = distance2Particle(id, fragCoord);\n            insertion_sort( new, dis, id, dis2 );\n        }\n    }\n    \n    for(int k = 0; k < 1; k++){\n        float h = hash(\n            iFragCoord.x + \n            iFragCoord.y*int(iResolution.x) + \n            iFrame*int(iResolution.x*iResolution.y) +\n            k\n        );\n        int p = int(h*float(PARTICLES));\n        insertion_sort(new, dis, p, distance2Particle(p, fragCoord) );\n    }\n    \n    fragColor = vec4(new); \n    \n}","name":"Buffer B","description":"","type":"buffer"}]}