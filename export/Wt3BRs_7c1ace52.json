{"ver":"0.1","info":{"id":"Wt3BRs","date":"1613749378","viewed":86,"name":"SimpleCanvas1.1","username":"dimitr","description":"Now tracks dessapear over time","likes":2,"published":1,"flags":32,"usePreview":0,"tags":["texture","fade","canvas"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// final fragment color\n// background is drawn here\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec4 cellColor = vec4(CANVAS_COLOR);\n    vec2 cellSize = vec2(CELL_SIZE);\n    vec2 cellPad = vec2(CELL_PAD);\n    \n    // Output to screen\n    \n    float inside = pixelInsideCell(fragCoord, cellSize, cellPad);\n    \n    vec2 uv = fragCoord.xy / iResolution.xy;\n    vec4 drawnColor = texture(iChannel0, uv); \n    \n    fragColor = inside * (cellColor + drawnColor);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"// save and restore drawn by brush color\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // tex coords for buffer\n    vec2 uv = fragCoord.xy / iResolution.xy;\n    // get texture color; remember it contains only drawn thing\n    // previous saved color decreases over time\n    vec4 prevDrawn = texture(iChannel0, uv) * (1.0 - FADE_COEF);\n    prevDrawn *= float(prevDrawn.a > 1e-5);\n    \n    // canvas setup\n    vec4 cellColor = vec4(CANVAS_COLOR);\n    vec4 brushColor = vec4(BRUSH_COLOR);\n    float brushRadius = BRUSH_RADIUS;\n    vec2 cellSize = vec2(CELL_SIZE);\n    vec2 cellPad = vec2(CELL_PAD);\n    \n    // currect pixel affiliation\n    float inside = pixelInsideCell(fragCoord, cellSize, cellPad);\n    \n    // find current selected color\n    vec4 curDrawnColor = getDrawnColor(fragCoord, cellSize, cellPad,\n                                       brushColor, brushRadius, vec2(iMouse.xy));\n    vec4 diffDrawnColor = curDrawnColor - prevDrawn;\n    diffDrawnColor *= float(diffDrawnColor.a > 0.0);\n    \n    // final color for iChannel0\n    fragColor = inside * (prevDrawn + diffDrawnColor);\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"/*\nSimple canvas\nUse next defines to set color and canvas properties\nIt's additive, so do not choose bright background color\n*/\n\n#define CELL_SIZE        12.0, 12.0\n#define CELL_PAD         2.0, 2.0\n#define CANVAS_COLOR     0.4, 0.4, 0.4, 1.0\n#define BRUSH_COLOR      0.2, 0.8, 0.2, 1.0\n#define BRUSH_RADIUS     40.0\n// fade coef - how much color is lost per frame\n#define FADE_COEF        0.01\n\nvec4 getCellBounds(vec2 pixel, vec2 cellSize, vec2 cellPad)\n{\n    // returns 4 coordinates, that describe a single cell (including pad)\n    vec2 enlarged_cell = cellSize + cellPad;\n    vec2 index = floor(pixel / enlarged_cell);\n    vec2 cell_begin = enlarged_cell * index;\n    vec2 cell_end = enlarged_cell * (index + vec2(1.0, 1.0));\n    return vec4(cell_begin, cell_end);\n}\n\nvec2 getCellCenter(vec2 pixel, vec2 cellSize, vec2 cellPad)\n{\n    // cell center\n    vec4 cell_bounds = getCellBounds(pixel, cellSize, cellPad);\n    vec2 cell_begin  = cell_bounds.xy;\n    vec2 cell_end    = cell_bounds.zw;\n    return (cell_begin + cell_end) * 0.5;\n}\n\nfloat pixelInsideCell(vec2 pixel, vec2 cellSize, vec2 cellPad)\n{\n    // if outside do nothing\n    vec4 cell_bounds = getCellBounds(pixel, cellSize, cellPad);\n    vec2 cell_end = cell_bounds.zw;\n    float outside_cell = float((pixel.x > (cell_end.x - cellPad.x)) || \n                               (pixel.y > (cell_end.y - cellPad.y)));\n    float inside_cell = 1.0 - outside_cell;\n    return inside_cell;\n}\n\nvec2 cellInRadius(vec2 canvas_cell, vec2 cursor_cell, float radius)\n{\n    // brush affected cells\n    vec2 v = canvas_cell - cursor_cell;\n    float d2 = dot(v, v);\n    float rad2 = radius * radius;\n    float inside = 1.0 - step(rad2, d2);\n    // return d*d to more sharp color gradient (bicubic, not linear)\n    return vec2(inside, d2);\n}\n\nvec4 getDrawnColor(vec2 pixel, vec2 cellSize, vec2 cellPad, \n                   vec4 brushColor, float rad, vec2 mouse)\n{\n    // select with mouse cursor\n    \n    // not smooth, but according to block size\n    vec2 cell_center = getCellCenter(pixel, cellSize, cellPad);\n    vec2 mouse_cell_center = getCellCenter(mouse.xy, cellSize, cellPad);\n    \n    // linear selected color grade\n    vec2 insideAndDistance = cellInRadius(cell_center, mouse_cell_center, rad);\n    float inside_rad = insideAndDistance[0]; // 1.0 - inside, 0.0 - not\n    float _distance2 = insideAndDistance[1]; // d*d\n    vec4 drawnColor = inside_rad * (1.0 - _distance2 / rad / rad) * brushColor;\n    \n    return drawnColor;\n}","name":"Common","description":"","type":"common"}]}