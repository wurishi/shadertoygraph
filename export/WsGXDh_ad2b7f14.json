{"ver":"0.1","info":{"id":"WsGXDh","date":"1573844888","viewed":387,"name":"Branch-Free HSB","username":"andremichelle","description":"Branchfree hsb (No if/else).\nVersion A: float only\nVersion B: array access","likes":2,"published":3,"flags":0,"usePreview":0,"tags":["color","hsb"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// uncomment following define to benchmark (wrong visuals though)\n//#define BENCHMARK\n\n#define clip(x) clamp(x, 0., 1.)\n\n// no branch, no cast\n// h: hue, s: saturation, b: brightness (all normalized between 0..1)\nvec3 hsb(in float h, in float s, in float b) {\n    const vec3 c0 = vec3(1., 0., 0.);\n    const vec3 c1 = vec3(1., 1., 0.);\n    const vec3 c2 = vec3(0., 1., 0.);\n    const vec3 c3 = vec3(0., 1., 1.);\n    const vec3 c4 = vec3(0., 0., 1.);\n    const vec3 c5 = vec3(1., 0., 1.);\n    const vec3 c6 = vec3(1., 0., 0.);\n    const vec3 cb = vec3(0.);\n    const vec3 cw = vec3(1.);\n    float h6 = h*6.;\n    return mix(cb,\n               mix(cw,\n                   mix(c0,\n                       mix(c1,\n                           mix(c2,\n                               mix(c3,\n                                   mix(c4,\n                                       mix(c5, c6,\n                                           clip(h6-5.)),\n                                       clip(h6-4.)),\n                                   clip(h6-3.)),\n                               clip(h6-2.)),\n                           clip(h6-1.)),\n                       clip(h6)),s),b);\n}\n\n// no branch, array access\n// h: hue, s: saturation, b: brightness (all normalized between 0..1)\nvec3 hsbl(in float h, in float s, in float b) {\n    const vec3 ch[7] = vec3[7](\n        vec3(1., 0., 0.),\n        vec3(1., 1., 0.),\n        vec3(0., 1., 0.),\n        vec3(0., 1., 1.),\n        vec3(0., 0., 1.),\n        vec3(1., 0., 1.),\n        vec3(1., 0., 0.)\n    );\n    float h6 = h*6.;\n    int h6i = int(h6);\n    return mix(vec3(0.),mix(vec3(1.),mix(ch[h6i],ch[h6i+1],fract(h6)),s),b);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    vec2 uv = fragCoord/iResolution.xy;\n    uv.y = 1.-uv.y;\n    \n    float h = uv.x;\n    float s = clip(2.*uv.y);\n    float b = clip(2.-2.*uv.y);\n    vec3 color = vec3(0.);\n    #ifdef BENCHMARK\n    // bench n: 10000 640x360px\n    // hsb : 9-10fps\n    // hsbl: 10-11fps\n   \tint n = 10000;\n    for(int i = 0 ; i < n ; i++) {\n        float h = fract(float(i));\n    \tcolor = hsb(h,s,b);\n    \t//color = hsbl(h,s,b);\n    }\n    #else\n    \tcolor = hsbl(h,s,b);\n    #endif\n    \n    fragColor = vec4(color,1.);\n}","name":"Image","description":"","type":"image"}]}