{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n#define EPSM  0.9999\n\n//iq's tools.\nfloat hash( float n )\n{\n    return fract(sin(n)*43758.5453123);\n}\n\nfloat hexp( vec2 p, vec2 h )\n{\n    vec2 q = abs(p);\n    return max(q.x-h.y,max(q.x+q.y*0.57735,q.y*1.1547)-h.x);\n}\n\nfloat plane(vec3 p, float D) {\n\treturn D - dot(abs(p), normalize(vec3(0.0, 1.0, 0.0)));\n}\n\nvec2 rot(vec2 p, float a) {\n\treturn vec2(\n\t\tcos(a) * p.x - sin(a) * p.y,\n\t\tsin(a) * p.x + cos(a) * p.y);\n}\n\nvec3 map(vec3 p) {\n\tvec3 pp = p;\n\t\n\t//ground\n\tfloat k = plane(pp, 0.7);\n\t\n\t//PYRAMID\n\tpp = mod(-abs(p), 1.0) - 0.5;\n\t\n\tfloat tim = iTime * 4.0 + sin(iTime * 3.0) * 2.0;\n\tfor(int e = 0 ; e < 6; e++) {\n\t\t//rotate\n\t\tif( floor(float(e) / 2.0) > 0.0 ) tim = -tim;\n\t\tvec3 ppp = pp;\n\t\tppp.xz = rot(ppp.xz, tim * 0.3 + ceil(p.z) / (1.5));\n\t\tk = min(k, max(ppp.y - 0.07 * float(e), hexp(ppp.xz, vec2(0.48 - 0.08 * float(e)))) );\n\t}\n\treturn vec3(pp.xz, k);\n}\n\t\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tvec2 uv    = -1.0 + 2.0 * ( fragCoord.xy / iResolution.xy );\n\t\n\t//ray\n\tvec3 dir   = normalize(vec3(uv * vec2(iResolution.x / iResolution.y, 1.0), 1.0)).xyz;\n\t\n\t//rotate\n\tdir.xz = rot(dir.xz, iTime * 0.07);\n\tdir.zy = rot(dir.zy, iTime * 0.002);\n\t//dir.xy = rot(dir.xy, time * 0.005);\n\t\n\t//camera \n\tvec3 pos   = vec3(0.0);\n\tpos.z     += iTime * 0.3;\n\tpos.x     += iTime * 0.1;\n\t\n\t//col\n\tvec3  col  = vec3(0.0);\n\tfloat t    = 0.01;\n\n\t//raymarch\n\tvec3  gm   = vec3(0.0);\n\tfor(int i  = 0 ; i < 48; i++) {\n\t\tgm = map(pos + dir * t * EPSM);\n\t\tt += gm.z;\n\t}\n\tvec3  IP   = pos + dir * t;\n\t\n\t//fake shadow and fake ao : http://pouet.net/topic.php?which=7535&page=1\n\tvec3  L    = vec3(-0.5, 0.2, -0.7); //norm...\n\tfloat Sef  = 0.05;\n\tfloat S1   = max(map(IP + Sef * L).z, 0.005);\n\tcol        = max(vec3(S1), 0.0);\n\t\n\t//sun\n\tvec3 sun   = mix(vec3(1, 2, 3), vec3(3, 2, 1), t * 0.5) * 0.04;\n\tcol        = sqrt(col) + dir.zxy * 0.05+ t * 0.07 + sun;\n\tfragColor = vec4(col, 1.0);\n\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XdX3WM","date":"1371348158","viewed":505,"name":"rotate pyramid","username":"gyabo","description":"Practice raymaching.","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["raymaching"],"hasliked":0,"parentid":"","parentname":""}}