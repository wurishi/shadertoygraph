{"ver":"0.1","info":{"id":"mtSSzK","date":"1676313479","viewed":316,"name":"Mean of Least Variance","username":"lalaoopybee","description":"similar to kuwahara, but imo looks better, since it can adapt to any K*K sub-region\nadded dithering and palette compression\n[url=https://www.shadertoy.com/view/ddyGWR]cubemap version[/url]","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["npr","mlv"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sX3Rn","filepath":"/media/a/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv","previewfilepath":"/media/ap/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define K 5//[3, 7]\n\n#define GRAY(a) dot(a, vec3(.299, .587, .114))\n\n//canvas effect?\n#define DITHER\n#define SPREAD .23\nint bayer[16]=int[16](\n    0, 8, 2, 10,\n    12, 4, 14, 6,\n    3, 11, 1, 9,\n    15, 7, 13, 5\n);\n\n#define SNAP(a, b) (round((a)/(b))*(b))\n#define SNAP_AMT .15\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n    vec2 uv=fragCoord/iResolution.xy;\n    \n    //optimizations?\n    float num=float(K*K);\n    float nWeight=1./num;\n    float n1Weight=1./(num-1.);\n    \n    //every possible kernel\n    float minVar=0.;\n    for(int oi=0;oi<K;oi++){\n        for(int oj=0;oj<K;oj++){\n            int ox=oi-K+1, oy=oj-K+1;\n            \n            //naive variance formula\n            vec4 sum=vec4(0.), sumSq=sum;\n            for(int ii=0;ii<K;ii++){\n                for(int ij=0;ij<K;ij++){\n                    vec2 offset=vec2(ox+ii, oy+ij)/iResolution.xy;\n                    vec3 col=texture(iChannel0, uv+offset).rgb;\n                    vec4 value=vec4(col, GRAY(col));\n                    sum+=value;\n                    sumSq+=value*value;\n                }\n            }\n            float var=(sumSq.a-sum.a*sum.a*nWeight)*n1Weight;\n            //\"sort\" while sampling\n            if((oi==0&&oj==0)||var<minVar){\n                minVar=var;\n                fragColor=vec4(sum.rgb*nWeight, 1.);\n            }\n        }\n    }\n    \n    float line=iMouse.x/iResolution.x;\n    if(iMouse.xy==vec2(0.)) line=sin(iTime*.8)*.5+.5;\n    if(uv.x<line) {\n        int i=int(fragCoord.x)%4;\n        int j=int(fragCoord.y)%4;\n        float bayerValue=float(bayer[i+j*4])*.0625;\n        float mask=bayerValue-.5;\n        fragColor.rgb+=mask*SPREAD;\n        \n        fragColor.r=SNAP(fragColor.r, SNAP_AMT);\n        fragColor.g=SNAP(fragColor.g, SNAP_AMT);\n        fragColor.b=SNAP(fragColor.b, SNAP_AMT);\n    }\n    fragColor*=smoothstep(0., .005, abs(uv.x-line));\n}","name":"Image","description":"","type":"image"}]}