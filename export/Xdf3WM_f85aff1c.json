{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"music","id":"XdfGzn","filepath":"/media/a/894a09f482fb9b2822c093630fc37f0ce6cfec02b652e4e341323e4b6e4a4543.mp3","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n#define TMULT  0.012\n#define tex    iChannel0\n#define music  iChannel1\n#define tmusic iChannelTime[1]\n\n\nvec2 rot(vec2 p, float a) {\n\treturn vec2(\n\t\tcos(a) * p.x - sin(a) * p.y,\n\t\tsin(a) * p.x + cos(a) * p.y);\n}\n\nfloat getbeat(void) {\n\treturn (\n\t\tpow(texture(music, vec2( 0.01, 0.25 ) ).x, 4.0) +\n\t\tpow(texture(music, vec2( 0.30, 0.25 ) ).x, 8.0) + \n\t\tpow(texture(music, vec2( 0.50, 0.25 ) ).x, 7.0) + \n\t\t0.0\n\t);\n}\n\nvec3 gethi(vec3 p) {\n\tvec2  uv1    = p.xz * TMULT;\n\tvec3  col0   = texture(iChannel0, uv1).xyz;\n\treturn col0;\n}\n\nvec3 map(vec3 p) {\n\tvec3  tk     = gethi(p);\n\tfloat k = 100.0;\n\tif(tmusic > 78.0) {\n\t\tk      = 3.0 - dot(abs(p), vec3(0, 1, 0)) - tk.z * getbeat() * 4.0;\n\t} else {\n\t\tk      = 3.0 + dot(p, vec3(0, 1, 0)) - tk.z * getbeat() * 4.0;\n\t}\n\treturn vec3(tk.xy, k);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tvec2   uv = -1.0 + 2.0 * fragCoord.xy / iResolution.xy;\n\t\n\t//ray\n\tvec3  dir = normalize(vec3(uv * vec2(iResolution.x / iResolution.y, 1.0), 1.0));\n\tdir.xz    = rot(dir.xz, tmusic * 0.1);\n\tdir.xy    = rot(dir.xy, sin(tmusic * 0.02) * 0.3);\n\t//dir.yz    = rot(dir.yz, -0.4 + sin(1.3 * sin(tmusic * 0.04) * 0.3));\n\t\n\t//cam pos\n\tvec3  pos = vec3(0,0,0);\n\tpos.x    += sin(tmusic * 0.1) * 4.0;\n\tpos.z    += tmusic * 5.0;\n\tvec3  col = vec3(0);\n\tvec3   mi = vec3(0);\n\tfloat   t = 0.01;\n\t\n\t//raymarching\n\tfor(int i = 0 ; i < 128; i++) {\n\t\tmi    = map(pos + dir * t * 0.3);\n\t\tif(mi.z < 0.01) break;\n\t\tt    += mi.z;\n\t}\n\tvec3   IP = pos + dir * t;\n\t\n\t//light.\n\tvec3    L = normalize(vec3(0.6, 0.4, 1.5));\n\t\n\t//col\n\tvec3 ycol = max(texture(tex, mi.xy).xyz, 0.0) + map(0.3 * L + IP).z * 0.01;\n\tycol      = mix(ycol, ycol.zyx, cos(tmusic * (1.0 / 36.0)) * 5.0);\n\t\n\t//fake sun\n\tvec3 sun  = vec3(5, 2, 1) * max(dot(L, dir), 0.1);\n\tsun       = sun + vec3(1, 2, 3) * 0.5;\n\tsun      *= sun;\n\n\t//fog\n\tvec3  fog = mix(vec3(4, 2, 1), vec3(3, 2, 1) * 0.1, t * 0.01) * 0.2;\n\n\t//cielo\n\tif(t > 256.0) {\n\t\tfog   = vec3(0);\n\t\tycol  = sun * pow(getbeat(), 2.0);\n\t}\n\t\n\t//color\n\tcol       = ycol;\n\tfragColor = vec4(sqrt(col * 0.25) + fog, 1.0);\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"Xdf3WM","date":"1371405175","viewed":769,"name":"Mars","username":"gyabo","description":"simple sync landscape. ","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""}}