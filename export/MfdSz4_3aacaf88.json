{"ver":"0.1","info":{"id":"MfdSz4","date":"1713705672","viewed":92,"name":"Pokemon_Azurill","username":"totan","description":"Who is that pokemon?","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define Res iResolution\n#define iMAX 30.0\n#define REACH 0.1\n#define repeat(p,r) (mod(p,r)-r/2.)\n#define rot(a) mat2(cos(a),sin(a),-sin(a),cos(a))\n#define Mod(p,a) mod(p-a/2.,a)-a/2.\n\n\n\n\nstruct RAY{\n    vec3 p;\n    vec3 dir;\n    vec3 Ndir;\n    vec2 tex;\n    float obj;\n    float total_d;\n    vec3 tCol;\n};RAY ray;\n\nfloat hash(float n){return fract(sin(n)*432.123);}\nfloat sdS(vec3 p, vec3 r)\n{\n    float k0 = length(p/r);\n    float k1 = length(p/(r*r));\n    return k0*(k0-1.0)/k1;\n}\nfloat S(vec3 p,float d){return length(p)-d;}\nfloat sdL( vec3 p, float h, float r )\n{\n  p.y -= clamp( p.y, 0.0, h );\n  return length( p ) - r;\n}\nint m;\nconst vec3[5] col_list= vec3[](vec3(0.5, 1.8, 4.),vec3(5.,1.5,1.5),\n      vec3(5., 5., 5.),vec3(.1, .1, .1),vec3(.5, .5, 4.));\nfloat MAP(in vec3 p0){\n    p0=mod(p0+12.,24.)-12.;\n\n    p0.xz*=rot(iTime*0.8);\n    vec3 p=p0;//body1\n    float d1=sdS(p,vec3(3.,2.5,3.));\n    p=p0-vec3(0.0, 5.6,0.0);\n    float d2=S(p,3.);\n    d1=min(d1,d2);\n    m=0;\n    \n    p=p0;//足\n    p.x=abs(p.x);\n    p-=vec3(1.6,4.6,-2.3);\n    p.zy*=rot(0.8);\n    p.xy*=rot(-0.2);\n    d2=sdS(p,vec3(.5,2.,.5));\n    d1=min(d1,d2);\n    \n    p=p0;//耳１\n    p.x=abs(p.x);\n    p-=vec3(2.,8.6,-1.0);\n    d2=sdS(p,vec3(1.5,1.5,0.5));\n    \n    p=p0;//耳２\n    p.x=abs(p.x);\n    p-=vec3(2.,8.6,-1.3);\n    float d3=sdS(p,vec3(0.7,0.7,0.4));\n    m=d1<d2?m:(d2>-d3?m:1);\n    d2=max(d2,-d3);\n    d1=min(d1,d2);\n    \n    \n    p=p0;//目\n    p.x=abs(p.x);\n    p-=vec3(1.,7.,-2.1);\n    p.xy*=rot(0.07);\n    d2=sdS(p,vec3(0.5,0.7,0.4)*1.1);\n    d1=min(d1,d2);\n    m=d1<d2?m:3;\n    \n    p=p0;//目2\n    p.x=abs(p.x);\n    p-=vec3(1.,7.4,-2.34);\n    p.xz*=rot(-0.4);\n    p.zy*=rot(-0.2);\n    d2=sdS(p,vec3(0.5,0.8,0.3)*0.5);\n    d1=min(d1,d2);\n    m=d1<d2?m:2;\n    \n    p=p0;//目3\n    p.x=abs(p.x);\n    p-=vec3(1.,7.1,-2.45);\n    p.xy*=rot(0.07);\n    d2=sdS(p,vec3(0.5,0.7,0.4)*0.3);\n    d1=min(d1,d2);\n    m=d1<d2?m:4;\n    \n    p=p0;//hoppe\n    p.x=abs(p.x);\n    p-=vec3(1.7,6.4,-2.37);\n    p.zy*=rot(-0.3);\n    p.xz*=rot(0.6);\n    d2=sdS(p,vec3(0.3,0.3,0.1));\n    d1=min(d1,d2);\n    m=d1<d2?m:2;\n    \n    p=p0;//口\n    p-=vec3(.0,6.4,-2.8);\n    d2=sdS(p,vec3(0.3,0.3,0.05)*1.2);\n    d1=min(d1,d2);\n    m=d1<d2?m:1;\n    \n    p=p0;//しっぽ\n    p-=vec3(.0,3.9,2.5);\n    p.zy*=rot(-0.5);\n    d2=sdL(p,2.,0.22);\n    d1=min(d1,d2);\n    m=d1<d2?m:3;\n    \n    p=p0;//しっぽ2\n    p-=vec3(.0,3.9,4.5);\n    p.zy*=rot(0.5);\n    d2=sdL(p,2.,0.22);\n    d1=min(d1,d2);\n    m=d1<d2?m:3;    \n    \n    p=p0;//しっぽ3\n    p-=vec3(.0,1.6,3.5);\n    p.zy*=rot(-0.4);\n    d2=sdL(p,2.5,0.22);\n    d1=min(d1,d2);\n    m=d1<d2?m:3;\n    \n    p=p0;//しっぽ4\n    p-=vec3(.0,-0.2,1.6);\n    p.zy*=rot(-0.8);\n    d2=sdL(p,2.5,0.22);\n    d1=min(d1,d2);\n    m=d1<d2?m:3;\n    \n    \n    return d1;\n}\nvec3 getNormal(float d){\n    //vec3 p=ray.p;\n    const vec2 e = vec2(0.001,0.0);\n    #if 0\n    return normalize(\n        vec3(MAP(ray.p + e.xyy) - MAP(ray.p - e.xyy),\n             MAP(ray.p + e.yxy) - MAP(ray.p - e.yxy),\n             MAP(ray.p + e.yyx) - MAP(ray.p - e.yyx)));\n    #else   \n    return normalize(\n        vec3(MAP(ray.p + e.xyy),\n             MAP(ray.p + e.yxy),\n             MAP(ray.p + e.yyx) )-MAP(ray.p));\n    #endif\n            \n}\n\nbool RM(){\n    vec3 dir = ray.dir;\n    for(float t_d=0.0,d,i=0.0;i++<iMAX;){\n        t_d += d = min(MAP(ray.p),10.);\n        ray.p+=dir*d;\n        if(d<REACH){\n            ray.Ndir=getNormal(d);\n            if(ray.obj<5.0){\n                ray.total_d=t_d;\n                return true;\n            }\n            dir = reflect(dir,ray.Ndir);\n        }\n    }\n    return false;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord-Res.xy*0.5)/Res.y;\n    vec3 dir=normalize(vec3(uv,1.0)),\n         pos=vec3(0.0,10.,-20.);\n    \n    dir.yz*=rot(-.2);\n    ray.dir=dir;\n    ray.p=pos;\n    ray.obj=1.0;\n    ray.tCol=vec3(0.0);\n    ray.total_d=0.0;\n    vec3 col=vec3(1.0);\n    if( RM() ){\n        float amb = 0.2*ray.Ndir.x+.3*ray.Ndir.y+.3;\n        col=col_list[m];\n        col*=0.017 * ray.total_d*amb;\n        \n    }\n    \n    col=pow(col, vec3(.4545));\n    \n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}