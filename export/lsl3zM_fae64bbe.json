{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"#define PI 3.14159265\n#define time (iTime + 20.)\nconst vec3 backc_top=vec3(0.1,0.4,0.7);\nconst vec3 backc_bot=vec3(0.0,0.1,0.2);\nconst vec3 mainc=vec3(0.2,0.8,1.0);\n\n//*math**********************************************/\n\nfloat hash( float n )\n{\n    return fract(sin(n)*43758.5453123);\n}\nfloat noise( in vec3 x )\n{\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n\n    f = f*f*(3.0-2.0*f);\n\n    float n = p.x + p.y*57.0 + 113.0*p.z;\n\n    return mix(mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n                        mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y),\n                    mix(mix( hash(n+113.0), hash(n+114.0),f.x),\n                        mix( hash(n+170.0), hash(n+171.0),f.x),f.y),f.z);\n}\n/*shape**********************************************/\n// from https://iquilezles.org/articles/distfunctions\nfloat sdCylinder( vec3 p, vec3 c )\n{\n  return length(p.xz-c.xy)-c.z;\n}\n\n/*deform**********************************************/\nvec3 opCheapBendX( vec3 p, float rad_bend )\n{\n    float c = cos(rad_bend*cos(p.y+  iTime));\n    float s = sin(rad_bend*cos(p.y+  iTime));\n    mat2  m = mat2(c,-s,s,c);\n    return vec3(m*p.xy,p.z);\n}\nvec3 opTwistY( vec3 p, float rad_twist)\n{\n\tfloat t = time * 0.03 ;\n    float c = cos(rad_twist*p.y+t);\n    float s = sin(rad_twist*p.y+t);\n    mat2  m = mat2(c,-s,s,c);\n\tvec2 xz = m*p.xz;\n    return  vec3(xz.x, p.y,xz.y );\n}\n//*transform*************************************/\nvec3 stepspace(in vec3 p,  in float s)\n{\n  return p-mod(p-s/2.0,s);\n}\nvec2 sim2d(\n  in vec2 p,\n  in float s)\n{\n   return fract((p+s/2.0)/s)*s-s/2.0;\n}\nvec3 tiling(in vec3 p, in float interval )\n{ \n\tvec3 fp=stepspace(p,interval);\n\tfloat d= sin(fp.x*0.3)+cos(fp.z*0.3);\n\tvec3 ret;\n\tret.y=p.y+d;\n\tret.xz=sim2d(p.xz,interval);\n\treturn ret;\n}\n//*Raymarching Functions***************************************************************/\n//====================\n// distanceFunction\n//====================\nfloat distanceFunction(vec3 p)\n{\n\tp = opTwistY( p, 0.08 );\n\tp.z +=10.+time*0.2;\n\tp = tiling(p,6.0);\n\tp = opCheapBendX( p, 0.1 );\n\treturn sdCylinder(p,vec3(0.6,0.6,0.6) ) \n\t\t+0.5*(noise(p*1.1)-0.7) \n\t\t+0.3*noise(p*2.0)\n\t\t+0.1*noise(p*8.0)\n\t;\n}\n//Normal\nvec3 getNormal(vec3 p, float t)\n{\n\tfloat e = 0.001*t;\n    vec3  eps = vec3(e,0.0,0.0);\n    return normalize( vec3(\n    \tdistanceFunction(p+eps.xyy) - distanceFunction(p-eps.xyy),\n\t\tdistanceFunction(p+eps.yxy) - distanceFunction(p-eps.yxy),\n\t\tdistanceFunction(p+eps.yyx) - distanceFunction(p-eps.yyx)\n\t\t));\n}\n//*Shading Functions*************************************************/\nvec3 phong(\n  in vec3 pt,\n  in vec3 prp,\n  in vec3 normal,\n  in vec3 light,\n  in vec3 color,\n  in float spec,\n  in vec3 ambLight)\n{\n\tvec3 lightv=normalize(light-pt);\n\tfloat diffuse=dot(normal,lightv);\n\tvec3 refl=-reflect(lightv,normal);\n\tvec3 viewv=normalize(prp-pt);\n\tfloat rim = max(0.0, 1.0-dot(viewv,normal));\n\tfloat specular=pow(max(dot(refl,viewv),0.0),spec);\n\treturn (max(diffuse*0.5,0.0)+rim*rim)*color+ambLight+specular;\n}\n//*Render Functions*************************************************/\nfloat raymarching(\n  in vec3 camPos,\n  in vec3 rayDir,\n  in int maxite,\n  in float precis,\n  in float startf,\n  in float maxd,\n  out int objfound)\n{ \n\tconst vec3 e=vec3(0.1,0,0.0);\n\tfloat s=startf;\n\tvec3 p;\n\tfloat f=startf;\n\tobjfound=1;\n\tfor(int i=0;i<256;i++){\n\tif (abs(s)<precis||f>maxd||i>maxite) break;\n\t\tf+=s;\n\t\tp=camPos+rayDir*f;\n\t\ts=distanceFunction(p)*0.5;\n\t}\n\tif (f>maxd) objfound=-1;\n\treturn f;\n}\n//render\nvec3 render(\n\tin vec3 camPos,\n\tin vec3 rayDir,\n\tin int maxite,\n\tin float precis,\n\tin float startf,\n\tin float maxd,\n\tin vec3 background,\n\tin vec3 light,\n\tin float spec,\n\tin vec3 ambLight)\n{ \n\n\tint objfound=-1;\n\tfloat f=raymarching(camPos,rayDir,maxite,precis,startf,maxd,objfound);\n\tif (objfound>0){\n\t\tvec3 p=camPos+rayDir*f;\n\t\tvec3 n = getNormal(p, f);\n\t\treturn mix(\n\t\t\tphong(p,camPos,n,light,mainc,spec,ambLight),\n\t\t\tbackground,\n\t\t\tmin(1.0,f*1.5/maxd) \n\t\t);\n\t}\n\tf=maxd;\n\treturn background;\n}\n//*Camera Functions*************************************************/\nvec3 camera(\n  in vec3 camPos,\n  in vec3 camAt,\n  in vec3 camUp,\n  in float focus,\n  in vec2 pixel)\n{\n\tvec2 vPos=-1.0+2.0*pixel/iResolution.xy;\n\tvec3 camDir=normalize(camAt-camPos);\n\tvec3 u=normalize(cross(camUp,camDir));\n\tvec3 v=cross(camDir,u);\n\tvec3 scrCoord=camPos+camDir*focus+vPos.x*u*iResolution.x/iResolution.y+vPos.y*v;\n\treturn normalize(scrCoord-camPos);\n}\nvec3 prp_mouse(){\n\t float mx=iMouse.x/iResolution.x*PI*2.0;\n\t float my=((iMouse.y+1.0)/iResolution.y - 0.5)*PI;\n\t return vec3(cos(my)*cos(mx),sin(my),cos(my)*sin(mx))*12.0; //Trackball style camera pos\n}\n//*Main***************************************************************/\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tconst vec3 camUp  =vec3(0,1,0);\n\tconst vec3 camAt  =vec3(0.0,0.0,0.0);\n\tconst float vpd=1.5;\n\tvec3 camPos = camAt+prp_mouse();\n\tvec3 rayDir= camera(camPos,camAt,camUp,vpd,fragCoord);\n\tvec3 light= camPos+vec3(0.0,5.0,0.0);\n\n\tconst float maxe=0.01;\n\tconst float startf=0.1;\n\tconst float spec=8.0;\n\tconst vec3 ambi=vec3(0.0,0.2,0.2);\n\t\n\tfloat latitude = 0.5+0.5+rayDir.y; //0.5+0.5*noise( normalize(scp) );\n\tvec3 back =mix(backc_bot,backc_top,latitude*latitude);\n\n\tvec3 c1=render(camPos,rayDir,256,maxe,startf,40.0,back,light,spec,ambi);\n\tfragColor=vec4(c1.xyz,1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"lsl3zM","date":"1366494618","viewed":2150,"name":"Long slender flexible things","username":"NeoNusso","description":"My first post.\nI imagined living things or plant life under the water.","likes":41,"published":1,"flags":0,"usePreview":0,"tags":["3d","raymarching","distancefield"],"hasliked":0,"parentid":"","parentname":""}}