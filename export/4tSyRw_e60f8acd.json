{"ver":"0.1","info":{"id":"4tSyRw","date":"1507796694","viewed":80,"name":"Regular Mandelbrot","username":"yqy","description":"Regular Mandelbrot","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["fractal","mandelbrot"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float param1 = 128.f;\nconst float param2 = 16.f;\nconst int color = 1;\n\nconst float PI = radians(180.f);\nconst float TAU = radians(360.f);\n\n#define div(a, b) int((a) / (b))\n#define sqr(a) ((a) * (a))\n#define cub(a) (sqr(a) * (a))\n\n#define map3(f, v) vec3(f((v).x), f((v).y), f((v).z))\n\nvec3 hsv2rgb(float h, float s, float v) {\n    h = fract(h) * 6.f;\n    float c = v * s;\n    float x = c * (1.f - abs(mod(h, 2.f) - 1.f));\n    float m = v - c;\n\n    #define ret(a, b, c)\\\n        return vec3(a + m, b + m, c + m)\n\n    switch (int(h)) {\n        case 0: ret(c, x, 0.f);\n        case 1: ret(x, c, 0.f);                                                                                                          \n        case 2: ret(0.f, c, x);                                                                                                          \n        case 3: ret(0.f, x, c);                                                                                                          \n        case 4: ret(x, 0.f, c);                                                                                                          \n        case 5: ret(c, 0.f, x);                                                                                                          \n    }                                                                                                                                  \n                                                                                                                                       \n    #undef ret                                                                                                                         \n}                                                                                                                                      \n                                                                                                                                       \nvec3 lab2xyz(float l, float a, float b) {                                                                                              \n    const vec3 w = vec3(0.95047f, 1.f, 1.08883f);                                                                                          \n    vec3 c = vec3((l + 16.f) / 116.f)                                                                                                      \n           + vec3(a / 500.f, 0.f, -b / 200.f);                                                                                               \n    #define f(t)\\\n        t > 6.f / 29.f\\\n            ? cub(t)\\\n            : (116.f * t - 16.f) * 27.f / 24389.f\n    return w * map3(f, c);                                                                                                             \n    #undef f                                                                                                                           \n}                                                                                                                                      \n                                                                                                                                       \nvec3 lab2rgb(float l, float a, float b) {\n    const mat3 m = mat3(\n         3.2404542f, -1.5371385f, -0.4985314f,\n        -0.9692660f,  1.8760108f,  0.0415560f,\n         0.0556434f, -0.2040259f,  1.0572252f\n    );\n    #define f(t)\\\n        t > 0.00304f\\\n            ? 1.055f * pow(t, 1.f / 2.4f) - 0.055f\\\n            : 12.92f * t\n    vec3 c = lab2xyz(l, a, b) * m;\n    return map3(f, c);\n    #undef f\n}\n\nvec3 labhsv(float h, float s, float v) {\n    h *= TAU;\n    s *= 100.f;\n    v *= 100.f;\n    return lab2rgb(v, s * sin(h), s * cos(h));\n}\n\nfloat foo1(float a, float b)\n{\n    return sqr(a)+sqr(b);\n}\n\nfloat foo(float a, float b)\n{\n    return log2(log2(sqr(a) + sqr(b)));\n}\n\nfloat mandel(vec2 c, int n)\n{\n    float res_r = 0.0f;\n    float res_i = 0.0f;\n    float res_r_tmp;\n    int i = 0;\n    while (foo1(res_r, res_i) < param2 && (i < n))\n    {\n        res_r_tmp = res_r;\n        res_r = sqr(res_r) - sqr(res_i) + c.x;\n        res_i = 2.0f * res_r_tmp * res_i + c.y;\n        ++i;\n    }\n    if (i < n)\n        return float(i+1)-foo(res_r, res_i);\n    else\n        return 1.f/0.f;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 pp = fragCoord.xy / iResolution.xy;\n    pp.x = pp.x * 4.f - 8.f/3.f;\n    pp.y = pp.y * 8.f/3.f - 4.f/3.f;\n    float m = mandel(pp, int(param1));\n    if (color == 0)\n        m /= param1;\n    fragColor = vec4(labhsv(m, 0.9f, 0.6f), 1);\n}","name":"Image","description":"","type":"image"}]}