{"ver":"0.1","info":{"id":"sdGfWR","date":"1657955599","viewed":77,"name":"16/07/22","username":"lechuga","description":"perdu","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["water","cubes"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define pi acos(-1.)\nfloat time;\n#define rot(a) mat2(cos(a),sin(a),-sin(a),cos(a))\nfloat pulse;\nfloat scene;\nfloat smin(float a, float b, float k){\n    float h = max(0., k-abs(a-b))/k;\n    return min(a,b)-h*h*k*.25;\n}\nvec3 smin(vec3 a, vec3 b, vec3 k){\n    vec3 h = max(vec3(0.), k-abs(a-b))/k;\n    return min(a,b)-h*h*k*.25;\n}\n\nfloat box(vec3 p, vec3 s){\n  p = abs(p)-s;\n  return max(max(p.x, p.y), p.z) + min(length(p), 0.);\n}\nfloat acum;\n#define texNoise iChannel0\nvec2 m(vec3 p)\n{\n  vec3 p0,p1;\n  p0=p1=p;\n  float flo = -p.y+2.-\n  texture(texNoise, p.xy*.00534+pulse*.0156).x + \n  texture(texNoise, p.xz*.02455+pulse*.0434).x + \n  texture(texNoise, p.zy * .055145+pulse*.034).x*.2;\n  float id = 5.;\n  /*\n  for(float i = 0.; i < 5; i++){\n    p=smin(p, mod(sin(pulse*.075)*4.5+4.5, 5.)-p, vec3(1));\n    p.yz *= rot(sin(pulse*.015375));\n    p.xz *= rot(cos(pulse*.06475));\n    p.xy *= rot(-sin(pulse*.02455));\n    id *= i*.1;\n    \n  }*/\n  float esp = length(p)-id-sin(p.x*.34)*cos(p.z*.3434)*.5-.5;\n  //acum += .1/(.1+esp*esp);\n  float d = flo;\n  p0.y -= 1.;\n  p0.xy *= rot((pi*2.+sin(time*20.)*.24-.24));\n  p0.yz *= rot(-(pi*2.+sin(time)*.24-.24));\n  p0.xz *= rot(time*2.);\n  float b = box(p0, vec3(2.));\n  //d = smin(d,b,1.);\n  p1.x -= 45.;\n  p1.xz += time*50.;\n  p1.xz = (fract(p1.xz/60.-.5)-.5)*60.;\n  float cols = length(p1.xz)-2.-sin(p1.y*.364);\n  d =min(d, cols*.5);\n\treturn d < b ? vec2(d, 0.) : vec2(smin(d,b,1.), 1.);\n}\nvec3 nm(vec3 p){\n  const vec2 e = vec2(0.01, 0.);\n  return normalize(m(p).x-vec3(m(p-e.xyy).x,m(p-e.yxy).x,m(p-e.yyx).x));\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    time = -mod(iTime, 100.) * .0745;\n    pulse = time*50.;\n    scene = mod(pulse*.15, 3.);\n\tvec2 uv = vec2(gl_FragCoord.x / iResolution.x, gl_FragCoord.y / iResolution.y);\n\tuv -= 0.5;\n\tuv /= vec2(iResolution.y / iResolution.x, 1.);\n  \n  vec3 s = vec3(0., -5., -25.);\n  s.y = scene > 1. ? -5. : -15.;\n  s.x = scene < 2. ? -10. : -10.;\n  vec3 p =s;\n  vec3 tg = vec3(0., 4., 4.3);\n  vec3 cz = normalize(vec3(tg-s));\n  vec3 cx = normalize(cross(cz,vec3(0., -1., 0.)));\n  vec3 cy = normalize(cross(cz,cx));\n  vec3 r = normalize(mat3(cx,cy,cz)*vec3(-uv, 1.));\n  vec3 co = vec3(0.76);\n\tvec3 l = normalize(vec3(4., 1., -.1));\n  float i = 0.;\n  float dd;\n  for(;i < 45.; i++){\n    vec2 mm = m(p);\n    float d = mm.x;\n    float id = mm.y;\n    if(d < .00001){\n      vec3 n = nm(p);\n      float dif = clamp(dot(l,n ), 0., 1.);\n      float esp = clamp(pow(dot(reflect(-l, r), n), .374234), 0., 1.);\n      float fr = pow(1.+dot(l,n),15.);\n      co = vec3(dif + esp) * fr;\n      l *=vec3(.34,.34,.85);\n      if(id < 1.){\n        vec3 n = nm(p);\n        r = reflect(r, n);\n        p-=20.;\n      }\n    }\n    else if(dd > 400.){\n      break;\n    }\n    dd += d;\n    p+=d*r;\n  }\n  co *= .1+length(p)*.01*vec3(.1,.125,.125);\n  co += .065+length(uv)*vec3(0.15,.24,.644)*.31;\n  co += acum * vec3(.241,.14,.0745)*.0575;\n\tfragColor = vec4(co,1.);\n}","name":"Image","description":"","type":"image"}]}