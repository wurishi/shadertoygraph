{"ver":"0.1","info":{"id":"4cV3zy","date":"1712930685","viewed":178,"name":"tm bus kaleido","username":"tubeman","description":"a","likes":18,"published":1,"flags":0,"usePreview":0,"tags":["kaleidoscope"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define FAR 60.\n#define PI 3.14159\nmat2 rot(float a) {\n    float c = cos(a);\n    float s = sin(a);\n    return mat2(c,-s,s,c);\n}\n//@iq\nfloat sdBox( vec3 p, vec3 b ){\n  vec3 q = abs(p) - b;\n  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n}\n\nvec2 boxes(vec3 p) {\n    vec2 h,t = vec2(1000,0);\n    vec3 q = p;\n    q.xy *= rot(iTime);\n    h = vec2(sdBox(abs(q)-vec3(4,0,0), vec3(1,4,1))-.1, 1);\n    t = h.x<t.x ? h : t;\n    \n    q = p;\n    q.xy *= rot(iTime);\n    h = vec2(sdBox(abs(q)-vec3(0,4,2), vec3(4,1,1))-.1, 1);\n    t = h.x<t.x ? h : t;\n    return t;\n}\n\nvec2 map(vec3 p) {\n    // kaleidoscope effect adapted from @NuSan\n    for (float i=0.; i<4.; i++) {\n        p = abs(p);\n        p.xy *= rot(sin(iTime*.5 + i*2.));\n        p -= i*mix(1.,1.5,sin(iTime)*.5+.5);\n    }\n    p.xy *= rot(iTime*.5);\n    p.yz *= rot(iTime*.5);    \n    vec2 t = min(boxes(p), boxes(p*2.)/2.);\n    return t;\n}\n\nvec3 normal(vec3 p) {\n    vec2 e = vec2(.001,0);\n    return normalize(map(p).x - vec3(map(p-e.xyy).x, map(p-e.yxy).x, map(p-e.yyx).x));\n}\n\nvoid cam(inout vec3 p) {\n    p.xz *= rot(iTime*.2);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    uv = uv*2.-1.;\n    uv.x *= iResolution.x/iResolution.y;\n    \n    vec3 col = vec3(0);\n    \n    vec3 ro = vec3(0,0,mix(-25.,-35., cos(PI+iTime*.5)*.5+.5));\n    vec3 rd = normalize(vec3(uv, 1));\n    \n    //cam(ro);cam(rd);\n    \n    float t = 0.;\n    for (float i=0.; i<100.; i++) {\n        vec3 p = ro + rd*t;\n        vec2 h = map(p);\n        float d = h.x;\n        float m = h.y;\n        t += d;\n        if (t>FAR) {\n            break;\n        }\n        if (d < .001) {\n            vec3 sn = normal(p);\n            col = .5+.5*cos((sn*.3+.15)*PI+iTime+vec3(0,4,8).yxz + dot(sn,vec3(1))*PI );\n            break;\n        }\n        float a = atan(uv.y,uv.x);\n        col += (1./d *.02)*(.5*.5+cos(iTime+a+vec3(0,2,4)));\n    }\n    \n    fragColor.xyz = pow(col,vec3(.4545));\n}","name":"Image","description":"","type":"image"}]}