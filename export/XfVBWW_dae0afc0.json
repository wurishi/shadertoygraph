{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"// Fork of \"Brick Wall Physics\" by wyatt. https://shadertoy.com/view/sdsyD8\n// 2024-12-13 00:02:20\n\n// Fork of \"Rigid Body Test 123\" by wyatt. https://shadertoy.com/view/fsscRr\n// 2022-01-12 05:43:47\n\nMain\nif (iFrame % 2 > 0) discard;\nQ = vec4(0);\nfor (float i = 0.; i < N; i++) {\n    vec4 a = A(vec2(i,0)+.5);\n    vec4 at= A(vec2(i,1)+.5);\n    vec2 aw = size(i)/2.;\n    float m = map(U,a,at,aw);\n    Q -= smoothstep(2.,1.,m);\n}\nQ = 1.-sin(U.y/R.y+Q+vec4(1,2,3,4));\n}","name":"Image","description":"","type":"image"},{"outputs":[],"inputs":[],"code":"vec2 R; float T; int I; vec4 M;\n#define A(U) texture(iChannel0,(U)/R)\n#define Main void mainImage(out vec4 Q, in vec2 U) {R=iResolution.xy;T=iTime;I=iFrame;M=iMouse;\n#define ei(a) mat2(cos(a),-sin(a),sin(a),cos(a))\n\n#define N 150.\n\n\nvec2 size (float i) {\n    vec2 s = vec2(5,10)*.01*R.y;\n    return s;\n}\n\n#define dt .4\n#define G -1e-2\nvec2 vel (vec2 p, vec4 a, vec4 t) {\n    vec2 w = p.xy-a.xy;\n    if (length(w)>0.) w = vec2(-w.y,w.x);\n    return a.zw + w*t.y;\n}\nfloat map ( vec2 p, vec4 a, vec4 t, vec2 b )\n{ //iquilezles.org/articles/distfunctionsl\n  p = (p-a.xy)*ei(-t.x);\n  vec2 q = (abs(p) - b);\n  return length(max(q,0.0)) + min(max(q.x,q.y),0.0)-4.;\n}\n\nvec2 norm (vec2 p, vec4 a, vec4 t, vec2 b)\n{   \n    float n = map(p+vec2(0,1),a,t,b),\n          e = map(p+vec2(1,0),a,t,b),\n          s = map(p-vec2(0,1),a,t,b),\n          w = map(p-vec2(1,0),a,t,b);\n    return .25*vec2(e-w,n-s);\n}","name":"Common","description":"","type":"common"},{"outputs":[{"channel":0,"id":"4dXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"XdfGR8","filepath":"/media/previz/buffer03.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main\n\n    if (U.y>4.)discard;\n    Q = A(vec2(U.x,.5));\n    vec4 t = A(vec2(U.x,1.5));\n    vec4 oQ = A(vec2(U.x,2.5));\n    vec4 ot = A(vec2(U.x,3.5));\n    vec2 w = size(floor(U.x));\n    \n    if (U.y<2.) {\n        vec2 f = vec2(0,G);\n        float tor = 0.;\n        float h = 0.;\n        for(float j = 0.; j < N; j++) if (j!=floor(U.x)) {\n            vec4 b = A(vec2(j,0)+.5);\n            vec4 bt = A(vec2(j,1)+.5);\n            vec2 bw = size(j);\n            for (float x = 0.; x<=1.; x++)\n            for (float y = 0.; y<=1.; y++)\n            {\n                { \n                    vec2 q = w*(vec2(x,y)-.5)*ei(t.x)+Q.xy;\n                    // my point in their box\n                    float m = map(q,b,bt,.5*bw);\n                    if (m<=0.) {\n                        vec2 r = q-Q.xy;\n                        vec2 v = vel(q,b,bt)-vel(q,Q,t);\n                        float l = length(r);\n                        vec2 im = norm(q,b,bt,.5*bw)+v;\n                        tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                        f += im*abs(dot(normalize(r),normalize(im)));\n                        //f += b.zw-b.zw;\n                        //tor += bt.y-t.y;\n                        h += 1.;\n                    }\n                }\n                { // their point in my box\n                    vec2 q = bw*(vec2(x,y)-.5)*ei(bt.x)+b.xy;\n                    float m = map(q,Q,t,.5*w);\n                    if (m<=0.) {\n                        vec2 r = q-Q.xy;\n                        vec2 v = vel(q,b,bt)-vel(q,Q,t);\n                        float l = length(r);\n                        vec2 im = norm(q,b,bt,.5*bw)+v;\n                        tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                        f += im*abs(dot(normalize(r),normalize(im)));\n                        //f += b.zw-b.zw;\n                        //tor += bt.y-t.y;\n                        h += 1.;\n                    }\n                }\n            }\n        }\n        for (float x = 0.; x<=1.; x++)\n        for (float y = 0.; y<=1.; y++)\n        {\n            vec2 q = w*(vec2(x,y)-.5)*ei(t.x)+Q.xy;\n            vec4 b = vec4(.5*R.xy,0,0);\n            float m = -map(q,b,vec4(0),b.xy);\n            if (m<0.) {\n                vec2 r = q-Q.xy;\n                vec2 v = vel(q,b,vec4(0))-vel(q,Q,t);\n                float l = length(r);\n                vec2 im = -norm(q,b,vec4(0),.5*R.xy)+v;\n                tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                f += im*abs(dot(normalize(r),normalize(im)));\n                h += 1.;\n            }\n        }\n        if (h>0.) f/=h, tor/=h;\n        Q.zw += dt*(f);\n        Q.xy += dt*(f+Q.zw);\n        t.y += dt*(tor);\n        t.x += dt*(tor+t.y);\n        if (M.z>0.) Q.zw += dt*1e-3*(Q.xy-M.xy)*exp(-.01*length(Q.xy-M.xy));\n        if (length(Q.zw)>1./dt) Q.zw = 1./dt*normalize(Q.zw);\n        if (abs(t.y)>dt) t.y = dt*sign(t.y);\n    }\n    \n    if(iFrame < 1) {\n        vec2 size = size(floor(U.x));\n        Q = vec4(U.x*size.x*1.7,size.y+U.x*size.x*.5,0,0);\n        t = vec4(U.x/N,0,0,0);\n    }\n    if (mod(U.y,2.)>1.) Q = t;\n\n}","name":"Buffer A","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"XsXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main\n\n    if (U.y>4.)discard;\n    Q = A(vec2(U.x,.5));\n    vec4 t = A(vec2(U.x,1.5));\n    vec4 oQ = A(vec2(U.x,2.5));\n    vec4 ot = A(vec2(U.x,3.5));\n    vec2 w = size(floor(U.x));\n    \n    if (U.y<2.) {\n        vec2 f = vec2(0,G);\n        float tor = 0.;\n        float h = 0.;\n        for(float j = 0.; j < N; j++) if (j!=floor(U.x)) {\n            vec4 b = A(vec2(j,0)+.5);\n            vec4 bt = A(vec2(j,1)+.5);\n            vec2 bw = size(j);\n            for (float x = 0.; x<=1.; x++)\n            for (float y = 0.; y<=1.; y++)\n            {\n                { \n                    vec2 q = w*(vec2(x,y)-.5)*ei(t.x)+Q.xy;\n                    // my point in their box\n                    float m = map(q,b,bt,.5*bw);\n                    if (m<=0.) {\n                        vec2 r = q-Q.xy;\n                        vec2 v = vel(q,b,bt)-vel(q,Q,t);\n                        float l = length(r);\n                        vec2 im = norm(q,b,bt,.5*bw)+v;\n                        tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                        f += im*abs(dot(normalize(r),normalize(im)));\n                        //f += b.zw-b.zw;\n                        //tor += bt.y-t.y;\n                        h += 1.;\n                    }\n                }\n                { // their point in my box\n                    vec2 q = bw*(vec2(x,y)-.5)*ei(bt.x)+b.xy;\n                    float m = map(q,Q,t,.5*w);\n                    if (m<=0.) {\n                        vec2 r = q-Q.xy;\n                        vec2 v = vel(q,b,bt)-vel(q,Q,t);\n                        float l = length(r);\n                        vec2 im = norm(q,b,bt,.5*bw)+v;\n                        tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                        f += im*abs(dot(normalize(r),normalize(im)));\n                        //f += b.zw-b.zw;\n                        //tor += bt.y-t.y;\n                        h += 1.;\n                    }\n                }\n            }\n        }\n        for (float x = 0.; x<=1.; x++)\n        for (float y = 0.; y<=1.; y++)\n        {\n            vec2 q = w*(vec2(x,y)-.5)*ei(t.x)+Q.xy;\n            vec4 b = vec4(.5*R.xy,0,0);\n            float m = -map(q,b,vec4(0),b.xy);\n            if (m<0.) {\n                vec2 r = q-Q.xy;\n                vec2 v = vel(q,b,vec4(0))-vel(q,Q,t);\n                float l = length(r);\n                vec2 im = -norm(q,b,vec4(0),.5*R.xy)+v;\n                tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                f += im*abs(dot(normalize(r),normalize(im)));\n                h += 1.;\n            }\n        }\n        if (h>0.) f/=h, tor/=h;\n        Q.zw += dt*(f);\n        Q.xy += dt*(f+Q.zw);\n        t.y += dt*(tor);\n        t.x += dt*(tor+t.y);\n        if (M.z>0.) Q.zw += dt*1e-3*(Q.xy-M.xy)*exp(-.01*length(Q.xy-M.xy));\n        if (length(Q.zw)>1./dt) Q.zw = 1./dt*normalize(Q.zw);\n        if (abs(t.y)>dt) t.y = dt*sign(t.y);\n    }\n    \n    if(iFrame < 1) {\n        vec2 size = size(floor(U.x));\n        Q = vec4(U.x*size.x*1.7,size.y+U.x*size.x*.5,0,0);\n        t = vec4(U.x/N,0,0,0);\n    }\n    if (mod(U.y,2.)>1.) Q = t;\n\n}","name":"Buffer B","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"4sXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main\n\n    if (U.y>4.)discard;\n    Q = A(vec2(U.x,.5));\n    vec4 t = A(vec2(U.x,1.5));\n    vec4 oQ = A(vec2(U.x,2.5));\n    vec4 ot = A(vec2(U.x,3.5));\n    vec2 w = size(floor(U.x));\n    \n    if (U.y<2.) {\n        vec2 f = vec2(0,G);\n        float tor = 0.;\n        float h = 0.;\n        for(float j = 0.; j < N; j++) if (j!=floor(U.x)) {\n            vec4 b = A(vec2(j,0)+.5);\n            vec4 bt = A(vec2(j,1)+.5);\n            vec2 bw = size(j);\n            for (float x = 0.; x<=1.; x++)\n            for (float y = 0.; y<=1.; y++)\n            {\n                { \n                    vec2 q = w*(vec2(x,y)-.5)*ei(t.x)+Q.xy;\n                    // my point in their box\n                    float m = map(q,b,bt,.5*bw);\n                    if (m<=0.) {\n                        vec2 r = q-Q.xy;\n                        vec2 v = vel(q,b,bt)-vel(q,Q,t);\n                        float l = length(r);\n                        vec2 im = norm(q,b,bt,.5*bw)+v;\n                        tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                        f += im*abs(dot(normalize(r),normalize(im)));\n                        //f += b.zw-b.zw;\n                        //tor += bt.y-t.y;\n                        h += 1.;\n                    }\n                }\n                { // their point in my box\n                    vec2 q = bw*(vec2(x,y)-.5)*ei(bt.x)+b.xy;\n                    float m = map(q,Q,t,.5*w);\n                    if (m<=0.) {\n                        vec2 r = q-Q.xy;\n                        vec2 v = vel(q,b,bt)-vel(q,Q,t);\n                        float l = length(r);\n                        vec2 im = norm(q,b,bt,.5*bw)+v;\n                        tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                        f += im*abs(dot(normalize(r),normalize(im)));\n                        //f += b.zw-b.zw;\n                        //tor += bt.y-t.y;\n                        h += 1.;\n                    }\n                }\n            }\n        }\n        for (float x = 0.; x<=1.; x++)\n        for (float y = 0.; y<=1.; y++)\n        {\n            vec2 q = w*(vec2(x,y)-.5)*ei(t.x)+Q.xy;\n            vec4 b = vec4(.5*R.xy,0,0);\n            float m = -map(q,b,vec4(0),b.xy);\n            if (m<0.) {\n                vec2 r = q-Q.xy;\n                vec2 v = vel(q,b,vec4(0))-vel(q,Q,t);\n                float l = length(r);\n                vec2 im = -norm(q,b,vec4(0),.5*R.xy)+v;\n                tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                f += im*abs(dot(normalize(r),normalize(im)));\n                h += 1.;\n            }\n        }\n        if (h>0.) f/=h, tor/=h;\n        Q.zw += dt*(f);\n        Q.xy += dt*(f+Q.zw);\n        t.y += dt*(tor);\n        t.x += dt*(tor+t.y);\n        if (M.z>0.) Q.zw += dt*1e-3*(Q.xy-M.xy)*exp(-.01*length(Q.xy-M.xy));\n        if (length(Q.zw)>1./dt) Q.zw = 1./dt*normalize(Q.zw);\n        if (abs(t.y)>dt) t.y = dt*sign(t.y);\n    }\n    \n    if(iFrame < 1) {\n        vec2 size = size(floor(U.x));\n        Q = vec4(U.x*size.x*1.7,size.y+U.x*size.x*.5,0,0);\n        t = vec4(U.x/N,0,0,0);\n    }\n    if (mod(U.y,2.)>1.) Q = t;\n\n}","name":"Buffer C","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"XdfGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main\n\n    if (U.y>4.)discard;\n    Q = A(vec2(U.x,.5));\n    vec4 t = A(vec2(U.x,1.5));\n    vec4 oQ = A(vec2(U.x,2.5));\n    vec4 ot = A(vec2(U.x,3.5));\n    vec2 w = size(floor(U.x));\n    \n    if (U.y<2.) {\n        vec2 f = vec2(0,G);\n        float tor = 0.;\n        float h = 0.;\n        for(float j = 0.; j < N; j++) if (j!=floor(U.x)) {\n            vec4 b = A(vec2(j,0)+.5);\n            vec4 bt = A(vec2(j,1)+.5);\n            vec2 bw = size(j);\n            for (float x = 0.; x<=1.; x++)\n            for (float y = 0.; y<=1.; y++)\n            {\n                { \n                    vec2 q = w*(vec2(x,y)-.5)*ei(t.x)+Q.xy;\n                    // my point in their box\n                    float m = map(q,b,bt,.5*bw);\n                    if (m<=0.) {\n                        vec2 r = q-Q.xy;\n                        vec2 v = vel(q,b,bt)-vel(q,Q,t);\n                        float l = length(r);\n                        vec2 im = norm(q,b,bt,.5*bw)+v;\n                        tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                        f += im*abs(dot(normalize(r),normalize(im)));\n                        //f += b.zw-b.zw;\n                        //tor += bt.y-t.y;\n                        h += 1.;\n                    }\n                }\n                { // their point in my box\n                    vec2 q = bw*(vec2(x,y)-.5)*ei(bt.x)+b.xy;\n                    float m = map(q,Q,t,.5*w);\n                    if (m<=0.) {\n                        vec2 r = q-Q.xy;\n                        vec2 v = vel(q,b,bt)-vel(q,Q,t);\n                        float l = length(r);\n                        vec2 im = norm(q,b,bt,.5*bw)+v;\n                        tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                        f += im*abs(dot(normalize(r),normalize(im)));\n                        //f += b.zw-b.zw;\n                        //tor += bt.y-t.y;\n                        h += 1.;\n                    }\n                }\n            }\n        }\n        for (float x = 0.; x<=1.; x++)\n        for (float y = 0.; y<=1.; y++)\n        {\n            vec2 q = w*(vec2(x,y)-.5)*ei(t.x)+Q.xy;\n            vec4 b = vec4(.5*R.xy,0,0);\n            float m = -map(q,b,vec4(0),b.xy);\n            if (m<0.) {\n                vec2 r = q-Q.xy;\n                vec2 v = vel(q,b,vec4(0))-vel(q,Q,t);\n                float l = length(r);\n                vec2 im = -norm(q,b,vec4(0),.5*R.xy)+v;\n                tor -= dot(r,vec2(-im.y,im.x))/(w.x*w.y);\n                f += im*abs(dot(normalize(r),normalize(im)));\n                h += 1.;\n            }\n        }\n        if (h>0.) f/=h, tor/=h;\n        Q.zw += dt*(f);\n        Q.xy += dt*(f+Q.zw);\n        t.y += dt*(tor);\n        t.x += dt*(tor+t.y);\n        if (M.z>0.) Q.zw += dt*1e-3*(Q.xy-M.xy)*exp(-.01*length(Q.xy-M.xy));\n        if (length(Q.zw)>1./dt) Q.zw = 1./dt*normalize(Q.zw);\n        if (abs(t.y)>dt) t.y = dt*sign(t.y);\n    }\n    \n    if(iFrame < 1) {\n        vec2 size = size(floor(U.x));\n        Q = vec4(U.x*size.x*1.7,size.y+U.x*size.x*.5,0,0);\n        t = vec4(U.x/N,0,0,0);\n    }\n    if (mod(U.y,2.)>1.) Q = t;\n\n}","name":"Buffer D","description":"","type":"buffer"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":true,"mFlagMusicStream":false},"info":{"id":"XfVBWW","date":"1734048178","viewed":170,"name":" Brick Wall Physics","username":"wyatt","description":"Rigid body ","likes":18,"published":3,"flags":32,"usePreview":1,"tags":["physics"],"hasliked":0,"parentid":"","parentname":""}}