{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"4dfGRn","filepath":"/media/a/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"texture","id":"XsfGRn","filepath":"/media/a/1f7dca9c22f324751f2a5a59c9b181dfe3b5564a04b724c657732d0bf09c99db.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":" //trying to account for resolution dependant MipBias\n#define MIPs (8.5+iResolution.y/512.0)\n\nfloat Sphere (in vec2 Coord, in vec2 Position, in float Size)\n{\n    return 1.0-clamp(dot(Coord/Size-Position,Coord/Size-Position),0.0,1.0);\n}\n\nfloat SelectMip (in float Roughness)\n{\n    return MIPs-1.0-(3.0-1.15*log2(Roughness));\n}\n\nvec2 Reflection (in vec2 Coord, in vec2 Position, in float Size, in float NormalZ)\n{\n    return (1.0-Size*(Coord/Size-Position)/NormalZ)/2.0;\n}\n\nvec4 BlurTexture (in vec2 Coord, in sampler2D Tex, in float MipBias)\n{\n\tvec2 TexelSize = MipBias/iChannelResolution[0].xy;\n    \n    vec4  Color = texture(Tex, Coord, MipBias);\n    Color += texture(Tex, Coord + vec2(TexelSize.x,-1.0), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(-TexelSize.x,-1.0), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(0.0,TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(0.0,-TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(TexelSize.x,TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(-TexelSize.x,TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(TexelSize.x,-TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(-TexelSize.x,-TexelSize.y), MipBias);    \n\n    return Color/9.0;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord.xy/iResolution.yy;    \n    \n    //Objects    \n    float s1 = Sphere(uv, vec2(1.5,1.25),0.25);\tfloat s2 = Sphere(uv, vec2(4.5,1.25),0.25);\n    float s3 = Sphere(uv, vec2(3.0,2.75),0.25);\tfloat s4 = Sphere(uv, vec2(6.0,2.75),0.25);    \n    float sph = s1*0.25+s2*0.25+s3*0.25+s4*0.25;    \n    float spm = clamp(sph*64.0,0.0,1.0);   \n    \n    //Normals    \n    float dx = dFdx(sph)*iResolution.x/4.0;    \n    float dy = dFdy(sph)*iResolution.x/4.0;     \n    vec3 vNormal = normalize(vec3(dx,dy,sqrt(clamp(1.0-dx*dx-dy*dy,0.0,1.0)))); \n    \n    //Shading    \n\tuv = (2.0*fragCoord.xy-iMouse.xy*0.1)/(iResolution.yy*2.0);\n    \n    vec2 uvr = ceil(s1)*Reflection(uv, vec2(1.5,1.25),0.25,vNormal.z) + ceil(s2)*Reflection(uv, vec2(4.5,1.25),0.25,vNormal.z)\n        \t + ceil(s3)*Reflection(uv, vec2(3.0,2.75),0.25,vNormal.z) + ceil(s4)*Reflection(uv, vec2(6.0,2.75),0.25,vNormal.z);    \n    \n    vec3 BaseColor = ceil(s1)*vec3(1.0,0.76,0.33) + ceil(s2)*vec3(0.66,0.61,0.53)\n                   + ceil(s3)*vec3(0.95,0.64,0.54)+ ceil(s4)*vec3(0.56,0.57,0.58);\n    \n    float Roughness = ceil(s1)*0.20+ceil(s2)*0.35+ceil(s3)*0.27+ceil(s4)*0.5;\n    \t  Roughness = mix(Roughness*1.5, Roughness*0.67, texture(iChannel1,8.0*uvr).x);\n       \n    vec3 vLight = normalize(vec3(fragCoord.xy,128.0)-vec3(iMouse.xy,0.0));\n    \n    vec3 vEye = vec3(0.0,0.0,-1.0);\n    \n    float Fresnel = 1.0-pow(clamp(dot(vNormal,-vEye),0.0,1.0),1.0);\n    \n    vec3 Environment = (1.0+Fresnel) * clamp(1.0*BlurTexture(uvr,iChannel0,SelectMip(Roughness)).xyz +\n                       3.0*clamp(texture(iChannel0,uvr,SelectMip(Roughness)+1.0).xxx-0.67,0.0,1.0),0.0,2.0);\n    \n    float sh = 0.75+0.25*clamp(dot(vNormal,vLight),0.0,1.0);\n    \n    vec3 sp = vec3(1.0-Roughness)*pow(clamp(dot(vNormal,normalize((vLight-vEye)*0.5)),0.0,1.0),1.0/(pow(Roughness+0.1,4.0)));\n    \n    vec3 fcol01 = mix(sh*BaseColor*Environment,mix(normalize(BaseColor)*2.5,vec3(1.5),0.4),sp);\n    \n    vec3 fcol02 = pow(1.375*texture(iChannel0,(0.2+uv)*vec2(0.4,-0.8),SelectMip(1.0)).xyz,vec3(1.5));\n\n    fragColor = vec4(mix(fcol02,fcol01,spm),1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4sBXRt","date":"1414709464","viewed":2058,"name":"Metal Materials","username":"mAlk","description":"Gold, Copper, Nickel, Iron","likes":19,"published":1,"flags":0,"usePreview":0,"tags":["2d","reflection","environment","ibl"],"hasliked":0,"parentid":"","parentname":""}}