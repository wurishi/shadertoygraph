{"ver":"0.1","info":{"id":"XsXfDB","date":"1497753820","viewed":513,"name":"Stereographic Projection Cubemap","username":"VoidChicken","description":"A stereo-graphic projection using a sphere with a cube map texture.","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["2d","3d","raymarch","cubemap","projection","stereographic"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsfGzn","filepath":"/media/a/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","previewfilepath":"/media/ap/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","type":"cubemap","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec2 _m(vec2 x,vec2 y){\n    return vec2((min(x.x,y.x)),(min(x.x,y.x)==x.x?x.y:y.y));\n}\nvec2 map(vec3 o) {\n    return _m(vec2(length(o)-1.,0.),vec2(o.y+1.,1.));\n}\nfloat trace(vec3 o,vec3 d){float t = 0.;for(int i=0;i<64;i++){t+=map(o+d*t).x;}return t;}\nconst float PI = acos(-1.);\nmat3 rm(vec3 axis, float angle)\n{\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1. - c;\n    \n    return mat3(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s, \n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s, \n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec3 d = vec3(uv*2.-1.,2.);\n    d.x*=iResolution.x/iResolution.y;\n    d=normalize(d);\n    vec2 ms = iMouse.xy/iResolution.xy;\n    vec3 o = vec3(0,0,-6);\n    mat3 r = rm(vec3(1,0,0),ms.y*PI)*rm(vec3(0,1,0),-ms.x*2.*PI);\n \to*=r;d*=r;\n    float t = trace(o,d);\n    vec3 h =o+d*t;\n    vec2 m = map(h);\n    vec3 c = vec3(1.);\n    \n    if (m.x<.01) \n    {\n        \n    \tif (m.y==1.) \n        {\n            vec3 P = h, L = vec3(0,1,0);\n\t\t\tvec3 N = L+normalize(P-L)/sin(mix(PI,0.,-normalize(P-L).y));\n            float ao = .1-map(P+vec3(0,.1,0)).x;\n            \n            c=texture(iChannel0, N).rgb-ao*2.;\n        }\n        else if (m.y==0.) {\n            float ao = .1-map(h+normalize(h)*.1).x;\n            c=texture(iChannel0, h).rgb-ao*2.;\n        }\n    }\n    c=mix(c,vec3(0),max(t<10.?0.:(t-10.)/5.,0.))*(1.-length(.5-uv));\n    \n    \n\tfragColor = mix(vec4(0),vec4(pow(c,vec3(1.2))*vec3(1.01,1.05,1),1),min(1.,iTime));\n}","name":"Image","description":"","type":"image"}]}