{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"music","id":"4dfGzn","filepath":"/media/a/ec8a6ea755d34600547a5353f21f0a453f9f55ff95514383b2d80b8d71283eda.mp3","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}}],"code":"//\"Glass Field\" by Kali\n\n#define lightcol1 vec3(0.1,0.2,.85)\n#define lightcol2 vec3(.05,.15,1.)\n\n\n\n\n//Rotation matrix by Syntopia\nmat3 rotmat(vec3 v, float angle)\n{\n\tfloat c = cos(angle);\n\tfloat s = sin(angle);\n\t\n\treturn mat3(c + (1.0 - c) * v.x * v.x, (1.0 - c) * v.x * v.y - s * v.z, (1.0 - c) * v.x * v.z + s * v.y,\n\t\t(1.0 - c) * v.x * v.y + s * v.z, c + (1.0 - c) * v.y * v.y, (1.0 - c) * v.y * v.z - s * v.x,\n\t\t(1.0 - c) * v.x * v.z - s * v.y, (1.0 - c) * v.y * v.z + s * v.x, c + (1.0 - c) * v.z * v.z\n\t\t);\n}\n\n//Smooth min by IQ\nfloat smin( float a, float b )\n{\n    float k = 0.5;\n\tfloat h = clamp( 0.5 + 0.5*(b-a)/k, 0.0, 1.0 );\n\treturn mix( b, a, h ) - k*h*(1.0-h);\n}\n\n\n//Distance Field\nfloat de(vec3 pos) {\n\tvec3 A=vec3(5.);\n\tvec3 p = abs(A-mod(pos,2.0*A)); //tiling fold by Syntopia\n\tfloat sph=length(p)- 5.0+sin(iTime)*1.5-texture(iChannel0, vec2(1.0, 1.0)).x * 2.8;\n\tfloat cyl=100.0;//length(p.xy)-.4;\n\t//cyl=min(cyl,length(p.xz))-.4;\n\t//cyl=min(cyl,length(p.yz))-.4;\n    return smin(cyl,sph);\n}\n\n// finite difference normal\nvec3 normal(vec3 pos) {\n\tvec3 e = vec3(0.0,0.001,0.0);\n\t\n\treturn normalize(vec3(\n\t\t\tde(pos+e.yxx)-de(pos-e.yxx),\n\t\t\tde(pos+e.xyx)-de(pos-e.xyx),\n\t\t\tde(pos+e.xxy)-de(pos-e.xxy)\n\t\t\t)\n\t\t);\t\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tfloat time = iTime*.6; \n\n\t//camera\n\tmat3 rotview=rotmat(normalize(vec3(1.)),sin(time*.6));\n\tvec2 coord = fragCoord.xy / iResolution.xy *2. - vec2(1.);\n\tcoord.y *= iResolution.y / iResolution.x;\n\tfloat fov=min((time*.2+.05),0.8); //animate fov at start\n\tvec3 from = vec3(cos(time)*2.,sin(time*.5)*10.,time*5.);\n\n\t//raymarch\n\tfloat totdist=0.;\n\tfloat distfade=1.;\n\tfloat glassfade=1.;\n\tfloat intens=1.;\n\tfloat maxdist=80.;\n\tfloat vol=0.;\n\tvec3 spec=vec3(0.);\n\tvec3 dir=normalize(vec3(coord.xy*fov,1.))*rotview; \n\tfloat ref=0.;\n\tvec3 light1=normalize(vec3(cos(time),sin(time*3.)*.5,sin(time)));\n\tvec3 light2=normalize(vec3(cos(time),sin(time*3.)*.5,-sin(time)));\n\tfor (int r=0; r<120; r++) {\n\t\tvec3 p=from+totdist*dir;\n\t\tfloat d=de(p);\n\t\tfloat distfade=exp(-1.5*pow(totdist/maxdist,1.5));\n\t\tintens=min(distfade,glassfade);\n\n\t\t// refraction\n\t\tif (d>0.0 && ref>.5) {\n\t\t\tref=0.;\n\t\t\tvec3 n=normal(p);\n\t\t\tif (dot(dir,n)<-.5) dir=normalize(refract(dir,n,1./.87));\n\t\t\tvec3 refl=reflect(dir,n);\n\t\t\tspec+=lightcol1*pow(max(dot(refl,light1),0.0),40.)*intens*.7;\n\t\t\tspec+=lightcol2*pow(max(dot(refl,light2),0.0),40.)*intens*.7;\n\n\t\t}\n\t\tif (d<0.0 && ref<.05) {\n\t\t\tref=1.;\n\t\t\tvec3 n=normal(p);\n\t\t\tif (dot(dir,n)<-.05) dir=normalize(refract(dir,n,.87));\n\t\t\tvec3 refl=reflect(dir,n);\n\t\t\tglassfade*=.75;\n\t\t\tspec+=lightcol1*pow(max(dot(refl,light1),0.0),40.)*intens;\n\t\t\tspec+=lightcol2*pow(max(dot(refl,light2),0.0),40.)*intens;\n\t\t}\n\t\t\n\t\ttotdist+=max(0.005,abs(d)); //advance ray \n\t\tif (totdist>maxdist) break; \n\n\t\tvol+=intens; //accumulate current intensity\n\t}\n\t\n\tvol=pow(vol,1.5)*.0005;\n\tvec3 col=vec3(vol)+vec3(spec)*.4+vec3(.05);\n\n\t//lights\n\tcol+=2.8*lightcol1*pow(max(0.,max(0.,dot(dir,light1))),10.)*glassfade; \n\tcol+=2.5*lightcol2*pow(max(0.,max(0.,dot(dir,light2))),10.)*glassfade; \n\t//col+=vec3(sin(time*10.)+1.,0.,0.)*.8*pow(max(0.,max(0.,dot(dir,vec3(0.,0.,1.)))),5.)*glassfade; \n\n\t\n\tcol*=min(1.,time); //fade in\n\n\tfragColor = vec4(col,1.0);\t\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4dS3zw","date":"1384900934","viewed":266,"name":"Glass","username":"Zou","description":"Based on Kali GlassField.","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["refraction"],"hasliked":0,"parentid":"","parentname":""}}