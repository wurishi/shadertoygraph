{"ver":"0.1","info":{"id":"XXlSzs","date":"1709849582","viewed":157,"name":"Flower Glade","username":"dd2d","description":"It's a small scene for the day of March 8. I also congratulate all women on this day.\nA huge thank you to \"miloyip\" for creating the rose - https://www.shadertoy.com/view/XsdyWr","likes":15,"published":1,"flags":0,"usePreview":0,"tags":["flower","rose"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define SCENE 4\n// 1 - violet\n// 2 - scarlet\n// 3 - white\n// 4 - all\n\n\nconst float PI = 3.14;\n\nconst vec3 sky = vec3(0.53,0.8,1.);\nconst vec3 violet = vec3(0.34,0.2,1.);\nconst vec3 scarlet = vec3(0.81,0.15,0.21);\nconst vec3 white = vec3(0.54,0.71,0.95);\nconst vec3 green = vec3(0.07,0.32,0.06);\n\nmat2 rote(float k){\n\tfloat cs = cos(k), sn = sin(k);\n\treturn mat2(vec2(cs,-sn), vec2(sn,cs));\n}\n\nmat3 rote3(vec2 k) {\n\tvec2 c = cos(k);\n\tvec2 s = sin(k);\n\treturn mat3(vec3(c.y,0.,-s.y), vec3(s.y*s.x,c.x,c.y*s.x), vec3(s.y*c.x,-s.x,c.y*c.x));\n}\n\nfloat box(vec3 p, vec3 b){\n\treturn length(max(abs(p) - b,0.));\n}\n\nfloat cylinder(vec3 p, float h, float r){\n\tvec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);\n\treturn min(max(d.x,d.y),0.) + length(max(d,0.));\n}\n\n\nfloat petal(vec3 p, float s){\n\tp *= vec3(0.6,1.2,0.6);\n    p.xy += 0.1;\n    \n\tvec2 q = vec2(length(p.xz), p.y);\n    \n\tfloat lower = max(length(q) - 1., q.y);\n\tfloat upper = length(q - vec2(s,0.)) - s;\n\tupper = max(max(-upper - 1., upper + 0.99), -q.y);\n    \n\treturn max(min(upper, lower), length(p - vec3(1.,0.,0.)) - 1.);\n}\nvec2 rose(vec3 p, vec2 id){\n\tfloat d, d2, s = 3., res = 3.;\n\tmat3 r = rote3(vec2(0.1, 6.32 * 0.618)) * mat3(vec3(1.08,0.,0.), vec3(0.,0.995,0.), vec3(0.,0.,1.08));\n\t\n\td = cylinder(p + vec3(0.,1.,0.), 1., 0.01 + 0.01*sin(30.*p.y))*0.2;\n\t\n\tint k = 8;\n    if (length(p) > 0.3) k = 1;\n    \n\tfor( int i=0; i<k; i++ ) {\n\t\td2 = petal(p*5., s)*0.2;\n        if( d > d2 ){\n            switch(SCENE){\n                case 1: res = 1.; break;\n                case 2: res = 0.; break;\n                case 3: res = 2.; break;\n                case 4: res = 10. + 2.*sin(length(id) + d);\n            }\n            d = d2;\n        }\n\t\tp = r*p + vec3(0.,-0.02,0.);\n\t\ts *= 1.05;\n    }\n\treturn vec2(d, res);\n}\n\n\nvec2 map(vec3 p){\n\tp.y += 1.;\n\tfloat d = 200., d0 = p.y + 1., res = 0.;\n    \n\tif( d > d0 ){ d = d0; res = 3.; }\n\t\n\tvec2 id = round(p.xz/1.1);\n    vec3 q = p;\n    q.xz = p.xz - id*1.1;\n\tq.y += 0.5*sin(30.*id.x + 0.3) - 0.4*cos(20.*id.y + 0.3) + 0.05*length(id);\n\tq *= rote3(0.1*(id + p.y));\n\t\n    vec2 d2 = rose(q, id);\n    if (d > d2.x){ d = d2.x; res = d2.y; }\n\t\n\tq = p;\n    q.xz += vec2(5.);\n    q.xz *= rote(2.);\n\tid = round(q.xz/1.1);\n\tq.xz = q.xz - 1.1*id;\n\tq.y += 0.1 + 0.2*sin(30.*id.x + 0.3) + 0.4*cos(20.*id.y + 0.3);\n\tq *= rote3(0.05*(id + p.y));\n\t\n    d2 = rose(q, id);\n    if( d > d2.x ){ d = d2.x; res = d2.y; }\n\t\n\tvec3 r = q * rote3(vec2(0.01*q.y)*length(id)); \n    r.xz *= rote(0.4*(id.x + id.y));\n\t\n    d0 = box(r + vec3(0.3,0.05*length(id),0.1), vec3(0.02,0.4,max(0.,0.2 - 0.65*p.y)));\n\td0 = max(p.y - 0.5, min(box(r + vec3(-0.3,1.-0.1*length(id),-0.1), vec3(0.02,0.5,max(0.,0.2 - 0.7*r.y))), d0));\n    if( d > d0 ){ d = d0; res = 3.; }\n\t\n    d0 = min(box(q + vec3(0.,5.5,0.), vec3(0.7,0.05*length(id) + 2.,0.7)), d);\n    if( d > d0 ){ d = d0; res = 4.; }\n\t\n\treturn vec2(max(p.y - 1.,d*0.6), res);\n}\n \n \n\nvec3 normal(vec3 p){\n\tvec2 e = vec2(5e-4,0.);\n\treturn normalize(map(p).x - vec3(map(p-e.xyy).x, map(p-e.yxy).x, map(p-e.yyx).x));\n}\n\nvec2 castRay(vec3 ro, vec3 rd){\n\tvec2 res = vec2(-1.); float t = 0.1;\n\t\n    for( int i=0; i<500 && t<46.; i++ ){\n\t\tvec2 h = map(ro + rd*t); t += h.x;\n\t\tif( abs(h.x) < 5e-3 ){ res = vec2(t, h.y); break; }\n\t}\n\treturn res;\n}\n\nfloat ao(vec3 p, vec3 n){\n    float r = 0., w = 1., d;\n    \n    for(float i=1.; i<6.; i++){\n        d = i*0.2;\n        r += w*(d - map(p + n*d).x);\n        w *= 0.5;\n    }\n    return 1. - clamp(r,0.,1.);\n}\n\nfloat shadow(vec3 ro, vec3 rd){\n    float s = 1.0, t = 0.02, h = 1.;\n    \n    for( int i=0; i<16; i++ ){\n        h = map(ro + rd*t).x;\n        s = min( s, 16.*h/t );\n        \n        if( s<0.01 ) break;\n        \n        t += clamp(h, 0.001, 0.02);\n    }\n    return clamp(s,.0,1.);\n}\n\nvec3 render(vec3 ro, vec3 rd){\n    vec2 res = castRay(ro, rd);\n\tvec3 p = ro + rd*res.x;\n\t\n    if( res.y < 0. ) return 0.5*sky.xyz - 0.2;\n    \n\tvec3 n = normal(p);\n\tvec3 lig = normalize(vec3(1.1,0.7,0.5));\n\t\n\tvec3 mate = white + 0.1*p.y;\n\tif( abs(res.y-1.) < 1e-2 || abs(res.y-8.) < 1. ){ mate = violet; }\n\telse if( abs(res.y-2.) < 1e-2 || abs(res.y-10.) < 1. ){ mate = scarlet; }\n\telse if( abs(res.y-3.) < 1e-2 ){ mate = green; }\n\telse if( abs(res.y-4.) < 1e-2 ){ mate = 0.9*green; }\n\t\t\n\tvec3 ld = normalize(vec3(1,1.5,-1.7));\n    float dif = 0.5*max(0.,dot(ld, n)) + 0.8;\n    float spe = pow(max(0.,dot(rd, reflect(ld, n))),24.)*0.5;\n    float bac = 0.1*max(0.,dot(-ld, n));\n    float amb = clamp(0.3 + 0.7*n.y,0.,1.);\n    float fre = 0.2*clamp(1. - dot(n, -rd),0.,1.);\n\n    float ao = ao(p, n)*0.5 + 0.5;\n    float sha = shadow(p, ld);\n    \n    vec3 col = (dif*sha*4. + bac+amb*sha*0.5 + fre*fre*fre*sha*10.)*mate*ao*ao + spe*sha*1.5 + mate*2.;\n    return 0.25*col;\n}\n\n\nvec3 direction(float fov, vec2 res, vec2 p){\n\treturn normalize(vec3(p - res*0.5, -res.y*tan((90. - fov*0.5) * PI/180.)*0.5)); }\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n\tvec3 rd = direction(20., iResolution.xy, fragCoord.xy);\n\tvec3 ro = vec3(0.,0.,10.+0.1*sin(0.1*iTime));\n\n\tmat3 rot= rote3(vec2(0.,0.01*iTime));\n    \n\trd *= rot; ro *= rot;\n\t\n\tvec3 col = render(ro, rd);\n    float r = 1. - 0.3*length(2.4*(fragCoord.xy/iResolution.xy) - vec2(1.2,1.3));\n    fragColor = vec4(col*r, 1.);\n}","name":"Image","description":"","type":"image"}]}