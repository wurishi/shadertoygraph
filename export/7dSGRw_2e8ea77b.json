{"ver":"0.1","info":{"id":"7dSGRw","date":"1617114687","viewed":199,"name":"Gyroid Marching","username":"kithy","description":"gyroid marching","likes":10,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","gyroid","fisheyecamera"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define MAX_STEPS 64\n#define MAX_DIST 64.0\n#define EPS 0.0001\n\nmat2 Rot(float a){\n\tfloat s=sin(a);\n\tfloat c=cos(a);\n\treturn mat2(c,-s,s,c);\n}\n\nfloat sdSphere(vec3 p){\n\treturn length(p)-0.9;\n}\n\nfloat sdGyroid(vec3 p,float scale,float tickness){\n\tp*=scale;\n\treturn abs(dot(sin(p),cos(p.zxy))-1.0)/scale-tickness;\n}\n\nfloat GetDist(vec3 p){\n\tp=mod(p,2.0)-1.0;\n\n\tp.xy*=Rot(iTime);\n\tp.yz*=Rot(iTime);\n\n\tfloat sphere=sdSphere(p);\n\tfloat gyroid=sdGyroid(p,8.0-sin(iTime),0.09);\n\tfloat d=max(sphere,gyroid);\n\n\treturn d;\n}\n\nfloat RayMarch(vec3 ro,vec3 rd){\n\tfloat dO=0.0;\n\n\tfor(int i=0;i<MAX_STEPS;i++){\n\t\tvec3 p=ro+rd*dO;\n\t\tfloat dS=GetDist(p);\n\t\tdO+=dS;\n\t\tif(dS<EPS)break;\n\t}\n\treturn dO;\n}\n\nvec3 GetNormal(vec3 p){\n\tfloat d=GetDist(p);\n\tvec2 e=vec2(EPS,0.0);\n\n\tvec3 n=d-vec3(\n\t\tGetDist(p-e.xyy),\n\t\tGetDist(p-e.yxy),\n\t\tGetDist(p-e.yyx));\n\treturn normalize(n);\n}\n\nvec3 GetRayDir(vec2 uv,vec3 p,vec3 l,float z){\n\tvec3 f=normalize(l-p);\n\tvec3 r=normalize(cross(vec3(0.0,1.0,0.0),f));\n\tvec3 u=cross(f,r);\n\tvec3 c=f*z;\n\tvec3 i=c+uv.x*r+uv.y*u;\n\tvec3 d=normalize(i);\n\treturn d;\n}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\tvec2 uv=(fragCoord-0.5*iResolution.xy)/iResolution.y;\n\n\tvec3 ro=vec3(0.0,0.0,-iTime);\n\t//vec3 rd=GetRayDir(uv,ro,vec3(0.0),1.0);\n\n\tvec3 rd=normalize(vec3(uv,(1.0-dot(uv,uv)*0.5)*0.5));//fish eye\n\n\trd.xy*=Rot(iTime*0.5);\n\trd.yz*=Rot(iTime*0.5);\n\n\tvec3 col=vec3(0.0);\n\tfloat d=RayMarch(ro,rd);\n\tvec3 n;\n\n\tif(d<MAX_DIST){\n\t\tvec3 p=ro+rd*d;\n\t\tn=GetNormal(p);\n\t\tvec3 r=reflect(rd,n);\n\t\t\n\t}\n\t\n\tfragColor=vec4(n*0.5+0.5,1.0);\n}\n","name":"Image","description":"","type":"image"}]}