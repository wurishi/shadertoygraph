{"ver":"0.1","info":{"id":"4fVyWD","date":"1731949515","viewed":22,"name":"First3d","username":"trexarms","description":"Simple raymarch","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["3d","raymarch"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nfloat smin(float x, float y) {\n    float k = 15.0;\n    return -log(exp(-k*x)+exp(-k*y))/k;\n}\n\nfloat SDF_sphere(vec3 p, float r) {\n    return length(p) - r;\n}\n\nfloat SDF_ground(vec3 p) {\n    return p.y+0.7;\n}\n\n#define INF 1e4\n#define TOL 1e-3\nfloat SDF_world(vec3 p) {\n    float d = INF;\n    d = min(d, SDF_sphere(p-vec3(0.,0.1,0.5),0.3));\n    d = smin(d, SDF_sphere(p-vec3(0.5,-0.2,0.5),0.3));\n    d = smin(d, SDF_sphere(p-vec3(-0.4*sin(iTime),0.5*cos(iTime),0.3),0.1));\n    d = smin(d, SDF_ground(p));\n    return d;\n}\n\nvec3 SDF_world_grad_dir(vec3 p) {\n    vec2 h = vec2(1e-3,0);\n    float d = SDF_world(p);\n    return normalize(vec3(SDF_world(p+h.xyy)-d,\n                          SDF_world(p+h.yxy)-d,\n                          SDF_world(p+h.yyx)-d));\n}\n\nvec3 raymarch(vec3 o, vec3 ray) {\n    vec3 p = o;\n    float sdf = SDF_world(p);\n    float d = sdf;  \n    int cnt = 0;\n    while (abs(sdf) > TOL && abs(sdf) < INF && cnt < 100) {\n        p = o + d * ray;\n        sdf = SDF_world(p);\n        d += sdf;\n        cnt++;\n    }\n    return p;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = (fragCoord-iResolution.xy/2.0)/iResolution.y;\n\n    // light\n    vec3 light = vec3(-5.5*sin(0.2*iTime), 1.7, 0.5);\n    \n    vec3 co  = vec3(0.,0.,-1.);\n    vec3 ray = normalize((vec3(uv,0)-co));\n    vec3 hit = raymarch(co,ray);\n    vec3 light_dir = normalize(light - hit);\n    vec3 lhit = raymarch(hit+0.01*light_dir,light_dir);\n    float shadow = smoothstep(0.00,0.01,SDF_world(lhit));\n    vec3 n = SDF_world_grad_dir(hit);\n    \n    vec3 refl = ray-2.0*dot(ray,n)*n;\n    //float spec = smoothstep(0.99,1.,dot(refl,light_dir));\n    float spec = pow(dot(refl,light_dir),25.0);\n    \n    float pix = dot(light_dir,n)*(0.1+0.9*shadow)+spec*shadow;\n    \n\n    //vec3 col = raymarch(vec3(uv,0.),vec3(0.,0.,1.));\n    //vec3 col = SDF_world_grad_dir(vec3(3.*uv,0.5));\n    //vec3 col = SDF_world_grad_dir(hit);\n    //vec3 col = vec3(light_dir);\n    vec3 col = vec3(pix);\n\n    // Output to screen\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}