{"ver":"0.1","info":{"id":"ttjXWV","date":"1567189297","viewed":74,"name":"Test: Counter","username":"g2_xpf","description":"A counter with the texture to store some values.\nEach time you click, the display turns white. Click 10 times to return.","likes":1,"published":1,"flags":32,"usePreview":0,"tags":["counter"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const ivec2 DATA_LOC = ivec2(0, 0);\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n    // memory layout:\n    //     iChannel0[0][0]: { counter: float, _, prev_clicked: vec2 }\n    \n    // get the counter value \"cnt\" where cnt \\in [0.0, \\infty)\n    float cnt = texelFetch(iChannel0, DATA_LOC, 0).x;\n    \n    fragColor = vec4(vec3(fract(cnt)), 1.);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"const float EPS = 1e-3;\nconst ivec2 DATA_LOC = ivec2(0, 0);\n\nvec4 read(ivec2 coord){\n\treturn texelFetch(iChannel0, coord, 0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    ivec2 fc = ivec2(fragCoord);\n    \n    if(iFrame == 0) {\n        // initialization\n        // memory layout:\n        //     iChannel0[0][0]: { counter: float, _, prev_clicked: vec2 }\n        fragColor = (fc == DATA_LOC) ? vec4(0., -1., iMouse.zw) : vec4(1.);\n    \treturn;\n    }\n    \n    vec4 data = read(DATA_LOC);\n    \n    float cnt = data.x;\n    ivec2 prevClick = ivec2(data.zw);\n    \n    if(ivec2(iMouse.zw) != prevClick && fc == DATA_LOC) {\n        if(iMouse.z > 0.) {\n            // clicked\n        \tfragColor.x = cnt + .1;\n        }else {\n           // released\n        \tfragColor.x = cnt;\n        }\n      \n        fragColor.y = -1.;\n        fragColor.zw = iMouse.zw;\n\t}else{\n         // steady state\n    \tfragColor = read(fc);// data;\n    }\n}","name":"Buffer A","description":"","type":"buffer"}]}