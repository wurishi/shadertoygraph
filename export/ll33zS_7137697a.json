{"ver":"0.1","info":{"id":"ll33zS","date":"1469878136","viewed":790,"name":"014 environment map","username":"kakaxizhhgjh","description":"environment map, sky box","likes":8,"published":1,"flags":0,"usePreview":0,"tags":["skybox","environmentmap"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsfGzn","filepath":"/media/a/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","previewfilepath":"/media/ap/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","type":"cubemap","channel":0,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float sphere(vec3 p) {\n\treturn length(p) - 2.5;\n}\n\nfloat trace(vec3 ro, vec3 rd) {\n\tfloat d, t = 0.0;\n    for(int i = 0; i < 48; ++i) {\n    \td = sphere(ro + t * rd);\n        if(abs(d) < 0.01) return t;\n        if(t > 100.0) return -1.0;\n        t += d;\n    }\n    return -1.0;\n}\n\nvec3 getNormal(vec3 p) {\n\tvec3 eps = vec3(0.001, 0.0, 0.0);\n    return normalize(vec3(\n        sphere(p + eps.xyy) - sphere(p - eps.xyy),\n        sphere(p + eps.yxy) - sphere(p - eps.yxy),\n        sphere(p + eps.yyx) - sphere(p - eps.yyx)\n    ));\n}\n\nmat3 getCamera(vec3 z) {\n\tvec3 x = normalize(cross(vec3(0.0, 1.0, 0.0), z));\n    return mat3(x, cross(z, x), z);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n\tvec2 uv = (fragCoord * 2.0 - iResolution.xy) / iResolution.y;\n    vec2 mo = iMouse.xy / iResolution.y * 5.0;\n    vec3 ro = vec3(5.0 * sin(mo.x), 0.0, 5.0 * cos(mo.x));\n    vec3 rd = getCamera(normalize(ro)) * normalize(vec3(uv, -1.0));\n    \n    float t = trace(ro, rd);\n    if(t != -1.0) {\n        vec3 p = ro + t * rd;\n    \tvec3 n = getNormal(p);\n        vec3 l = reflect(rd, n);\n        fragColor = texture(iChannel0, l);\n    } else {\n        fragColor = texture(iChannel0, rd);\n    }\n}","name":"Image","description":"","type":"image"}]}