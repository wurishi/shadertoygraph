{"ver":"0.1","info":{"id":"tsjXzz","date":"1552793245","viewed":181,"name":"volumetric light propagation","username":"Carandiru","description":"workinprogresstheory","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["lighting","volumetric","propogation"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdX3Rr","filepath":"/media/a/aea6b99da1d53055107966b59ac5444fc8bc7b3ce2d0bbb6a4a3cbae1d97f3aa.bin","previewfilepath":"/media/ap/aea6b99da1d53055107966b59ac5444fc8bc7b3ce2d0bbb6a4a3cbae1d97f3aa.bin","type":"volume","channel":0,"sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define TAU 6.2831853071\n#define NUM_LIGHTS 3\n\nvec2 uv;\n\nvec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 255.0 / 3.0, 255.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvoid updateField(inout vec2 f, vec3 p) {\n    vec2 dispvec = uv-p.xy;\n    vec2 dir = normalize(dispvec);\n    float len = length(dispvec);\n    float mag = p.z/(len*len);\n    f += (f,dir*mag);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tuv = fragCoord.xy / iResolution.xy;\n    uv = uv * 2.0 - 1.0;\n    uv.x *= iResolution.x / iResolution.y;\n    //uv.y *= iResolution.y / iResolution.x;\n    \n    vec2 field = vec2(0.0);\n    \n    vec3 p[NUM_LIGHTS];\n    \n    for ( int i = 0 ; i < NUM_LIGHTS ; ++i )\n    {\n        float ii = float(i);\n        p[i] = texture(iChannel0, vec3(cos(TAU*iTime*0.001f+iTime*0.1f), \n                                       sin(TAU*iTime*0.001f+iTime*0.1f),\n                                       ii/float(NUM_LIGHTS) * 2.0f)).xyz;\n        \n        updateField(field, p[i] * 2.0f - 1.0f);\n    }\n    \n    float direction = atan(field.y, field.x)/TAU;\n    float intensity = 1.0-1.0/(1.0+length(field));\n    \n    vec3 col = hsv2rgb( vec3(direction, 1.5+0.5-intensity, intensity) );\n    col = pow(col, vec3(0.45));\n    \n\tfragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}