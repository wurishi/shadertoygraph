{"ver":"0.1","info":{"id":"lcscDr","date":"1721042292","viewed":34,"name":"UInt Right Shift ANGLE Bug","username":"TinyTexel","description":"Seems like ANGLE performs a signed right shift if the uint to be shifted is a literal and the shift amount isn't.\nThe bits of the shift result are shown as white vertical bars (least significant bit is on the right).\nFor me the top third is white. ","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["shader"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"/*\n    Seems like ANGLE performs a signed right shift if the uint to be shifted is a literal and the shift amount isn't.\n    The bits of the shift results are shown as white vertical bars (least significant bit is on the right).\n    For me the top third is completely white (all bits set).\n    \n    Minimalist testing setup: https://www.shadertoy.com/view/4ffyW8\n    \n    \n    Twitter thread: https://x.com/Mirko_Salm/status/1812814974248427585\n*/\n\n// uint to be shifted\n#define NUM 0x80000000u\n\n// shift amount\n#define SHIFT 31u\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    bool isBottom = fragCoord.y < iResolution.y * (1.0/3.0);\n    bool isTop    = fragCoord.y > iResolution.y * (2.0/3.0);\n    \n    uint shift = SHIFT;\n    uint num = NUM;\n    \n    uint bits;\n    \n    // 3 code variations that should all be equivalent:\n    if(isTop)\n    {\n        // top\n        bits = NUM >> shift;// this appears to perform a signed right shift (if ANGLE is active)\n    }\n    else if(!isBottom)\n    {\n        // middle\n        bits = num >> SHIFT;\n    }\n    else\n    {\n        // bottom\n        bits = num >> shift;\n        //bits = NUM >> SHIFT;\n    }\n    \n    // show resulting bit pattern:\n    uint bitNum = uint(floor((1.0 - fragCoord.x / iResolution.x) * 32.0));\n\n    //bits = NUM;\n    float result = (bits & (1u << bitNum)) != 0u ? 1.0 : 0.0;\n\n    fragColor = vec4(result);// white == bit set\n}","name":"Image","description":"","type":"image"}]}