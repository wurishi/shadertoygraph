{"ver":"0.1","info":{"id":"DsGfzz","date":"1697802595","viewed":62,"name":"Viewshed demo","username":"aiken","description":"Shows all points visible from some other point, where a texture's value is the height at each point (select with the mouse).","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["heightmap","viewshed"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Shows all points visible from some other point, where a texture's\n// value is the height at each point (select with the mouse).  Do what\n// you like with this code.\n\n// How far above the height map to view from\n#define HEIGHT .01\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    // Choose a place if there's no input yet\n    vec2 mouseUv = (length(iMouse.xy) < 2.)\n        ? vec2(.48, .89)\n        : iMouse.xy / iResolution.xy;\n\n    float srcValue = texture(iChannel0, mouseUv).x;\n    float destValue = texture(iChannel0, uv).x;\n    \n    // How many pixels to visit\n    vec2 diff = abs(fragCoord - iMouse.xy);\n    float step = 1. / max(diff.x, diff.y);\n    vec4 target = vec4(texture(iChannel0, uv).xxx, 1.);\n    for (float t = 0.; t < 1.; t += step) {\n        float targetHeight = mix(srcValue, destValue, t);\n        float val = texture(iChannel0, mix(mouseUv, uv, t)).x;\n        if (val - HEIGHT > targetHeight)\n            target.yz = vec2(0.);\n    }\n    \n    fragColor = target;\n}","name":"Image","description":"","type":"image"}]}