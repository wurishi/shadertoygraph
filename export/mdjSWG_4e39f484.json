{"ver":"0.1","info":{"id":"mdjSWG","date":"1670838324","viewed":254,"name":"Live Code CdA Enghien 28/11/22","username":"NuSan","description":"Shader coded live during a performance at Centre des Arts d'Enghien-les-Bains (28 november 2022)\nOnly parts in map and mainImage function where coded live, the rest was a pre-made template","likes":14,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","live"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Shader coded live during a performance at Centre des Arts d'Enghien-les-Bains (28 november 2022)\n// Only parts in map and mainImage function where coded live, the rest was a pre-made template\n\nfloat time;\n\n//////// FUNCTIONS ////////\nmat2 rot(float a) {float ca=cos(a); float sa=sin(a); return mat2(ca,sa,-sa,ca);}\nfloat box(vec3 p, vec3 s) {p=abs(p)-s; return max(p.x,max(p.y,p.z));}\nfloat cyl(vec3 p, float r, float h) {return max(abs(p.y)-h,length(p.xz)-r);}\nfloat rep(float p, float s) {return (fract(p/s+0.5)-0.5)*s;}\nvec2 rep(vec2 p, vec2 s) {return (fract(p/s+0.5)-0.5)*s;}\nvec3 rep(vec3 p, vec3 s) {return (fract(p/s+0.5)-0.5)*s;}\nfloat rnd(float t) {return fract(sin(t*452.714)*352.654);}\nvec3 rnd3(vec3 t) {return fract(sin(t.xyz*452.714+t.yzx*741.969+t.zxy*264.878)*352.654);}\nfloat curve(float t, float d) {t/=d; return mix(rnd(floor(t)), rnd(floor(t)+1.0), pow(smoothstep(0.0,1.0,fract(t)),10.0));}\nfloat curvetime(float t, float d) {t/=d; return mix(floor(t)+rnd(floor(t)), floor(t)+1.0+rnd(floor(t)+1.0), pow(smoothstep(0.0,1.0,fract(t)),10.0));}\n\nfloat oo=0.0;\nfloat m1=0.0;\nfloat map(vec3 p) {\n    vec3 bp=p;\n    float mm=10000.0;\n    float oc=0.0;\n    for(float i=0.0; i<3.0; ++i) {\n        p.xz *= rot(curvetime(time+i*0.2,1.7)*0.7);\n        p.yz *= rot(sin(curvetime(time+i*0.3,2.7)*1.4)*1.2);\n        oc+=sign(p.x)*(0.05+0.1*i*i);\n        mm=min(mm, abs(p.x));\n        float ee=curve(time+oc*3.0, 0.6)*curve(time+oc*3.0+17.0, 0.7)*5.0;\n        p=abs(p)-1.3-i*0.3+curve(time+rnd(oc)*7.0,0.6)-ee;\n        //p.y-=curve(time, 1.3)*curve(time, 1.4)*curve(time, 1.5)*5;\n    }\n    oo=oc;\n\n    m1=mm-smoothstep(0.1,0.2,sin(p.x*2.0+p.y*4.0-time))*10.0;\n    float d=box(p, 0.1+vec3(1)*rnd3(oc+vec3(17.3,3.8,52.7)));\n    d=min(d, max(mm-0.1, length(bp)-5.0));\n    d=min(d, max(abs(mm)-0.0, 0.1));\n    float d3=length(abs(p.xy)-0.5)-0.05;\n    d3=min(d3, length(abs(p.xz)-0.5)-0.05);\n    d=min(d, max(d3, length(bp)-4.0-rnd(oc)*15.0));\n      return d;\n}\n\n//////// MAP ////////\nvec3 norm(vec3 p, float o) {vec2 off=vec2(o,0); return normalize(map(p)-vec3(map(p-off.xyy), map(p-off.yxy), map(p-off.yyx)));}\nfloat gao(vec3 p, vec3 n, float d) {return smoothstep(0.0,1.0,map(p+n*d)/d)*0.5+0.5;}\nfloat tao(vec3 p, vec3 n) {return gao(p,n,0.25)*gao(p,n,0.5)*gao(p,n,1.0);}\nfloat fog(vec3 p, vec3 s) {return 1.0-clamp(length(p-s)/100.0,0.0,1.0);}\nvec2 grid(vec2 uv, vec2 s) {return floor(uv*s)/s;}\nfloat lamb(vec3 n, vec3 l) {return max(0.0, dot(n,l));}\nfloat spec(vec3 n, vec3 r, vec3 l) {return max(0.0, dot(n,normalize(l-r)));}\nfloat fre(vec3 n, vec3 r, float po) {return pow(1.0-abs(dot(n,r)),po);}\n\n//////// LIGHT ////////\nvec3 lum(vec3 p, vec3 s, vec3 r) {\n  vec3 col=vec3(0);\n  float ff=fog(p,s);\n  vec3 n=norm(p,0.01);\n  vec3 l=normalize(vec3(-1,3,-2));\n  float ao=tao(p,n);\n  col += lamb(n,l) * ff * ao * (0.5 + pow(spec(n,r,l),10.0));\n  col += fre(n,r,3.0) * vec3(0.3,0.5,1) * ff * ao;\n  return col;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = vec2(fragCoord.x / iResolution.x, fragCoord.y / iResolution.y);\n\tuv -= 0.5;\n\tuv /= vec2(iResolution.y / iResolution.x, 1);\n\n    time=mod(iTime*0.7, 200.);\n    time+=rnd(floor((time-length(uv))/10.0))*300.0;\n\n    //if(curve(time*3.0-length(uv)*6.0,0.4)<0.3) uv=grid(uv, vec2(60));\n\n    vec3 col=vec3(0);\n\n    vec3 s=vec3(curve(time, 1.6)*14.0-7.0,0,-10.0-20.0*curve(time, 1.3));\n    vec3 r=normalize(vec3(uv, 0.3+curve(time, 0.7)));\n\n    vec3 p=s;\n    int count=0;\n    for(int i=0; i<50; ++i) {\n        float d=abs(map(p));\n        if(d<0.01) {\n\n            vec3 n=norm(p,0.01);\n            r=reflect(r,n);\n            col += lum(p,s,r);\n            d=0.2;\n            count+=1;\n\n            if(count>3) break;\n        }\n        if(d>100.0) break;\n        p+=r*d;\n        col += vec3(1,0.5+oo,0.3-oo)*0.02/(0.01+abs(m1)+0.5*length(p));\n    }\n\n    col.xz *= rot(time*0.3+step(abs(uv.x),0.5*curve(time, 0.3))+abs(uv.y));\n    col.xy *= rot(time*0.2+abs(uv.x));\n    col=abs(col);\n\n    col *= 1.2-length(uv);\n\n    col = smoothstep(0.0,1.0,col);\n    col = pow(col, vec3(0.4545));\n \n    fragColor = vec4(col, 1);\n}","name":"Image","description":"","type":"image"}]}