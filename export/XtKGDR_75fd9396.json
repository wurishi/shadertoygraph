{"ver":"0.1","info":{"id":"XtKGDR","date":"1474173632","viewed":331,"name":"walk in cubemap","username":"wachel","description":"box projected cubemap","likes":14,"published":1,"flags":0,"usePreview":0,"tags":["cubemap","projected"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsfGzn","filepath":"/media/a/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","previewfilepath":"/media/ap/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","type":"cubemap","channel":0,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI 3.1415926\n\nvec3 render(in vec3 ro, in vec3 rd)\n{\n    vec3 emax = vec3(12.5,7.0,2.0);\n    vec3 emin = vec3(-20.0,-0.50,-2.0);\n    vec3 epos = vec3(0.0);\n    \n    vec3 rbmax = (emax - ro)/rd;\n    vec3 rbmin = (emin - ro)/rd;\n    vec3 rbminmax = vec3(rd.x > 0.0 ? rbmax.x: rbmin.x,rd.y > 0.0 ? rbmax.y: rbmin.y,rd.z > 0.0 ? rbmax.z: rbmin.z);\n\tfloat fa = min(min(rbminmax.x,rbminmax.y),rbminmax.z);\n    vec3 pos_on_box = ro + rd*fa;\n    vec3 dir = normalize(pos_on_box - epos);\n    return texture(iChannel0, dir).xyz; \n}\n\nvec3 rayDir(in vec3 dir, in vec3 up ,in vec3 uvw)\n{\n\tvec3 uu = normalize( cross(up,dir) );\n\tvec3 vv = normalize( cross(dir,uu) );\n    return normalize(uu * uvw.x + vv * uvw.y + dir * uvw.z);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n\tfloat pixelSize = tan(PI / 6.0) * 2.0 / iResolution.y;\n\tvec2 p = (fragCoord.xy - iResolution.xy * 0.5) * pixelSize;\n\t\n    float yaw = iMouse.x * 0.05;\n    float pitch = clamp(iMouse.y * 3.0 /iResolution.y,-PI * 0.5,PI * 0.5) - 0.9;\n    \n    if(iMouse.x == 0.0 && iMouse.y == 0.0){\n        yaw = PI / 2.0;\n        pitch = 0.001;\n    }\n    \n    float x = sin(iTime) * 3.0;\n    float y = (sin(iTime * 0.75) * 0.5 + 0.5) * 2.0;\n    float z = cos(iTime) * 1.0;\n    vec3 camPos = vec3(x,y,z);\n    vec3 camDir = vec3(sin(yaw) * cos(pitch),sin(pitch),cos(yaw) * cos(pitch));\n    vec3 ro = camPos;\n\tvec3 rd = rayDir(camDir,vec3(0.0,1.0,0.0),vec3(p,1.0));\n\n    vec3 col = render(ro, rd);\n\n    fragColor = vec4(col, 1.0);\n}","name":"Image","description":"","type":"image"}]}