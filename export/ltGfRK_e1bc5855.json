{"ver":"0.1","info":{"id":"ltGfRK","date":"1543122106","viewed":141,"name":"Another Cubic Crystallograph","username":"khlorghaal","description":"I math only a little and suddenly the void awakens","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["raytrace","crystal"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define ETA 1e-5\n\n#define PI 3.14159265359\n#define TAU (PI*2.)\n\n#define time float(iTime)\n\nprecision highp float;\n\n\nmat3 rotx(float t){\n    float c= cos(t);\n    float s= sin(t);\n    \n    return mat3(\n        1, 0, 0,\n        0, c,-s,\n        0, s, c\n    );\n}\nmat3 roty(float t){\n    float c= cos(t);\n    float s= sin(t);\n    \n    return mat3(\n         c,0,s,\n         0,1,0,\n    \t-s,0,c\n    );\n}\nmat3 rotz(float t){\n    float c= cos(t);\n    float s= sin(t);\n    \n    return mat3(\n        c,-s,0,\n        s, c,0,\n    \t0, 0,1\n    );\n}\n\nfloat f(vec3 p){\n    p= mod(p,1.)*2.-1.;\n\treturn dot(p,p)-.99;\n}\n\n#define MARCHES 128\nfloat raytrace(vec3 orig, vec3 dir){\n    float a= 0.;\n    vec3 ray= orig;\n    for(int i=0; i!=MARCHES; i++){\n        vec3 osc= sin(vec3(time)*vec3(.25,.5,1.));\n\t\tfloat t= osc.x*osc.y*osc.z*8.;\n        ray+= dir*t;\n        a+= f(ray);\n    }\n    return a;\n}\n\nvec3 subsample(vec2 fc){\n    vec2 res= iResolution.xy;\n    vec2 uv = fc/res;\n    vec2 uvn= uv*2.-1.;\n    uvn.y*= res.y/res.x;\n    \n    vec2 r= (iMouse.xy/iResolution.xy)*PI;\n    \n    r= vec2(-.125,.25)*PI;\n    \n    vec3 d= vec3(uvn*2., 1);\n    d= rotx(-(r.y-PI/2.))*d;\n    d= roty(r.x*2.-PI/2.)*d;\n    d= normalize(d);//its boring without this\n    \n    vec3 ca= vec3(0.);\n    vec3 cb= vec3(1.);\n    \n    float a= raytrace(vec3(0.),d);\n    \n    return mix(ca,cb, a);\n}\n#define SS 3\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n    vec2 fc = fragCoord;\n    \n    vec3 c= vec3(0);\n    for(int y=0; y!=SS; y++){\n    \tfor(int x=0; x!=SS; x++){\n            c+= subsample(fc + (vec2(x,y)/float(SS)) );\n        }\n    }\n    c/=float(SS*SS);\n    //c= pow(c,vec3(1./2.2));\n    fragColor= vec4(c,1);\n}","name":"Image","description":"","type":"image"}]}