{"ver":"0.1","info":{"id":"3tfGz4","date":"1555774189","viewed":234,"name":"Fk and IK","username":"mxr233","description":"A simple test.\n\nYou can use the 'q' or 'w' to switch this state.\n","likes":9,"published":1,"flags":16,"usePreview":0,"tags":["test","ik","keyboard","fk","inversekinematics"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define maxbone 10\nconst int keycode_q =81;\nconst int keycode_w =87;\nfloat langle;\nstruct Bone{\n    vec2 head,tail;\n    float angle,len;\n}FKbone[3],IKbone[2];\nfloat line( vec2 a, vec2 b, vec2 p )\n{\n\tvec2 pa = p - a;\n\tvec2 ba = b - a;\n\tfloat h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n\t\n\treturn length( pa - ba*h )+ 0.05;\n}\nfloat circle(vec2 uv,float r)\n{\n    return length(uv)-r;\n}\nBone setbone(vec2 head,float angle,float len)\n{\n  Bone t;\n  t.head=head;\n  t.angle=angle;\n  t.len=len;\n  t.tail=t.head+vec2(len*cos(angle),len*sin(angle));\n  return t;\n}\nvoid follow(inout Bone a,vec2 p)\n{\n    vec2 n=normalize(p-a.head);\n    a.angle=atan(n.y,n.x);\n    a.head=p+n*a.len*-1.;\n}\nvoid updateIK(vec2 mo)\n{\n    follow(IKbone[1],mo);\n    follow(IKbone[0],IKbone[1].head);\n    //IKbone[0]=setbone(IKbone[0].head,IKbone[0].angle,IKbone[0].len);\n    IKbone[0]=setbone(vec2(0.6,0.2),IKbone[0].angle,IKbone[0].len);\n    IKbone[1]=setbone(IKbone[0].tail,IKbone[1].angle,IKbone[1].len);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n   \n    vec3 color=vec3(0,0,0);\n    vec2 uv = (2.*fragCoord-iResolution.xy)/iResolution.y;\n     if(uv.x<0.02&&uv.x>0.){\n         fragColor=vec4(1,1,1,1);\n         return;\n    }\n    vec2 mouseUV=(2.*iMouse.xy-iResolution.xy)/iResolution.y;\n    vec2 root=vec2(-1.2,0.2);\n    vec2 tuv=mouseUV-root;\n    float angle=atan(tuv.y,tuv.x);\n    float par,chd;\n    float pressq=texelFetch( iChannel0, ivec2(keycode_q,0), 0 ).x;\n    float preesw=texelFetch( iChannel0, ivec2(keycode_w,0), 0 ).x;\n    if(pressq> 0.){\n        FKbone[0]=setbone(root,0.,0.3);\n        tuv=mouseUV-FKbone[0].tail;\n        FKbone[1]=setbone(FKbone[0].tail,-0.5*-atan(tuv.y,tuv.x)+FKbone[0].angle,0.3);\n        FKbone[2]=setbone(FKbone[1].tail,-0.5+FKbone[1].angle,0.3);\n        par=circle(uv-FKbone[1].head,0.01);\n        chd=circle(uv-FKbone[0].head,0.01);\n        chd=min(chd,circle(uv-FKbone[2].head,0.01));\n        chd=min(chd,circle(uv-FKbone[2].tail,0.01));\n    }     \n    else {\n        FKbone[0]=setbone(root,0.5*angle,0.3);\n        FKbone[1]=setbone(FKbone[0].tail,-0.5+FKbone[0].angle,0.3);\n        FKbone[2]=setbone(FKbone[1].tail,-0.5+FKbone[1].angle,0.3);\n        par=circle(uv-FKbone[0].head,0.01);\n        chd=circle(uv-FKbone[1].head,0.01);\n        chd=min(chd,circle(uv-FKbone[2].head,0.01));\n        chd=min(chd,circle(uv-FKbone[2].tail,0.01));\n    }\n    //IK\n    \n    IKbone[0]=setbone(vec2(0.6,0.2),.2,.3);\n    IKbone[1]=setbone(IKbone[0].tail,-0.8,.3);\n    if(preesw>0.)\n\t\tupdateIK(vec2(max(0.,mouseUV.x),mouseUV.y));\n    par=min(par,circle(uv-IKbone[0].head,0.01));\n   \tchd=min(chd,circle(uv-IKbone[0].tail,0.01));\n \tfloat ik=line(IKbone[0].head,IKbone[0].tail,uv);\n    ik=min(ik,line(IKbone[1].head,IKbone[1].tail,uv));\n    float t=line(FKbone[0].head,FKbone[0].tail,uv);\n    \n    \n    t=min(t,line(FKbone[1].head,FKbone[1].tail,uv));\n    t=min(t,line(FKbone[2].head,FKbone[2].tail,uv));\n    \n    color=mix(color,vec3(1,1,1),smoothstep(0.06,0.05,t));\n    color=mix(color,vec3(1,1,1),smoothstep(0.06,0.05,ik));\n    color=mix(color,vec3(1,0,0),smoothstep(0.02,0.01,par));\n    color=mix(color,vec3(1,1,1),smoothstep(0.02,0.01,chd));\n    color=mix(color,vec3(1,1,0),smoothstep(0.02,0.01,circle(uv-IKbone[1].tail,0.01)));\n   // updatematrix(3);\n    // Output to screen\n   \n    fragColor = vec4(color,1.0);\n}","name":"Image","description":"","type":"image"}]}