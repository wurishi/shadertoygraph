{"ver":"0.1","info":{"id":"wdlGzS","date":"1546759744","viewed":141,"name":"Data Stuff","username":"rory618","description":"Some functions for storing lower precision mat4 in a vec4.","likes":2,"published":1,"flags":32,"usePreview":0,"tags":["pack","minifloat","packunorm4x8","unpackunorm4x8"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n\n    mat4 data = unpackvec4Tomat4(texture(iChannel0, uv))/32768.;\n    \n    fragColor = data[int(dot(vec2(lessThan(iMouse.x>0.?iMouse.xy/iResolution.xy:vec2(.5),uv)),vec2(1,2)))];\n\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"float uintToMinifloat(uint i){\n    if((i&0xFFu)==0u) return 0.;\n    float mantissa = float(i&7u);\n    float exponent = float((i>>3)&15u);\n    float sgn = float((i>>7)&1u);\n    return (mantissa/8.+1.)*exp2(exponent)*(sgn*2.-1.);\n}\n\nuint MinifloatTouint(float x){\n    float sgn = float(x>0.);\n    x = abs(x);\n    if(x<.5) return 0u;\n    float exponent = floor(log2(x));\n    float mantissa = floor(8.*(x / exp2(exponent) - 1.));\n    if(exponent>=16.){\n        exponent=15.;\n        mantissa=7.;\n    }\n    return uint(sgn)<<7 | uint(exponent) << 3 | uint(mantissa);\n    \n}\n\nvec4 unpackUnorm4x8(uint p){\n    return vec4(uintToMinifloat(p),\n                uintToMinifloat(p>>8),\n                uintToMinifloat(p>>16),\n                uintToMinifloat(p>>24));\n}\n\nuint packUnorm4x8(vec4 v){\n    return MinifloatTouint(v.x) |\n            MinifloatTouint(v.y)<<8 |\n            MinifloatTouint(v.z)<<16 |\n            MinifloatTouint(v.w)<<24;\n}\n\nmat4 unpackvec4Tomat4(vec4 v){\n    return mat4(unpackUnorm4x8(floatBitsToUint(v.x)),\n                unpackUnorm4x8(floatBitsToUint(v.y)),\n                unpackUnorm4x8(floatBitsToUint(v.z)),\n                unpackUnorm4x8(floatBitsToUint(v.w))\n               );\n}\n\nvec4 packmat4Tovec4(mat4 m){\n    return vec4(uintBitsToFloat(packUnorm4x8(m[0])),\n                uintBitsToFloat(packUnorm4x8(m[1])),\n                uintBitsToFloat(packUnorm4x8(m[2])),\n                uintBitsToFloat(packUnorm4x8(m[3])));\n}","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4sfGRn","filepath":"/media/a/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg","previewfilepath":"/media/ap/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg","type":"texture","channel":3,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dX3Rn","filepath":"/media/a/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","previewfilepath":"/media/ap/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XdXGzr","filepath":"/media/a/8979352a182bde7c3c651ba2b2f4e0615de819585cc37b7175bcefbca15a6683.jpg","previewfilepath":"/media/ap/8979352a182bde7c3c651ba2b2f4e0615de819585cc37b7175bcefbca15a6683.jpg","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    mat4 data = mat4(texture(iChannel0, uv),\n                     texture(iChannel1, uv),\n                     texture(iChannel2, uv),\n                     texture(iChannel3, uv));\n    fragColor = packmat4Tovec4(data*32768.);\n}","name":"Buffer A","description":"","type":"buffer"}]}