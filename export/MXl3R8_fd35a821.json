{"ver":"0.1","info":{"id":"MXl3R8","date":"1707150775","viewed":138,"name":"3D_visual deviation cross / plus","username":"chenxianming","description":"3D visual deviation cross / plus\n2D ver at \nhttps://www.shadertoy.com/view/lfjSRt","likes":12,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","deviation"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dX3Rn","filepath":"/media/a/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","previewfilepath":"/media/ap/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define I iResolution\n#define T iTime * .6\n#define T2( s ) fract( iTime * s ) * PI * 4.\n#define A min( I.x, I.y )\n#define PI 3.14\n#define rot( r ) mat2(cos(r), sin(r), -sin(r), cos(r) )\n#define g( a ) sin( a * 1.5 ) / .96\n#define v( a ) clamp( a, 0., 1. )\n\n\nfloat smax(float a, float b, float c) {\n  float d = clamp(.5 + .5 * (-b + a) / c, 0., 1.);\n  return -(mix(-b, -a, d) - c * d * (1. - d));\n}\n\nvec3 texf( vec2 u ){\n    float p, i, a = 2.;\n    \n    while( i++ < a ){\n        u.x += cos( u.y * atan( u.x, u.y ) ) * .5 - cos( i - T2( .125 ) );\n        u.y += cos( u.x * atan( u.x, u.y ) ) * .2 + cos( i - T2( .125 ) );\n    }\n    \n    p = dot( cos( u.x ), sin( u.y ) ) / a;\n    \n    return vec3( sin(u.x) * cos( u.y ), dot(u.x,u.y), p / .1 );\n}\n\n\nfloat plus, ground;\n\nfloat l( vec2 u, float i ){\n    \n    u += vec2( .1, .3 ) * i++;\n\n    u = ( u - vec2( .3 * round( u.x / .3 ), round( u.x / -.3 ) * .1 ) ) * rot( g( T ) * PI / 2. );\n    \n    \n    return min(\n        max( abs(u.x) - .05, abs(u.y) - .15 ),\n        max( abs(u.x) - .15, abs(u.y) - .05 )\n    );\n}\n\nfloat tex( vec2 u ){\n    \n    u += texture( iChannel0, u.xy * 5. ).xy * ( .1 / A );\n\n    float p = .1, i = -11.;\n    \n\n    if( g( T ) > .0 )\n        u += vec2( .6, .3 );\n    \n    \n    for( ; i < 11.; p = min(\n            p,\n            l( u, i++ )\n        )\n    );\n    \n    \n    return p * sign( g( T ) );\n}\n\nfloat grd( vec3 p ){\n\n    p.z += texture( iChannel0, p.xy * 5. ).g * ( .5 / A );\n    \n    return -p.z - .02;\n}\n\nfloat f( vec3 p ){\n\n    p.z += texture( iChannel0, p.xy * 5. ).g * ( .5 / A );\n    \n    return smax(\n            tex( p.xy ),\n            abs( p.z ) - .05,\n            .012\n        );\n}\n\n\nfloat df( vec3 p ){\n    return min(\n        plus = f( p ),\n        ground = grd( p )\n    );\n}\n\nvec3 l(in vec3 b) {\n  vec2 a = vec2(1, -1) * .5773;\n  return normalize(a.xyy * df(b + a.xyy * 5e-4) + a.yyx * df(b + a.yyx * 5e-4) +\n                   a.yxy * df(b + a.yxy * 5e-4) + a.xxx * df(b + a.xxx * 5e-4));\n}\n\nfloat S( vec3 p, vec3 ca, vec3 r, float q ){\n    return v( pow( dot( l( p ), normalize( normalize( ca ) - r ) ), q ) );\n}\n\nvec3 trace( vec2 u ){\n    vec3 c, p, o = vec3( 0., 0., -2. ), r = vec3( u * .4, 1. );\n    float t, d, i;\n    for( ; i < 256.; i++ ){\n        p = o + r * t,\n        p.yz *= rot( PI * .25 ),\n        p.y -= fract( T * .05 ) * 5.,\n        p.y -= 5. * round( p.y / 5. ),\n        d = df( p ),\n        t += d * .334;\n        if( d < 1e-3 || t < .21 )\n            break ;\n    }\n\n    \n    if( d < 1e-3 ){\n        \n        vec3 lg = vec3( .2, .3, -1.1 );\n        lg.xy += vec2( cos(T), sin(T) ) * .5;\n        lg *= vec3( 0.85, 0.85, 0.82 );\n        float dd = v( dot( l( p ), lg ) );\n        c += S( p, lg, r, 15. ) * dd + vec3( 0.85, 0.85, 0.82 ) * .1;\n        c += ( df(p) == plus ) ? texf( p.xz ) * .05 : vec3(-.2);\n    }\n    \n    return c;\n}\n\nvoid mainImage( out vec4 U, in vec2 V )\n{\n    U = vec4( trace( ( V * 2. - I.xy ) / A ), 1. );\n}","name":"Image","description":"","type":"image"}]}