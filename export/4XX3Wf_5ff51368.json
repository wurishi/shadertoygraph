{"ver":"0.1","info":{"id":"4XX3Wf","date":"1707982413","viewed":54,"name":"Jzazbz space visualizer","username":"StarlightSource","description":"LC projection of Jzazbz","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["template"],"hasliked":0,"parentid":"X3X3Wf","parentname":"OK Lab space visualizer"},"renderpass":[{"inputs":[{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float L_sdr = 203.0;\n\nconst float GAMMA = 2.4;\nconst float L_W = 1.0;\nconst float L_B = L_W / 1000.0;\n\nfloat bt1886_r(float L, float gamma, float Lw, float Lb) {\n    float a = pow(pow(Lw, 1.0 / gamma) - pow(Lb, 1.0 / gamma), gamma);\n    float b = pow(Lb, 1.0 / gamma) / (pow(Lw, 1.0 / gamma) - pow(Lb, 1.0 / gamma));\n    float V = pow(max(L / a, 0.0), 1.0 / gamma) - b;\n    return V;\n}\n\nvec3 bt1886_r_3(vec3 x) {\n    return vec3(\n        bt1886_r(x.r, GAMMA, L_W, L_B),\n        bt1886_r(x.g, GAMMA, L_W, L_B),\n        bt1886_r(x.b, GAMMA, L_W, L_B)\n    );\n}\n\nconst float pq_m1 = 0.1593017578125;\nconst float pq_m2 = 78.84375;\nconst float pq_c1 = 0.8359375;\nconst float pq_c2 = 18.8515625;\nconst float pq_c3 = 18.6875;\n\nconst float pq_C  = 10000.0;\n\nfloat Y_to_ST2084(float C) {\n    float L = C / pq_C;\n    float Lm = pow(L, pq_m1);\n    float N = (pq_c1 + pq_c2 * Lm) / (1.0 + pq_c3 * Lm);\n    N = pow(N, pq_m2);\n    return N;\n}\n\nfloat ST2084_to_Y(float N) {\n    float Np = pow(N, 1.0 / pq_m2);\n    float L = Np - pq_c1;\n    if (L < 0.0 ) L = 0.0;\n    L = L / (pq_c2 - pq_c3 * Np);\n    L = pow(L, 1.0 / pq_m1);\n    return L * pq_C;\n}\n\nvec3 Y_to_ST2084_3(vec3 x) {\n    return vec3(\n        Y_to_ST2084(x.r),\n        Y_to_ST2084(x.g),\n        Y_to_ST2084(x.b)\n    );\n}\n\nvec3 RGB_to_XYZ(vec3 RGB) {\n    mat3 M = mat3(\n        0.6369580483012914, 0.14461690358620832,  0.1688809751641721,\n        0.2627002120112671, 0.6779980715188708,   0.05930171646986196,\n        0.000000000000000,  0.028072693049087428, 1.060985057710791);\n    return RGB * M;\n}\n\nvec3 XYZ_to_RGB(vec3 XYZ) {\n    mat3 M = mat3(\n         1.716651187971268,  -0.355670783776392, -0.253366281373660,\n        -0.666684351832489,   1.616481236634939,  0.0157685458139111,\n         0.017639857445311,  -0.042770613257809,  0.942103121235474);\n    return XYZ * M;\n}\n\nvec3 XYZ_to_Cone(vec3 XYZ) {\n    mat3 M = mat3(\n         0.41478972, 0.579999,  0.0146480,\n        -0.2015100,  1.120649,  0.0531008,\n        -0.0166008,  0.264800,  0.6684799);\n    return XYZ * M;\n}\n\nvec3 Cone_to_XYZ(vec3 LMS) {\n    mat3 M = mat3(\n         1.9242264357876067,  -1.0047923125953657,  0.037651404030618,\n         0.35031676209499907,  0.7264811939316552, -0.06538442294808501,\n        -0.09098281098284752, -0.3127282905230739,  1.5227665613052603);\n    return LMS * M;\n}\n\nvec3 Cone_to_Iab(vec3 LMS) {\n    mat3 M = mat3(\n        0.5,       0.5,       0.0,\n        3.524000, -4.066708,  0.542708,\n        0.199076,  1.096799, -1.295875);\n    return LMS * M;\n}\n\nvec3 Iab_to_Cone(vec3 Iab) {\n    mat3 M = mat3(\n        1.0,                 0.1386050432715393,   0.05804731615611886,\n        0.9999999999999999, -0.1386050432715393,  -0.05804731615611886,\n        0.9999999999999998, -0.09601924202631895, -0.8118918960560388);\n    return Iab * M;\n}\n\nconst float b = 1.15;\nconst float g = 0.66;\n\nconst float d = -0.56;\nconst float d0 = 1.6295499532821566e-11;\n\nvec3 RGB_to_Jzazbz(vec3 color) {\n    color *= L_sdr;\n\n    color = RGB_to_XYZ(color);\n\n    float Xm = (b * color.x) - ((b - 1.0) * color.z);\n    float Ym = (g * color.y) - ((g - 1.0) * color.x);\n\n    color = XYZ_to_Cone(vec3(Xm, Ym, color.z));\n\n    color.r = Y_to_ST2084(color.r);\n    color.g = Y_to_ST2084(color.g);\n    color.b = Y_to_ST2084(color.b);\n\n    color = Cone_to_Iab(color);\n\n    color.r = ((1.0 + d) * color.r) / (1.0 + (d * color.r)) - d0;\n\n    return color;\n}\n\nvec3 Jzazbz_to_RGB(vec3 color) {\n    color.r = (color.r + d0) / (1.0 + d - d * (color.r + d0));\n\n    color = Iab_to_Cone(color);\n\n    color.r = ST2084_to_Y(color.r);\n    color.g = ST2084_to_Y(color.g);\n    color.b = ST2084_to_Y(color.b);\n\n    color = Cone_to_XYZ(color);\n\n    float Xa = (color.x + ((b - 1.0) * color.z)) / b;\n    float Ya = (color.y + ((g - 1.0) * Xa)) / g;\n\n    color = XYZ_to_RGB(vec3(Xa, Ya, color.z));\n\n    color /= L_sdr;\n\n    return color;\n}\n\nconst float pi = 3.141592653589793;\nconst float epsilon = 1e-6;\n\nvec3 Lab_to_LCH(vec3 Lab) {\n    float a = Lab.y;\n    float b = Lab.z;\n\n    float C = length(vec2(a, b));\n    float H = 0.0;\n\n    if (!(abs(a) < epsilon && abs(b) < epsilon)) {\n        H = atan(b, a);\n        H = H * 180.0 / pi;\n        H = mod((mod(H, 360.0) + 360.0), 360.0);\n    }\n\n    return vec3(Lab.x, C, H);\n}\n\nvec3 LCH_to_Lab(vec3 LCH) {\n    // float C = max(LCH.y, 0.0);\n    float C = LCH.y;\n    float H = LCH.z * pi / 180.0;\n\n    float a = C * cos(H);\n    float b = C * sin(H);\n\n    return vec3(LCH.x, a, b);\n}\n\nmat3 BT2020_to_BT709 = mat3(\n     1.66049100210843540, -0.58764113878854950,  -0.072849863319884740,\n    -0.12455047452159074,  1.13289989712595960,  -0.008349422604369515,\n    -0.01815076335490526, -0.10057889800800737,   1.118729661362913000\n);\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    vec3 lch = vec3(\n        fragCoord.y / iResolution.y,\n        (fragCoord.x / iResolution.x) - 0.5,\n        (iMouse.x / iResolution.x) * 360.0\n    );\n    bool inGamut;\n\n    fragColor = vec4(0.5, 0.5, 0.5, 1.0);\n\n    vec3 bt2100pq = Y_to_ST2084_3(Jzazbz_to_RGB(LCH_to_Lab(lch)) * L_sdr);\n    inGamut = bt2100pq == clamp(bt2100pq, 0.0, 1.0);\n    if(inGamut) fragColor = vec4(bt2100pq, 1.0);\n\n    vec3 bt2020 = bt1886_r_3(Jzazbz_to_RGB(LCH_to_Lab(lch)));\n    inGamut = bt2020 == clamp(bt2020, 0.0, 1.0);\n    if(inGamut) fragColor = vec4(bt2020, 1.0);\n\n    vec3 bt709 = bt1886_r_3(Jzazbz_to_RGB(LCH_to_Lab(lch)) * BT2020_to_BT709);\n    inGamut = bt709 == clamp(bt709, 0.0, 1.0);\n    if(inGamut) fragColor = vec4(bt709, 1.0);\n}\n","name":"Image","description":"","type":"image"}]}