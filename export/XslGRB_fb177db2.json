{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"// Created by Nikita Miropolskiy, nikat/2013\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License\n\n#define AA\n\nvec2 rotate2(vec2 p, float theta) {\n\treturn vec2(\n\t\tp.x*cos(theta)-p.y*sin(theta),\n\t\tp.x*sin(theta)+p.y*cos(theta)\n\t);\n}\n\nfloat scene(vec3 p) {\n\tp.xz = rotate2(p.xz, iTime);\n\treturn length(p)-1.0+0.04*sin(10.0*(p.x+p.y+0.5*iTime));\n}\n\nfloat raymarche(vec3 origin, vec3 ray, float min_distance, float max_distance) {\n\tfloat distance_marched = min_distance;\n\tfor (int i=0; i<160; i++) {\n\t\tfloat step_distance = scene(origin + ray*distance_marched);\n\t\tif (abs(step_distance) < 0.001) {\n\t\t\treturn distance_marched/(max_distance-min_distance);\n\t\t}\n\t\tdistance_marched += step_distance;\n\t\tif (distance_marched > max_distance) {\n\t\t\treturn -1.0;\n\t\t}\n\t}\n\treturn -1.0;\n}\n\nvec3 render(vec2 q) {\n\tvec3 eye = vec3(0.0, 0.0, -3.0);\n\tvec3 screen = vec3(q, -2.0);\n\tvec3 ray = normalize(screen - eye);\n\n\tfloat s = raymarche(eye, ray, 1.0, 4.0);\n\t\n\tvec3 col;\n\t\n\tif (s == -1.0) {\n\t\tcol = vec3(0.5 + 0.5*q.y + 0.08*cos(3.0*q.x));\n\t} else {\n\t\tcol = vec3(s*0.75);\n\t\tcol.rg *= 0.8;\n\t}\n\t\n\treturn col;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 q = (2.0*fragCoord.xy - iResolution.xy)/iResolution.x;\n\t\n\tvec3 col = render(q);\n\t\n\t#ifdef AA\n\tvec3 halfpixel = vec3(.5/iResolution.xy, 0.0);\n\tcol += render(q + halfpixel.xz);\n\tcol += render(q + halfpixel.zy);\n\tcol += render(q + halfpixel.xy);\n\tcol *= .25;\n\t#endif\n\t\t\n\tfragColor = vec4(col, 1.0);\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XslGRB","date":"1373452325","viewed":530,"name":"Distorted sphere","username":"nikat","description":"My \"hello, world\" with raymarching distance field. First code from scratch.","likes":12,"published":1,"flags":0,"usePreview":0,"tags":["3d","raymarching","distancefield"],"hasliked":0,"parentid":"","parentname":""}}