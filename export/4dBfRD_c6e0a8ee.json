{"ver":"0.1","info":{"id":"4dBfRD","date":"1499653552","viewed":384,"name":"MRF Style transfer","username":"rory618","description":"Minor modification to https://www.shadertoy.com/view/XsBBzW","likes":3,"published":1,"flags":32,"usePreview":0,"tags":["random","field","style","transfer","markov"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = (floor(fragCoord.xy)+.5) / iResolution.xy;\n    fragColor = texture(iChannel0, uv);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dfGRn","filepath":"/media/a/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","previewfilepath":"/media/ap/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","type":"texture","channel":3,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dX3Rn","filepath":"/media/a/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","previewfilepath":"/media/ap/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"\n\nvec4 hash44(vec4 p4){\n    p4 = fract(sin(p4)  * vec4(443.897, 441.423, 437.195, 444.129)/8.);\n    p4 += dot(p4, p4.wzxy+19.19);    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    \n    if(iFrame <30){\n        fragColor = texture(iChannel3, uv);\n    } else {\n        fragColor = texture(iChannel0, uv);\n    \n        vec2 closest = (textureLod(iChannel1, uv,-100.).xy+.5)/iChannelResolution[2].xy;\n        float e = textureLod(iChannel1, uv,-100.).z;\n\n        float r = .01;\n\n        fragColor = (1.-r)*fragColor + r*textureLod(iChannel2,closest,-100.);\n    }\n    //fragColor = .999*fragColor +.001*texture(iChannel3, uv);\n    \n}","name":"Buf A","description":"","type":"buffer"},{"inputs":[{"id":"4dX3Rn","filepath":"/media/a/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","previewfilepath":"/media/ap/bd6464771e47eed832c5eb2cd85cdc0bfc697786b903bfd30f890f9d4fc36657.jpg","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"\nconst int size = 3;\n\nvec4 hash44(vec4 p4){\n    p4 = fract(sin(p4)  * vec4(443.897, 441.423, 437.195, 444.129)/8.);\n    p4 += dot(p4, p4.wzxy+19.19);    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\nfloat error(vec2 p, vec2 uv){\n    float e = 0.;\n    for(int dx = -size; dx <= size; dx++){\n        for(int dy = -size; dy <= size; dy++){\n            vec2 d = vec2(dx,dy);\n            vec4 a = texture(iChannel0,uv+d/iChannelResolution[0].xy);\n            vec4 b = textureLod(iChannel2,(p+.5+d)/iChannelResolution[2].xy,-100.);\n            e += length(a-b);\n            \n        }\n    }\n    return e;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec2 px = vec2(1) / iResolution.xy;\n    \n    if(iFrame <30){\n        fragColor = floor(iChannelResolution[2].xyzz*hash44(hash44(iDate)+hash44(uv.xyxy)));\n        fragColor.z = 1000.;\n    } else {\n        fragColor = texture(iChannel1, uv);\n    \n        vec2 p = fragColor.xy;\n        float e = fragColor.z;\n        vec2 np;\n        float ne;\n        //for (int i = 0; i < 4; i++){\n            np = floor(iChannelResolution[2].xy*hash44(hash44(iDate)+hash44(uv.xyxy)).xy);\n            ne = error(np,uv);\n            if(ne<e){\n               e = ne;\n               p = np;\n            }\n        //}\n\n        vec4 u = texture(iChannel1, uv+px*vec2(0,1));\n        vec4 d = texture(iChannel1, uv+px*vec2(0,-1));\n        vec4 l = texture(iChannel1, uv+px*vec2(-1,0));\n        vec4 r = texture(iChannel1, uv+px*vec2(1,0));\n        np = u.xy-vec2(0,1);\n        ne = error(np,uv);\n        if(ne<e){\n            e = ne;\n            p = np;\n        }\n        np = d.xy-vec2(0,-1);\n        ne = error(np,uv);\n        if(ne<e){\n            e = ne;\n            p = np;\n        }\n        np = l.xy-vec2(-1,0);\n        ne = error(np,uv);\n        if(ne<e){\n            e = ne;\n            p = np;\n        }\n        np = r.xy-vec2(1,0);\n        ne = error(np,uv);\n        if(ne<e){\n            e = ne;\n            p = np;\n        }\n\n\n        fragColor.xy = p;\n        fragColor.z = e;\n    }\n    if(iMouse.z>0. && length(fragCoord.xy-iMouse.xy) < 20.){\n        fragColor = hash44(hash44(iDate)+hash44(uv.xyxy));\n        fragColor.z = 1000.;\n    }\n}","name":"Buf B","description":"","type":"buffer"}]}