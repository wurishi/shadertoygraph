{"ver":"0.1","info":{"id":"lsy3Dz","date":"1454075547","viewed":148,"name":"crude bouncing balls","username":"public_int_i","description":"bouncing balls, click and move mouse to push away balls","likes":0,"published":1,"flags":32,"usePreview":0,"tags":["test","balls","bouncing","crude"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tfragColor = texture(iChannel0, fragCoord.xy / iResolution.xy);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"XdXGzn","filepath":"/media/a/3083c722c0c738cad0f468383167a0d246f91af2bfa373e9c5c094fb8c8413e0.png","previewfilepath":"/media/ap/3083c722c0c738cad0f468383167a0d246f91af2bfa373e9c5c094fb8c8413e0.png","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"\nconst float epsilon = .0001;\nconst float ballRadius = 0.02;\nconst int numberOfBalls = 40;\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    int ind = int(fragCoord.x);\n    if (ind > numberOfBalls) { discard;return; }\n    \n    if (iFrame < numberOfBalls) {\n     \tfragColor = vec4( fract(float(ind)*.2)*1.8-.8, float(ind/5)*.18-.9,\n            \t\t\t\ttexture(iChannel1, fragCoord.xy*4./iResolution.xy).xy*.04-.02 )*.5+.5;\n        return;\n    }\n    \n    \n    vec2 uv = fragCoord/iResolution.xy;\n    \n    vec4 d = texture(iChannel0, uv)*2.-1.;\n    \n    if (iMouse.w > 0.) {\n        vec2 muv = (iMouse.xy/iResolution.xy)*2.-1.;\n        d.zw += normalize(d.xy-muv)*max(0.,.02-length(muv-d.xy)*.03);\n        d.zw = clamp(d.zw,-.02,.02);\n    }\n    d.w -= .0098/60.;\n    d.zw = clamp(d.zw,-1.,1.);\n    \n    vec2 pos = d.xy;\n    vec2 dir = normalize(d.zw);\n    float len = length(d.zw);\n    float mlen = len;\n    vec2 reflDir;\n    bool hit = false;\n    \n    for (int i = 0; i < numberOfBalls; i++) {\n        if (i == ind) continue;\n        \n        vec4 d2 = texture(iChannel0, vec2(float(i)/iResolution.x,0.))*2.-1.;\n    \n        bool dhit = false;\n        float tlen = 0.;\n        for (int k = 0; k < 4; k++) {\n            float dst = length(d2.xy-(pos+dir*tlen))-ballRadius;\n            if (dst < ballRadius) {\n                tlen += min(0.,dst-ballRadius);\n                dhit = true;\n                break;\n            }\n            if (tlen > mlen) break;\n            \n            tlen += dst;\n        }\n        if (tlen < mlen) {\n            mlen = tlen;\n            if (dhit) {\n                hit = true;\n                reflDir = d2.xy;\n            } else {\n                hit = false;\n            }\n        }\n    }\n    \n    d.xy += dir*mlen;\n    if (hit) {\n        reflDir = normalize(d.xy-reflDir);\n        d.xy += reflDir*epsilon;\n        d.zw = reflect(normalize(d.zw),reflDir)*length(d.zw);\n    }\n    if (abs(d.x) > 1. || abs(d.y) > 1.) {\n       d.zw = reflect(normalize(d.zw),abs(d.x)>abs(d.y)?vec2(sign(d.x),0.):vec2(0.,sign(d.y)))*length(d.zw);\n    }\n    d = clamp(d,-1.,1.);\n    fragColor = d*.5+.5;\n}","name":"Buf A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"\nconst int numberOfBalls = 40;\nconst float motionBlur = .3;\nconst float ballRadius = 0.02;\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = (fragCoord.xy / iResolution.xy - .5)*2.;\n    \n    float dst = 999.;\n    for (int i = 0; i < numberOfBalls; i++) {\n        vec4 d = texture(iChannel0, vec2((float(i))/iResolution.x,0.))*2.-1.;\n    \tdst = min(length(d.xy-uv)-ballRadius, dst);\n    }\n    \n    fragColor = texture(iChannel1,fragCoord/iResolution.xy)*motionBlur+vec4( max(0., 1.-dst*100.) )*(1.-motionBlur);\n}","name":"Buf B","description":"","type":"buffer"}]}