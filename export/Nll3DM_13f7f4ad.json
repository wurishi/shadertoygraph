{"ver":"0.1","info":{"id":"Nll3DM","date":"1622211996","viewed":92,"name":"Evangelion Moon","username":"kithy","description":"Something like moon in the movie \" EVANGELION:3.0 YOU CAN (NOT) REDO.\".","likes":4,"published":1,"flags":32,"usePreview":0,"tags":["raymarching","terrain","texture"],"hasliked":0,"parentid":"NtlGDN","parentname":"Earth Texture"},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define ITR 32\n#define EPS 0.001\n#define SCALE 5.0\n#define PI 3.141592\n#define TWO_PI 6.2831\n#define GREEN vec3(0.2,0.9,0.7)\n\nmat2 rot(float a){\n\tfloat s=sin(a);\n\tfloat c=cos(a);\n\treturn mat2(c,-s,s,c);\n}\n\nfloat sdSphere(vec3 p){\n\treturn length(p)-1.0;\n}\n\nvec3 genNormal(vec3 p){\n\tvec3 normal=vec3(\n\t\tsdSphere(p+vec3(EPS,0.0,0.0))-sdSphere(p+vec3(-EPS,0.0,0.0)),\n\t\tsdSphere(p+vec3(0.0,EPS,0.0))-sdSphere(p+vec3(0.0,-EPS,0.0)),\n\t\tsdSphere(p+vec3(0.0,0.0,EPS))-sdSphere(p+vec3(0.0,0.0,-EPS))\n\t\t);\n\treturn normalize(normal);\n}\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\tvec2 uv=(2.0*fragCoord.xy-iResolution.xy)/iResolution.y;\n\n\tvec3 ro=vec3(0.0,0.0,-6.0);\n\tvec3 lookat=vec3(0.0,0.0,0.0);\n\tfloat zoom=5.0;\n\n\tvec3 f=normalize(lookat-ro);\n\tvec3 r=normalize(cross(vec3(0.0,1.0,0.0),f));\n\tvec3 u=cross(f,r);\n\tvec3 c=ro+f*zoom;\n\tvec3 i=c+uv.x*r+uv.y*u;\n\tvec3 rd=normalize(i-ro);\n\n\tfloat dS,dO;\n\tvec3 p,normal;\n\n\t\n\n\t//raymarching\n\tfor(int i=0;i<ITR;i++){\n\t\tp=ro+rd*dO;\n\t\tdS=sdSphere(p);\n\t\tnormal=genNormal(p);\n\t\tif(dS<EPS)break;\n\t\tdO+=dS;\n\n\t}\n\t\n\tp.xz*=rot(1.0+iTime*0.1);\n    p.yz*=rot(0.3);\n\tp.xy*=rot(-0.2);\n\n\tvec3 col=vec3(0.0);\n\n\n\t//polar coordinate\n\tif(dS<EPS){\n\t\t\n        //2D pattern\n        uv=vec2(atan(p.x,p.z)/TWO_PI,p.y/5.0)+0.5;\n        vec3 tex=texture(iChannel0,uv).rgb;\n        vec3 grid=texture(iChannel1,uv).rgb;\n\n        col=tex+grid;\n\t}\n\t\n    float diff=max(dot(normal,vec3(1.0,1.0,-1.0)),0.1);\n\n\tcol.x*=diff;\n\tcol.y*=diff;\n\tcol.z*=diff;\n   \n\tfragColor=vec4(col,1.0);\n}\n\n","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"#define NUM_OCTAVES 8\n#define time 0.1*(iTime-0.5)\n\nmat2 rot=mat2(\n\tcos(0.5),sin(0.5),\n\t-sin(0.5),cos(0.5)\n\t);\n\nfloat hash12(vec2 p){\n\tvec3 p3=fract(vec3(p.xyx)*0.1031);\n\tp3+=dot(p3,p3.yzx+19.19);\n\treturn fract((p3.x+p3.y)*p3.z);\n}\n\nfloat noise(in vec2 p){\n\tvec2 i=floor(p);\n\tvec2 f=fract(p);\n\tvec2 u=f*f*(3.0-2.0*f);\n\n\treturn mix(mix(hash12(i+vec2(0.0,0.0)),\n\t\t\thash12(i+vec2(1.0,0.0)),u.x),\n\t\t   mix(hash12(i+vec2(0.0,1.0)),\n\t\t   \thash12(i+vec2(1.0,1.0)),u.x),u.y);\n}\n\nfloat fbm(in vec2 st){\n\tfloat v=0.0;\n\tfloat a=0.5;\n\tvec2 shift=vec2(100.0);\n\tfor(int i=0;i<NUM_OCTAVES;i++){\n\t\tv+=a*noise(st);\n\t\tst=rot*st*2.0+shift;\n\t\ta*=0.5;\n\t}\n\treturn v;\n}\n\nconst vec3 water_rgb=vec3(0.0,5.0,30.0);\nconst vec3 continent_rgb=vec3(0.0,4.0,50.0);\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord){\n\tvec2 uv=fragCoord/iResolution.y;\n\t//uv+=vec2(0.3*time,0.0);\n\tfloat aa=1.0/iResolution.y;\n\tfloat terrain=fbm(12.0*uv);\n\tuv.x*=0.4;\n\tfloat clouds=fbm(20.0*uv+vec2(100.0,50.0));\n\tfloat mist=fbm(20.0*uv+vec2(14.0,-30.0));\n\tvec3 col=mix(water_rgb/255.0,continent_rgb/255.0,smoothstep(0.55,0.55+5.0*aa,terrain));\n\tcol+=mix(col,vec3(1.0),smoothstep(0.45,1.0,clouds));\n\tcol+=mix(col,vec3(0.5),smoothstep(0.3,0.8,mist));\n\n\tfragColor=vec4(col,1.0);\n}\n","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"void mainImage(out vec4 fragColor,in vec2 fragCoord){\n\tvec2 uv=(2.0*fragCoord.xy-iResolution.xy)/iResolution.y;\n\n\tuv*=8.0;\n\tvec2 gv=fract(uv)-0.5;\n\n\tvec3 col=vec3(0.0);\n\n\tif(gv.x>0.42||gv.y>0.42){\n\t\tcol.r=1.0;\n\t}\n\tfragColor=vec4(col,1.0);\n}","name":"Buffer B","description":"","type":"buffer"}]}