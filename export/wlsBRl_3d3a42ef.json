{"ver":"0.1","info":{"id":"wlsBRl","date":"1597498682","viewed":139,"name":"Square Wheels","username":"athibaul","description":"Who said square wheels don't work?","likes":8,"published":1,"flags":0,"usePreview":0,"tags":["2d","geometry","gear","tangent","humor"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// A funny little car with square wheels.\n//\n// https://mathcurve.com/courbes2d.gb/engrenage/engrenage2.shtml\n// http://aesculier.fr/fichiersMaple/rouesdroles/rouesdroles.html\n// https://en.wikipedia.org/wiki/Square_wheel\n\nvec2 uv;\nfloat T = 2.*asinh(1.);\n\nfloat ZeroSet(float f, float linewidth)\n{\n    vec2 grad = vec2(dFdx(f), dFdy(f));\n    float pxSize = max(length(grad), fwidth(uv.y));\n    return clamp(linewidth-abs(f)/pxSize, 0., 1.);\n}\nfloat Fill(float f) {\n    vec2 grad = vec2(dFdx(f), dFdy(f));\n    float pxSize = max(length(grad), fwidth(uv.y));\n    return clamp(max(-f, 0.)/pxSize, 0., 1.);\n}\nfloat ZeroSet(float f) { return ZeroSet(f, 2.); }\nfloat Point(vec2 x) { return ZeroSet(length(x), 5.); }\n\nfloat Segment(vec2 a, vec2 b, vec2 p)\n{\n    float h = clamp(dot(p-a,b-a) / dot(b-a,b-a), 0., 1.);\n    float d = length(p-a - h*(b-a));\n    return ZeroSet(d);\n}\n\nfloat wheel(float x0)\n{\n    float x0p = x0 - T*round(x0/T);\n    vec2 q1 = vec2(x0, 0.);\n    vec2 rot = normalize(vec2(1., -sinh(x0p)));\n    vec2 uvp = mat2(rot.x, rot.y, rot.y, -rot.x) * (uv-q1);\n    vec2 tmp = abs(uvp)-1.;\n    float box = length(max(tmp,0.)) + min(max(tmp.x,tmp.y),0.);\n    return box;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Set coordinates to [-1.,1.] vertically, and a little bit more\n    // horizontally.\n    uv = fragCoord/iResolution.xy;\n    uv = uv*2.-1.;\n    uv.x *= iResolution.x/iResolution.y;\n    // Scale and pan to taste\n    uv *= 3.;\n    uv.y += 1.;\n    float xcar = 2.*(iTime - 2.1*cos(iTime/2.));\n    uv.x += xcar;\n    \n    // Periodize the road\n    float xp = uv.x - T*round(uv.x/T);\n    // The road is piecewise given by the cosh function\n    float fx = -cosh(xp);\n    \n    // Draw the wheels\n    float x0 = xcar - T*1.25;\n    float x1 = xcar + T*1.25;\n    float wh0 = wheel(x0);\n    float wh1 = wheel(x1);\n    \n    // Draw the car\n    vec2 carc = vec2(xcar, 1.);\n    vec2 carr = vec2(3.5, 1.7);\n    float car = length((uv-carc)/carr) - 1.;\n    \n    vec3 col = vec3(0.95,0.94,0.9);\n    //col = mix(col, vec3(0.8), ZeroSet(uv.y));\n    col = mix(col, vec3(0.6, 0.8, 0.9), Fill(10.*car));\n    col = mix(col, vec3(0.1, 0.5, 0.6), ZeroSet(10.*car));\n    col = mix(col, vec3(0.5,0.9,0.7), Fill(wh0));\n    col = mix(col, vec3(0.,0.7,0.4), ZeroSet(wh0));\n    col = mix(col, vec3(0.5,0.9,0.7), Fill(wh1));\n    col = mix(col, vec3(0.,0.7,0.4), ZeroSet(wh1));\n    col = mix(col, vec3(0.), Point(vec2(x0,0.)-uv));\n    col = mix(col, vec3(0.), Point(vec2(x1,0.)-uv));\n    col = mix(col, vec3(1.,0.,0.), 0.2*ZeroSet(uv.y));\n    col = mix(col, vec3(0.), 0.5*Fill(uv.y - fx));\n    col = mix(col, vec3(0.), ZeroSet(fx - uv.y));\n    \n    // Output to screen\n    fragColor.rgb = col;\n}","name":"Image","description":"","type":"image"}]}