{"ver":"0.1","info":{"id":"fsBGWG","date":"1617847016","viewed":67,"name":"Distance to feature points III","username":"tomoe","description":"differentiation of the function getting the closest distance (fork from [url=https://www.shadertoy.com/view/fsSGWG]Distance to feature points II[/url])","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["bd202104"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"uvec3 k = uvec3(0x456789abu, 0x6789ab45u, 0x89ab4567u);\nconst uint max32 = 0xffffffffu;\nconst float PI = 3.14159265359;\nuvec2 hash22u(uvec2 n) {  \n    n ^= (n.yx << 24);\n    n ^= (n.yx >> 1);\n    n *= k.xy;\n    n ^= (n.yx << 1);\n    return n * k.xy;\n}\nvec2 hash22(vec2 p) {\n    uvec2 n = uvec2(p);\n    return vec2(hash22u(n)) / vec2(max32) - 0.5;\n}\nmat2 rot(float t) {\n    return mat2(cos(t), sin(t), - sin(t), cos(t));\n}\nfloat length2(vec2 v){\n    return dot(v, v);\n}\nfloat F1(vec2 p){   \n    vec2 n = round(p);\n    vec2 f = p - round(p);\n    float dist = length2(abs(f) + 0.5);\n    vec2 sgn = vec2(1.0);\n    vec2 glid = vec2(0.0);\n    for(float j = 0.0; j <= 2.0; j ++ ) {\n        glid.y += sgn.y * j;\n        sgn.y *= -1.0;\n        if (abs(glid.y - f.y) - 0.5 > sqrt(dist)){\n            continue;\n        }\n        for(float i = 0.0; i <= 2.0; i ++ ){\n            glid.x += sgn.x * i;\n            sgn.x *= -1.0;\n            vec2 nbd = glid + hash22(n + glid);\n            dist = min(dist, length2(nbd - f));\n        }\n        glid.x = 0.0;\n    }\n    return sqrt(dist);\n}\nvec2 grad(vec2 p) {\n    float d = 0.001;\n    return 0.5 * (vec2(\n            F1(p + vec2(d, 0.0)) - F1(p - vec2(d, 0.0)),\n            F1(p + vec2(0.0, d)) - F1(p - vec2(0.0, d))\n        )) / d;\n}\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n    vec2 pos = fragCoord.xy/ iResolution.xx;\n    pos *= 20.0;\n    pos += iTime;\n    if (fragCoord.x < 0.33 * iResolution.x){\n        fragColor = vec4(vec3(F1(pos)), 1.0);\n    } else if(fragCoord.x < 0.66 * iResolution.x) {\n        fragColor = vec4(grad(pos), 1.0, 1.0);\n    } else {\n        vec2 ray = rot(iTime) * vec2(1.0, 0.0);\n        fragColor = vec4(dot(ray, grad(pos)));\n    }\n    \n}\n","name":"Image","description":"","type":"image"}]}