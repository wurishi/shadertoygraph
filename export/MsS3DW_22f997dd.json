{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[{"channel":0,"type":"video","id":"Xdf3Rn","filepath":"/media/a/e81e818ac76a8983d746784b423178ee9f6cdcdf7f8e8d719341a6fe2d2ab303.webm","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"texture","id":"4dfGRn","filepath":"/media/a/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"float th = 8.0; // threshold\nfloat a2 = 1.2;\nfloat spill = 1.0;\n\nfloat getAlpha(vec4 c){\n\t// First Vlahos assumption: Gf <= a2Bf\t\n\treturn 1.0 - th*(c.g-a2*(max(c.r,c.b)));\n\t}\n\nvec4 despill(vec4 c){\n\t/// Second Vlahos assumption: max (Gf - Bf,0) <= max(Bf - Rf, 0)\n\tfloat sub = max(c.g - mix(c.b, c.r, 0.45), 0.0);\n\tc.g -= sub;\n\t\n\t/// \n\tc.a -= smoothstep(0.25, 0.5, sub*c.a);\n\t\n\t//restore luminance (kind of, I slightly reduced the green weight)\n\tfloat luma = dot(c.rgb, vec3(0.350, 0.587,0.164));\n\tc.r += sub*c.r*2.0*.350/luma;\n\tc.g += sub*c.g*2.0*.587/luma;\n\tc.b += sub*c.b*2.0*.164/luma;\n\n\treturn c;\n\t}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = vec2(0,1) + vec2(1,-1) * fragCoord.xy / iResolution.xy;\n\t\n\tvec4 fg = texture(iChannel0,uv);\n\tvec4 bg = texture(iChannel1,uv);\n\tvec4 ofg = fg;\n\t\n\tfg.a = clamp(getAlpha(fg), 0.0, 1.0);\n\tfg = despill(fg);\n\t\n\tfragColor.rgb = ofg.rgb;\n\tfragColor.rgb = bg.rgb*(1.0-fg.a) + fg.rgb*fg.a;\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"MsS3DW","date":"1389915338","viewed":1463,"name":"vlahos chroma key","username":"casty","description":"Trying to understand Vlahos ck ","likes":13,"published":1,"flags":0,"usePreview":0,"tags":["vlahoschromakey"],"hasliked":0,"parentid":"","parentname":""}}