{"ver":"0.1","info":{"id":"XXfyRN","date":"1725909998","viewed":52,"name":"spend a perfectvacae last Sunday","username":"chenxianming","description":"i took my easy last Sunday at home, one thin cigarette, little wile, and more music, perfect!\nleft click and drab horizontally move to interactive this shade.","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["smoke","holiday","ashtray","vocation"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define I iResolution.xy\n#define fa .5735764363992\n#define A min(I.x, I.y)\n#define H(a) fract(sin(dot(a, vec2(12.3456, 54.321))) * 9876.54321)\n#define rot(a) mat2(cos(a), sin(a), -sin(a), cos(a))\n#define tp(u, a, b)                                                            \\\n  (u.x - a.x) / (b.x - a.x) - (u.y - a.y) / (b.y - a.y) // two point exp\n  \n// #define HP // for high performance device or 1x DPI monitor\n\nfloat signEqTri(vec2 u, float w) {\n  float H = sqrt(pow(w, 2.) - pow(w * .5, 2.));\n\n  vec2 p1 = vec2(0, H * .5), p2 = vec2(w * .5, H * -.5),\n       p3 = vec2(-w * .5, H * -.5);\n\n  // return ( tp( u, p1, p2 ) < 0. && tp( u, p1, p3 ) < 0. && tp( u, p3, p2 ) < 0. ) ? 0. : 1.;\n\n  return max(max(tp(u, p1, p2), tp(u, p1, p3)), tp(u, p3, p2));\n}\n\nmat2 m = mat2(.1, .05, -.5, .6);\n\nfloat noi(in vec2 x) {\n  x *= m;\n  return (cos(x.x + .12356) * sin(x.y + .987654) + .123456);\n}\n\nfloat fbm(in vec2 x, in float H) {\n  float t, i, f, a;\n\n  for (; i < 10.; i++)\n    f = pow(2.0, i), a = pow(f, -H), t += a * noi(f * vec2(x.x * .5, x.y));\n\n  return t;\n}\n\nfloat h(vec2 u) {\n  float p = .1;\n\n  u.x += .5;\n\n  vec2 u2 = u;\n\n  // H\n  u.x = abs(u.x) - .06;\n\n  p = min(p, max(abs(u.x) - .025, abs(u.y) - .1));\n\n  p = min(p, max(abs(u2.x) - .05, abs(u2.y) - .02));\n\n  u = u2;\n\n  u.x -= .2;\n\n  // I\n  p = min(p, max(abs(u.x) - .025, abs(u.y) - .1));\n\n  // L\n\n  u.x -= .15;\n  p = min(p, max(abs(u.x + .025) - .025, abs(u.y) - .1));\n\n  p = min(p, max(abs(u.x - .05) - .05, abs(u.y + .08) - .02));\n\n  // T\n\n  u.x -= .15;\n\n  p = min(p, max(abs(u.x - .06) - .08, abs(u.y - .08) - .02));\n\n  p = min(p, max(abs(u.x - .06) - .025, abs(u.y) - .1));\n\n  // O\n\n  u.x -= .28;\n\n  p = min(p, max(length(u * vec2(1., .8)) - .09,\n                 -(length(u * vec2(1., .8)) - .06)));\n\n  // N\n\n  u.x -= .25;\n  u2 = u;\n  u.x = abs(u.x) - .06;\n\n  p = min(p, max(abs(u.x) - .025, abs(u.y) - .1));\n\n  p = min(p, max(abs(u2.x + .6 * u2.y) - .025, abs(u.y) - .1));\n\n  return p;\n}\n\nfloat desk, around, bface, cigaratte, cigarattes, zippo, fog;\n\nvec3 wt(vec2 u) {\n  u += fbm(vec2(fbm(u + 5., 1.)), .05);\n\n  return clamp(u.y * .4, 0., 3.) * vec3(.154, .116, .08) +\n         vec3(.308, .232, .16);\n}\n\nfloat smin(float a, float b, float r) {\n  float h = clamp(.5 + .5 * (b - a) / r, 0., 1.);\n  return mix(b, a, h) - r * h * (1. - h);\n}\n\nfloat smax(float a, float b, float c) { return -smin(-a, -b, c); }\n\nfloat rep(inout vec2 u, float rep) {\n\n  float r = 6.28 / rep; // each radian\n\n  float a = round(atan(u.y, u.x) / r) * r; // aligned uv\n\n  u = vec2(dot(u, vec2(cos(a), sin(a))), dot(u, vec2(-sin(a), cos(a))));\n\n  return floor(mod((round(a / r) + rep * .5), rep)); // index\n}\n\nfloat r1(vec3 p) {\n\n  rep(p.xz, 30.);\n  p.x -= .6 * fa;\n  p.xz *= rot(1.57);\n\n  return max(smax(length(p.xz + vec2(.14 * fa, 0)),\n                  length(p.xz - vec2(.14 * fa, 0)), .04) -\n                 .13 * fa,\n             abs(p.y) - .05 * fa);\n}\n\nfloat r2(vec3 p) {\n\n  return smax(\n\n             max(length(p.xz) - .6 * fa, abs(p.y) - .05 * fa),\n\n             -max(length(p.xz) - .5 * fa, abs(p.y) - .05 * fa), .015) *\n         1.01;\n}\n\nfloat r3(vec3 p) {\n\n  vec3 q = p;\n\n  rep(q.xz, 30.);\n  q.xy += vec2(-.24, .025);\n  q.xz *= rot(1.57);\n\n  return smin(\n\n             smax(length(q.xy) - .015 * fa * (q.z / 2. + .5),\n                  abs(q.z) - .15 * fa, .02),\n             smax(length(p.xz) - .55 * fa, abs(p.y + .04) - .034 * fa, .02),\n             .01) *\n         .9;\n}\n\nfloat s1(vec3 p) {\n\n  p.xz += vec2(.4, .45);\n  p += h(p.zx * 3.) * .006;\n\n  return max(max(abs(p.x) - .1375 * fa, abs(p.y) - .0525 * fa),\n             abs(p.z) - .2125 * fa) *\n         .5556;\n}\n\nfloat s2(vec3 p) {\n  p -= vec3(.25, .06, -.2);\n  p.zx *= rot(.4);\n\n  return max(length(p.yz) - .035 * fa, abs(p.x) - .33 * fa) * .4445;\n}\n\nfloat s3(vec3 p) {\n\n  p -= vec3(.02, .25, -.15);\n\n  return max(max(abs(p.x) - .15, abs(p.y) - .25), abs(p.z) - .01\n\n             ) *\n         .5556;\n}\n\nfloat as(vec3 p) { return around = smin(r1(p), r2(p), .06) * 1.1; }\n\nfloat zp(vec3 p) {\n\n  p.xz += vec2(.15, .5);\n  p.xz *= rot(1.25);\n\n  return min(\n\n             max(\n\n                 smax(smax(abs(p.x) - .07 * fa, abs(p.z) - .12 * fa, .015),\n                      abs(p.y) - .035 * fa, .015),\n                 -max(\n\n                     max(abs(p.x) - .07 * fa, abs(p.z - .02 * fa) - .001),\n                     abs(p.y) - .06 * fa\n\n                     )\n\n                     ),\n\n             max(length(p.xz + vec2(-.06 * fa, -.02 * fa)) - .004,\n                 abs(p.y) - .035 * fa)\n\n                 ) *\n         .55556;\n}\n\nfloat dsk(vec3 p) {\n  return min(min(min(as(p), bface = r3(p)),\n                 min(cigaratte = s2(p), cigarattes = s1(p))),\n             zippo = zp(p));\n}\n\nfloat df(vec3 p) {\n\n  return min(dsk(p),\n             desk = max(max(abs(p.x) - 2.5, abs(p.z) - 1.5), p.y + .2) * .5556);\n}\n\nvec3 n(in vec3 b) {\n  vec2 a = vec2(1, -1) * .5773;\n  return normalize(a.xyy * df(b + a.xyy * 5e-4) + a.yyx * df(b + a.yyx * 5e-4) +\n                   a.yxy * df(b + a.yxy * 5e-4) + a.xxx * df(b + a.xxx * 5e-4));\n}\n\nfloat S(vec3 p, vec3 ca, vec3 r, float q) {\n  return pow(dot(n(p), normalize(normalize(ca) - r)), q);\n}\n\nfloat sd(vec3 r, vec3 o, float m) {\n  float t, d, i, s;\n\n  vec3 p;\n\n  while (i++ < 12.) {\n    p = o + r * t, p.yz *= rot(.565), p.xz *= rot(m), d = dsk(p) * .888,\n    s += (d < 1e-3) ? (1. - i / 12.) * .5 * (p.y / 2. + .3) : 0., t += d;\n  }\n\n  return s;\n}\n\nvec3 calCiFace1(vec2 u) {\n  vec3 c;\n\n  vec2 u1 = u;\n  u.y += .035;\n  vec2 u2 = u;\n  u2 += vec2(.0195, .025);\n\n  vec2 t = round(u / .01);\n\n  u.x -= .01 * clamp(t.x, -6., 6.);\n  u.y -= .01 * clamp(t.y, -7., 7.);\n\n  float p = signEqTri(u, .01);\n\n  p = smoothstep(.001 / A, 0., p);\n\n  c += p * vec3(.519, .16, .253);\n\n  c = mix(c, vec3(.61, .64, .55),\n          smoothstep(.001 / A, 0., signEqTri(u2, .056)));\n\n  c = mix(c, vec3(.546, .16, .253),\n          smoothstep(.001 / A, 0., signEqTri(u2, .035)));\n\n  u2.x -= .005;\n\n  c = mix(c, vec3(.9), smoothstep(.001 / A, 0., signEqTri(u2, .015)));\n\n  c = mix(c, vec3(.546, .16, .253),\n          smoothstep(.001 / A, 0., h(u1 * 10. + vec2(0, -.9))));\n\n  c = mix(\n      c, vec3(.2),\n      smoothstep(.001 / A, 0., max(abs(u1.x) - .1, abs(u1.y - .056) - .004)));\n\n  c = mix(\n      c, vec3(.67),\n      smoothstep(.001 / A, 0., max(abs(u1.x) - .1, abs(u1.y - .054) - .002)));\n\n  return c;\n}\n\nvec3 calCiFace2(vec2 u) {\n\n  return smoothstep(.001 / A, 0., h(u * 15.)) * (vec3(133., 41., 65.) / 256.) *\n         .85;\n}\n\nvec3 calCiFace3(vec2 u) {\n\n  vec3 c;\n\n  vec2 u2 = u;\n\n  vec2 t = round(u / .01);\n\n  u.x -= .01 * clamp(t.x, -10., 6.);\n  u.y -= .01 * clamp(t.y, -1., 1.);\n\n  float p = signEqTri(u, .01);\n\n  c = mix(c, vec3(.546, .16, .253),\n          smoothstep(.001 / A, 0., signEqTri(u, .015)) * .6);\n\n  c = mix(c, vec3(.1), smoothstep(.001 / A, 0., h(u2 * 15.)));\n\n  u2.x -= .084;\n\n  c = mix(c, vec3(.1),\n          smoothstep(.001 / A, 0.,\n                     max(abs(u2.y + 1.1 * u2.x) - .002, abs(u2.x) - .025)));\n\n  u2 -= vec2(.02, .005);\n\n  c = mix(c, vec3(.546, .16, .253) * .7,\n          smoothstep(.001 / A, 0., signEqTri(u2, .025)));\n\n  return c;\n}\n\nvec3 smoke(vec3 r, float m) {\n  vec3 c, p, o = vec3(0., 0., -1.);\n\n  float t, d, i;\n\n  while (i++ < 5.) {\n    p = o + r * t, p.zy *= rot(.596), p.xz *= rot(m), d = s3(p);\n    t += d;\n  }\n\n  if (d < 1e-2) {\n\n    p -= vec3(.02, .25, -.15);\n\n    vec2 u = p.xy;\n\n    float g;\n\n    g = fbm(vec2(fbm((u * vec2(1., .5)) * .5 +\n                         vec2(cos(iTime * .1), -iTime * .1),\n                     .02)),\n            .7) *\n        .5;\n\n    p += g * .1 * (u.y / 2. + .5);\n\n    g = max(abs(p.x - .11) - .06, abs(p.y - .07) - .2);\n\n    c += smoothstep((5. + fract(cos(iTime * .4)) * 15.) / A, 0., abs(g));\n\n    c *= max(max(abs(p.x) - .15, abs(p.y) - .25),\n\n             -max(abs(p.x) - .2, abs(p.y + cos(iTime * .3) * .2) - .05)\n\n    );\n  }\n\n  return c;\n}\n\nvec3 calcBg(vec2 u) {\n  float p = fbm(u * vec2(1.2 * cos(u.y) + .5, .1), .01) * .1;\n\n  u += p;\n\n  return vec3(smoothstep(-.5 / A, .5 / A,\n                         abs(max(abs(u.x) - 2., abs(u.y - 1.) - .1) + .01) -\n                             .07) *\n              .3) +\n         p;\n}\n\nvoid mainImage(out vec4 U, in vec2 V) {\n  vec2 u = (V + V - I) / A;\n  \n  if( .5-iTime > 0. )\n  u.y -= H( round( u / .1 - 5.) ) * .2 * ( .5-iTime );\n\n  float t, d, i, m = (iMouse.x * 2. - I.x) / A;\n\n  m *= A / max(I.x, I.y) * .1;\n  m = clamp(m, -.1, .1);\n\n  vec3 c, p, o = vec3(0., 0., -1.), r = vec3(u, 1.428148);\n\n#ifdef HP\n  while (i++ < 256.) {\n#else\n  while (i++ < 45.) {\n#endif\n    p = o + r * t, p.zy *= rot(.596), p.xz *= rot(m), d = df(p);\n    t += d;\n#ifndef HP\n    if (t < .1 || d < 2e-4) {\n      break;\n    }\n#endif\n  }\n\n  if (d < 1e-3) {\n\n    vec3 zl = vec3(0, 5.1, -1.2), nor = n(p), ll = vec3(0, -.3, .1);\n\n    float dd = clamp(dot(nor, normalize(zl)), 0., 1.), sgn = df(p);\n\n    if (sgn == desk) {\n\n      c -= sd(r * vec3(1, -1, 1), vec3(-.005, -.05, -1), m) * .4;\n\n      c += wt(p.xz) * .8;\n\n      c *= fog = (1.1 - exp(r.y * 2. - .8));\n    }\n\n    if (sgn == bface) {\n      ll = vec3(0, .1, .1);\n      c += wt(refract(1. - ll, p, .3).xz + .5) * .7 - .05;\n      c += S(p, ll, r, 5.) * .35;\n    }\n\n    if (sgn == around) {\n      ll = vec3(0, .5, .1);\n      c += wt(refract(1. - ll, p, .4).xz * 1.3 + .5) * .58 + .05;\n      c += S(p, ll, r, 20.) * .3;\n    }\n\n    if (sgn == cigaratte) {\n      c += .85;\n      c -= H(p.yz * .05) * .1;\n\n      p.x -= .25;\n      p.y -= .06;\n      p.z += .2;\n\n      p.zx *= rot(.4);\n\n      if (p.x > .07) {\n        c = vec3(.527, .351, .167);\n        c += H(p.yz * .2) * .1;\n      }\n\n      if (p.x < .08 && p.x > .07) {\n        c = vec3(.597, .16, .253);\n      }\n\n      if (p.x < -.16 && p.x > -.2) {\n        c = vec3(.9, .1, .1) - (p.y / 2. + .5);\n        c = mix(c * 2.5, vec3(.15), H(p.yz * 5. - iTime) * 1.1);\n      }\n    }\n\n    if (sgn == cigarattes) {\n\n      float f1 = max(nor.y, 0.), f2 = max(-nor.z, 0.), f3 = max(nor.x, 0.);\n\n      c += vec3(.61, .64, .55) * f1;\n\n      c = mix(c, calCiFace1(p.xz + vec2(.4, .45)) * f1,\n              clamp(calCiFace1(p.xz + vec2(.4, .45)).r * 2., 0., 1.));\n\n      c += vec3(.61, .64, .55) * .8 * f2;\n\n      c = mix(c, calCiFace2(p.xy + vec2(.4, .0)) * f2,\n              clamp(calCiFace2(p.xy + vec2(.4, .0)).r * 2., 0., 1.));\n\n      c += vec3(.61, .64, .55) * .9 * f3;\n\n      c = mix(c, calCiFace3(p.zy + vec2(.45, 0.)) * f3,\n              clamp(calCiFace3(p.zy + vec2(.45, 0.)).r * 2., 0., 1.));\n\n      c += S(p, vec3(-.1, .1, .25), r, 4.);\n\n      c *= c;\n    }\n\n    if (sgn == zippo) {\n      vec3 ll = vec3(0, -.5, .3), nor = n(p), q = p;\n\n      p.xz += vec2(.15, .5);\n      p.xz *= rot(1.25);\n\n      float f1 = max(-nor.z, 0.);\n\n      c += wt(refract(1. - ll, p * 50., .2).xz + .5) * .05;\n\n      c += S(q, ll, r, 4.) + .2 * dd;\n\n      // ZBF\n      c = mix(c, vec3(.796, .628, .363) * 1.5 - .4,\n              step(length(p.xy * vec2(.35, 1.)) - .01, 0.) * f1);\n    }\n  }\n\n  vec3 bg = calcBg(u) * .2;\n\n  bg = clamp(bg, 0., 1.);\n  bg *= vec3(.154, .116, .08) * 7.;\n  bg *= u.y * 1.8 - .75;\n\n  vec3 oc =\n      mix((bg * smoothstep(.8, 0.,\n                           length(u * vec2(.9, 1.) -\n                                  vec2(m * (max(I.x, I.y) / A * 10.), .6))) +\n           bg * .2) -\n              fog,\n          c, clamp(c.r * 10., -1., 1.));\n\n  vec3 smk = smoke(r, m);\n\n  oc = mix(oc, smk * 20., clamp(smk.r, -1., 1.));\n\n  U = vec4(oc, 1.0);\n}\n","name":"Image","description":"","type":"image"}]}