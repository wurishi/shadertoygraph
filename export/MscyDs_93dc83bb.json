{"ver":"0.1","info":{"id":"MscyDs","date":"1520566291","viewed":159,"name":"Stick nest","username":"chrisjj","description":"Should show https://i.imgur.com/c44SEi1.png\n\nDrag mouse to rotate","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["art"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define RAY_STEPS 150\n\n#define detail .001\n#define t (iTime+2.)\n#define tt (t/10.)\n\nfloat det=0.0;\n\n// 2D rotation\nmat2 rot(float a) {\n\treturn mat2(cos(a),sin(a),-sin(a),cos(a));\n}\n\n// Distance function\nfloat de(vec3 pos) {\n\tvec4 p = vec4(pos,1.);\n\tp *= 3.;\n\tp.xyz = -abs(p.xyz)+3.+sin(t/6.);\n\tp.xyz = -abs(p.xyz)+2.+sin(t/6.2)/3.;\n\tfloat fr = length(max(p.xyz,-0.78))-0.8;\n\treturn fr/p.w/1.4;\n}\n\n// Normals\nvec3 normal(vec3 p) {\n\tvec3 e = vec3(0.0,det*5.,0.0);\n\tfloat d1=de(p-e.yxx),d2=de(p+e.yxx);\n\tfloat d3=de(p-e.xyx),d4=de(p+e.xyx);\n\tfloat d5=de(p-e.xxy),d6=de(p+e.xxy);\n\treturn normalize(vec3(d1-d2,d3-d4,d5-d6));\n}\n\n// Raymarch\nvec3 raymarch(in vec3 from, in vec3 dir, in vec3 ldir)\n{\n//\tfrom.z-=2.*scale; // centre\n\tvec3 p;\n\tfloat d=100.;\n\tfloat totdist=0.,todistlimit=50./*was 25*/;\n\tfor (int i=0; i<RAY_STEPS; i++) {\n\t\tif (d>det && totdist<todistlimit) {\n\t\t\tp=from+totdist*dir;\n\t\t\td=de(p);\n\t\t\tdet=detail*exp(.13*totdist);\n\t\t\ttotdist+=d;\n\t\t}\n\t}\n\tp-=(det-d)*dir;\n\tvec3 col = min(abs(p.xyz),6.);\n\tvec3 norm=normal(p);\n\n\tldir = (ldir-p);\n\tfloat incid = max(0.0,dot(-norm, normalize(ldir)));\n\tcol *= .2\n\t\t+ pow(incid,6.)*.2;\n\tcol += pow(incid,200.)*.5\n\t;\n\treturn col;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy*2.-1.;\n\tuv.y*=iResolution.y/iResolution.x;\n\tvec4 mouse=(iMouse.xyzw/iResolution.xyxy-.5)*3.;\n\n\tfloat fov=.8;\n\tvec3 origin=vec3(0,0,-6.);\n\tvec3 dir=normalize(vec3(uv*fov,1.));\n\n\tvec3 from=origin;\n\tfrom.xz*=rot(mouse.x);dir.xz*=rot(mouse.x);\n\tfrom.yz*=rot(mouse.y);dir.yz*=rot(mouse.y); // Turn object\n    float a = 1.*6.*tt*4.,a2=a*2.*1.;\n\tfrom.xz*=rot(radians(a2));\tdir.xz*=rot(radians(a2));\n\tfrom.yz*=rot(radians(a));\tdir.yz*=rot(radians(a));\n    vec3 ldir = (vec3(15,15,-20)); // lamp pos\n\tldir.xz*=rot(mouse.x);\n\tldir.yz*=rot(mouse.y);\n\tldir.xz*=rot(radians(a2));\n\tldir.yz*=rot(radians(a));\n\tvec3 col=raymarch(from,dir,ldir);\n\tfragColor = vec4(col,1.);\n}\n\n////////////////////\n\n","name":"Image","description":"","type":"image"}]}