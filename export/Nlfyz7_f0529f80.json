{"ver":"0.1","info":{"id":"Nlfyz7","date":"1647629044","viewed":106,"name":"Radial gradient test","username":"raph","description":"This is a basically a worksheet for radial gradients with center offsets. There's a straightforward calculation based on inverting an affine transformation then solving a quadratic formula, and there's another version designed for preprocessing.","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["gradient"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Copyright 2022 Google LLC\n// SPDX-License-Identifier: Apache-2.0\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 xy = fragCoord;\n    vec4 mat = vec4(1.0, 0.0, 0.0, 1.0);\n    vec2 translate = vec2(00.0, 0.0);\n    \n    // invert the affine transformation\n    float inv_det = 1.0 / (mat.x * mat.w - mat.y * mat.z);\n    vec4 inv_mat = inv_det * vec4(mat.w, -mat.y, -mat.z, mat.x);\n    vec2 inv_tr = inv_mat.xz * translate.x + inv_mat.yw * translate.y;\n    xy = inv_mat.xz * xy.x + inv_mat.yw * xy.y;\n    xy = xy - inv_tr;\n\n    vec2 center0 = vec2(450.0, 300.0);\n    float r0 = 50.0;\n    \n    vec2 center1 = vec2(500.0, 300.0);\n    float r1  = 200.0;\n    \n    // quadratic equation\n    xy = xy - center0;\n    center1 = center1 - center0;\n    float a = r1 * r1 - dot(center1, center1);\n    // This is actually 0.5 * b, makes numbers come out cleaner\n    float b = dot(xy, center1);\n    float c = -dot(xy, xy);\n    float t = (-b + sqrt(b * b - a * c)) / a;\n\n    // scale for inner radius\n    t = 1.0 - (r1 / (r1 - r0)) * (1.0 - t);\n\n    // alternate calculation with more preprocessing\n    float rr = r1 / (r1 - r0);\n    float ainv = 1.0 / a;\n    vec2 c1s = center1 * (ainv * rr);\n    float ra = rr * rr * ainv;\n    float roff = rr - 1.0;\n    \n    float ba = dot(xy, c1s);\n    float ca = ra * dot(xy, xy);\n    float t2 = sqrt(ba * ba + ca) - ba;\n    t2 = t2 - roff;\n\n\n    t = clamp(t, 0.0, 1.0);\n    fragColor = vec4(t, t2, t, 1.0);\n}\n","name":"Image","description":"","type":"image"}]}