{"ver":"0.1","info":{"id":"dtsXDS","date":"1675320787","viewed":384,"name":"Rayball","username":"Kali","description":"Result of an improvised shader jam at my friend jpupper's home","likes":23,"published":1,"flags":0,"usePreview":0,"tags":["a","b","c"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float maxdist=20.;\nconst float det=.001;\nconst vec3 dirlight = vec3(1.,-2.,-1.);\nfloat obj_id;\nfloat on=1.;\nvec3 pos,objpos;\n\nmat2 rot(float a){\nfloat c=cos(a),s=sin(a);\nreturn mat2(c,s,-s,c);\n}\nfloat sphere(vec3 p, float radio) {\n  return length(p)-radio;  \n}\n\nvec3 path(float t)\n{\n  vec3 p=vec3(sin(t+cos(t*1.35)),cos(t*.8564)*.25,cos(t*.4537)+.5)*6.;\n  return p;\n}\n\nfloat obj(vec3 p) {\n  float d=sphere(p,1.5)-length(sin(p*3.+iTime))*.55;\n  d=max(d,-length(p)+2.15);\n  d=max(d,length(p)-2.25);\n  obj_id=1.;\n  return d*.5+length(fract(p*10.))*.02;\n}\n\n\nfloat de(vec3 p) {\n  vec3 po=p-objpos;\n  vec3 p1=po,p2=po;\n  p1.yz*=rot(iTime);\n  p1.xz*=rot(iTime*.5);\n  float ob3=obj(p1/1.5)*1.5;\n  float ob1=min(obj(p1*1.5),ob3);\n  p2.xy*=rot(iTime*5.);\n  p2.xz*=rot(iTime*3.);\n  float ob2=obj(p2/1.3)/1.3;\n  float d=min(ob1,ob2);\n  p1/=length(po)*.2;\n  float lu=1000.;\n  lu=min(lu,length(p1.xz-sin(p.y*3.)*length(p1)*.1)-sin(p1.y*10.+iTime*50.)*.1);\n  lu=min(lu,length(p1.xy-sin(p.z*3.)*length(p1)*.1)-sin(p1.z*10.+iTime*50.)*.1);\n  lu=min(lu,length(po)-1.);\n  lu=min(lu,(length(fract(p*.2)-.5)-.01)*5.);\n  d=min(d,lu);\n  if (d==ob1) {\n    pos=p1;\n    obj_id=1.;    \n  }\n  if (d==ob2) {\n    pos=p2;    \n    obj_id=2.;    \n  }\n  if (d==lu) obj_id=3.;\n  //pos=p;\n  return d*.5;\n}\n\nvec3 normal(vec3 p) {\n  vec3 e = vec3(0.,det*2.,0.);\n  return normalize(vec3(de(p-e.yxx),de(p-e.xyx),de(p-e.xxy))-de(p));\n}\n\nfloat is_id(float id) {\n  return 1.-step(.1,abs(id-obj_id));\n}\n\n\nvec3 color() {\n  vec3 col=vec3(0.);\n  vec3 text=1.-abs(fract(pos*6.+vec3(0.,sin(pos.x*10.+iTime*5.)*.5,iTime*2.))-.5);\n  text=smoothstep(1.4,1.5,length(sin(pos*10.)))*vec3(2.,.8,3.)+.2;\n  col+=text*is_id(1.);\n  col+=vec3(2.,0.,3.)*is_id(2.);\n  col+=vec3(1.,.0,1.)*is_id(3.)*3.;\n  return col;\n}\n\nvec3 light(vec3 p, vec3 dir, vec3 n, vec3 col) {\n  vec3 ldir=normalize(-p);\n  float amb=.2;\n  float diff=max(0.,dot(ldir,-n))*2.0*on;\n  vec3 ref=reflect(dir,-n);\n  float spec=pow(max(0.,dot(ldir,ref)),10.)*1.7*on;\n  return col*(amb+diff)+spec*vec3(1,0,1);\n}\n\nvec3 march(vec3 from, vec3 dir) {\n  vec3 p, col=vec3(0.), backcol=vec3(0.);\n  float totdist=0.,d,g=0.;\n  for (int i=0; i<180; i++) {\n    p=from+dir*totdist;\n    d=de(p);\n    totdist+=d;\n    if (d<det || totdist>maxdist) {\n      break;\n    }\n    g+=.1/(.1+d*.5)*(is_id(3.));\n  }\n  if (d<det) {\n    p-=det*dir*2.;\n    vec3 obj_col=color();\n    vec3 n=normal(p);\n    col=light(p,dir,n,obj_col);\n  } else {\n    totdist=maxdist;\n    p=from+dir*maxdist;\n  }\n  backcol=vec3(.8,.9,1.)*(1.-.7*smoothstep(0.,10.,-p.y-.5));\n  vec2 uv=gl_FragCoord.xy/iResolution.xy-.5;\n  uv.x*=iResolution.x/iResolution.y;\n  backcol=abs(sin(dir+iTime*2.))*.5*smoothstep(1.,.0,length(uv));\n  backcol.rb*=rot(iTime);\n  backcol.g*=.2;\n  float depth = 1.-(maxdist-totdist)/maxdist;\n  col=mix(col,backcol,pow(depth,.5));\n  col+=g*.1*on*vec3(2,0,3)*exp(-1.5*depth);\n  return col;\n}\n\nmat3 lookat(vec3 dir,vec3 up){\n    dir=normalize(dir);vec3 rt=normalize(cross(dir,normalize(up)));\n    return mat3(rt,cross(rt,dir),dir);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n  float t=iTime;\n  on=fract(t*6.);\n  vec2 uv = fragCoord/iResolution.xy-.5;\n  uv.x*=iResolution.x/iResolution.y;\n  uv*=rot(iTime);\n  vec3 dir = normalize(vec3(uv,.5));\n  vec3 from = vec3(0.,0.,-5.);\n  from=path(t);\n  objpos=vec3(tan(iTime*.5)*2.,cos(iTime)*5.,sin(iTime)*8.);\n  vec3 target = objpos;\n  vec3 to = normalize(target-from);\n  dir.x+=to.y*.5;\n  dir=lookat(target-from,vec3(0.,1.,0.))*dir;\n  vec3 col=march(from, dir);\n  fragColor = vec4(col,1.);\n}\n","name":"Image","description":"","type":"image"}]}