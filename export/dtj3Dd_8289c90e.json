{"ver":"0.1","info":{"id":"dtj3Dd","date":"1674150809","viewed":74,"name":"raymarching with blinn phong","username":"ZeroSkyline","description":"raymarching with blinn phong","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","blinnphong"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"struct ray \n{\n    vec3 p;\n    float t;\n    vec3 d;\n};\nstruct hit\n{\n    float t;\n    vec3 p;\n    vec3 n;\n};\nfloat sd_sphere(vec3 p, vec3 c, float r) \n{\n    return length(p-c)-r; \n}\nfloat sdf(vec3 p)\n{\n    return sd_sphere(p, vec3(0), .5);\n}\nvec3 pixel_dir(float fov, vec2 fragCoord) \n{\n    vec3 dir;\n    dir.xy = fragCoord-iResolution.xy*.5;\n    dir.z = -iResolution.y*.5/tan(radians(fov)*.5);\n    return normalize(dir);\n}\nvec3 get_normal(vec3 p)\n{\n    float d = .0001;\n    float x = sdf(vec3(p.x+d,p.y,p.z)) - sdf(vec3(p.x-d, p.y, p.z));\n    float y = sdf(vec3(p.x,p.y+d,p.z)) - sdf(vec3(p.x, p.y-d, p.z));\n    float z = sdf(vec3(p.x,p.y,p.z+d)) - sdf(vec3(p.x, p.y, p.z-d));\n    return normalize(vec3(x,y,z));\n}\nhit marching(ray r) \n{\n    hit h;\n    float t = r.t;\n    for(int i = 0; i != 256; i++) \n    { \n        vec3 p = r.p + vec3(t) * r.d;\n        float sd = sdf(p);\n        if(sd < .0001) \n        {\n            h.n = get_normal(p); \n            h.t = t;\n            h.p = p;\n            return h;\n        } \n        t += sd; \n    }\n    return h; \n} \nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) \n{\n    vec3 cam = vec3(0,0,2.);\n    vec3 l = normalize(vec3(sin(iTime), 1., cos(iTime)));\n    \n    ray r; r.p = cam; r.t = 0.; r.d = pixel_dir(30., fragCoord);\n    \n    hit res = marching(r);\n    \n    if(res.t > 0.)\n    {\n        float nl = dot(res.n,l);\n        vec3 v = normalize(cam-res.p);\n        vec3 h = normalize(v + l);\n        \n        vec3 dirLightCol = vec3(3.14);\n        vec3 envCol = vec3(.1,.2,.4);\n        \n        float lambert = max(nl,0.);\n        \n        vec3 indirL = envCol;\n        vec3 dirL = dirLightCol * lambert;\n        vec3 diff = (dirL + indirL) / 3.14;\n        \n        float blinn_phong = pow(max(dot(h, res.n),0.),30.)*max(nl,0.) / 3.14;\n        float F = .04 + pow(1.-dot(res.n, v), 5.);\n        vec3 spec = dirLightCol * blinn_phong + envCol * F;\n        \n        vec3 col = spec + diff;\n        \n        col = pow(col, vec3(.45));\n        \n        fragColor = vec4(col,1.);\n    }\n    else\n        fragColor = vec4(.1,.2,.4,1.);\n}","name":"Image","description":"","type":"image"}]}