{"ver":"0.1","info":{"id":"lccBzH","date":"1732936256","viewed":70,"name":"Smoke Toy","username":"Dusty","description":"in the beginning there was nothing\nto blow smoke, hold left click and take a drag\nto blow more smoke, take a longer drag\nno reason not to go fullscreen, its very fast, no iteration stuff","likes":4,"published":1,"flags":32,"usePreview":0,"tags":["simulation","smoke","toy","gas"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define field iChannel2\n\n// xy is flow field\n// z is virtual pressure field\n// w is smoke field\n\n#define SHADE(a,t) vec3(pow(a,0.4545-t),pow(a,0.4545),pow(a,0.4545+t))\n\nMAIN\n{\n    vec4 c = Sample(field, iCoord);\n    fragColor = vec4(\n    SHADE(c.w, 0.15*(smoothstep(-0.7, 0.7,c.z)-0.5)\n    ), 1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define MAIN void mainImage( out vec4 fragColor, in vec2 fragCoord )\n#define iCoord ivec2(floor(fragCoord))\n\n#define S ivec2(0,-1)\n#define W ivec2(-1,0)\n#define N ivec2(0,1)\n#define E ivec2(1,0)\n\nvec4 Sample(sampler2D s, ivec2 coord)\n{ \n    return texelFetch(s, (coord + textureSize(s,0)) % textureSize(s,0), 0);\n}\n\nmat4 Sample4(sampler2D s, ivec2 coord) \n{ \n    return mat4( Sample(s, coord),\n        Sample(s, coord + ivec2(1, 0)), \n        Sample(s, coord + ivec2(0, 1)), \n        Sample(s, coord + 1) ); \n}\n\nvec4 Mix4(mat4 M, vec2 f) \n{ \n    return mix(mix(M[0], M[1], f.x), mix(M[2], M[3], f.x), f.y);\n}\n\nvec4 Sample(sampler2D s, vec2 coord) \n{\n    return Mix4( Sample4(s, ivec2(floor(coord - 0.5))), fract(coord - 0.5) );\n}\n\n","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"#define field iChannel2\n\n// change of flow due to \"pressure\"\n\nMAIN\n{\n    vec4 c = Sample(field, iCoord);\n    fragColor = c + vec4(\n        0.5*(Sample(field, iCoord + W).z-c.z), \n        0.5*(Sample(field, iCoord + S).z-c.z), 0,0);\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"#define field iChannel0\n\n// change of \"pressure\" due to flow\n\nMAIN\n{\n    vec4 c = Sample(field, iCoord);\n    fragColor = vec4(\n        c.xy,\n        c.z + c.x + c.y - Sample(field, iCoord + N).y - Sample(field, iCoord + E).x,\n        c.w);    \n}\n\n\n\n","name":"Buffer B","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4sXGR8","channel":0}],"code":"#define field iChannel1\n\n#define DECAY vec4(0.9997, 0.9997, 1.0, 0.9995)\n#define IS_DRAGGING (iMouse.z > 0.0)\n#define DRAG_START abs(iMouse.zw)\n#define DRAG_NOW iMouse.xy\n\n#define mouseR 0.5\n#define SD(a,b,p) length(((p)-(a))-((b)-(a))*clamp(dot((p)-(a),(b)-(a))/dot((b)-(a),(b)-(a)), 0.0, 1.0))\n\n// change of position due to flow\n\nMAIN\n{\n    vec2 flow = Sample(field, iCoord).xy;    \n    fragColor = DECAY * Sample(field, fragCoord-flow);\n    \n    if(IS_DRAGGING)\n    {\n        float theta = float(iFrame);\n        vec2 start = DRAG_START + mouseR * vec2(cos(theta),sin(theta));\n        vec2 end = DRAG_NOW + mouseR * vec2(cos(2.0*theta),sin(2.0*theta));\n        float d = SD(end, start, fragCoord); \n        vec2 delta = (end - start);\n        if(d < mouseR && length(delta) > mouseR)\n        {\n            fragColor.xy += 0.0002 * ((mouseR - d) / mouseR) * delta;\n            fragColor.w = fragColor.w + 0.01 * ((mouseR - d) / mouseR);\n        }\n    }\n}","name":"Buffer C","description":"","type":"buffer"}]}