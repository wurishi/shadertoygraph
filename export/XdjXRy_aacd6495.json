{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"#define PI\t3.14159265359\n#define PI2\t( PI * 2.0 )\n\nstruct Quad\n{\n    vec3 a;\n    vec3 b;\n    vec3 c;\n    vec3 d;\n};\n    \nvec2 rotate( in vec2 p, in float t )\n{\n\treturn p * cos( -t ) + vec2( p.y, -p.x ) * sin( -t );\n}   \n\nvec3 rotate( in vec3 p, in vec3 t )\n{\n    p.yz = rotate( p.yz, t.x );\n    p.zx = rotate( p.zx, t.y );\n\tp.xy = rotate( p.xy, t.z );\n    return p;\n}\n\nQuad rotate( in Quad m, in vec3 t )\n{\n    m.a = rotate(m.a, t);\n    m.b = rotate(m.b, t);\n    m.c = rotate(m.c, t);\n    m.d = rotate(m.d, t);\n    return m;\n}\n\nfloat sdSegment( in vec2 p, in vec2 a, in vec2 b )\n{\n\tvec2 pa = p - a;\n\tvec2 ba = b - a;\n\tfloat h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n\treturn length( pa - ba*h );\n}\n\nfloat deStar( in vec2 p)\n{\n    float time = -1.5 * iTime;\n    vec2 v0 = rotate( vec2(0.4, 0.0), PI2 / 5.0 * 0.0 + time) + vec2(0.5);\n    vec2 v1 = rotate( vec2(0.4, 0.0), PI2 / 5.0 * 1.0 + time) + vec2(0.5);\n    vec2 v2 = rotate( vec2(0.4, 0.0), PI2 / 5.0 * 2.0 + time) + vec2(0.5);\n    vec2 v3 = rotate( vec2(0.4, 0.0), PI2 / 5.0 * 3.0 + time) + vec2(0.5);\n    vec2 v4 = rotate( vec2(0.4, 0.0), PI2 / 5.0 * 4.0 + time) + vec2(0.5);\n    float de = 1.0;\n    de  = min( de, sdSegment( p, v0, v2) );\n    de  = min( de, sdSegment( p, v2, v4) );\n    de  = min( de, sdSegment( p, v4, v1) );\n    de  = min( de, sdSegment( p, v1, v3) );\n    de  = min( de, sdSegment( p, v3, v0) );\n    return de;\n}\n\nvec3 hsv(float h, float s, float v)\n{\n  return mix( vec3( 1.0 ), clamp( ( abs( fract(\n    h + vec3( 3.0, 2.0, 1.0 ) / 3.0 ) * 6.0 - 3.0 ) - 1.0 ), 0.0, 1.0 ), s ) * v;\n}\n\nfloat castRay( in vec3 ro, in vec3 rd, in Quad q, out vec3 p)\n{\n    float z = 10.0;\n    vec3 n = cross( q.c - q.a, q.b - q.a );\n    float t = dot( q.a - ro, n ) / dot( rd, n );\n    if ( t > 0.0 )\n\t{\n    \tp = ro + rd * t;\n        if ( dot( cross( q.b - q.a, n ), p - q.a ) > 0.0 ) \n        if ( dot( cross( q.c - q.b, n ), p - q.b ) > 0.0 ) \n        if ( dot( cross( q.d - q.c, n ), p - q.c ) > 0.0 )\n        if ( dot( cross( q.a - q.d, n ), p - q.d ) > 0.0 ) z = t;\n    }\n    return z;\n}\n\nvec2 getUV(in Quad q, in vec3 p)    \n{\n\tvec3 ap = p - q.a;\n    vec3 bp = p - q.b;\n    vec3 dp = p - q.d;\n    vec3 ab = q.b - q.a;\n    vec3 ad = q.d - q.a;\n    float x0 = dot( bp, ab );\n    float x1 = dot( ap, ab );\n\tfloat y0 = dot( dp, ad );\n    float y1 = dot( ap, ad );\n    return vec2( x0 / ( x0 - x1 ), y0 / ( y0 - y1 ) );\n}\n\nQuad genQuad( in vec3 center)\n{\n \treturn Quad(\n        center + vec3(  1.0,  1.0, 0.0) * 0.5,\n        center + vec3( -1.0,  1.0, 0.0) * 0.5,\n        center + vec3( -1.0, -1.0, 0.0) * 0.5,\n        center + vec3(  1.0, -1.0, 0.0) * 0.5);\n}\n\nQuad quads( in int i )\n{\n    float time = 0.3 * iTime ;\n    vec3 theta = vec3( 0.2, 0.2, 0.6 * iTime );\n\tif ( i < 15)\n    {\n        time *= -1.0;\n        theta *= -1.0;\n    }\n    Quad s = genQuad(\n    \tvec3( 3.0 * sin( float( i ) * PI2 / 15.0 + time ),\n    \t\t  0.1, \n    \t\t  3.0 * cos( float( i ) * PI2 / 15.0 + time ) - 3.0\n    \t) );\n\treturn  rotate( s, theta );  \n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 p = ( 2.0 * fragCoord.xy - iResolution.xy ) / iResolution.y;\n    vec3 rd = normalize( vec3( p, -1.8 ) );\n\tvec3 ro = vec3( 0.0, 0.0, 1.8 );\n    vec3 col =  vec3( 0.2 + 0.2 * p.y );\n    float z = 10.0;\n    for (int i = 0; i < 30; i++ )\n    {\n    \tQuad s = quads( i );\n    \tvec3 pos;\n    \tfloat d = castRay(ro, rd, s, pos);\n    \tif ( z > d )\n    \t{\n        \tvec2 uv = getUV( s, pos );\n            float dd = deStar(uv);\n            if ( dd < 0.025)\n            {\n                z = d;\n                col = hsv(mod(float(i), 15.0)/15.0, 0.8, 0.8) ;\n            }\n    \t}\n    } \n    fragColor = vec4( col, 1.0 );\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XdjXRy","date":"1413299336","viewed":410,"name":"Chain of stars","username":"gaz","description":".","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["2d","3d","billboard"],"hasliked":0,"parentid":"","parentname":""}}