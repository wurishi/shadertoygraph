{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"video","id":"4sX3Rn","filepath":"/media/a/c3a071ecf273428bc72fc72b2dd972671de8da420a2d4f917b75d20e1c24b34c.ogv","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"texture","id":"4sXGRn","filepath":"/media/a/95b90082f799f48677b4f206d856ad572f1d178c676269eac6347631d4447258.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"// vincent francois/2014\n\n#define T iTime * 2.0 // Time\n\nvec3 rX(vec3 v, float t) {\n\tfloat COS = cos(t);\n\tfloat SIN = sin(t);\n\treturn vec3(v.x,SIN*v.z+COS*v.y,COS*v.z-SIN*v.y);\n}\n\nvec3 rY(vec3 v, float t) {\n\tfloat COS = cos(t);\n\tfloat SIN = sin(t);\n\treturn vec3(COS*v.x-SIN*v.z, v.y, SIN*v.x+COS*v.z);\n}\n\nstruct camera\n{\n\tvec3 o, d;\n\tvec2 uv;\n};\n\t\nvoid rotateCamera(inout camera c, vec3 at)\n{\n\tfloat S = 2.0 * (iMouse.x/iResolution.x) - 1.0;\n\t\n\tc.o = rY(rX(vec3(0.0, 0.0, 4.0), T),S) + at - rY(rX(at, T),S);\n\tc.d = rY(rX(vec3(c.uv.x, c.uv.y, 1.0), T),S);\n}\n\nstruct plane\n{\n\tvec3 o, n, i, j, k;\n\tfloat t;\n};\n\nint iPlane(inout plane p, vec3 ro, vec3 rd) {// n.(t.r-p)=0\t\n\tfloat d = dot(p.n, rd);\n\tif(d == 0.0) return 0;\n\tfloat t = (dot(p.n,p.o)-dot(p.n,ro))/dot(p.n,rd);\n\tp.t = t;\n\tp.k = t * rd + ro - p.o;\t\t\n\tif(d < 0.0) p.k.x = -p.k.x;\n\treturn 1;\n}\n\nvoid dPlane(inout plane p, camera c, sampler2D s, inout float z, in vec4 fragColor) {\n\tif(iPlane(p, c.o, c.d) == 1)\n\t{\n\t\tvec2 st;\t\t\n\t\tst = vec2(dot(p.i, p.k), dot(p.j, p.k));\t\t\n\t\tfloat l = length(p.o - c.o);\t\t\n\t\tif(l < z)\t\t{\n\t\t\tif(max(abs(st.x) - 0.2, 0.0) == 0.0 && max(abs(st.y) - 0.2, 0.0) == 0.0)\n\t\t\t{\n\t\t\t\tz = l;\n\t\t\t\tfragColor = texture(s, st * 1.25 + vec2(0.5));\n\t\t\t}\n\t\t}\n\t}\n}\nvoid mPlane(inout plane p, const vec3 o, const vec3 n, const vec3 i) {\n\tp.o = o;\n\tp.n = n;\n\tp.i = i;\n\tp.j = cross(n, i);\t\n}\n\nstruct box\n{\n\tvec3 o;\n\tplane p0, p1, p2, p3, p4, p5;\n};\n\t\nbox makeBox(vec3 o, vec3 b)\n{\n\tbox ret;\n\t\n\tmPlane(ret.p0, o + vec3( b.x,  0. ,  0.),  vec3(1., 0., 0.), vec3(0., 1., 0.));\n\tmPlane(ret.p1, o + vec3(-b.x,  0. ,  0.),  vec3(1., 0., 0.), vec3(0., 1., 0.));\n\tmPlane(ret.p2, o + vec3(  0., -b.y,  0.),  vec3(0., 1., 0.), vec3(1., 0., 0.));\n\tmPlane(ret.p3, o + vec3(  0.,  b.y,  0.),  vec3(0., 1., 0.), vec3(1., 0., 0.));\n\tmPlane(ret.p4, o + vec3(  0.,  0. ,  b.z), vec3(0., 0., 1.), vec3(0., 1., 0.));\n\tmPlane(ret.p5, o + vec3(  0.,  0. , -b.z), vec3(0., 0., 1.), vec3(0., 1., 0.));\n\t\n\treturn ret;\n}\n\nvoid drawBox(box b, camera c, inout float z, in vec4 fragColor)\n{\n\tdPlane(b.p0, c, iChannel1, z, fragColor);\n\tdPlane(b.p1, c, iChannel1, z, fragColor);\n\tdPlane(b.p2, c, iChannel1, z, fragColor);\n\tdPlane(b.p3, c, iChannel1, z, fragColor);\n\tdPlane(b.p4, c, iChannel0, z, fragColor);\n\tdPlane(b.p5, c, iChannel0, z, fragColor);\n}\n\n#define BOX(O, F) { box b = makeBox(O, vec3(0.20)); drawBox(b, c, z, F); }\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tfragColor = vec4(0.0);\n\tvec2 ar = vec2(iResolution.x/iResolution.y, 1.0);\n\t\n\tcamera c;\n\t\n\tc.uv = ar *((fragCoord.xy / iResolution.xy) - 0.5);\n\t\n\tc.o = vec3(0.0, 0.0, 5.0);\n\trotateCamera(c, vec3(0.0));\t\n\t\n\tfloat z = 10.0;\n\n\tBOX(vec3(-1.0, 1.0, 0.0), fragColor);\n\tBOX(vec3(-0.5, 1.0, 0.0), fragColor);\n\tBOX(vec3( 0.0, 1.0, 0.0), fragColor);\n\tBOX(vec3( 0.5, 1.0, 0.0), fragColor);\n\tBOX(vec3( 1.0, 1.0, 0.0), fragColor);\n\t\t\n\tBOX(vec3(-1.0, 0.0, 0.0), fragColor);\n\tBOX(vec3(-0.5, 0.0, 0.0), fragColor);\n\tBOX(vec3( 0.0, 0.0, 0.0), fragColor);\n\tBOX(vec3( 0.5, 0.0, 0.0), fragColor);\n\tBOX(vec3( 1.0, 0.0, 0.0), fragColor);\n\n\n\tBOX(vec3(-1.0, -1.0, 0.0), fragColor);\n\tBOX(vec3(-0.5, -1.0, 0.0), fragColor);\n\tBOX(vec3( 0.0, -1.0, 0.0), fragColor);\n\tBOX(vec3( 0.5, -1.0, 0.0), fragColor);\n\tBOX(vec3( 1.0, -1.0, 0.0), fragColor);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XssSz2","date":"1404396914","viewed":313,"name":"ZBuffer","username":"cyanux","description":"An old application of the z buffer (of course, the sorting method is better).","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["buffer","z"],"hasliked":0,"parentid":"","parentname":""}}