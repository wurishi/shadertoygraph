{"ver":"0.1","info":{"id":"stjfDm","date":"1652622915","viewed":149,"name":"mnikn-real-smile","username":"mnikn","description":"mnikn-real-smile","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["grpah"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float sat(float t) {\n    return clamp(t, 0.0, 1.0);\n}\n\nfloat remap01(float a, float b, float t) {\n    return sat((t - a) / (b - a));\n}\n\nfloat remap(float a, float b, float c, float d, float t) {\n    return remap01(a, b, t) * (d - c) + c;\n}\n\nvec2 within(vec2 uv, vec4 rect) {\n    return (uv - rect.xy) / (rect.zw - rect.xy);\n}\n\nvec4 face(vec2 uv) {\n    vec4 color = vec4(1.0, 0.6, 0.3, 1.0);\n    float d = length(uv);\n    color.a = smoothstep(0.5, 0.495, d);\n    \n    // 边缘渐变\n    float gradient = smoothstep(0.45, 0.5, d);\n    // 多次相乘让 gradient 能够让颜色从中心到边缘的衰弱感加深, 参考 y=x^2 函数图形\n    gradient *= gradient;\n    color.rgb = mix(color.rgb, color.rgb * 0.6, gradient);\n    \n    // 脸部高光\n    float highlight = smoothstep(0.45, 0.447, d);\n    // 使用 remap 让高光只画在脸的上半部分\n    highlight *= remap(0.45, 0.05, 0.8, 0.0, uv.y); \n    color.rgb = mix(color.rgb, vec3(1.0), highlight);\n    \n    // 描边\n    color.rgb = mix(color.rgb, vec3(0.5, 0.1, 0.1), smoothstep(0.487, 0.495, d));\n    \n    // 脸颊\n    // 让脸颊能够镜像\n    uv.x = abs(uv.x);\n    vec2 cheek_uv = uv + vec2(-0.2, 0.2);\n    float cheek_d = length(cheek_uv);\n    float cheek = smoothstep(0.2, 0.05, cheek_d) * 0.3;\n    color.rgb = mix(color.rgb, vec3(0.9, 0.2, 0.1), cheek);\n    \n    \n    return color;\n}\n\nvec4 eye(vec2 uv, float dir) {\n    uv -= 0.5;\n    uv.x *= dir;\n   \n    // 基础的圆\n    vec4 color = vec4(1.0);\n    float d = length(uv);\n    color.a = smoothstep(0.4, 0.39, d);\n    \n    \n    vec3 iris_color = vec3(0.2, 0.6, 0.9);\n    \n    // 眼眶\n    float iris = smoothstep(0.27, 0.4 , d) * 0.7;\n    iris *= iris;\n    color.rgb = mix(color.rgb, iris_color, iris);\n    \n    // 眼眶下左边缘描边\n    color.rgb *= 1.0 - smoothstep(0.38, 0.4, d) * sat(-uv.x-uv.y);\n    \n    // 眼球描边\n    color.rgb = mix(color.rgb, vec3(0.0), smoothstep(0.27, 0.26, d));\n    \n    // 眼球\n    iris_color *= 1.0 + smoothstep(0.26, 0.05, d);\n    color.rgb = mix(color.rgb, iris_color, smoothstep(0.26, 0.24, d));\n    \n    // 瞳孔\n    color.rgb = mix(color.rgb, vec3(0.0), smoothstep(0.15, 0.14, d));\n    \n    // 瞳孔高光\n    float highligh1 = smoothstep(0.12, 0.11, length(uv+vec2(-0.2,-0.1)));\n    color.rgb = mix(color.rgb, vec3(1.0), highligh1);\n    float highlight2 = smoothstep(0.07, 0.06, length(uv+vec2(0.15,0.08)));\n    color.rgb = mix(color.rgb, vec3(1.0), highlight2);\n    \n    return color;\n}\n\nvec4 mouth(vec2 uv) {\n    uv -= 0.5;\n    vec4 color = vec4(0.8, 0.3, 0.2, 1.0);\n    \n    // 嘴\n    uv.y += uv.x*uv.x;\n    float d = length(uv);\n    color.a = smoothstep(0.4, 0.39, d);\n    \n    // 牙齿\n    float td = remap(-0.25, 0.25, 0.0, 1.0, uv.y);\n    vec3 teeth_col = vec3(smoothstep(0.5, 0.3, d));\n    color.rgb = mix(color.rgb, teeth_col, smoothstep(0.05, 0.02, td));\n    \n    // 嘴部渐变\n    float mtd = 1.0 - remap(-0.25, 0.3, 0.0, 1.0, uv.y);\n    color.rgb *= 1.0 - smoothstep(0.4, 0.0, mtd) * 0.2;\n    \n    return color;\n}\n\nvec4 brow(vec2 uv) {\n    uv -= 0.5;\n    \n    // 调整眉毛位置\n    uv.y -= uv.x * uv.x - uv.x;\n    vec4 color = vec4(0.8, 0.4, 0.2, 1.0) * 0.8;\n    float d = length(uv);\n    color *= 1.0 + smoothstep(0.38, 0.05, d);\n    color.a = smoothstep(0.4, 0.39, d);\n    \n    // 描边\n    color.rgb *= 1.0 - smoothstep(0.37, 0.4, d) * 0.5;\n    \n    return color;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec4 color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    vec2 uv = fragCoord/iResolution.xy;\n    uv -= 0.5;\n    // 让画布变为正方形\n    uv.x *= iResolution.x / iResolution.y;\n    \n    // 画脸\n    vec4 face_c = face(uv);\n    color.rgb = mix(color.rgb, face_c.rgb, face_c.a);\n    \n    float dir = sign(uv.x);\n    \n    // 画眼球\n    vec4 eye_c = eye(within(vec2(abs(uv.x), uv.y), vec4(0.04, -0.12, 0.35, 0.22)), dir);\n    color.rgb = mix(color.rgb, eye_c.rgb, eye_c.a);\n    \n    // 画嘴\n    vec4 mouth_c = mouth(within(uv, vec4(-0.3, -0.12, 0.3, -0.45)));\n    color.rgb = mix(color.rgb, mouth_c.rgb, mouth_c.a);\n    \n    // 画眉毛\n    vec4 brow_c = brow(within(vec2(abs(uv.x), uv.y), vec4(0.04, 0.33, 0.36, 0.24)));\n    color.rgb = mix(color.rgb, brow_c.rgb, brow_c.a);\n    \n    fragColor = color;\n}","name":"Image","description":"","type":"image"}]}