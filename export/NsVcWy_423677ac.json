{"ver":"0.1","info":{"id":"NsVcWy","date":"1655521999","viewed":209,"name":"20220618_11 E. Piano","username":"0b5vr","description":"everyone loves the preset 11\n\nnot strictly based on the original parameters\n","likes":14,"published":1,"flags":8,"usePreview":0,"tags":["sound","fm","dx7","chorus"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // no image\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define BPM 68.0\n\n#define PI 3.14159265359\n#define TAU 6.28318530718\n#define TIME2STEP (BPM/15.0)\n#define STEP2TIME (15.0/BPM)\n#define saturate(i) clamp(i, 0.,1.)\n#define clip(i) clamp(i, -1.,1.)\n#define linearstep(a,b,x) saturate(((x)-(a))/((b)-(a)))\n#define st(i) pow(2.,(i)/12.)\n#define n2f(i) (440.*st(i-69.))\n\nint ch1SeqP[] = int[](\n  43, 50, 55, 55, 55, 55, 55, 55,\n  43, 50, 55, 55, 55, 55, 55, 55,\n  41, 48, 53, 53, 53, 53, 53, 53,\n  41, 48, 53, 53, 53, 53, 48, 48\n);\n\nint ch1SeqT[] = int[](\n  0, 0, 0, 1, 2, 3, 4, 5,\n  0, 0, 0, 1, 2, 3, 4, 5,\n  0, 0, 0, 1, 2, 3, 4, 5,\n  0, 0, 0, 1, 2, 3, 0, 1\n);\n\nint ch2SeqP[] = int[](\n   0,  0,  0, 57, 57, 59, 59, 62,\n  62, 62, 62, 74, 74, 74, 74, 74\n);\n\nint ch2SeqT[] = int[](\n  0, 0, 0, 0, 1, 0, 1, 0,\n  0, 1, 2, 0, 1, 2, 3, 4\n);\n\nint ch3SeqP[] = int[](\n   0,  0,  0,  0,  0,  0,  0,  0,\n  67, 67, 67, 79, 79, 79, 79, 79\n);\n\nint ch3SeqT[] = int[](\n  0, 0, 0, 0, 0, 0, 0, 0,\n  0, 1, 2, 0, 1, 2, 3, 4\n);\n\nfloat fmEPiano( float t, float freq ) {\n  if ( t < 0.0 ) { return 0.0; }\n  \n  float tauPhase = TAU * t * freq;\n  float fbPhase = TAU * pow( fract( st( 0.07 ) * t * freq ), 0.7 ); // cringe pseudo feedback\n\n  return (\n    + exp( -1.0 * t ) * cos( st( 0.03 ) * tauPhase + exp( -8.0 * t ) * cos( 14.0 * tauPhase ) ) // OP1, OP2\n    + exp( -1.0 * t ) * cos( tauPhase + 3.0 * exp( -1.0 * t ) * cos( 1.0 * tauPhase ) ) // OP3, OP4\n    + exp( -1.0 * t ) * cos( st( -0.07 ) * tauPhase + 3.0 * exp( -2.0 * t ) * cos( fbPhase ) ) // OP5, OP6\n  ) / 3.0;\n}\n\nvec2 mainSound( int samp, float _ ) {\n  float time = float( samp % int( 8.0 * 60.0 / BPM * iSampleRate ) ) / iSampleRate;\n  vec2 dest = vec2( 0.0 );\n\n  for ( int i = 0; i < 6; i ++ ) {\n    // chorus!\n    vec2 pan = mix( vec2( 1.0, 0.0 ), vec2( 0.0, 1.0 ), float( i ) / 5.0 );\n    float t = time + 0.0005 * ( cos( TAU * fract( float( i ) * 0.42 ) + 10.0 * time ) );\n\n    float s = t * TIME2STEP;\n    int si = int( s );\n\n    {\n      float p = float( ch1SeqP[ si % 32 ] );\n\n      if ( p > 0.0 ) {\n        float tt = mod( t, 32.0 * STEP2TIME ) - float( si % 32 - ch1SeqT[ si % 32 ] ) * STEP2TIME;\n        float l = ch1SeqT[ ( si + 1 ) % 32 ] == 0 ? float( ch1SeqT[ si % 32 ] + 1 ) * STEP2TIME : 1E3;\n        float env = linearstep( l, l - 0.01, tt );\n        dest += 0.3 * env * pan * fmEPiano( tt, n2f( p ) );\n      }\n    }\n\n    {\n      float p = float( ch2SeqP[ si % 16 ] );\n\n      if ( p > 0.0 ) {\n        float tt = mod( t, 16.0 * STEP2TIME ) - float( si % 16 - ch2SeqT[ si % 16 ] ) * STEP2TIME;\n        float l = ch2SeqT[ ( si + 1 ) % 32 ] == 0 ? float( ch2SeqT[ si % 32 ] + 1 ) * STEP2TIME : 1E3;\n        float env = linearstep( l, l - 0.01, tt );\n        dest += 0.2 * pan * fmEPiano( tt, n2f( p ) );\n      }\n    }\n\n    {\n      float p = float( ch3SeqP[ si % 16 ] );\n\n      if ( p > 0.0 ) {\n        float tt = mod( t, 16.0 * STEP2TIME ) - float( si % 16 - ch3SeqT[ si % 16 ] ) * STEP2TIME;\n        float l = ch3SeqT[ ( si + 1 ) % 32 ] == 0 ? float( ch3SeqT[ si % 32 ] + 1 ) * STEP2TIME : 1E3;\n        float env = linearstep( l, l - 0.01, tt );\n        dest += 0.2 * pan * fmEPiano( tt, n2f( p ) );\n      }\n    }\n  }\n\n  return tanh( 0.5 * dest );\n}\n","name":"Sound","description":"","type":"sound"}]}