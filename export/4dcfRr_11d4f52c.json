{"ver":"0.1","info":{"id":"4dcfRr","date":"1523900668","viewed":380,"name":"3D Worley/Voronoise fBm","username":"chronos","description":"2D slice through 3D fBm Voronoise through time.","likes":10,"published":1,"flags":0,"usePreview":0,"tags":["3d","fractal","worley","brownian","motion","voronoise"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n#define NUM_OCTAVES 6\n\nvec3 rnd33( vec3 p ) {\n    vec3 q = vec3( dot(p,vec3(127.1,311.7, 109.2)),\n                   dot(p,vec3(269.5,183.3, 432.6)),\n                   dot(p,vec3(419.2,371.9, 304.4)) );\n    return fract(sin(q)*43758.5453);\n}\n\nfloat rnd13( vec3 p ) {\n    return fract(43758.5453*sin(dot(p,vec3(127.1,311.7, 109.2))));\n}\n\nfloat worley3D(vec3 u) {\n    float d = 1e4, a;\n    float acc = 0., acc_w = 0.;\n    vec3 k =  floor(u), f = u-k, p, q = k;\n    const int r = 3;\n    for(int i = -r; i < r; i++) {\n        for(int j = -r; j < r; j++) {\n            for(int l = -r; l < r; l++) {\n\t            vec3 p_i = vec3(i, j, l),\n                     p_f = rnd33(k+p_i);\n        \t    float d = length(p_i - f + p_f);\n            \tfloat w = exp(-8. * d) * (1.-step(sqrt(float(r*r)),d));\n            \tacc += w * rnd13(k+p_i);\n            \tacc_w += w;\n    \t} } }\n    return acc / acc_w;\n}\n\nfloat fbm3D(vec3 u) {\n    float v = 0.;\n    for(int i = 0; i < NUM_OCTAVES; i++) {\n        v += pow(.5, float(i+1)) * worley3D(u);\n        u = 2. * u + 1e3;\n    }\n    return v;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.y;\n\tvec2 p = uv * 3.;\n    vec3 col = vec3(0.);\n    float t = iTime/3.;\n    float f;\n    #if 0\n    \tcol += fbm3D( vec3(p, iTime/3.) );\n    #elif 0\n    \tcol += fbm3D( vec3(p, t) + \n            \t   vec3( fbm3D(vec3(p, t)+1e3),\n                       \t fbm3D(vec3(p, t)-1e3),\n                         fbm3D(vec3(p, -t))\n                       )\n          \t\t );\n    #elif 1\n    \tcol = vec3( fbm3D(vec3(p, t)+1e3),\n                    fbm3D(vec3(p, t)-1e3),\n                    fbm3D(vec3(p, -t))\n                   );\n    #endif\n            \n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}