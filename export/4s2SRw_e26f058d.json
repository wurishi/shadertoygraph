{"ver":"0.1","info":{"id":"4s2SRw","date":"1478643709","viewed":124,"name":"emergence","username":"dirkadirkadan","description":"i dunno","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["raymarcher"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsX3zn","filepath":"/media/a/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","previewfilepath":"/media/ap/94284d43be78f00eb6b298e6d78656a1b34e2b91b34940d02f1ca8b22310e8a0.png","type":"cubemap","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define MAX_STEPS 100\n\nfloat max_distance = 30.0;\nfloat epsilon = 0.015;\n\nfloat de(vec3 p)\n{\n    return min(length(p)-.85, length(p.xz*.2*(p.y+2.))-.2);    \n}\n\nfloat march(vec3 start_pos, vec3 ray_dir)\n{\n\tfloat d = 0.0;\n\t\n\tfor (int i = 0; i < MAX_STEPS; i++)\n\t{\n\t\tvec3 ray_pos = start_pos + ray_dir*d;\n\t\tfloat s = de(ray_pos);\n\t\t\n\t\td += s;\n\t\tif (s < epsilon)\n\t\t\treturn d;\t\n\t}\n\t\n\treturn max_distance;\n}\n\nvec3 getNormal(vec3 point)\n{\n  float d0 = de(point);\n  float dX = de(point - vec3(epsilon, 0.0, 0.0));\n  float dY = de(point - vec3(0.0, epsilon, 0.0));\n  float dZ = de(point - vec3(0.0, 0.0, epsilon));\n\t\n  vec3 r = vec3(dX-d0, dY-d0, dZ-d0);\n  return normalize(r);\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = (2.0*fragCoord.xy -iResolution.xy) / iResolution.y;\n\t\n\tvec3 eye_pos = vec3(0.0, 0., 3.);\n\t\n\tvec3 ray_dir = normalize(vec3(uv, -1.));\n\n\tfloat d = march(eye_pos, ray_dir);\n\tvec3 point = eye_pos + ray_dir*d;\n    \n    vec3 normal = getNormal(point);\n\n\tvec3 color = texture(iChannel0, normal).xyz;\n    color = mix(color, vec3(.4), 1.-exp(-.01*d*d));\n    \n    fragColor = vec4(color,1.0);\n}","name":"Image","description":"","type":"image"}]}