{"ver":"0.1","info":{"id":"XssBWn","date":"1495665886","viewed":155,"name":"Audio Viz - Freq - Rainbow Psy","username":"DonKarlssonSan","description":"psy trance","likes":2,"published":1,"flags":64,"usePreview":0,"tags":["audio","soundcloud"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"MslXz7","filepath":"https://soundcloud.com/cyrusthevirus/cyrus-the-virus-less-is-more-spiritual-connection","previewfilepath":"https://soundcloud.com/cyrusthevirus/cyrus-the-virus-less-is-more-spiritual-connection","type":"musicstream","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":0}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// From Stackoveflow\n// http://stackoverflow.com/questions/15095909/from-rgb-to-hsv-in-opengl-glsl\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat getAverage(float start, float end) {\n    float sum = 0.0;\n    int count = 0;\n    for(float i = start; i < end; i += 1.0/512.0) {\n        sum += texelFetch(iChannel0, ivec2(int(i*512.0), 0), 0).x;\n        count++;\n    }\n    float average = sum/float(count);\n    return average;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord.xy / iResolution.xy;\n    \n    int bars = 32;\n    float stepSize = 1.0 / float(bars);\n    int currentBar = int(uv.x * float(bars));\n    float currentMin = float(currentBar) * stepSize;\n    float currentMax = float(currentBar+1) * stepSize;\n    float average = getAverage(currentMin, currentMax);\n    bool b = average > uv.y ;\n    \n    vec3 hsv = vec3(uv.x, average, float(b)); \n    vec3 rgb = hsv2rgb(hsv);\n    \n\tfragColor = vec4(rgb, 1.0);\n}","name":"Image","description":"","type":"image"}]}