{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n// Created by S.Guillitte \n//based on Pustules by nimitz :https://www.shadertoy.com/view/XdSXDc\n//Using code from Knighty : https://www.shadertoy.com/view/XlX3zB\n\n\n\n#define PI\t3.14159265359\n#define PI2\t( PI * 2.0 )\n\n#define time iTime\n\n\n// 1 = 3*3*3 kernel, 0 = 2*2*2 kernel\n#if 0\nfloat k2 = 1.;\nconst int m =1;\n#else\nfloat k2 = .7;\nconst int m =0;\n#endif\n\n\nfloat hash( in vec3 p ) \n{\n    return fract(sin(p.x*15.32758341+p.y*39.786792357+p.z*59.4583127+7.5312) * 43758.236237153)-.5;\n}\n\n\nvec3 voronoi(in vec3 p)\n{    \n    vec3 ip = floor(p);\n    vec3 fp = fract(p);\n\tfloat rid = -1.;\n    vec2 r = vec2(2.);\n    for (int i=-1; i<=m; i++) \n\tfor (int j=-1; j<=m; j++) \n\tfor (int k=-1; k<=m; k++) \n\t{\n\t\tvec3 g = vec3(i, j, k);\n        float h = hash(ip - g);\n        vec3 pp = fp +g +h*k2;\n        float d = dot(pp, pp);\n\n        if (d < r.x)\n\t\t{\n            r.y = r.x;\n            r.x = d;\n            rid = h +.5;\n\t\t}\n        else if(d < r.y)\n\t\t{\n    \t\tr.y = d;\n\t\t}\n\t}    \n    return vec3(r,rid);\n}\n\n\n\n//-------------------------------------------------\n//From https://www.shadertoy.com/view/XtXGRS#\nvec2 rotate(in vec2 p, in float t)\n{\n\treturn p * cos(-t) + vec2(p.y, -p.x) * sin(-t);\n}\n\n\nfloat map( vec3 p)\n{\n\tfloat d = length(p)-1.5;\n    vec3 vor = voronoi(p*5.0);\n    vor.y += vor.x;\n    d = max( d, (d-((vor.x+vor.y)-1.))*.15 );\n\treturn d;\t\n       \t\n}\n\n\nvec3 calcNormal(in vec3 p)\n{\n\tconst vec2 e = vec2(0.0001, 0.0);\n\treturn normalize(vec3(\n\t\tmap(p + e.xyy) - map(p - e.xyy),\n\t\tmap(p + e.yxy) - map(p - e.yxy),\n\t\tmap(p + e.yyx) - map(p - e.yyx)));\n}\n\nfloat march(in vec3 ro, in vec3 rd)\n{\n\tconst float maxd = 5.0;\n\tconst float precis = 0.001;\n    float h = precis * 2.0;\n    float t = 0.0;\n\tfloat res = -1.0;\n    for(int i = 0; i < 128; i++)\n    {\n        if(h < precis*t || t > maxd) break;\n\t    h = map(ro + rd * t);\n        t += h;\n    }\n    if(t < maxd) res = t;\n    return res;\n}\n\nvec3 transform(in vec3 p)\n{\n    p.yz = rotate(p.yz, iTime * 0.2 + (iMouse.y-0.5*iResolution.y)*PI2/360.);\n    p.zx = rotate(p.zx, iTime * 0.125 + (0.5*iResolution.x-iMouse.x)*PI2/360.);\n    return p;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 p = (2.0 * fragCoord.xy - iResolution.xy) / iResolution.y;\n\tvec3 col = vec3(.3);\n   \tvec3 rd = normalize(vec3(p, -2.));\n\tvec3 ro = vec3(0.0, 0.0, 3.5);\n    vec3 li = normalize(vec3(0.5, 0.8, 3.0));\n    ro = transform(ro);\n\trd = transform(rd);\n\tli = transform(li);\n    \n    //Marble background from Nimitz's Pustule\n    vec3 bgvor = voronoi(rd*4.2)*0.35;\n    bgvor += voronoi(rd*9.)*0.25;\n    bgvor += voronoi(rd*25.)*0.1;\n    bgvor.y -= bgvor.x;\n    col = ((bgvor.z*.6 + 0.2)*(.5 - bgvor.x*1.5*(1.5 - bgvor.y*10.)))\n        *(sin(vec3(1.7,1.5,1)+.5 + voronoi(rd*24.).x)*0.5 + 0.5);\n    \n    float t = march(ro, rd);\n    if(t > -0.001)\n    {\n        vec3 pos = ro + t * rd;\n        vec3 nor = calcNormal(pos);\n\t\tfloat dif = clamp(dot(nor, li), 0.0, 1.0);\n        float c = voronoi(pos*5.).x;\n        vec3 col1 =vec3(c*c,c,.9)*c;\n        nor = reflect(rd, nor);\n        col1 += pow(max(dot(li, nor), 0.0), 25.0)*vec3(1.);\n\t    col = .1+col1;\n        col = col * dif;\n        \n\t}\n    \n   \tfragColor = vec4(col, 1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"MtsGDS","date":"1424969136","viewed":499,"name":"Voronoi 2x2x2","username":"guil","description":"Experiment with 3d voronoi \"cellular noise\"\nBased on Nimitz Pustules : https://www.shadertoy.com/view/XdSXDc\nI mainly tried to optimize the  voronoi3d with 2x2x2 kernel","likes":15,"published":1,"flags":0,"usePreview":0,"tags":["3d","voronoi","noise"],"hasliked":0,"parentid":"","parentname":""}}