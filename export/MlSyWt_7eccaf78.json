{"ver":"0.1","info":{"id":"MlSyWt","date":"1510544694","viewed":546,"name":"Ink Bloom","username":"mplanck","description":"Creates these cool looking voronoi like bloom patterns. I keep playing with evolving diffusion math and stumbling onto effects like this.","likes":22,"published":1,"flags":32,"usePreview":1,"tags":["bloom","diffusion","ink"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec3 scol = texelFetch(iChannel0, ivec2(fragCoord), 0).rgb;\n\tfragColor.rgb = pow(scol, vec3(1.8));\n    fragColor.a = 1.0f;\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"XdfGRn","filepath":"/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","previewfilepath":"/media/ap/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","type":"texture","channel":3,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dfGRn","filepath":"/media/a/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","previewfilepath":"/media/ap/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsX3Rn","filepath":"/media/a/92d7758c402f0927011ca8d0a7e40251439fba3a1dac26f5b8b62026323501aa.jpg","previewfilepath":"/media/ap/92d7758c402f0927011ca8d0a7e40251439fba3a1dac26f5b8b62026323501aa.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"float luminosity(vec3 color)\n{\n    return dot(vec3(0.21, 0.71, .07), color);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // give some time for the images to load\n    int frame = iFrame - 30;\n    \n    vec2 this_coord = fragCoord/iResolution.xy;\n    vec3 scol = vec3(0.);\n    if (frame >= 0)\n    {\n        if (frame%600 == 0)\n        {        \n            int selector = (frame/600)%3;\n\n            if (selector == 0) \n            {\n            \tscol = textureLod(iChannel1, this_coord, 0.).rgb;\n            } \n            else if (selector == 1)\n            {\n            \tscol = textureLod(iChannel2, this_coord, 0.).rgb;\n            }\n            else if (selector == 2)\n            {\n            \tscol = textureLod(iChannel3, this_coord, 0.).rgb;            \n            }\n\n        }\n        else\n        {\n            vec3 this_color = textureLod(iChannel0, this_coord, 0.).rgb;\n            float this_value = luminosity(this_color);\n            \n            // the lower you make the starting value of this color's influence,\n            // the faster the diffusion goes.\n            float this_color_alpha = .8;\n            vec4 accum = vec4(0.);\n            \n            for (int i = -1; i<=1; i += 1)\n            {\n                for (int j = -1; j<=1; j += 1)\n                {\n\n                    if (i == 0 && j == 0) {\n                        continue;\n                    }\n                    \n                    vec2 coord_offset = vec2(i, j);                \n                    vec2 neighbor_coord = vec2(this_coord) + 1. * coord_offset/iResolution.xy;\n                    neighbor_coord;\n\n                    vec3 neighbor_color = vec3(0.);\n                    \n                    // simple boundary conditions\n                    if (neighbor_coord.x < 0. || neighbor_coord.x >= 1. || \n                        neighbor_coord.y < 0. || neighbor_coord.y >= 1.)\n                    {\n                        neighbor_color = this_color;\n                    }\n                    else\n                    {\n                        neighbor_color = textureLod(iChannel0, neighbor_coord, 0.).rgb;\n                    }\n\n                    float neighbor_value = luminosity(neighbor_color);\n\n                    float l = sqrt(dot(vec2(1.), abs(vec2(coord_offset))));\n                    float d = .5 * (neighbor_value - this_value) / l;                    \n                    \n                    if (d > 0.) {\n\t                    accum.rgb += neighbor_color * d;\n    \t                accum.a += d;\n                    } else {\n        \t            this_color_alpha += d;\n                    }\n                }\n            }\n            this_color_alpha = max(this_color_alpha, 0.01);\n            \n            accum.rgb += this_color * this_color_alpha;\n            accum.a += this_color_alpha;\n\n            accum.rgb /= accum.a;\n\n            scol = accum.rgb;\n\t    }\n    }\n\n    // Great recommendation by Ultraviolet to add interactivity!\n\t// Note that if you add ink in areas that are already over bright,\n    // while the ink is going through a lower value, it could get absorbed\n    // by surrounding difference.\n    // So draw in dark areas for more blooming effect\n    if(length(iMouse.xy-fragCoord.xy)<5. && iMouse.z>.5) {\n        scol *= 1.02;\n    }\n    \n    fragColor = vec4(scol,1.0);\n}","name":"Buffer A","description":"","type":"buffer"}]}