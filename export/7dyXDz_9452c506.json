{"ver":"0.1","info":{"id":"7dyXDz","date":"1634491064","viewed":337,"name":" Fab17 #inktober2021 \"collide\"","username":"FabriceNeyret2","description":"[url]https://inktober.com/[/url]\n#inktober2021 themes: [img]https://i.imgur.com/QjhAdpd.png[/img]\n\nclick to reset.   set nÂ² = nb partics in Common.   try other B(U)  shapes.\n\n","likes":22,"published":3,"flags":32,"usePreview":0,"tags":["2d","simulation","physics","inktober2021"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// reusing bits of https://shadertoy.com/view/sdtSRs\n\nvoid mainImage(out vec4 O, vec2 U)\n{\n    O = T(U);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4sf3Rr","filepath":"/media/a/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","previewfilepath":"/media/ap/ad56fba948dfba9ae698198c109e71f118a54d209c0ea50d77ea546abad89c57.png","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"// --- draw scene + gradient ( could be done just once )\n\nvoid mainImage(out vec4 O, vec2 u)\n{\n     vec2  U = ( u+u - R ) / R.y;\n     float d = B(U);\n     U = abs( 2.*u/R-1. ); d -= 4.*max(0.,max(U.x,U.y)-.9); // band guard at screen borders.\n     O = vec4( d, normalize(vec2(dFdx(d), dFdy(d))), 0 );\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define R         iResolution.xy\n#define S(v)      smoothstep(5./R.y,0., v ) \n//#define H(p)    ( 2.*fract(sin((p)*mat2(127.1,311.7, 269.5,183.3)) *43758.5453123) -1. )\n#define T(U)      texelFetch( iChannel0, ivec2(U), 0 )\n#define hue(v)  ( .6 + .6 * cos( 6.3*(v)  + vec4(0,23,21,0)  ) )\n\nint n = 12;       // n*n particles\n\n// --- custom scene SDF\n\n//float K = 32.;    // smooth min: https://iquilezles.org/articles/smin\n//#define B(U) ( .9 + log2(exp2(-K*length(U-vec2(.7,0)))+exp2(-K*length(U+vec2(.7,0))) )/K )\n  #define B(U) ( .9 - length(U/vec2(2,1)) + map(U).x-.4 ) \n\n#define map(U) texture(iChannel1, .5+.5*((U)*R.y/R) )","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"// --- physics: simulate particles   .xy = pos, .zw = v.dt\n\nvoid mainImage(out vec4 O, vec2 U)\n{\n    if ( max(U.x,U.y) > float(n) ) return;                    // only 64 partics\n    \n    if (iFrame==0 || iMouse.w>0.) \n     // { O = vec4( H(U), .01*H(U+.1) ); return; }            // init\n        { U-=.5; float i = U.x+float(n)*U.y;\n          O = vec4( 0,0, .01*cos(3.1415*(2.*i/float(n*n)-1.)+vec2(0,-1.57)) ); return; } // init\n                      // variant: .7+.2*(\n    O = T(U);                                                 // recover previous state\n    O.xy += O.zw;                                             // move particle\n    \n    vec4 T = map(O.xy);                                       // scene SDF + gradient \n    if ( T.x < 0.)                                            // collision with border\n        O.zw = reflect( O.zw, T.yz ),                         // bounce\n        O.xy += 2.*O.zw; // decollision.  NB: can't be merged with previous line: GLSL bug !\n    if ( length(O.xy) > 2. ) O.xy *= 0.;                      // in case a particle escaped, relauch\n}","name":"Buffer B","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4sXGR8","channel":0}],"code":"// --- draw particles with memory\n\nvoid mainImage(out vec4 O, vec2 u)\n{\n    vec2  U = ( u+u - R ) / R.y;\n    float d = 9., l; int i, k=0;\n\n    for (; k <n*n; k++)                               // particle closest to pixel\n      l = length( T(vec2(k%n,k/n)).xy - U ),\n      l < d ? d = l, i = k : i;\n    \n    O = max(     S(d-.01) * hue(float(i)/float(n*n))  // draw particle\n               + S( map(U).x)                         // draw scene\n             , .99 *texture(iChannel2,u/R)            // blend past for trajectories\n           );\n}","name":"Buffer C","description":"","type":"buffer"}]}