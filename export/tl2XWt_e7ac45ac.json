{"ver":"0.1","info":{"id":"tl2XWt","date":"1567531810","viewed":121,"name":"kompot","username":"foran","description":"kompot","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["kompot"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI 3.14158\n#define TAU PI*2.\n#define t iTime*.13\n\nfloat sphere (vec3 p, float r) { return length(p)-r; }\nfloat cyl (vec2 p, float r) { return length(p)-r; }\nfloat sdBox(vec3 p,vec3 b)\n{ vec3 d=abs(p)-b; return length(max(d,0.)) +min(max(d.x,max(d.y,d.z)),0.);// remove this line for an only partially signed sdf\n}\nvec3 moda (vec2 p, float count) {\n  float an = TAU/count;\n  float a = atan(p.y,p.x)+an/2.;\n  float c = floor(a/an);\n  a = mod(a,an)-an/2.;\n  c = mix(c, abs(c), step(count/2., abs(c)));\n  return vec3(vec2(cos(a),sin(a))*length(p),c); \n}\nmat2 rot (float a) { float c=cos(a),s=sin(a); return mat2(c,-s,s,c); }\n\nfloat smin (float a, float b, float r) {\n  float h = clamp(.5+.5*(b-a)/r, 0.,1.);\n  return mix(b,a,h)-r*h*(1.-h);\n}\n\nfloat map (vec3 p);\n\nvec3 normal (vec3 p){\n  float e = 0.01;\n  return normalize(vec3(map(p+vec3(e,0,0))-map(p-vec3(e,0,0)),\n  map(p+vec3(0,e,0))-map(p-vec3(0,e,0)),\nmap(p+vec3(0,0,e))-map(p-vec3(0,0,e))));\n}\n\nfloat iso (vec3 p, float r) { return dot(p, normalize(sign(p)))-r; }\n\nfloat map (vec3 p) {\n  p.xy *= rot(t);\n  p.yz *= rot(t*.5);\n  p.xz *= rot(t*.3);\n  p.xz *= rot(p.y*.3+t);\n\n  float cyl2 = cyl(p.xz, .3+.8 * (.5+.5*sin(p.y*1.+t*10.)));\n  float a = atan(p.y,p.x);\n  float l = length(p.xy);\n  float c = 1.;//   10\n  p.x = mod(abs(l*.95-4.)+t*1., c)-c/2.;\n  //p.y = cos(a)*10.;\n\n  vec3 p1 = moda(p.xz, 8.);//      20\n  float wave1 = sin(t*10.+p.y*0.5+p1.z);\n  p1.x -= 2.+(.5+.5*wave1);\n  p.xz = p1.xy;\n  float celly = 3.;\n  vec3 p2 = p1;\n  p.y = mod(p.y+t*10.+p1.z,celly)-celly/2.;\n  float sph1 = sphere(p, 0.2+.2*(.5+.5*sin(p.y+t*10.)));\n  float cyl1 = cyl(p.xz, 0.2*wave1+.02);\n  float box=sdBox(p-vec3(0,-wave1,0),vec3(2.*.125));\n  float box1=sdBox(p-vec3(0,0,0),vec3(.3+.8*(.5+.5*sin(t*10.))));\n  float scene=smin(cyl1,box,.3);\n  scene=smin(scene,cyl2,.3);\n    \n  p.y = mod(p.y+t*10.,celly)-celly/2.;\n  float iso1 = iso(p,0.2+.2*wave1);\n  scene = smin(scene, iso1, .13);\n  return scene;\n}\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord)\n\n{\n  vec2 uv = (fragCoord.xy-.5*iResolution.xy)/iResolution.y;\n  vec3 eye = vec3(uv, -5.), ray = (vec3(uv,.5)), pos = eye;\n  int ri = 0;\n  for (int i = 0; i < 50; ++i) {\n    float dist = map(pos);\n    if (dist < 0.01) {\n      break;\n    }\n    pos += ray*dist;\n    ri = i;\n  }\n  vec3 n = normal(pos);\n  float ratio = float(ri)/50.;\n  vec4 color = vec4(1.);\n  color.rgb = n*.5+.5;\n  color.rgb *= 1.- ratio;\n  fragColor = vec4(color.rgb,1.0);\n\n}","name":"Image","description":"","type":"image"}]}