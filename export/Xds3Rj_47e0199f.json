{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"const int LIGHTNING_PARTS = 10;\n\nfloat hash(float x)\n{\n\treturn fract(21654.6512 * sin(385.51 * x));\n}\n\nfloat hash(vec2 p)\n{\n\treturn fract(21654.65155 * sin(35.51 * p.x + 45.51 * p.y));\n}\n\nfloat lhash(float x, float y)\n{\n\tfloat h = 0.0;\n\t\n\tfor(int i = 0;i < 5;i++)\n\t{\n\t\th += (fract(21654.65155 * float(i) * sin(35.51 * x + 45.51 * float(i) * y * (5.0 / float(i))))* 2.0 - 1.0) / 10.0;\n\t}\n\treturn h / 5.0 + 0.02;\n\treturn (fract(21654.65155 * sin(35.51 * x + 45.51 * y))* 2.0 - 1.0) / 20.0;\n}\n\nfloat noise(vec2 p)\n{\n\tvec2 fl = floor(p);\n\tvec2 fr = fract(p);\n\t\n\tfr.x = smoothstep(0.0,1.0,fr.x);\n\tfr.y = smoothstep(0.0,1.0,fr.y);\n\t\n\tfloat a = mix(hash(fl + vec2(0.0,0.0)), hash(fl + vec2(1.0,0.0)),fr.x);\n\tfloat b = mix(hash(fl + vec2(0.0,1.0)), hash(fl + vec2(1.0,1.0)),fr.x);\n\t\n\treturn mix(a,b,fr.y);\n}\n\n\nfloat distanceToSegment( vec2 a, vec2 b, vec2 p )\n{\n\tvec2 pa = p - a;\n\tvec2 ba = b - a;\n\tfloat h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n\t\n\treturn length( pa - ba*h );\n}\n\nfloat fbm(vec2 p)\n{\n\tfloat v = 0.0, f = 1.0, a = 0.5;\n\t\n\tfor(int i = 0;i < 5; i++)\n\t{\n\t\tv += noise(p * f) * a;\n\t\t\n\t\tf *= 2.0;\n\t\ta *= 0.5;\n\t}\n\t\n\treturn v;\n}\nfloat lightning2(vec2 ls, vec2 le, float intensity,vec2 uv)\n{\n\tfloat f = 1.0;\n\t\n\tfor(int i = 0;i < LIGHTNING_PARTS;i++)\n\t{\n\t\t\n\t\tvec2 ltemp1 = mix(ls,le,float(i) / float(LIGHTNING_PARTS));\n\t\tvec2 ltemp2 = mix(ls,le,float(i+1) / float(LIGHTNING_PARTS));\n\t\tfloat h3= fract(21654.65155 * sin(35.51 * ls.x));\n\t\tfloat lh1 = lhash(ltemp1.y, iTime);\n\t\tfloat lh2 = lhash(ltemp2.y, iTime);\n\t\tltemp1.x += lh1;\n\t\tltemp2.x += lh2;\n\t\t\n\t\tif(i == 0)\n\t\t\tf = min(f,distanceToSegment(ls, ltemp2, uv ));\n\t\t//else if(i == LIGHTNING_PARTS - 1)\n\t\t\t//f = min(f,distanceToSegment(ltemp1, le, uv ));\n\t\telse\t\t\t\n\t\t\tf = min(f,distanceToSegment(ltemp1, ltemp2, uv ));\n\t\t//if(abs(h3) > 0.07 && intensity > 0.1)\t\t\t\n\t\t\t//f = min(f,lightning(ltemp1, vec2(mix(ltemp1, le, 0.5) + vec2(lh1 * 3.0 - h3 * 5.0,h3 * 5.0)),intensity * 0.5,uv));\n\t\n\t\t//\tf = min(f,distanceToSegment(ltemp1, vec2(mix(ltemp1, le, 0.5) + vec2(lh1 * 3.0 - h3 * 5.0,h3 * 5.0)),uv));\n\t}\n\t\n\treturn f;\n}\n\nfloat lightning(vec2 ls, vec2 le, float intensity,vec2 uv)\n{\n\tif(intensity < 0.3)\n\t\treturn 1.0;\n\t\n\tfloat f = 1.0;\n\t\n\tfor(int i = 0;i < LIGHTNING_PARTS;i++)\n\t{\n\t\t\n\t\tvec2 ltemp1 = mix(ls,le,float(i) / float(LIGHTNING_PARTS));\n\t\tvec2 ltemp2 = mix(ls,le,float(i+1) / float(LIGHTNING_PARTS));\n\t\tfloat h3 = fract(22654.65155 * ls.x * sin(3542.51 * ltemp1.y * le.y)) - sqrt(ltemp1.y) + 0.6;\n\t\tfloat lh1 = lhash(ltemp1.y + ltemp1.x, iTime);\n\t\tfloat lh2 = lhash(ltemp2.y + ltemp2.x, iTime);\n\t\tltemp1.x += lh1;\n\t\tltemp2.x += lh2;\n\t\t\n\t\tif(i == 0)\n\t\t\tf = min(f,distanceToSegment(ls, ltemp2, uv ));\n\t\telse\t\t\t\n\t\t\tf = min(f,distanceToSegment(ltemp1, ltemp2, uv ));\n\t\tif(h3 > 0.9)\t\t\t\n\t\t\tf = min(f,sqrt(float(i + 2)) * lightning2(ltemp1, vec2(le.x + ltemp1.y + sqrt(h3) - 1.0 + lh1 * 7.0,le.y),intensity * 0.5,uv)) ;\n\t}\n\t\n\treturn f;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\tuv = uv*2.0 -1.0;\n\tuv.x *= iResolution.x / iResolution.y;\t\n\t\t\n\t//fractal brownian motion\n\tvec2 cad = uv + vec2(iTime,0.0);\t \n\tfloat p = fbm(cad);\t\n\tp = 1.0 - abs(p * 2.0 - 1.0);\n\t\n\t//Background\n\tvec3 col = pow(vec3(p),vec3(0.3)) - (uv.y + 3.0) * 0.2;\n\t\n\t\n\t\n\tvec2 ls = vec2(0.0,1.01);\n\tvec2 le = vec2(0.0 ,-1.0);\n\t//ls.x = mod(-iTime,2.0)-1.0;\n\t//le.x = mod(-iTime,2.0)-1.0;\n\t\n\tfloat f = 1.0;\n\tfor(int i = 0; i < 10; i++ )\n\t{\n\t\t//Lightning Seeds\n\t\tfloat h = hash(vec2(sqrt(float(i)),floor((iTime) * 7.0 + (float(i) / 10.0)) * float(i)));\n\t\tls.x = hash(h) * 3.0  - mod(iTime,3.0);\n\t\tle.x = ls.x + sqrt(hash(sqrt(h + float(i)))) - 0.5;\n\t\t\n\t\tif(h > 0.96)\n\t\t\tf = min(f,lightning(ls,le,1.0,uv));\t\n\t}\n\tcol = mix( col, vec3(1.0), 1.0-smoothstep(0.0,0.2,pow(f / 2.0,0.5) - uv.y/40.0) );\n\t\n\tfragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"Xds3Rj","date":"1375018691","viewed":2644,"name":"Lightining","username":"asti","description":"Some random lightning with a fractal brownian motion as background","likes":47,"published":1,"flags":0,"usePreview":0,"tags":["2d","lightning"],"hasliked":0,"parentid":"","parentname":""}}