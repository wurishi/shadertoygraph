{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[],"code":"#define period 15.\n#define fxrand floor(iTime/period)+iDate.z\n#define hash1 rnd(fxrand)\n#define hash2 rnd(fxrand+.111)\n#define hash3 rnd(fxrand+.222)\n#define hash4 rnd(fxrand+.333)\n#define hash5 rnd(fxrand+.444)\n#define hash6 rnd(fxrand+.555)\n#define hash7 rnd(fxrand+.666)\n#define hash8 rnd(fxrand+.777)\n#define hash9 rnd(fxrand+.877)\n#define hash10 rnd(fxrand+.997)\n#define hash11 rnd(fxrand+1.11777)\n#define hash12 rnd(fxrand+1.411777)\n\nconst mat2 m = mat2( 1.6, .2, -1.2,  1.6 );\nvec2 uvd;\nfloat zoom;\n\nfloat hashh(vec2 p) {\n\treturn fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x))));\n}\n\nfloat hash(vec2 p)\n{\n\tvec3 p3  = fract(vec3(p.xyx) * .1031);\n    p3 += dot(p3, p3.yzx + 33.33);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nfloat noise(vec2 x) {\n\tvec2 i = floor(x);\n\tvec2 f = fract(x);\n\tfloat a = hash(i);\n\tfloat b = hash(i + vec2(1.0, 0.0));\n\tfloat c = hash(i + vec2(0.0, 1.0));\n\tfloat d = hash(i + vec2(1.0, 1.0));\n\tvec2 u = f * f * (3.0 - 2.0 * f);\n\treturn mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\nfloat fbm (in vec2 p) {\n\n    float value = 0.0;\n    float freq = 1.0;\n    float amp = .5;\n\n    for (int i = 0; i < 14; i++) {\n        value += amp * (noise((p - vec2(1.0)) * freq));\n        freq *= 1.9;\n        amp *= 0.6;\n    }\n    return value;\n}\n\n\nmat2 rot(float a)\n{\n    float s=sin(a), c=cos(a);\n    return mat2(c,s,-s,c);\n}\n\nfloat rnd(float p)\n{\n    p*=1234.5678;\n    p = fract(p * .1031);\n    p *= p + 33.33;\n    return fract(2.*p*p);\n}\n\n\nfloat rand(float r){\n\tvec2\tco=vec2(cos(r*428.7895),sin(r*722.564));\n\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n\nvec3 render(vec3 dir)\n{\n\tfloat s=0.3,fade=1., fade2=1., pa=0., sd=0.2;\n\tvec3 v=vec3(0.);\n    dir.y+=4.*hash4;\n    dir.x+=hash5;\n\tfor (float r=0.; r<15.; r++) {\n\t\tvec3 p=s*dir;\n        mat2 rt=rot(r);\n        p.xz*=rt;\n        p.xy*=rt;\n        p.yz*=rt;\n\t\tp = abs(1.-mod(p*(hash1*2.+1.),2.));\n\t\tfloat pa,a=pa=0.;\n\t\tfor (int i=0; i<13; i++) {\n\t\t\tif (float(i)>mod(iTime,period)*10.) break;\n\t\t\tp=abs(p)/dot(p,p)-.7-step(.5,hash10)*.1;\n\t\t\tfloat l=length(p)*.5;\n\t\t\ta+=abs(l-pa);\n\t\t\tpa=length(p);\n\t\t}\n        fade*=.96;\n\t\tsd+=.5;\n\t\tfloat cv=abs(2.-mod(sd,4.));\n\t\tv+=normalize(vec3(cv*2.,cv*cv,cv*cv*cv))*pow(a*.02,2.)*fade;\n\t\tv.rb*=rot(hash3*3.);\n        v=abs(v);\n\t\tpa=a;\n\t\ts+=.05;\n\t}\n\tfloat sta=v.x;\n\tvec3 roj=vec3(1.5,1.,.8);\n\tuvd.x*=sign(hash12-.5);\n\tuvd*=rot(radians(360.*hash8));\n\tuvd.y*=1.+(uvd.x+.5)*1.;\n\tv=pow(v,1.-.5*vec3(smoothstep(.5,0.,abs(uvd.y))));\n\tv+=.04/(.1+abs(uvd.y*uvd.y))*roj*min(1.,iTime*.3);\n\tfloat core=smoothstep(.3,0.,length(uvd))*1.2*min(1.,iTime*.3);\n\tv+=core*roj;\n\tv=mix(vec3(length(v)*.7),v,.45);\n\tfloat neb=fbm(dir.xy*15.)-.5;\n\tuvd.y+=neb*.3;\n\tneb=pow(smoothstep(.8,.0,abs(uvd.y)),2.)*.9;\n\tv=mix(v*vec3(1.,.9,1.2),vec3(0.),max(neb,.7-neb)+core*.06-sta*.1);\n\treturn pow(v,vec3(1.05))*1.2;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    zoom=iMouse.z>0.?2.:0.;\n    vec2 uv = fragCoord/iResolution.xy-.5;\n    uv.x*=iResolution.x/iResolution.y;\n\tuvd=uv;\n\tvec2 m=iMouse.xy/iResolution.xy-.5;\n    m.x*=iResolution.x/iResolution.y;\n\tfloat fade=.5;\n\tif (step(.3,length(uv-m))<.5&&zoom>0.1) {\n\t\tfloat zo=.4/zoom;\n\t\tuv-=m;\n\t\tuvd-=m;\n\t\tuv*=zo;\n\t\tuvd*=zo;\n\t\tuv+=m;\n\t\tuvd+=m;\n\t\tfade=1.;\n\t}\n    vec3 dir=normalize(vec3(uv,1.));\n    vec3 col = render(dir);\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"fdyfDm","date":"1658267622","viewed":952,"name":"Night's Backbone","username":"Kali","description":"Procedural galactic arms. Kaliset fractal for the stars, fbm for dust cloud. It generates new one every 15 sec with different seed each day. Click mouse for telescope mode.","likes":78,"published":1,"flags":0,"usePreview":0,"tags":["procedural","fbm","galaxy","stars","kset"],"hasliked":0,"parentid":"","parentname":""}}