{"ver":"0.1","info":{"id":"Wd23R1","date":"1548163257","viewed":190,"name":"Lambert Torus","username":"valler","description":"Lambert","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["ray","distance","lambert","field","march"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// https://iquilezles.org/articles/distfunctions\nfloat sdTorus( vec3 p, vec2 t )\n{\n  vec2 q = vec2(length(p.xz)-t.x,p.y);\n  return length(q)-t.y;\n}\n\nfloat f (vec3 p)\n{\n    return sdTorus(p,vec2(1.,.5));\n}\n\n// https://iquilezles.org/articles/normalsSDF\nvec3 calcNormal( vec3 p, float t )\n{\n    float e = 1.e-3*t;\n    vec2 h = vec2(1.0,-1.0)*0.5773;\n    return normalize( h.xyy*f( p + h.xyy*e ) + \n\t\t\t\t\t  h.yyx*f( p + h.yyx*e ) + \n\t\t\t\t\t  h.yxy*f( p + h.yxy*e ) + \n\t\t\t\t\t  h.xxx*f( p + h.xxx*e ));\n}\n\nvec3 bg (vec2 p)\n{    \n    return normalize(vec3(fract(fract(p*.5)+sin(p.yx)),1.3)*.5-.5);\n}\n\nvec3 lambert (vec3 c, vec3 n, vec4 l)\n{\n\treturn max(0.,dot(n,l.xyz))*c*l.w;\n}\n\nvoid mainImage( out vec4 c, in vec2 a )\n{\n    vec2 s = (a-.5*iResolution.xy)/iResolution.x;\n    vec3 o = vec3(0,3.,0);\n    vec3 y = vec3(0,1,0);\n    vec3 w = normalize(-o);\n    if (abs(dot(o,y)) > .999) y = y.yxx;\n    vec3 u = normalize(cross(w,y));\n\tvec3 d = mat3(u,cross(u,w),w) * normalize(vec3(s,.25));\n    float t = 0., e = 1.e-4, h = 1.;\n    vec3 p = o+d*t;\n    float m = 1.e6;\n    while (t < m)\n    {\n        h = f(p);\n        if (h < e) break;\n        t = min(m,t+h);\n        p = o+d*t;\n    }\n    vec4 l = vec4(normalize(vec3(cos(iTime*.2),1,sin(iTime*.2))),1);\n    vec3 k = calcNormal(p,t);\n    vec3 n = t > e && t < m ? lambert(vec3(.025),k,l) : lambert(vec3(.5),-bg(10.*s),l);\n    c = vec4(sqrt(n),1);\n}","name":"Image","description":"","type":"image"}]}