{"ver":"0.1","info":{"id":"4djyWh","date":"1491907385","viewed":215,"name":"Sphere Distance Function tutoria","username":"sw","description":"tutorial\nSphere Distance Function.\ni created normal and camera to do lighting.\nthe direction of the light will change when dragging.","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["tutorial"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float distanceFunc(vec3 p){\n    return length(p) - 2.0;\n}\nvec3 getNormal(vec3 p){\n    float d = 0.0001;\n    return normalize(vec3(\n        distanceFunc(p + vec3(  d, 0.0, 0.0)) - distanceFunc(p + vec3( -d, 0.0, 0.0)),\n        distanceFunc(p + vec3(0.0,   d, 0.0)) - distanceFunc(p + vec3(0.0,  -d, 0.0)),\n        distanceFunc(p + vec3(0.0, 0.0,   d)) - distanceFunc(p + vec3(0.0, 0.0,  -d))\n    ));\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // fragment position\n    vec2 p = (fragCoord.xy * 2.0 - iResolution.xy) / min(iResolution.x, iResolution.y);\n    \n    // light\n    vec2 mouse=iMouse.xy/iResolution.xy;\n\tvec3 lightDir = normalize(vec3(mouse.x, mouse.y, 0.577));\n    \n    // camera\n    vec3 cPos = vec3(0.0,  0.0,  3.0);\n    vec3 cDir = vec3(0.0,  0.0, -1.0);\n    vec3 cUp  = vec3(0.0,  1.0,  0.0);\n    vec3 cSide = cross(cDir, cUp);\n    float targetDepth = 1.0; \n    \n    // ray\n    vec3 ray = normalize(cSide * p.x + cUp * p.y + cDir * targetDepth);\n    \n    // marching loop\n    float distance = 0.0;\n    float rLen = 0.0;     \n    vec3  rPos = cPos; \n    for(int i = 0; i < 16; i++){\n        distance = distanceFunc(vec3(0,0,0)+rPos);\n        rLen += distance;\n        rPos = cPos + ray * rLen;\n    }\n    \n    // hit check\n    if(abs(distance) < 0.001){\n        vec3 normal=getNormal(rPos);\n        float lighing=clamp(dot(normal,lightDir),0.0,1.0);\n        vec3 SurfaceColor=vec3(0.2,0.4,0.9);\n        fragColor.xyz = SurfaceColor*lighing;\n    }else{\n        fragColor = vec4(vec3(0.0), 1.0);\n    }\n\n}","name":"Image","description":"","type":"image"}]}