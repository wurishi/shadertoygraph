{"ver":"0.1","info":{"id":"WlBSRR","date":"1564735360","viewed":177,"name":"Polar Fold Test","username":"gaz","description":"Polar fold. used smooth minmum.","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["fold"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define PI\t3.14159265359\n#define PI2\tPI * 2.0\n#define rot(a) mat2(cos(a),sin(a),-sin(a),cos(a))\n\nfloat smin(float d1, float d2, float k)\n{\n    float h = clamp(0.5 + 0.5 * (d2 - d1) / k, 0.0, 1.0);\n    return mix(d2, d1, h) - k * h * (1.0 - h);\n}\n\nvec2 polarFold(vec2 p,float n)\n{\n    float h=floor(log2(n));\n    float a =PI2*exp2(h)/n;\n    for(int i=0;i<int(h)+2;i++)\n    {\n        vec2 v = vec2(-cos(a),sin(a));  \n        p-=2.0*min(0.0,dot(p,v))*v;\n        a*=0.5;\n    }\n    return p;\n}\n\nvec2 polarSmoothFold(vec2 p,float n)\n{\n    float h=floor(log2(n));\n    float a =PI2*exp2(h)/n;\n    for(int i=0; i<int(h)+2; i++)\n    {\n        vec2 v = vec2(-cos(a),sin(a));  \n \t\tp-=2.0*smin(0.0,dot(p,v),0.05)*v;\n        a*=0.5;\n    }\n    return p;\n}\n\nfloat map(vec3 p)\n{\n    p.xy *= rot(iTime*0.5);\n    p.yz *= rot(iTime*0.3);\n\n    p.xy=polarSmoothFold(p.xy,16.);\n    p.y -= 1.2;\n    return length(p)-0.3;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = (2.0 * fragCoord.xy - iResolution.xy) / iResolution.y;\n    \n    vec2 q = polarFold(uv,6.);\n    q.y-=iTime*0.8;\n    q.y=mod(q.y,0.4)-0.05;\n    vec3 col = vec3(0.2,0.5,0.1);\n    col = mix(col, vec3(0,0.15,0),step(0.0, q.x * q.y)); \n    col = mix(col, vec3(1,0.5,0)*0.7*dot(uv,uv), smoothstep(0.02, 0.0, abs(q.y)));\n    col = mix(col, vec3(0,0.6,1)*0.8*length(uv), smoothstep(0.02, 0.0, abs(q.x)));\n    \n \tvec3 ro = vec3(0,0,3);\n    vec3 rd = normalize(vec3(uv,-2));\n    float d, t = 0.0;\n    for(float i = 1.0;i > 0.0;i -= 1.0/30.0)\n    {\n     \tt += d = map(ro+t*rd);\n        if(d < 0.001)\n        {\n            col += i*i;\n            break;\n        }\n    }\n\tfragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}