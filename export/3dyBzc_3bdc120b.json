{"ver":"0.1","info":{"id":"3dyBzc","date":"1607606731","viewed":213,"name":"Fractal metamorphose","username":"gaz","description":"3d","likes":9,"published":1,"flags":0,"usePreview":0,"tags":["3d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void rot(inout vec3 p,vec3 a,float t){\n\ta=normalize(a);\n\tvec3 u=cross(a,p),v=cross(a,u);\n\tp=u*sin(t)+v*cos(t)+a*dot(a,p);   \n}\n\n#define sabs(a)sqrt((a)*(a)+1e-4)\nfloat scale;\nfloat map(vec3 p){\n \trot(p,vec3(cos(iTime*.07),sin(iTime*.06),sin(iTime*.05)*.5),iTime*.5+1.2*sin(iTime*.8));\n    p.x-=10.;\n    float s=2.;\n    p=sabs(p);\n    for(int j=0;j<8;j++){\n        p=-sign(p)*(sabs(sabs(sabs(p)-2.)-1.)-1.);\n        float l=(-2.13+.3*sin(iTime*.7+.5*sin(iTime*.5)))\n            /max(.43+.38*sin(iTime*.9+.3*sin(iTime*.8)),dot(p,p));\n        s*=l;\n        p*=l;\n        p-=.55+.01*sin(iTime*1.2+.5*sin(iTime*.5));\n    }\n    scale=s;\n    return dot(p,normalize(vec3(1,2,3)))/s;\n}\n\nvec3 calcNormal(vec3 p)\n{\n  vec3 n=vec3(0);\n  for(int i=0; i<4; i++){\n    vec3 e=.003*(vec3(9>>i&1,i>>1&1,i&1)*2.-1.);\n    n+=e*map(p+e);\n  }\n  return normalize(n);\n}\n\nfloat march(vec3 ro, vec3 rd, float near, float far)\n{\n    float t=near,d;\n    for(int i=0;i<90;i++)\n    {\n        t+=d=map(ro+rd*t);\n        if (d<.001) return t;\n        if (t>=far) return far;\n    }\n    return far;\n}\n\nvec3 doColor(vec3 p)\n{\n    return cos(vec3(3,2,8)+log(scale*.003)+iTime*1.5)*.5+.5;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord.xy*2.-iResolution.xy)/iResolution.y;\n    vec3 ro = vec3(0,0,120);\n    vec3 rd = normalize(vec3(uv,-2));\n    vec3 col= min(vec3(.8),.8*vec3(.03,.02,.01)/length(uv*.4));\n\tconst float maxd=150.;\n    float t=march(ro,rd,30.,maxd);\n    if(t<maxd)\n    {\n        vec3 p=ro+rd*t;\n        col=doColor(p); \n        vec3 n=calcNormal(p);      \n\t\tvec3 lightPos=ro+vec3(2,5,2);\n    \tvec3 li=normalize(lightPos-p);\n\t\tfloat dif=clamp(dot(n,li),0.,1.);\n        col*=max(dif,.2);\n        float rimd=pow(clamp(1.-dot(reflect(-li,n),-rd),0.,1.),2.5);\n\t\tfloat frn=rimd+2.2*(1.-rimd);\n    \tcol*=frn*.4;\n        col*=max(.5+.5*n.y,.3);\n        col*=exp2(-2.*pow(max(0.,1.-map(p+n*.8)/.8),2.));\n        col+=vec3(12,6,5)*pow(clamp(dot(reflect(rd,n),li),0.,1.),10.);\n    }\n    col*=1.5;\n    fragColor.xyz=col;\n}","name":"Image","description":"","type":"image"}]}