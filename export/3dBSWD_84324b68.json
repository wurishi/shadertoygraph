{"ver":"0.1","info":{"id":"3dBSWD","date":"1553727313","viewed":645,"name":"Anti fisheye / fisheye 2","username":"Xys","description":"Anti fisheye / fisheye","likes":3,"published":1,"flags":0,"usePreview":1,"tags":["fisheye"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dfGRn","filepath":"/media/a/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","previewfilepath":"/media/ap/8de3a3924cb95bd0e95a443fff0326c869f9d4979cd1d5b6e94e2a01f5be53e9.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n#define MAX_POWER -0.2 // negative : anti fish eye. positive = fisheye\n\n//Inspired by http://stackoverflow.com/questions/6030814/add-fisheye-effect-to-images-at-runtime-using-opengl-es\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )//Drag mouse over rendering area\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec2 ndcPos = uv * 2.0 - 1.0;\n\n    float aspect = iResolution.x / iResolution.y;\n    \n    //float u_angle = -2.4;\n    \n    float u_angle = -2.4 * sin(iTime * 2.0);\n    \n    float eye_angle = abs(u_angle);\n    float half_angle = eye_angle/2.0;\n    float half_dist = tan(half_angle);\n\n    vec2  vp_scale = vec2(aspect, 1.0);\n    vec2  P = ndcPos * vp_scale; \n    \n    float vp_dia   = length(vp_scale);\n    float rel_dist = length(P) / vp_dia;  \n    vec2  rel_P = normalize(P) / normalize(vp_scale);\n\n    vec2 pos_prj = ndcPos;\n    if (u_angle > 0.0)\n    {\n        float beta = rel_dist * half_angle;\n        pos_prj = rel_P * tan(beta) / half_dist;  \n    }\n    else if (u_angle < 0.0)\n    {\n        float beta = atan(rel_dist * half_dist);\n        pos_prj = rel_P * beta / half_angle;\n    }\n\n    vec2 uv_prj = pos_prj * 0.5 + 0.5;\n    vec2 rangeCheck = step(vec2(0.0), uv_prj) * step(uv_prj, vec2(1.0));   \n    if (rangeCheck.x * rangeCheck.y < 0.5)\n        fragColor = vec4(1.0, 1.0, 1.0, 1.0);\n    else {\n    \tvec4 texColor = texture(iChannel0, uv_prj.st);\n    \tfragColor = vec4( texColor.rgb, 1.0 );\n    }\n}","name":"Image","description":"","type":"image"}]}