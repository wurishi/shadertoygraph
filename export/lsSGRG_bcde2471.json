{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"keyboard","id":"4dXGRr","filepath":"/presets/tex00.jpg","sampler":{"filter":"nearest","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}},{"channel":2,"type":"texture","id":"XsX3Rn","filepath":"/media/a/92d7758c402f0927011ca8d0a7e40251439fba3a1dac26f5b8b62026323501aa.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":3,"type":"texture","id":"XdfGRn","filepath":"/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"// Base values\n#define COMPRESSION 400.0\n#define OUTER_SIZE 0.75\n#define INNER_HEIGHT 0.5\n#define INNER_ASPECT 0.3\n\nconst int Key_A = 65; // anger\nconst int Key_S = 83; // anger\nconst int Key_D = 68; // anger\n\nconst int Key_P = 80; // jimmy two-eyes\n\nvec2 Noise2( in vec3 x )\n{\n    vec3 p = floor(x.xzy);\n    vec3 f = fract(x.xzy);\n\tf = f*f*(3.0-2.0*f);\n//\tvec3 f2 = f*f; f = f*f2*(10.0-15.0*f+6.0*f2);\n\n\tvec2 uv = (p.xy+vec2(37.0,17.0)*p.z) + f.xy;\n\tvec4 rg = textureLod( iChannel0, (uv+0.5)/256.0, 0.0 );\n\treturn mix( rg.yw, rg.xz, f.z );\n}\n\t\t\nfloat Noise( in vec3 x )\n{\n\treturn Noise2(x).x;\n}\n\n// key is javascript keycode: http://www.webonweboff.com/tips/js/event_key_codes.aspx\nbool ReadKey( int key, bool toggle )\n{\n\tfloat keyVal = texture( iChannel1, vec2( (float(key)+.5)/256.0, toggle?.75:.25 ) ).x;\n\treturn (keyVal>.5)?true:false;\n}\n\nfloat diamond(vec2 uv, float squint, vec2 pupilCenter, float aspect, float height)\n{\n\tfloat ret = \n\t\tclamp((abs(uv.x - 0.5 + pupilCenter.x) / aspect + \n\t\t\t   abs(uv.y - 0.5 + pupilCenter.y) / squint - height * 0.5) * COMPRESSION,\n\t\t0.0, 1.0);\n\t\n\treturn 1.0 - ret;\n}\n\nvec3 eye(vec2 uv, float squintiness, float pupilAspect, float anger, float pulsatingPupil, float timeOffset)\n{\n\tfloat time = iTime/2.0 + timeOffset;\n\ttime += Noise(vec3(0,time,0));\n\t\n\t//float lookFlick = noise11(time * 1.0, 0.2) * 2.0 - 1.0;\n\tfloat lookFlick = floor(time)+smoothstep(0.0,0.05,fract(time));\n\tvec2 angles = (texture( iChannel0, vec2((lookFlick+.5)/256.0,.5), -100.0 ).rb-.5) * 0.5;\n\tangles += texture(iChannel0, vec2(iTime*.01)).xy*.001;\n\t\n\t// manual control\n\tif (iMouse.w > .00001)\n\t{\n\t\tangles.xy = -(iMouse.xy / iResolution.xy - vec2(0.5, 0.5));\n\t}\n\tangles.y *= 1.0 - squintiness;\n\t\n\tfloat blink = smoothstep(.0,.02,abs(Noise(vec3(iTime*.2,0,0))-.5 ));\t\n\tfloat squint = clamp(blink, 0.0, 1.0);\n\t\n\tsquint *= 1.0 - squintiness;\n\t\n\tfloat outer = diamond(uv, squint + abs(angles.y) * 0.25, angles * vec2(0.01, 0.05), 1.0 + abs(angles.x) * 0.075, OUTER_SIZE);\n\t\n\tfloat innerHeight = INNER_HEIGHT;\n\tfloat innerAspect = pupilAspect;\n\t\n\tinnerHeight = innerHeight * mix(0.825, 1.0, mix(0.0, abs(sin(iTime * anger * 40.0)), pow(pulsatingPupil, 2.0)));\n\tinnerHeight = mix(innerHeight, innerHeight * 0.875, anger);\n\t\n\tfloat inner = diamond(uv, mix(0.75, 1.0, squint), angles, innerAspect, innerHeight);\n\t//float glint = diamond(uv + vec2(0.05 * innerAspect, -0.0625), mix(0.75, 1.0, squint), angles, innerAspect, innerHeight * 0.1);\n\t\n\tvec3 color = vec3(1.0);\n\t\n\tvec3 eyeTex = pow(texture(iChannel2, uv * 2.0 + time * 0.1).rgb * 2.0, vec3(2.0));\n\tvec3 darkTex = pow(texture(iChannel3, -uv + time * 0.1).rgb * 2.0, vec3(2.0));\n\t\n\tcolor = mix(vec3(0.0, 0.0, 0.0) + pow(darkTex * vec3(0.1, 0.1, 0.1), vec3(2.0)), vec3(1.0, 0.25, 0.125) * eyeTex, inner);\t\n\tcolor = mix(vec3(1.0, 1.0, 1.0), color, outer);\n\t//color = mix(color, vec3(1.0, 1.0, 1.0), glint);\n\n\treturn color;\t\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\t\n\t// MODIFIERS\n\tfloat squintiness = 0.125;\n\tfloat pulsatingPupil = 0.0;\t\n\tfloat pupilAspect = INNER_ASPECT;\n\t\n\t// STATES\n\tfloat anger = ReadKey(Key_A, false) ? 0.3 : 0.0;\t\n\tanger = ReadKey(Key_S, false) ? 0.6 : anger;\t\n\tanger = ReadKey(Key_D, false) ? 1.0 : anger;\t\n\n\t// STATE INFLUENCE\n\tif (anger > 0.0)\n\t{\n\t\tanger = clamp(anger, 0.0, 1.0);\n\t\t\n\t\tsquintiness = mix(squintiness, 0.75, anger);\n\t\tpulsatingPupil = mix(pulsatingPupil, 1.0, anger);\n\t\tpupilAspect = mix(pupilAspect, 0.15, anger);\n\t}\n\t\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n\t\n\tvec3 color = vec3(1.0);\n\t\n\tif (ReadKey(Key_P, true))\n\t{\n\t\tcolor *= eye(vec2(uv.x, uv.y - 0.25) * 2.0, squintiness, pupilAspect, anger, pulsatingPupil, 0.0);\t\n\t\tcolor *= eye(vec2(uv.x - 0.5, uv.y - 0.25) * 2.0, squintiness, pupilAspect, anger, pulsatingPupil, 0.0);\t\n\t}\n\telse\n\t{\n\t\tcolor *= eye(uv, squintiness, pupilAspect, anger, pulsatingPupil, 0.0);\n\t}\n\t\n\tfragColor = vec4(color, 1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":true,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"lsSGRG","date":"1389910449","viewed":144,"name":"Diamond Eye Tests","username":"renaudbedard","description":"Test for the The Dark's eyes","likes":0,"published":1,"flags":16,"usePreview":0,"tags":["2d","eye","diamond"],"hasliked":0,"parentid":"","parentname":""}}