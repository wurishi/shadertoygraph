{"ver":"0.1","info":{"id":"WlsSRr","date":"1561841911","viewed":371,"name":"Cubemap sampling","username":"MMatteini","description":"Few cubemap sampling function to copy-paste for manual sampling atlas etc. No conditionals.","likes":8,"published":1,"flags":0,"usePreview":1,"tags":["cubemapatlasshadowmap"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","previewfilepath":"/media/ap/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n// direction -> cubemap face normal\nvec3 GetCubeFaceDir(vec3 dir)\n{\n    vec3 absDir = abs(dir);   \n    float maxDir = max(max(absDir.x, absDir.y), absDir.z);\n    vec3 faceDir;\n    faceDir.x = step(maxDir, absDir.x) * sign(dir.x);\n    faceDir.y = step(maxDir, absDir.y) * sign(dir.y);\n    faceDir.z = step(maxDir, absDir.z) * sign(dir.z);\n    return faceDir;\n}\n\n// cubemap face normal -> face ID\nfloat CubeFaceDirToID(vec3 faceDir)\n{\n    return dot(clamp(faceDir, 0., 1.), vec3(0., 1., 2.)) + dot(clamp(-faceDir, 0., 1.), vec3(3., 4., 5.));\n}\n\n// cubemap face normal, direction -> face UVs\nvec2 CubeFaceCoords(vec3 faceDir, vec3 viewDir)\n{\n    vec3 uv3d = viewDir / dot(viewDir, faceDir) - faceDir;\n    vec3 uDir = vec3(faceDir.z + abs(faceDir.y), 0, -faceDir.x);\n    vec3 vDir = vec3(0, 1. - abs(faceDir.y), -faceDir.y);\n    return vec2(dot(uv3d, uDir), dot(uv3d, vDir)) * .5 + .5;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // rotating \"camera\"\n    vec2 uv = fragCoord/iResolution.xy * 2. - 1.;   \n    vec3 viewDir = normalize(vec3(uv, .8)); \n    float t = iTime * 0.3;\n    viewDir = vec3(\n       dot(viewDir, vec3(cos(t), 0, sin(t))),\n       dot(viewDir, vec3(0, 1., 0)),\n       dot(viewDir, vec3(-sin(t), 0, cos(t)))\n    );\n   \n    \n    // function usage:\n    vec3 faceDir = GetCubeFaceDir(viewDir);   \n    float faceId = \tCubeFaceDirToID(faceDir);\n    vec2 faceCoords = CubeFaceCoords(faceDir, viewDir);\n    \n\n    //fragColor = vec4(faceDir * 0.5 + 0.5,1.0); // show normals\n    //fragColor = vec4(faceCoords.xyx,1.0); // show tex coords \n    fragColor.rgb = texture(iChannel0, 3.0 * faceCoords).xyz * pow(dot(viewDir, faceDir), 2.) * 1.5; // show shaded \n}\n\n","name":"Image","description":"","type":"image"}]}