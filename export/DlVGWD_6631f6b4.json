{"ver":"0.1","info":{"id":"DlVGWD","date":"1684019339","viewed":22,"name":"vengeance of joy","username":"jneen","description":"Prototype of the shader for my Infloresce / Chatanooga Trans Liberation Collective music video https://www.youtube.com/watch?v=7FKV6Wks3Og","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["jneen"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec3 C;\nvec2 uv;\nvec2 cell;\nfloat TAU=radians(360.);\nvec3 p1 = vec3(.3, .7, 1.);\nvec3 p2 = vec3(1., .6, .7);\n\nfloat G = 0.;\n\n#define nsin(X) (.5+.5*sin(X))\n\nfloat T;\n//#define T iTime\n#define SLOW nsin(T*.1)\n#define MEDIUM nsin(T*.5+3.)\n#define FAST nsin(T*.6+4.)\n\nfloat pmix(float a, float b, float q) {\n  return pow(b, q) * pow(a, 1.-q);\n}\n\nfloat smin(float a, float b, float k) {\n    float h = clamp(0.5 + 0.5*(a-b)/k, 0.0, 1.0);\n    return mix(a, b, h) - k*h*(1.0-h);\n}\n\nfloat smax(float a, float b, float k) {\n  return -smin(-a, -b, k);\n}\n\nfloat sinterp(float x) {\n  return 3.*x*x - 2.*x*x*x;\n}\n\nmat2 rot(float a) {\n  return mat2(cos(a), sin(a), -sin(a), cos(a));\n}\n\nfloat box(vec3 p, vec3 a) {\n  vec3 q = abs(p)-a;\n  return length(max(q,0.))+min(0., max(q.x,max(q.y,q.z)));\n}\n\nfloat W(vec3 op) {\n  G += 1.;\n  vec3 p = op.xyz;\n  p.xy *= rot(T);\n  p.xz *= rot(MEDIUM);\n  //p.xy *= rot(length(sin(fract(100.*cell+1.8398624))));\n  float b = box(p, vec3(.5))-.2;\n  \n  op.xz *= rot(T*.1);\n  //op.xz *= rot(sin(T*3.));\n    \n  b = smin(b, length(op.xz)-.2, .7);\n  b = smin(b, length(op.yz)-.2, .7);  \n\n  b = smax(b, -(length(p)-.6), .5);\n\n  float outer = length(op+.2) - 2.5;\n  \n  b = smax(b, outer, .5);\n  \n  return b;\n}\n\nfloat D;\nvec3 P;\nvoid tr(vec3 start, vec3 look) {\n  D = 0.;\n  float s;\n  P = start;\n  \n  for (float i=0.; i<100.; i+=1.) {\n    s = W(P);\n    D += s;\n    P += look * s;\n    if (s < .001) return;\n  }\n  \n  D= 1000.;\n}\n\nfloat grid(vec2 uv) {\n  //return 5.;\n  uv = sin(uv*20.);\n  return pmix(8., 400., nsin(T))*(abs(uv.x)+abs(uv.y));\n  //return length(sin((uv+T*.03)*(20.+20.*SLOW)));\n}\n\nvec3 norm(vec3 p) {\n  mat3 k = mat3(p,p,p) - mat3(.01);\n  return normalize(vec3(W(k[0]), W(k[1]), W(k[2])));\n}\n\nvec3 render3d(vec3 look) {\n    G=0.;\n    vec3 cam = vec3(0,0,-5);\n    vec3 R = vec3(0);\n    \n    tr(cam, normalize(look));\n    vec3 N = norm(P);\n    G /= 3.;\n    N.xy *= rot(iTime);\n    float diff = length(.5+.5*sin(1.5*N))/sqrt(3.);\n    float pl = dot(N, normalize(P));\n\n    if (D < 10.) {\n        R += p1*diff*.05;//-.04*f;\n        R += p1*pow(pl, 3.)*.1+.05;\n        //R.rgb += max(0.,.2*pow(dot(N,normalize(P)),3.));\n    }\n\n    return R;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    T=iTime;\n    T *= .7;\n    \n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 ncuv = fragCoord/iResolution.xy;\n    vec2 uv = ncuv - .5;\n    \n    uv.x *= iResolution.x/iResolution.y;\n    float f = .4+2.*nsin(.1*iTime);\n    uv *= f;\n    ncuv *= f;\n    uv *= rot(SLOW);\n    uv *= rot(MEDIUM - 1.+ mix(-1., 1., FAST)*length(uv));\n    uv *= rot(MEDIUM + 2.+ mix(-.2, .2, MEDIUM)*pow(length(uv),2.));\n    uv *= rot(MEDIUM - 10.+mix(-.2, .2, SLOW)*pow(length(uv), 3.));\n    uv -= TAU/29.;\n    uv *= rot(-SLOW);\n    vec2 local = fract(uv*TAU)-.5;\n    cell = floor(uv*TAU);\n    \n    T += uv.y*uv.y;\n    float bright = smoothstep(.5+.5*grid(uv), 0., .3 + .3*SLOW);\n\n    vec2 hiuv = rot(sin(iTime)*.1)*uv;\n    float hilite = 1.-smoothstep(abs(hiuv.y/f), 0., .05*(MEDIUM+.1));\n\n    C.rgb = (1.1+hilite*(1.-length(uv)))*mix(p1, p2, abs(uv.y/f)+.1);//nsin(uv.xyx);\n    \n    vec3 rendered = vec3(0);\n    if (mod(cell.x + 3.*cell.y, 5.) == 4.) {\n        rendered = render3d(vec3(-local,1.));\n    }\n\n    C.rgb += rendered;\n    \n    rendered = render3d(vec3(rot(FAST)*(-uv*.18)-(.1),1.));\n    \n    C.rgb += nsin(T*.05)*(rendered - G*.01 + .3);\n    \n    C *= pow(bright, nsin(-T*.05));//bright*bright*bright;\n    \n    fragColor = vec4(C,1.0);\n}","name":"Image","description":"","type":"image"}]}