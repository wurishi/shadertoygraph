{"ver":"0.1","info":{"id":"ft3Szf","date":"1639468654","viewed":97,"name":"light scatter","username":"origo_","description":"light scattering","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["scatterlightgodrays"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec4 tonemap(vec3 color, float z)\n{\n    float exposure = 1.0f-z;\n    float gamma = 1.0f+z;\n    return vec4(pow(1.0f - exp(-color.rgb * exposure), vec3(1.0f/gamma)), 1.0);\n}\n\nconst float weight    = 0.02;\nconst float exposure  = 0.1;\nconst int numSamples  = 64;\nconst float decay     = 1.0-1.0/float(numSamples);\n\n#define max(x,y) (x) > (y) ? x : y\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float density   = (1.0/3.0)*1.1+sin(iTime*0.3)/3.0;\n\n    vec2 uv = 2.0*(fragCoord/iResolution.xy-0.5);\n\n    vec2 light = vec2(cos(sin(iTime*1.3))/2.0-0.25, sin(iTime/2.0)/3.0);\n//    vec2 txo = light+vec2(sin(iTime/2.7), cos(iTime*1.7)/2.0);\n//    vec2 light = vec2(0.0);\n    vec2 txo = vec2(0.0);\n\n    vec2 tx = uv.xy + txo;///2.0*vec2(0.3,1.0);\n    vec2 deltaTx = vec2(tx - light);\n    deltaTx *= (1.0 /  float(numSamples)) * density;\n\n    vec3 col =  vec3(texture(iChannel0, tx).rgb)/4.0;//vec3(0);\n    float illumDecay = 1.0;\n\n    int maxSamples = int(max(16.0, float(numSamples)*density));\n\n    for(int i=0; i < maxSamples ; i++){\n        tx -= deltaTx;\n        vec3 samp = vec3(texture(iChannel0, tx).rgb);\n        samp *= illumDecay * weight;\n        col += samp;\n        illumDecay *= decay;\n    }\n    \n//    col *= pow((uv.y+1.0), 0.8);\n\n    col *= exposure * ((1.0/(length(deltaTx)))/16.0);\n\n    fragColor = tonemap(col, 0.8);\n}","name":"Image","description":"","type":"image"}]}