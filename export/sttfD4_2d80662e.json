{"ver":"0.1","info":{"id":"sttfD4","date":"1663152148","viewed":266,"name":"morphable kifs","username":"pb","description":"Use the Mouse, click and drag to morph.  You can still use the Mouse if you press Pause too.\n\nkifs sdf from Shane and code golfed by FabriceNeyret2","likes":14,"published":1,"flags":0,"usePreview":0,"tags":["fractal","raymarch","kifs"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//philip.bertani@gmail.com\n//kifs dist func taken from Shane's - https://www.shadertoy.com/view/XsKXzc - and modified\n//Code was graciously golfed and refactored by FabriceNeyret2 (see https://www.shadertoy.com/view/7tcBDn)\n\n#define R(a)  mat2(cos(a + 1.57*vec4(0,-1,1,0)))  //rotation matrix using pi/2 phase offset for sin\n#define N     normalize\n\nfloat t, e=1., l=0., d, i=0.; // globals\nvec2 mm;  //Mouse\n\nfloat f(vec3 p) {\n    vec3  o = vec3(1,.75,.15), q;\n    float d=1e6, s=-.006, a=1.,r=.02, i=0., k = o.z*s;\n    for( p.xz *= R(t/7.) ; i++<17. ; )\n        a *= 1.-s,\n        p.xy *= R(mm.x), p.yz *= R(mm.y), // rotations here have large impact on shape\n        p = abs(p),\n#define S(p) p.x < p.y ? p = p.yx : p     \n        S(p.xy), S(p.xz), S(p.yz),  // sort\n        p = mix( p, o, s),\n        p.z < k*.5 ? p.z -= k : d,\n        q = p = abs(p),\n        S(q.xy), S(q.xz), S(q.yz),  // sort\n        d = min(d, max( q.x/a - r, -q.y/a +r-.002 ) );\n    return d;\n}\n\nvoid mainImage(out vec4 O, vec2 U) {\n    t = iTime;\n    vec3 R = iResolution, E = vec3(1,-1,-1), n,\n         L =  vec3(sin(t*2.),0.,-1.),        // light pos\n         D = N( vec3( U+U,-R.y) - R.xyy ),   // ray pos and dir\n         P = R-R; P.z = max(0., .24 - max(.7*sin((t+6.28)/2.),0.));\n\n    mm = 5.*(iMouse.xy-2.*R.xy)/R.y; if(iMouse.w==0.)mm=5.*vec2(.23,.09);\n    \n    for ( O-=O ; i++<1e2 && l<3. && e>0.; P += d*D ) {\n        l += d = f(P)*.7;\n        e = d - (1.+l*l)/4e4;\n        if( e < 0. ) {\n            P += e*D;\n            L = N(L-P);\n#define F(x)  x* f( P + (1.+l*l)/2e3 *x )\n            n = N( F(E.x)+F(E.yyx)+F(E)+F(E.yxy) );  // normal vec\n            O.rgb =  .3* max(0.,dot(-n,L)) *vec3(.7,.5,0.)\n                    +.6* pow(max(0.,dot(reflect(-D,n),L)),4.) *vec3(.9,.8,.3);\n            O = pow( 5.*(1.-exp(-O*O)) /exp(l*l*60.),vec4(.4) ); \n            break; \n          }\n    }\n}\n","name":"Image","description":"","type":"image"}]}