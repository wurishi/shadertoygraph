{"ver":"0.1","info":{"id":"ldcyDX","date":"1520378487","viewed":278,"name":"Lollipop tunnel","username":"Flopine","description":"Quick shader that will make you hungry... but why? :P","likes":12,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","candy","harmonicpalette"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Code by Flopine\n// Thanks to wsmind and leon for teaching me :)\n\n#define PI 3.141592\n#define TAU 2.*PI\n#define ITER 60\n\nmat2 rot (float a)\n{\n    float c = cos(a);\n    float s = sin(a);\n    return mat2 (c,s,-s,c);\n}\n\n// iq's palette https://iquilezles.org/articles/palettes\nvec3 palette(in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d)\n{\n    return a + b*cos( 6.28318*(c*t+d) );\n}\n\nvec2 moda (vec2 p, float per)\n{\n    float angle = atan(p.y, p.x);\n    float l = length(p);\n    angle = mod(angle-per/2.,per)-per/2.;\n    return vec2(cos(angle),sin(angle))*l;\n}\n\nfloat cylZ (vec3 p, float r)\n{\n    return length(p.xy)-r;\n}\n\n\nfloat map (vec3 p)\n{\n\n    p.xy *= rot(-p.z);\n    p.xy = moda(p.xy, TAU/5.);\n    p.x -= 0.5;\n    return cylZ(p,.3); \n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = 2.*(fragCoord/iResolution.xy)-1.;\n\tuv.x *= iResolution.x/iResolution.y;\n    \n    float shad = 1.;\n    vec3 p = vec3(0.001,0.001,-iTime*0.3);\n    vec3 dir = normalize(vec3(uv,1.));\n    \n    for (int i = 0; i<ITER; i++)\n    {\n        float d = map(p);\n        if (d<0.001)\n        {\n            shad = float(i)/float(ITER);\n            break;\n        }\n        p+=dir*d;\n        \n    }\n    vec3 pal = palette(p.z,\n                      vec3(0.0,0.5,0.5),\n                      vec3(0.5),\n                      vec3(5.),\n                      vec3(0.,0.1, iTime*0.2));\n    // Time varying pixel color\n    vec3 col = vec3(1.-shad)*pal*2.;\n\n    // Output to screen\n    fragColor = vec4(pow(col, vec3(0.45)),1.0);\n}","name":"Image","description":"","type":"image"}]}