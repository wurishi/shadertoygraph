{"ver":"0.1","info":{"id":"7tXyWf","date":"1648885193","viewed":278,"name":"points and regions","username":"kastorp","description":"a naive way to display many points without iterating them all\n\n[url=https://www.shadertoy.com/view/slfcWl]new version here[/url] \n","likes":12,"published":1,"flags":32,"usePreview":0,"tags":["aabb","points"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// points & regions by kastorp\n//---------------------------\nvoid mainImage( out vec4 O, in vec2 U )\n{\n    vec2  p = (U/R.y -R/R.y*.5),mp = (iMouse.xy/R.y -R/R.y*.5),\n        c = (p*R.y/R.xy +.5)*float(M) ;    \n    int j = int(c.x) +int(c.y)*M; //current region id\n    \n    O=vec4(0);\n    for(int i=0,k=i;k<N && i<500;i++){ // scan points in current region (max 500)\n        \n        vec4 c=texelFetch(iChannel1,ivec2(k%NX,k/NX +j*NY),0);\n        if(c.w==0.) { //the point is in\n            float d =length(p-c.xy);            \n            O=mix(O,vec4(0.5 + 0.5*cos(c.z*6.+vec4(0,2,4,0))),smoothstep(0.01,.002,d));\n            k+=1; //next point\n        }\n        else k+=int(c.w); //skip till first point in region\n    }\n    \n#ifdef DEBUG      \n       float sz=1./float(M);\n       vec2 s =(vec2((j%M),j/M)+.5)*sz-.5 ;\n       s*=R.xy/R.y ;\n       O+=vec4(.1)*step(max(abs(p.x-s.x)-.48*sz*R.x/R.y,abs(p.y-s.y)-.48*sz),.0)*\n      (1.+ 4.* step(max(abs(mp.x-s.x)-.5*sz*TL*R.x/R.y,abs(mp.y-s.y)-.5*sz*TL),.0));\n#endif    \n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","previewfilepath":"/media/ap/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"//random points \n\nvoid mainImage( out vec4 O, in vec2 U )\n{\n  vec4 n=texture(iChannel1,U/iResolution.xy)-.5;\n   O.xy=(n.xy)*R.xy/R.y +n.z*vec2(cos(n.w*iTime),sin(n.w*iTime));\n   O.zw=n.zw;\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"\n#define N 4000   //number of points\n#define H 200  //number of scanned points in buffer B\n#define TL 1.2 //region border tolerance \n\n#define DEBUG\n#define R iResolution.xy\n#define NX int(iResolution.x)\n#define NY max(1,N/NX)\n#define M min(16,int(sqrt(iResolution.y/float(NY))))\n\n","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"//points in each region\nvoid mainImage( out vec4 O, in vec2 U )\n{\n    \n    if(int(U.y)>(NY*M*M) || int(U.x)>NX) discard ;\n       \n    int j=int(U.y)/NY,\n        i= (int(U.y)%NY)*NX + int(U.x);\n\n    O=vec4(0.);\n    for( int k = i; k<min(N,i+H);k++){\n        \n        vec4 p= texelFetch(iChannel0,ivec2(k%NX,k/NX),0);\n        //vec2 c = (p*R.y/R.xy +.5)*float(M) ;             \n        //int jp = int(c.x) +int(c.y)*M;\n        float sz=1./float(M);\n        vec2 s =(vec2((j%M),j/M)+.5)*sz-.5 ;\n            s*=R.xy/R.y ;\n        \n        if(max(abs(p.x-s.x)-.5*TL*sz*R.x/R.y,abs(p.y-s.y)-.5*TL*sz)<0.)\n        //if(jp==j ) \n        {\n            O.xyz=p.xyz;\n            O.w=float(k-i);\n            return;\n        }\n        \n    }\n    O=vec4(0,0,0,H); \n       \n    \n}","name":"Buffer B","description":"","type":"buffer"}]}