{"ver":"0.1","info":{"id":"td2GRw","date":"1548642537","viewed":5222,"name":"Sonic Fusion","username":"BigWIngs","description":"Watch fullscreen with sound till the end! Use mouse to scrub time.","likes":67,"published":1,"flags":64,"usePreview":0,"tags":["torus","music"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"llsGWr","filepath":"https://soundcloud.com/mamulashvili1/daft-punk-beyond-nicolas-jaar-feat-dave-harrington-remix","previewfilepath":"https://soundcloud.com/mamulashvili1/daft-punk-beyond-nicolas-jaar-feat-dave-harrington-remix","type":"musicstream","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":0}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Sonic Fusion by Martijn Steinrucken aka BigWings - 2019\n// Email:countfrolic@gmail.com Twitter:@The_ArtOfCode\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n//\n// What you get when you play with the inside of a torus for too long.\n// Originally inspired by: https://turtletoy.net/turtle/90e6288a6b\n// \n// Turns out that if music is groovy enough, it can cause fusion! ;)\n// Use mouse to scrub time.\n//\n// Music: Daft Punk - Beyond (Nicolas Jaar Feat Dave Harrington Remix)\n// https://soundcloud.com/mamulashvili1/daft-punk-beyond-nicolas-jaar-feat-dave-harrington-remix\n\n#define MAX_STEPS 50.\n#define SURF_DIST .001\n#define SIN(x) (sin(x)*.5+.5)\n#define COS(x) (cos(x)*.5+.5)\n#define S(x) smoothstep(0.,1.,x)\n#define PI 3.1415\n#define HPI 1.5708\n\nfloat bigRadius = 1.;\nfloat smallRadius = .8;\n\nfloat Fade(float a, float b, float c, float d) {\n    float t = mod(iTime,315.); // iChannelTime[0];   // doesn't work on some systems ?\n\treturn smoothstep(a, b, t)*smoothstep(d, c, t);\n}\n\nvec3 R(vec2 uv, vec3 p, vec3 l, vec3 up, float z) {\n    vec3 f = normalize(l-p),\n        r = normalize(cross(up, f)),\n        u = cross(f, r),\n        c = p+f*z,\n        i = c + uv.x*r + uv.y*u,\n        d = normalize(i-p);\n    return d;\n}\n\nmat2 Rot(float a) {\n    float s = sin(a);\n    float c = cos(a);\n    return mat2(c, -s, s, c);\n}\n\n\nfloat GlowDist(vec3 p) {\n    float x = atan(p.x, p.z)+PI;\n    float fft = texture(iChannel0, fract(vec2(x/6.2831+.5)), 1./512.).x;\n    \n    p.y += (fft-.5)*.4;\n    \n    float s = 1.+sin(x*4.+iTime)*.05;\n    float circle = length(vec2(length(p.xz*s)-bigRadius, p.y));\n\tfloat d = (circle+smallRadius*.001);\n    return d;\n}\n\nfloat D(vec3 p) {\n    float circle = length(vec2(length(p.xz)-bigRadius, p.y));\n\tfloat d = -(circle-smallRadius);\n    return d;\n}\n\nvec3 N(vec3 p, float eps) {\n\tvec2 e = vec2(eps,0);\n    return normalize(\n        vec3(\n           D(p+e.xyy)-D(p-e.xyy),\n           D(p+e.yxy)-D(p-e.yxy),\n           D(p+e.yyx)-D(p-e.yyx)\n        )\n    );\n}\n\nvec2 TV(vec3 p) {\n    float y = atan(length(p.xz)-bigRadius, p.y);\n\tfloat x = atan(p.x, p.z);\n    return vec2(x, y); \n}\n                      \nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 m = iMouse.xy/iResolution.xy;\n    vec2 UV = fragCoord/iResolution.xy;\n\tvec2 uv = (UV-.5);\n    uv.x *= iResolution.x/iResolution.y;\n    \n   \tfloat t = iTime*2.-m.x*100.;\t// can scrub 50 seconds with mouse\n    float t4 = t/4.;\n    float t8 = t/8.;\n    float t16 = t/16.;\n    float t32 = t/32.;\n    \n    float fft = texture( iChannel0, vec2(.7,0) ).x;\n    \n    smallRadius = mix(.125, .8, S(SIN(t8)));\n    \n    // screen twist\n    float d = 1.-dot(uv,uv);\n    float twist = Fade(0., 100., 200., 300.);\n    uv *= Rot(d*2.*twist*sin(t16)*(1.-COS(t32)));\n    \n    // torus cam setup\n    vec3 ro = vec3(0., sin(t8)*.25*smallRadius, -bigRadius-sin(t4)*smallRadius*.3);\n    float lookAngle = ((SIN(-t8)));\n    vec3 lookDir = vec3(0, 0, 1);\n    lookDir.xz *= Rot(lookAngle*HPI);\n    float fov =  mix(.5, .1+COS(t32), Fade(30.,60., 250., 300.));      \n    vec3 rd = R(uv*Rot(t*.1), ro, ro+lookDir, vec3(0,1,0), fov);\n    \n    // Ray march\n    float dO = 0.;\n    float minDistC = 5.;\n    for(float i=0.; i<MAX_STEPS; i++) {\n    \tvec3 p = ro + dO*rd;\n        float dS = D(p);\n        float dC = GlowDist(p);\n        \n        minDistC = min(minDistC, dC);\n        \n        dO += min(dS, dC);\n        if(dS<SURF_DIST) break;\n    }\n    \n    vec3 col = vec3(0);\n    \n    // get pos, normal and torus uvs\n    vec3 p = ro + dO*rd;\n \tvec3 n = N(p,.01);\n    vec2 tv = TV(p)/6.2831+.5;\n    \n    // Texture\n    tv.y += t*.05*Fade(143.5, 143.51, 220.,230.);\n    d = fract((tv.y+tv.x)*10.);\n    float outline = smoothstep(.3, .28, abs(d-.5));\n    float swirl = smoothstep(.25, .2, abs(d-.5));\n    float hatchUv = (tv.y-tv.x)*10.*3.1415;\n    float hatch = sin(hatchUv*20.+t4)*SIN(t4);\n    hatch += sin(hatchUv+t)*SIN(t8);\n    col += (outline-swirl*hatch)*.5;\n    \n    // vignette\n    col *= 1.-dot(uv,uv);\n    \n    // color inversion\n    float bw = 1.-clamp(sin(length(uv)*1.-t*.1)*3., 0., 1.);\n    col = mix(col, 1.-col, bw);\n    \n    // add more 3d-ness\n    float fresnel = -dot(n, rd);\n    fresnel *= fresnel;\n    col *= mix(1., fresnel*fresnel, SIN(t8*.5674));\n    \n    \n    // Add some color\n    vec3 c = cross(rd, n);\n    c.xy *= Rot(t);\n    c.zy *= Rot(t4);\n    c = c*.5+.5;\n    c = pow(c, vec3(1.+SIN(t4)*3.));\n    float tasteTheRainbow = Fade(82., 83., 100., 120.);\n    tasteTheRainbow += Fade(143.5, 144.5, 170., 200.);\n    tasteTheRainbow += Fade(205., 206., 230., 260.);\n    col = mix(col, col*c*3., tasteTheRainbow);\n    \n    // add lightning\n    float lightning = fft*(.1/(minDistC));\n    vec3 lightningCol = lightning*mix(vec3(1.,.1,.1), vec3(.1, .1, 1.), bw);\n    float fade = Fade(21., 25., 50., 70.);\n    fade += Fade(82., 83., 100., 120.);\n    fade += Fade(143.5, 144.5, 170., 200.);\n    fade += Fade(215., 216., 230., 260.);\n    \n    col += lightningCol * fade;\n    \n    col *= Fade(0., 10., 290., 315.);\n    \n    // preview window gets the party right away\n    if(iResolution.x<300.) {\n       col = col*c*3.+lightningCol;\n    }\n    \n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}