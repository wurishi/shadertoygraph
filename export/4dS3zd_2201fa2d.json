{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"4dXGRn","filepath":"/media/a/10eb4fe0ac8a7dc348a2cc282ca5df1759ab8bf680117e4047728100969e7b43.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"\nvec2 rot(vec2 p, float r)\n{\n\treturn vec2(\n\t\tcos(r) * p.x - sin(r) * p.y,\n\t\tsin(r) * p.x + cos(r) * p.y);\n}\n\n//https://www.cl.cam.ac.uk/teaching/1999/AGraphHCI/SMAG/node2.html\nfloat tr(vec3 p, float m)\n{\n\tfloat R = m * 1.0;\n\tfloat r = m * 0.33;\n\tvec2  g = vec2(length(p.xy) - R * R, p.z);\n\treturn length(g) - (r * r);\n}\n\nfloat scene(vec3 p, float tm)\n{\n\tfloat k = 1.05 + dot(p, vec3(0, -1, 0));\n\tp.xz = mod(p.xz, 6.0) - 3.0;\n\tp.y += abs(sin(0.75 * tm * 3.141592)) * 1.5;\n\t\n\t//1st\n\tvec3 w = p;\n\tw.zx = rot(w.zx, tm * 1.5);\n\tw.yz = rot(w.yz, tm * 1.4);\n\tfloat h0 = min(k, min(tr(w, 1.0), min(tr(w.zxy, 0.9), tr(w.yzx, 0.8))));\n\t\n\t//2nd\n\tw = p;\n\tw.zx = rot(w.zx, -tm * 1.4);\n\tw.yz = rot(w.yz, -tm * 1.5);\n\tfloat h1 = min(k, min(tr(w, 0.7), min(tr(w.zxy, 0.6), tr(w.yzx, 0.5))));\n\treturn min(h0, h1);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tfloat tm = iTime;\n\tvec2 uv  = -1.0 + 2.0 * ( fragCoord.xy / iResolution.xy );\n\tvec3 pos = vec3(0, -2.0, -2.0 +  (iMouse.x / iResolution.x) * 2.0);\n\tvec3 dir = normalize(vec3(uv * vec2(1.25, -1.0), 1.0));\n\tdir.yz = rot(dir.yz, -0.7);\n\tdir.xz = rot(dir.xz, tm * 0.1 +  (iMouse.x / iResolution.x) * 2.0);\n\tfloat t = 0.0;\n\t\n\t//Inter\n    for(int i = 0; i < 100; i++) {\n        float tt = scene(dir * t + pos, tm);\n        if(tt < 0.005) break;\n        t += tt;\n    }\n\t\n\t//Shadow\n\tvec3  ip = pos + dir * t * 0.99;\n\tvec3  L  = normalize(vec3(3, -5, -4));\n\tfloat s  = 0.0;\n\tfor(int i = 0; i < 10; i++)\ts += scene(s * L + ip, tm);\n\t\n\t//merge\n\ts *= 0.333;\n\tvec4  tcol = texture(iChannel0, ip.xz * 0.25 + vec2(0, tm * 0.5));\n\tif(ip.y < 1.0) tcol = vec4(0.717);\n\ttcol = 0.05 * vec4(vec3(3, 1.0, 1.0 + t * 0.25) * s, 1.0) * tcol.xyzz;\n\tfragColor = sqrt(tcol) * vec4(1.7 - dot(uv, uv));\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4dS3zd","date":"1392118298","viewed":241,"name":"Bouncing torus","username":"gyabo","description":"Bouncing!","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","shadow"],"hasliked":0,"parentid":"","parentname":""}}