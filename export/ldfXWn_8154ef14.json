{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"float sdistSphere(vec4 s, vec3 rayPos)\n{\n\treturn length(rayPos - s.xyz) - s.w;\n}\n\nfloat sdBox( vec3 p, vec3 b )\n{\n\tvec3 d = abs(p) - b;\n\treturn min(max(d.x,max(d.y,d.z)),0.0) +\n\t\t   length(max(d,0.0));\n}\n\nfloat sdCross(vec3 p)\n{\n\t// infinity doesn't exist, so 123456789. does the job\n\treturn min(sdBox(p, vec3(123456789., 1., 1.)),\n\t\t\t   min(sdBox(p, vec3(1., 123456789., 1.)),\n\t\t\t   sdBox(p, vec3(1., 1., 123456789.))));\n}\n\nfloat sdistBox(vec3 boxPos, vec3 boxDim, vec3 rayPos)\n{\n  vec3 d = abs(rayPos - boxPos) - boxDim;\n  return min(max(d.x,max(d.y,d.z)),0.0) +\n         length(max(d,0.0));\n}\n\nfloat sdistRoundedBox(vec3 boxPos, vec3 boxDim, float r, vec3 rayPos)\n{\n\treturn sdistBox(boxPos, boxDim, rayPos) - r;\n}\n\n//--------------------------------\n\nfloat dist2nearest(vec3 p)\n{\n\tfloat d = sdBox(p, vec3(1.));\n\t\n\tfloat s = 1.;\n\t\n\tfor(int i = 0; i < 3; i++)\n\t{\n\t\tvec3 r = mod(p * s, 2.) - 1.;\n\t\ts *= 3.;\n\t\t// no - before sdCross and it works ?\n\t\td = max(d, sdCross(1. - abs(r) * 3.) / s);\n\t}\n\t\n\treturn d;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec3 camDir = vec3(fragCoord.xy / iResolution.xy, 1.) * 2. - 1.;\n\tcamDir.x *= iResolution.x / iResolution.y;\n\t\n\tcamDir = normalize(camDir);\n\t\n\tvec3 camPos = vec3(3., 3., -5);\n\t\n\tfloat t = 0., d = 0.000002;\n\tint j = 0;\n\t\n\tfor(int i = 0; i < 64; i++)\n\t{\n\t\tif(abs(d) < 0.000001 || t > 100.) continue;\n\t\td = dist2nearest(camPos + t * camDir);\n\t\tt += d;\n\t\tj = i;\n\t}\n\t\n\tfloat shade = 0.;\n\tif(abs(d) < 0.000001) shade = 1. - float(j) / 64.;\n\t\n\tfragColor = vec4(shade);\n}\n","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"ldfXWn","date":"1398934615","viewed":187,"name":"Menger ..?","username":"matrefeytontias","description":"iq, your article https://iquilezles.org/articles/menger/menger.htm seems to be wrong in some way ... see dist2nearest() in my code.","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["procedural","3d","raymarching"],"hasliked":0,"parentid":"","parentname":""}}