{"ver":"0.1","info":{"id":"WlycDt","date":"1611932152","viewed":444,"name":"Dig Down","username":"Kali","description":"Yet another trippy tunnel still","likes":25,"published":1,"flags":0,"usePreview":0,"tags":["fractal","tunnel"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"mat2 rot(float a)\n{\n    float s = sin(a), c = cos(a);\n    return mat2(c, s, -s, c);\n}\n\n\nvec3 path(float z)\n{\n    vec3 p = vec3(sin(z) * .5, cos(z * .5), z);\n    return p;\n}\n\nvec3 fractal(vec3 p)\n{\n    float z = p.z * .1;\n    p.z = abs(.5 - fract(z));\n    float m = 100.;\n    for (int i = 0; i < 10; i++)\n    {\n        p.xy *= rot(z);\n        p = abs(p * 1.5) - 2.;\n        m = min(m, abs(p.y) + .5 * abs(.5 - fract(p.x * .25 + iTime + float(i) * .1)));\n    }\n    m = exp(-4. * m) * 2.;\n    return vec3(p.xz * 2., m) * m;\n}\n\nfloat de(vec3 p)\n{\n    p.xy -= path(p.z).xy;\n    return -length(p.xy) + .25;\n}\n\nvec3 march(vec3 from, vec3 dir)\n{\n    float d, td = 0.;\n    vec3 p, col = vec3(0);\n    for (int i = 0; i < 80; i++)\n    {\n        p = from + dir * td;\n        d = de(p);\n        if (d < .001) break;\n        td += d;\n    }\n    if (d < .1) \n    {\n        p -= .001 * dir;\n        col = fractal(p) * exp(-.7 * td * td) * smoothstep(.3, 1., td);\n    }\n    return col;\n}\n\nmat3 lookat(vec3 dir, vec3 up) {\n    dir = normalize(dir);\n    vec3 rt = normalize(cross(dir, normalize(up)));\n    return mat3(rt, cross(rt, dir), dir);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord - iResolution.xy * .5) / iResolution.y;\n    float t = iTime;\n    vec3 from = path(t);\n    vec3 fw = normalize(path(t + .5) - from);\n    vec3 dir = normalize(vec3(uv, 1));\n    dir = lookat(fw, vec3(0, 1, 0)) * dir;\n    vec3 col = march(from, dir);\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}