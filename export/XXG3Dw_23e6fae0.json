{"ver":"0.1","info":{"id":"XXG3Dw","date":"1717694483","viewed":30,"name":"Simple ray marching sphere","username":"orange389","description":"Ray marching with a reflective red-ish sphere.","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"vec3 centerSphere() {\n    return vec3(4.0 * cos(iTime / 2.0), 3.0, 2.0 * sin(iTime) + 6.0);\n}\n\nfloat floorSDF(in vec3 position) {\n    return position.y;\n}\n\nfloat sphereSDF(in vec3 position) {\n    return length(position - centerSphere()) - 2.0;\n}\n\nvec3 floorHitColor(in vec3 position) {\n    bool a = fract(position.x * 0.25) < 0.5 ? true: false;\n    bool b = fract(position.z * 0.25) < 0.5 ? true: false;\n    return a ^^ b ? vec3(0.5, 0.5, 0.5) : vec3(1.0, 1.0, 1.0);\n}\n\nbool hitFloor(in vec3 position) {\n    return position.y < 0.001;\n}\n\nbool hitSphere(in vec3 position) {\n    return sphereSDF(position) < 0.001;\n}\n\nfloat combinedSDF(in vec3 position) {\n    return min(floorSDF(position), sphereSDF(position));\n}\n\nvoid rayMarch(inout vec3 position, in vec3 direction) {\n    position += direction * combinedSDF(position);\n}\n\nbool hit(in vec3 position) {\n    return hitFloor(position) || hitSphere(position) || abs(position.z) > 50.0 || position.y > 50.0;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (fragCoord / iResolution.xy * 2.0 - 1.0) * iResolution.xy / iResolution.yy;\n    vec3 position = vec3(uv.x, uv.y + 2.5 +  1.5 * cos(iTime * 0.125), 0.0);\n    vec3 dir = vec3(uv, 1.0);\n    dir = dir / length(dir);\n    vec3 color = vec3(0.0, 0.0, 0.0);\n    \n    float factor = 1.0;\n    \n    for(int i = 0; i < 50; ++i) {\n        \n        int j = 0;\n    \n        while(!hit(position) && j < 1000) {\n            ++j;\n            rayMarch(position, dir);\n        }\n    \n        if (hitFloor(position)) {\n            color += 0.90 * factor * floorHitColor(position);\n            factor *= 0.10;\n            dir = reflect(dir, vec3(0, 1, 0));\n            j = 0;\n            \n            while(hit(position) && j < 1000) {\n                ++j;\n                rayMarch(position, dir);\n            }\n            continue;\n        }\n        if (hitSphere(position)) {\n        \n            color += 0.1 * factor * vec3(1.0, 0.0, 0.0);\n            factor *= 0.9;\n            \n            vec3 lastDir = dir;\n            dir = reflect(dir, position - centerSphere());\n            \n            j = 0;\n            while(hit(position) && j < 1000) {\n                ++j;\n                rayMarch(position, dir);\n            }\n            \n            continue;\n        }\n        \n        color += factor * dot(dir, vec3(0, 1, 0)) * vec3(0.25, 0.25, 0.5);\n        color += factor * vec3(0.0, 0.0, 0.5);\n        break;\n        \n    }\n    fragColor = vec4(color, 1.0);\n}","name":"Image","description":"","type":"image"}]}