{"ver":"0.1","info":{"id":"Ml3XzB","date":"1480275139","viewed":283,"name":"rainbow rock","username":"jasonaugur","description":"test","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["raymarch","lighting","highlights"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float box( vec3 p, vec3 d ) {\n\treturn max( max( abs(p.x)-d.x, abs(p.y)-d.y ), abs(p.z)-d.z );\n}\n\nfloat sphere( vec3 p, float r ) {\n\treturn length(p) - r;\n}\n\nfloat sdf_smin(float a, float b, float k)\n{\n\tfloat res = exp(-k*a) + exp(-k*b);\n\treturn -log(max(0.0001,res)) / k;\n}\n\nvec2 rotate( vec2 v, float a ) {\n\treturn vec2( v.x * sin(a) + v.y * cos(a), v.y * sin(a) - v.x * cos(a) );\n}\n\nvec3 rotate( vec3 v, float a ) {\n\treturn vec3( rotate( v.xz, a ), v.y ).xzy;\n}\n\nfloat scene( vec3 p ) {\n\tvec3 b1 = p + vec3( 0., -.5, 0.);\n\tb1 = rotate(b1.yxz,3.14*.2).yxz;\n\tb1 = rotate(b1.xyz,3.14*.25).xyz;\n\treturn sdf_smin(\n        \tsdf_smin( sphere(p - vec3(0.,1.5,0.), .5), box(b1, vec3(.5)), 5.), \n        \tsphere(p,1.),5.-.5*sin(p.x*20.)-.5*sin(p.z*20.));\n}\n\nvec3 grad( vec3 p ) {\n\tvec2 eps = vec2( .01, 0. );\n\treturn normalize(\n\t   vec3( scene( p + eps.xyy),\n\t\t     scene( p + eps.yxy),\n\t\t     scene( p + eps.yyx) ) -\n\t   vec3( scene( p - eps.xyy),\n\t\t     scene( p - eps.yxy),\n\t\t     scene( p - eps.yyx) )\n\t\t);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 sp = (fragCoord.xy / iResolution.xy) - .5;\n    sp.x *= iResolution.x/iResolution.y;\n\tvec3 o = vec3(0.,.5,-2.);\n\tvec3 v = normalize(vec3(sp, .5));\n\tvec3 l = normalize(vec3(.25,.25,-1.));\n\tfloat t = 3.1415926 * .5*sin(iTime);\n\to.xz = rotate( o.xz, t );\n\tv.xz = rotate( v.xz, t );\n\tl.xz = rotate( l.xz, t );\n    \n    vec3 n = vec3(0.);\n\tfor( int i = 0; i < 32; i++ ) {\n\t\tfloat dt = scene( o );\n\t\to += v * dt;\n\t\tif( dt < .01 )\n\t\t\tn = grad( o );\n\t}\n\t\n\tvec3 c = rotate(rotate(rotate(n.zxy, o.x*2.).zxy,o.y*2.).zxy,o.z*2.);\n    c = mix( c, n, clamp(abs(mod(iTime,20.)-10.)-5.,0.,1.));\n\tfragColor = vec4( (c *.5+.5) * (1.-dot(-n,v)) * dot(n,l) + pow(dot(n,l),64.), 1. );\n}","name":"Image","description":"","type":"image"}]}