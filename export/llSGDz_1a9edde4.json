{"ver":"0.1","info":{"id":"llSGDz","date":"1428395513","viewed":127,"name":"7 sins intro","username":"such","description":"vague presentation","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XdX3Rn","filepath":"/media/a/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","previewfilepath":"/media/ap/52d2a8f514c4fd2d9866587f4d7b2a5bfa1a11a0e772077d7682deb8b3b517e5.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGzn","filepath":"/media/a/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","previewfilepath":"/media/ap/0c7bf5fe9462d5bffbd11126e82908e39be3ce56220d900f633d58fb432e56f5.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"const float closed_left_eye = 0.75;\nconst float closed_right_eye = 0.8;\nconst float bending = 0.025;\nconst float bending_x = 0.;\nuniform float look_azimuth;\nuniform float look_elevation;\nconst float N_birds = 7.;\nconst float Bird_radius = 0.8;\nconst float camera_distance = .1508;\nconst float funkyness = 1e9;\nconst float steplessiter = 20.;\nconst float backoff = 0.;\n    //look_elevation = clamp(look_elevation,-.1,.3);\n    //look_azimuth = clamp(look_azimuth,-.4,.4);\n    \n#define BACKOFF\n\n// as allways, higher is better\n#define RM_MAX_ITER 20\n\n// define one of these\n//#define CLEAN // at least 10 iterations\n//#define EVIL_BIRD_IN_THE_DARK // at least 16 iterations\n#define FUNKY_BACKGROUND\n\n// this is cool with FUNKY_BACKGROUND\n//#define ONLY_BEAK\n\n// woho!\n//#define DANCE_GROOVE\n//#define DANCE_FUNK\n\n//#define EAT_MUSHROOMS\n\n//#define UNDERCOVER\n\n//#define BANDANA\n\n//#define BACKGROUNDTEXTURE\n\nconst float eps = 0.01;\nconst float neck = 0.48;\nconst float pi = 3.14159;\nconst float pi2 = 6.28319;\n\n// raymarching CSG: min = union, max = intersection\nfloat sphere(vec3 p, vec3 c, float r)\n{\n    return length(p-c) - r;\n}\n\nfloat plane(vec3 p, vec3 n, float d)\n{\n    return dot(p,n)-d;\n}\n\nvec3 bendBody(vec3 p)\n{\n    // offset position to compute distance from to give the effect of the object moving\n    //float bending = 0.015*sin(4.*iTime);\n    p.z -= p.y*p.y*bending;\n    float bend_x = p.y*p.y*bending_x;\n    p.x -= bend_x;\n    p.y -= abs(bend_x);\n    \n    #ifdef EAT_MUSHROOMS\n    p.x = p.x - sin(p.y);\n    #endif\n    \n    #ifdef DANCE_GROOVE\n    float o = p.y*p.y*bending*2.*sin(4.*iTime);\n    p.x += o;\n    p.y += abs(o);\n    #endif\n    #ifdef DANCE_FUNK\n    float o2 = p.y*p.y*bending*2.*sin(4.*iTime);\n    p.x += o2;\n    p.y -= abs(o2);\n    #endif\n    return p;\n}\n\nfloat birdieBody(in vec3 p)\n{\n    // Model the body as a cylinder with varying radius\n    float y = clamp(p.y,0.,1.);\n\n    float r1 = mix(1.4,0.15,y/neck);\n    float t = 1. - (y-neck)/(1.-neck);\n    float r2 = -.85*t*t*t*t + 1.;\n    r2 *= sqrt(2.*t-t*t);\n    float r = y<neck ? r1 : r2;\n    \n    float body = length(p.xz) - r*0.1;\n    return max(max(p.y-1.,-p.y),body);\n}\n\nfloat birdieBeak1(in vec3 p)\n{\n    float d_back = p.z - (-0.02);\n    float d_bottom = -(p.y - 0.57);\n    float d_left = sphere(p,vec3(-.15, 0.6, 0.02),.2);\n    float d_right = sphere(p,vec3(.15, 0.6, 0.02),.2);\n    \n    return max(max(d_left,d_right),max(d_bottom,d_back));\n}\n\nfloat birdieBeak2(in vec3 p,float openjaw)\n{\n    float d_back = p.z - (-0.02);\n    float d_top = plane(p, vec3(0.,1.,-.6-.3*openjaw), 0.6+.03*openjaw);\n    float d_left = sphere(p,vec3(-.115, 0.65, 0.06),.2);\n    float d_right = sphere(p,vec3(.115, 0.65, 0.06),.2);\n    \n    return max(max(d_left,d_right),max(d_top,d_back));\n}\n\nfloat birdieBeak(in vec3 p)\n{\n    float beak1 = birdieBeak1(p);\n    float beak2 = birdieBeak2(p, 0.);\n    \n    return min(beak1,beak2);\n}\n\nfloat birdieEyePupil(in vec3 p)\n{\n    vec3 off1 = vec3( 0.04, 0.717+0.04*look_elevation, -0.048);\n    vec3 off2 = vec3( -0.04, 0.717+0.04*look_elevation, -0.048);\n\n    float ca = cos(look_azimuth);\n    float sa = sin(look_azimuth);\n    \n    off1 = vec3(off1.z*sa + off1.x*ca, off1.y, off1.z*ca - off1.x*sa);\n    off2 = vec3(off2.z*sa + off2.x*ca, off2.y, off2.z*ca - off2.x*sa);\n    \n    return min(length(p-off1),length(p-off2)) - .025; // distance to sphere\n}\n\nfloat birdieEyeWhite(float body,in vec3 p)\n{\n    float d_bottom = plane(p,vec3(0.,-1.,0.),-0.69);\n    float d_top = plane(p,vec3(0.,1.,0.),0.9);\n    float d_sphere = min(sphere(p,vec3(0.1,0.75,-0.1),.1),\n                         sphere(p,vec3(-0.1,0.75,-0.1),.1));\n    return max(max(body,d_sphere),max(d_top,d_bottom));\n}\n\nfloat birdieBandana(float body,in vec3 p)\n{\n#ifdef BANDANA\n    float d_bottom = plane(p,vec3(0.,-1.,0.),-0.85);\n    float d_top = plane(p,vec3(0.,1.,0.),0.91);\n#else\n    float d_bottom = plane(p,vec3(0.,-1.,0.),-0.92);\n    float d_top = plane(p,vec3(0.,1.,0.),0.91);\n#endif\n#ifdef UNDERCOVER\n    return body;\n#else\n    return max(body,max(d_top,d_bottom));\n#endif\n}\n\nfloat birdieEyeLid(in vec3 p, float closed_left, float closed_right)\n{\n    p.y = (p.y-0.75)*0.5 + 0.75;\n    float d_bottom = plane(p,vec3(-.8*(1.-closed_left),-1.,0.),-0.9 + 0.21*closed_left);\n    float d_sphere1 = sphere(p,vec3(-0.1,0.75,-0.1),.1);\n    float d_sphere2 = sphere(p,vec3(0,0.77,0),.1);\n    float lid1 = max(max(d_sphere1,d_sphere2),d_bottom);\n\n    d_bottom = plane(p,vec3(0.8*(1.-closed_right),-1.,0.),-0.9 + 0.21*closed_right);\n    d_sphere1 = sphere(p,vec3(0.1,0.75,-0.1),.1);\n    d_sphere2 = sphere(p,vec3(0,0.77,0),.1);\n    float lid2 = max(max(d_sphere1,d_sphere2),d_bottom);\n    return min(lid1,lid2);\n}\n\nvec4 birdie(in vec3 p)\n{\n    p.y += 0.5;\n    p = bendBody(p);\n    float body = birdieBody(p);\n    float beak = birdieBeak(p);\n    float eyepupil = max(body,birdieEyePupil(p));\n    float eyewhite = birdieEyeWhite(body,p);\n    float eyelid = birdieEyeLid(p,closed_left_eye, closed_right_eye);\n    float ninjabandana = birdieBandana(body,p);\n    \n    #ifdef ONLY_BEAK\n    body += 10.;\n    eyepupil += 10.;\n    eyewhite += 10.;\n    eyelid += 10.;\n    #endif\n\n    float m = min(min(min(body,beak),min(eyepupil,eyewhite)),eyelid);\n    vec4 r;\n    if (m==beak) return vec4(0.8, 0.4, 0.2, m);\n    if (m==eyepupil) return vec4(0.0, 0.0, 0.0, m);\n    if (m==ninjabandana) return vec4(0.1, 0.2, 0.3, m);\n    if (m==eyewhite) return vec4(1.0, 1.0, 1.0, m);\n    if (m==eyelid) return vec4(0.6, 0.6, 0.6, m);\n    return vec4(0.8, 0.8, 0.8, m); // m==body\n}\n\nvec4 scene(in vec3 p)\n{\n    vec4 br = vec4(0.,0.,0.,10000.);\n    float a = floor(mod(atan(p.x,p.z)+pi2*(N_birds+0.5)/N_birds,pi2)/pi2*N_birds);\n    float ang = pi2*a/N_birds;\n    float ca = cos(ang);\n    float sa = sin(ang);\n\n    vec3 q = p - vec3(sa*Bird_radius,0,ca*Bird_radius);\n    q = vec3(q.z*sa - q.x*ca, q.y, q.z*ca + q.x*sa);\n\n    vec4 b = birdie(q);\n    if (b.w < br.w)\n        br = b;\n    \n    return br;\n}\n\n// gradient normal\nvec3 getNormal(in vec3 p,float w)\n{\n    vec3 normal;\n    vec3 ep = vec3(eps,0,0);\n    normal.x = scene(p + ep.xyz).w - w;\n    normal.y = scene(p + ep.yxz).w - w;\n    normal.z = scene(p + ep.yzx).w - w;\n    return normalize(normal);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = (fragCoord.xy - iResolution.xy*0.5) / iResolution.yy;    \n    \n    vec3 rayStart = vec3(0,0,camera_distance);\n    vec3 rayDir = normalize(vec3(uv,-1));\n    \n    float ca,sa;\n    float rotatex = -0.05+0.1*sin(.1*iTime);\n    float rotatey = .2*iTime;\n    float steps = steplessiter;\n    float funkval = funkyness;\n    \n    #ifdef BACKOFF\n    float backoff_v = backoff;\n    backoff_v = sin(0.2*iTime)*0.5 + 0.5;\n//    backoff_v = 1.;\n    rotatex = backoff_v*3.14/2.;\n    rotatey += 10.*(1.+backoff_v*backoff_v);\n    rayStart.xz *= (1.-backoff_v)*(1.-backoff_v);\n    rayStart.xz = vec2(0.);\n    steps = mix(steplessiter,2.0,backoff_v);\n    funkval = pow(backoff_v,21.)*10.;\n    #endif\n    \n    //a = 3.14+.4*iTime;\n    ca = cos(rotatex);\n    sa = sin(rotatex);\n\trayStart = vec3(rayStart.x, rayStart.z*sa + rayStart.y*ca, rayStart.z*ca - rayStart.y*sa);\n    rayDir = vec3(rayDir.x, rayDir.z*sa + rayDir.y*ca, rayDir.z*ca - rayDir.y*sa);\n\n    //float a = 3.e4+1.4*iTime;\n    ca = cos(rotatey);\n    sa = sin(rotatey);\n    rayStart = vec3(rayStart.z*sa + rayStart.x*ca, rayStart.y, rayStart.z*ca - rayStart.x*sa);\n    rayDir = vec3(rayDir.z*sa + rayDir.x*ca, rayDir.y, rayDir.z*ca - rayDir.x*sa);\n\n    #ifdef BACKOFF\n    rayStart.y += backoff_v*backoff_v*3.;\n    #endif\n    \n    vec3 p;\n    float t = 0.0;\n    vec4 currentColor;\n    for (int i=0; i<RM_MAX_ITER; ++i)\n    {\n        float k = min(1.,steps);\n        steps -= k;\n        p = rayStart + rayDir*t;\n        currentColor = scene(p);\n\t\tt += currentColor.w*k;\n    }\n\n    vec3 finalColor = vec3(0,0,0);\n    vec3 normal = getNormal(p,currentColor.w);\n    //vec3 normal = vec3(0,0,1);\n    vec3 light1 = vec3(sin(iTime),cos(iTime),0);\n    vec3 light2 = vec3(0,0,-1);\n    //            finalColor = normal;\n    //            finalColor = vec3(1,0,1) *\n    //                dot(vec3(1.,sin(iTime ),cos(iTime )),normal);\n    float diffuse1 = 0.1+dot(light1,normal);\n    float diffuse2 = 0.1+dot(light2,normal);\n    float specular = pow(max(0.,dot(light1,normal)),21.);\n    \n//    #ifdef CLEAN\n    if (currentColor.w>funkval)\n    //if (currentColor.w>eps)\n    {\n        currentColor = vec4(0.,0.,0.,currentColor.w);\n    }\n//    #endif\n    \n    #ifdef EVIL_BIRD_IN_THE_DARK\n    if (currentColor.w>0.)\n    {\n        currentColor = vec4(0.,0.,0.,currentColor.w);\n    }\n    #endif\n\n\n    //float specular = 0.;\n    float ambient = 0.2;\n    finalColor = currentColor.xyz *\n        (ambient + max(0.,0.5* diffuse1) + 0.5*diffuse2 + specular);\n    \n\tfragColor = vec4(finalColor, min(1.,max(0.,1.-currentColor.w) + length(finalColor)));\n\n    #ifdef BACKGROUNDTEXTURE\n    fragColor = mix(vec4(pow(texture (iChannel0,fragCoord/iResolution.xy).r,21.)), fragColor, fragColor.a);\n    #endif\n}\n","name":"","description":"","type":"image"}]}