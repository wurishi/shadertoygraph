{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[],"code":"// carcarspacecar by eiffie\n// This is the morph from the shiney toy car to the space car in kali's shader.\n// It is part of a larger animation that wouldn't compile :(\n\n//from iq, this version removes the mix\nfloat smin(float a,float b,float k){float h=clamp(0.5+0.5*(b-a)/k,0.0,1.0);return b+h*(a-b-k+k*h);}\n\nmat2 trmx,mrmx;//the wheel spinners\nfloat minL,cc3,cc4;//car config\nvec4 trpc,cc;//color and stuff\nbool bColoring=false;\n\nfloat DE(in vec3 p0){//carcarspacecar by eiffie\n\tvec3 p=p0;\n\tp.y+=1.24;\n\tfloat d=length(max(vec3(abs(p.x)-0.35,length(p.yz)-1.92,-p.y+1.4),0.0))-0.05;\n\td=max(d,p.z-1.0);\n\tp=p0+vec3(0.0,-0.22,0.39);\n\tp.xz=abs(p.xz);\n\tfloat w1=0.24,w2=cc.z,dL=length(p+vec3(-0.3,0.0,-1.18-p0.z*0.17))-0.05;\n\tp.xz-=vec2(cc.w,1.0);\n\tif(p0.z<0.0){\n\t\tw1=cc.x;w2=cc.y;\n\t\tp.xy=mrmx*p.xy;\n\t}else p.xz=mrmx*p.xz;\n\tp.x=abs(p.x);\n\tfloat r=length(p.yz);\n\td=smin(d,length(vec2(max(max(p.x-w2,0.0),-p.y-0.08),r-w1))-0.02,0.25);\n\tfloat d1=length(vec2(max(p.x-w2-0.01,0.0),r-w1+0.05))-0.04;\n\tif(p0.z<0.0)p.yz=p.yz*trmx;\n\telse p.yz=trmx*p.yz;\n\tfloat d2=min(min(abs(p.z+p.y),abs(p.z-p.y)),min(abs(p.z),abs(p.y)));//8 blades\n\td2=max(r-w1+cc3,max(d2-0.003,p.x-w2+0.04));\n\td2=min(d2,dL);\n\tminL=min(minL,d2);//catch the minimum distance to the glowing things\n\tif(bColoring){\n\t\tif(d2<d && d2<d1){trpc+=vec4(1.0,0.6,0.5,256.0);}//spokes/turbines\n\t\telse if(d1<d){trpc+=vec4(vec3(clamp(1.0-(r-w1+0.09)*100.0,0.0,1.0)),256.0);}\n\t\telse {//the car's body\n\t\t\tif(p0.z<-1.04 || (abs(p0.y-0.58)>0.05-p0.z*0.09 || p0.z>0.25) && length(max(abs(p0.xz+vec2(0.0,-0.27))-vec2(0.18,0.39),0.0))>0.1)trpc+=vec4(1.0,0.9,0.4,16.0);\n\t\t\telse trpc+=vec4(0.1,0.2,0.3,2.0);//the windshield\n\t\t}\n\t}\n\treturn min(d,min(d1,d2)); \n}\nvoid setConfig(){\n\tfloat t=mod(iTime,10.0);\n\tt=t-5.0;\n\tif(t>4.0)t=5.0-t;\n\tt=clamp(t,0.0,1.0);\n\tcc3=mix(0.06,-0.03,t);\n\tcc4=mix(0.0,-0.5,t);\n\tcc=mix(vec4(0.24,0.07,0.1,0.55),vec4(0.33,0.04,0.22,0.72),t);\n}\nmat3 lookat(vec3 fw,vec3 up){\n\tfw=normalize(fw);vec3 rt=normalize(cross(fw,normalize(up)));return mat3(rt,cross(rt,fw),fw);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tsetConfig();\n\tfloat tim=iTime*5.0,a=cc4*3.0;\n\ttrmx=mat2(cos(tim),sin(tim),-sin(tim),cos(tim));//the turbine spinner\n\tmrmx=mat2(cos(a),sin(a),-sin(a),cos(a));\n\ttim=iTime*0.5;\n\tvec3 ro=vec3(cos(tim),0.1+sin(tim*0.7),sin(tim))*(2.5-abs(sin(tim*0.7)));\n\tvec3 rd=lookat(-ro,vec3(0.0,1.0,0.0))*normalize(vec3((2.0*fragCoord.xy-iResolution.xy)/iResolution.y,1.0));\n\tvec3 col=vec3(0.4,0.5,0.6)+rd*0.1,L=normalize(vec3(0.5,0.5,-0.5));\n\tfloat t=0.0,d=1.0;\n\tminL=100.0;\n\tfor(int i=0;i<32;i++){\n\t\tt+=d=DE(ro+rd*t);\n\t}\n\tif(d<0.1){\n\t\tvec3 p=ro+rd*t;\n\t\tvec2 v=vec2(2.0/iResolution.y,0.0);\n\t\ttrpc=vec4(0.0);bColoring=true;\n\t\tvec3 N=normalize(vec3(-DE(p-v.xyy)+DE(p+v.xyy),-DE(p-v.yxy)+DE(p+v.yxy),-DE(p-v.yyx)+DE(p+v.yyx)));\n\t\tcol=trpc.rgb*0.1666*max(0.2,0.25+0.75*dot(N,L));\n\t\tcol*=mix(vec3(0.5,0.5,1.0),vec3(1.0,1.0,0.5),abs(dot(rd,N)));\n\t\tcol+=vec3(1.0,0.5,0.0)*pow(max(0.0,dot(reflect(rd,N),L)),trpc.a);\n\t}\n\tcol+=vec3(1.0,0.5,0.2)/(1.0+minL*minL*10000.0);//the glow\n\tfragColor = vec4(clamp(col,0.0,1.0),1.0);\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XtsGRH","date":"1418577101","viewed":643,"name":"carcarSpacecar morph","username":"eiffie","description":"I was told I would have a flying car by now. :(","likes":11,"published":1,"flags":0,"usePreview":0,"tags":["morph","car","spacecar"],"hasliked":0,"parentid":"","parentname":""}}