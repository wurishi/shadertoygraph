{"ver":"0.1","info":{"id":"sdSGRK","date":"1617635149","viewed":144,"name":"Rain drops 2","username":"alexmalyutndev","description":"Rain drops","likes":2,"published":1,"flags":32,"usePreview":0,"tags":["rain","drops"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    \n    vec4 buff = texture(iChannel0, uv);\n   \n    float mass = buff.z;\n    fragColor = vec4(mass * mass * mass);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"float clamp01(float a)\n{\n    return clamp(a, 0.0, 1.0);\n}\n\n#define VelSize 5.0\n\nvec2 unpackVel(vec2 vel)\n{\n    return (vel * 2.0 - 1.0) * VelSize;\n}\n\nvec2 packVel(vec2 vel)\n{\n    if (length(vel) > VelSize)\n        vel = normalize(vel) * VelSize;\n    \n    return (vel / VelSize * 0.5 + 0.5);\n}\n\nfloat random(float a, vec2 uv)\n{\n    a *= 101.91;\n    vec2 point = vec2(cos(5.81 * a), sin(7.12 *  a)) * 0.49 + 0.5;\n    return distance(point * iResolution.xy, uv) * (sin(15.1 * a) * 0.1 + 1.0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 a = vec2(0.1, -1.0);\n    vec2 uv = fragCoord / iResolution.xy;\n    \n    vec4 buff = texture(iChannel0, uv);\n    vec2 vel = unpackVel(buff.xy);\n    \n    if (iFrame < 1)\n    {\n        vel = vec2(0.0, 0.0);\n    }\n    \n    vel = vel + a * iTimeDelta;\n    float mass = 0.0;\n    float frec = texture(iChannel1, uv * vec2(0.1, 0.5)).x * 0.5 + 0.5;\n    \n    float dist = distance(iMouse.zw, uv * iResolution.xy);\n    if (dist < 10.0 || (iFrame % 5 == 0 && random(iTime, uv * iResolution.xy) < 10.0))\n    {\n        mass = 1.0;\n        vel *= 0.5;\n    }\n    else\n    {\n        vec2 ref = uv - vel / iResolution.xy * frec;\n    \n        mass = texture(iChannel0, ref).z * 1.001;\n        \n        if (ref.x < 0.0 || ref.x > 1.0 || ref.y < 0.0 || ref.y > 1.0)\n            mass = 0.0;\n    }\n    \n    mass = clamp01(mass);\n    fragColor = vec4(packVel(vel), mass, 1.0);\n}","name":"Buffer A","description":"","type":"buffer"}]}