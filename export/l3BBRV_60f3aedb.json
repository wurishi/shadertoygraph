{"ver":"0.1","info":{"id":"l3BBRV","date":"1729684108","viewed":56,"name":"LSD échappatoire (forked) v2","username":"ArthurTent","description":"An infinite corridor in which you a̶r̶e̶ e̶s̶c̶a̶p̶i̶n̶g̶  took something (I duno)\n","likes":6,"published":1,"flags":0,"usePreview":0,"tags":["raymarching","blackandwhite","doors","corridor","rooms","escaping"],"hasliked":0,"parentid":"7lBXRG","parentname":"échappatoire"},"renderpass":[{"inputs":[{"id":"4sXGzn","filepath":"/media/a/a6a1cf7a09adfed8c362492c88c30d74fb3d2f4f7ba180ba34b98556660fada1.mp3","previewfilepath":"/media/ap/a6a1cf7a09adfed8c362492c88c30d74fb3d2f4f7ba180ba34b98556660fada1.mp3","type":"music","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define FFT(a) pow(texelFetch(iChannel0, ivec2(a, 0), 0).x, 5.)\nfloat snd = 0.;\n\n#define P 6.283185307\nconst float div = 4.9, spiralspeed = P/35.;\nvec3 c, map;\nfloat t, roomId;\nint matid=0, doorpart=0;\n\nmat2 rot(in float a) { return mat2(cos(a),sin(a),-sin(a),cos(a)); }\n\nfloat box(in vec3 p, in vec3 s, in float r) { return length(max(abs(p) - s,0.)) - r; }\nfloat box(in vec2 p, in vec2 s) { p = abs(p) - s; return max(p.x,p.y); }\nfloat cyl(in vec3 p, in float h, in float r) {\n  vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(h,r);\n  return min(max(d.x,d.y),0.) + length(max(d,0.));\n}\n// colormap\nvec3 palette(float t) {\n    if(t <1.)t+=1.;\n    vec3 a = vec3(0.5);\n    vec3 b = vec3(0.5);\n    vec3 c = vec3(1.);\n    vec3 d = vec3(0.563,0.416,0.457 + .2);\n    \n    return a + b*cos( 6.28 * c * (t+d)); // A + B * cos ( 2pi * (Cx + D) )\n}\n// MIT Licensed hash From Dave_Hoskins (https://www.shadertoy.com/view/4djSRW)\nvec3 hash33(vec3 p)\n{\n    p = fract(p * vec3(443.8975,397.2973, 491.1871));\n    p += dot(p.zxy, p.yxz+19.27);\n    return fract(vec3(p.x * p.y, p.z*p.x, p.y*p.z));\n}\n\nvec3 stars(in vec3 p)\n{\n    vec3 c = vec3(0.);\n    float res = iResolution.x*0.8;\n    \n\tfor (float i=0.;i<4.;i++)\n    {\n        vec3 q = fract(p*(.15*res))-0.5;\n        //q*= snd/10.;\n        vec3 id = floor(p*(.15*res));\n        vec2 rn = hash33(id).xy;\n        float c2 = 1.-smoothstep(0.,.6,length(q));\n        c2 *= step(rn.x,.0005+i*i*0.001);\n        c += c2*(mix(vec3(1.0,0.49,0.1),vec3(0.75,0.9,1.),rn.y)*0.25+0.75);\n        p *= 1.4;\n    }\n    return c*c*.65;\n}\n\n// 3d value noise\nfloat snoise(vec3 uv, float res)\n{\n\tconst vec3 s = vec3(1e0, 1e2, 1e3);\n\tuv *= res;\n\tvec3 uv0 = floor(mod(uv, res))*s;\n\tvec3 uv1 = floor(mod(uv+vec3(1.), res))*s;\n\t\n\tvec3 f = fract(uv); f = f*f*(3.0-2.0*f);\n\tvec4 v = vec4(uv0.x+uv0.y+uv0.z, uv1.x+uv0.y+uv0.z,\n\t\t      \t  uv0.x+uv1.y+uv0.z, uv1.x+uv1.y+uv0.z);\n\tvec4 r = fract(sin(v*1e-1)*1e3);\n\tfloat r0 = mix(mix(r.x, r.y, f.x), mix(r.z, r.w, f.x), f.y);\n\tr = fract(sin((v + uv1.z - uv0.z)*1e-1)*1e3);\n\tfloat r1 = mix(mix(r.x, r.y, f.x), mix(r.z, r.w, f.x), f.y);\n    return mix(r0, r1, f.z)*2.-1.;\n\t//return 0.7*(1.+snd)*mix(r0, r1, f.z)*2.-1.;\n}\n\nfloat firefbm(vec2 p) {\n    float result = 0.;\n    result = snd*2.;\n    for(int i=1; i<=7; i++) {\n        float amp = pow(2.0,float(i));\n        result += (1.5 / amp) * snoise(vec3(p,0.5) + vec3(0.,-iTime*0.1, iTime*0.01), 16. * amp);\n    }\n    return result;\n}\n\nfloat mypattern(vec2 p) {\n    float intensity = 3. - 3.*length(0.05*p);\n    p.x+=1.;\n    p.x+=sin(iTime)/21.;\n    p.y+=sin(iTime)/20.;\n    intensity += firefbm(p);\n    return intensity;\n               \n}\n\n\nfloat door(in vec3 p, in vec3 s, in float opened) {\n    p.x -= s.x; p.xz *= rot(opened); p.x += s.x;\n    float ddbis = -max(box(vec3(p.x, mod(abs(p.y + .2) - .2, 1.285) - .6425, abs(p.z) - .03), s*vec3(1.,.5,1.), .01), box(p, s*vec3(.725,.85,1.), .02));\n    float dd = box(p, s, .01);\n    p.z = abs(p.z); p.x += .435;\n    float ddd = min(length(max(abs(vec2(length(p.xy) - .012, p.z - .075)) - vec2(.01,.0),0.)) - .015, length(max(abs(vec2(length(p.xy) - .01, p.z - .012)) - vec2(.02,.0),0.)) - .015);\n    ddd = min(ddd, cyl(p.yzx, .015, .075));\n    float d = min(max(dd, ddbis), ddd);\n    doorpart = d == dd ? 1 : 0;\n    return d;\n}\n\nfloat df(in vec3 p) {\n    p.xy *= rot(cos(p.z*spiralspeed)*1.75);\n    \n    float pz = p.z;\n    float Pz = floor(p.z/div + .4)*div;\n    roomId = floor(p.z/div + .5);\n    p.z = mod(pz, div) - div*.5;\n    \n    float pz2 = pz/(div*2.) + 0.24  ;\n    p.xy = mix(p.xy,p.yx,mod(floor(pz2),2.))*sign(mod(floor(pz2 + .5),2.) - .5);\n    map = p;\n    \n    const vec3 doorSize = vec3(.5, 1.125, .01);\n    float wall = box(p.xy, vec2(1.5));\n    p.y += doorSize.y/3.;\n    \n    float dap = abs(Pz - c.z + div/2.);\n    float door = door(p, doorSize, P*.35*(cos(clamp( (dap*dap*dap)*.0125 ,-3.14,3.14))*.5 + .5));\n    \n    float endwall = abs(p.z) - .01;\n\n    float plaintesFond = max(endwall, p.y + 1.05) - .025;\n    float doorShape = box(p.xy, doorSize.xy);\n    float doorShapeExtr = max(doorShape - .05, abs(p.z) - .035);\n    float walls = min(abs(wall) - .01, max(max(wall, min(min(endwall, doorShapeExtr), plaintesFond)),  -doorShape));\n        \n    float plaintes = max(-wall, p.y + 1.02) - .025;\n    \n    float d = min(min(walls, door), plaintes);\n    \n    matid = d == plaintesFond || d == doorShapeExtr ? 3 : d == door ? 1 : d == walls  ? 2 : 3;\n    \n    return d;\n}\n\n#define LIM .001\n#define MAX_D 20.\n#define MAX_IT 50\nstruct rmRes { vec3 pos; int it; bool hit; };\nrmRes rm(in vec3 c, in vec3 r) {\n    vec3 p = c;\n    int it;\n    bool hit = false;\n    for(int i = 0; i < MAX_IT; i++) {\n        float d = df(p);\n        if(d < LIM) { hit = true; break; }\n        if(distance(c,p) > MAX_D) break;\n        p += d*r;\n        it = i;\n    }\n    rmRes res;\n    res.pos = p;\n    res.it = it;\n    res.hit = hit;\n    return res;\n}\n\nvec3 plane2sphere(in vec2 p) {\n    float t = -4./(dot(p,p) + 4.);\n    return vec3(-p*t, 1. + 2.*t);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    int max_freq = 100;\n    for(int i=1; i < max_freq; i++){\n        snd +=FFT(i)*float(i);\n    }\n    snd /=float(max_freq*20);\n    snd*=1.6;\n    \n    vec2 st = (fragCoord.xy - iResolution.xy*.5)/iResolution.x;\n    t = iTime < 0.01 ? 98. : iTime*5. ;\n        \n    c = vec3(0.,0.,t);\n    vec3 r = -plane2sphere(st*5.);\n    r.xz *= rot(cos(t*spiralspeed/3.)*.75);\n    r.xy *= rot(-cos(t*spiralspeed)*1.75);\n\n    rmRes res = rm(c,r);\n    \n    vec3 n = vec3(0.), b = vec3(.88);\n    float whichroom = step(.5,fract(roomId/2.));\n    vec3 c1 = mix(n,b,whichroom), c2 = mix(b,n,whichroom);\n    //float bg_pattern = mypattern(st*0.5*(1.+snd));\n    float bg_pattern = mypattern(st);\n    c2*=palette(bg_pattern);\n    \n    vec3 rd = normalize(vec3(st,-1.5));\n    vec3 bg = stars(rd)*(1.+30.*snd);\n    if(whichroom>0.5){\n        c2+=bg; \n    }\n    vec3 color = c2;\n    vec3 col = vec3( max(bg_pattern,0.),\n                     pow(max(bg_pattern,0.),2.) * 0.4,\n                     pow(max(bg_pattern,0.),3.) * 0.15);\n    //color*=col;\n    if(res.hit)\n        if(matid == 1) color = doorpart == 1 ? c2/palette(bg_pattern) : c1;\n        else if(matid == 2) color = c2;\n        else {\n            if(map.y < -1.45) {\n                if(map.z > .1 || map.z < 0.) {\n                    map.xz *= rot(3.14*.25);\n                    map.xz *= 10.;\n                    color = mix(c1,c2/palette(bg_pattern),step(0.,cos(map.x)*cos(map.z)));//*palette(snd*2.);                    \n                } else\n                    color = c2/palette(bg_pattern);//*palette(snd*2.);\n            } else color = c1;//*palette(snd*2.);\n        }\n    \n    float l = length(st);\n        \n    \n    \n    fragColor = vec4(color - l*l*.5,1.0);\n}","name":"Image","description":"","type":"image"}]}