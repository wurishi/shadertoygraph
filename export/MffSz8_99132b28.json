{"ver":"0.1","info":{"id":"MffSz8","date":"1704930656","viewed":127,"name":"instability of vortex knots","username":"Boogaloo","description":"Simulation of a vortex knot devolving into turbulence in an ideal (incompressible, inviscid) fluid. It's a very rough approximation and might be wildly incorrect.","likes":8,"published":1,"flags":32,"usePreview":0,"tags":["fluid","turbulence","vortex"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"go{\nO=vec4(0.);\nfor(float k=0.; k<s; k++){\nvec4 c = tex(C0,ivec2(k,0.));\nO+=1./pow(distance(I,c.xy),2.)*clamp((60.-c.z)/60.,0.,2.);\n}\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define go void mainImage( out vec4 O, in vec2 I )\n#define R iResolution\n#define C0 iChannel0\n#define cut(x) clamp(x,0.,1.)\n#define tex(x,y) texelFetch(x,y,0)\n#define P I.x*6.28/s\nfloat s = 180.;","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"vec3 flow(vec3 a, float n){\nvec3 fl = vec3(0.);\nfor(float k=0.; k<s; k++){\nif(n==k){continue;}\nvec3 vm = a-tex(C0,ivec2(k,0)).xyz;\nvm /= max(pow(vm.x*vm.x+vm.y*vm.y+vm.z*vm.z,2.),.001);\nvec3 tv = tex(C0,ivec2(k,1.)).xyz;\nfl += cross(vm,tv);\n}\nreturn fl;}\n\ngo{\nO=vec4(0.);\nif(I.y>2.){return;}\nif(I.x>s){return;}\nif(iFrame<2){\nif(I.y>1.){\nO.x=cos(P)+4.*cos(2.*P);\nO.y=4.*sin(2.*P)-sin(P);\nO.z=-3.*cos(3.*P);\nO *= 50.;\nreturn;}\nO.x=60.*sin(P)+120.*sin(2.*P)+R.x*.5;\nO.y=60.*cos(P)-120.*cos(2.*P)+R.y*.5;\nO.z=-60.*sin(3.*P);\nreturn;}\nvec4 me = tex(C0,ivec2(I.x,0.));\nO=me;\nif(I.y>1.){\nvec3 left = flow(vec3(me.x-1.,me.y,me.z),I.x);\nvec3 right = flow(vec3(me.x+1.,me.y,me.z),I.x);\nvec3 down = flow(vec3(me.x,me.y-1.,me.z),I.x);\nvec3 up = flow(vec3(me.x,me.y+1.,me.z),I.x);\nvec3 front = flow(vec3(me.x,me.y,me.z-1.),I.x);\nvec3 back = flow(vec3(me.x,me.y,me.z+1.),I.x);\nvec3 gx = vec3(right.x-left.x,up.x-down.x,back.x-front.x);\nvec3 gy = vec3(right.y-left.y,up.y-down.y,back.y-front.y);\nvec3 gz = vec3(right.z-left.z,up.z-down.z,back.z-front.z);\nvec3 myv = tex(C0,ivec2(I)).xyz;\nO=vec4(myv.x+clamp(dot(myv,gx),-3.,3.),myv.y+clamp(dot(myv,gy),-3.,3.),myv.z+clamp(dot(myv,gz),-3.,3.),0.);\nreturn;}\nO.xyz += flow(me.xyz,I.x);\n}","name":"Buffer A","description":"","type":"buffer"}]}