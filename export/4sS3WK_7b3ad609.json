{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"texture","id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"texture","id":"XdfGRn","filepath":"/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define GROUNDMAT 1.0\n#define TREESMAT 2.0\n#define GRASSMAT 3.0\n#define GRASS2MAT 4.0\n#define WATERMAT 5.0\n#define FLOODFACT sin(iTime*0.234)*0.25+0.75 \n#define DAYCHANGE (cos(iTime*0.1)*0.5+0.5)*0.8\n\n/***********************************************/\nfloat hash(float n) { \n\treturn fract(sin(n)*43758.5453123); \n}\n/***********************************************/\nfloat noise2(vec2 x) {\n    vec2 p = floor(x);\n    vec2 f = fract(x);\n    f = f*f*(3.0-2.0*f);\n\tfloat n = p.x + p.y*57.0;\n    return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n               mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n/***********************************************/\nvec3 terrain(vec3 p) {\n\n    /* base terrain */\n    float h= texture(iChannel0, p.xz*0.001).x*3.1;    //heightmap\n    float t= texture(iChannel0, p.xz*0.001).x*1.2;   //terrain\n    \n    /* trees */\n    float o= 0.5- texture(iChannel0, p.xz*0.05).x *0.8;\n\n    /* water */\n//    float w=texture(iChannel0, p.xz*0.2).x *0.03 ;\n\n    float n=noise2(p.xz);\n\n    /* default material set */\n    float mat=GROUNDMAT;\n\n    /*forest is in range ? */\n    if (h> 1.+n  ) {\n            mat=GRASSMAT;\n    /* compare terrain vs tree */\n        if (h>o) {\n            t+=o;\n            mat=TREESMAT;\n        }\n    }\n    /* grass */\n    if (h> 0.85 && h<1.+n ) mat=GRASS2MAT; \n    /* water */\n   if (h<FLOODFACT+n*0.5 ) {        \n        t=min(t,FLOODFACT);\n        mat=WATERMAT; \n    }\n    \n    return vec3( p.y+4.0-t, mat, h);\n}\n/***********************************************/\nvec3 DE(vec3 p) {\n\tvec3 r=terrain(p);\n\treturn r;\n}\n/***********************************************/\nvec3 normal(vec3 p) {\n\tvec3 e=vec3(0.01,-0.01,0.0);\n\treturn normalize( vec3(\te.xyy*DE(p+e.xyy).x +\te.yyx*DE(p+e.yyx).x +\te.yxy*DE(p+e.yxy).x +\te.xxx*DE(p+e.xxx).x));\n}\n/***********************************************/\nfloat csh( vec3 ro, vec3 rd, float mint, float maxt, float k ) {\n    float res = 1.0;\n    float dt = 0.02;\n    float t = mint;\n    for( int i=0; i<10; i++ ) {\n        float h = DE( ro + rd*t ).x;\n        res = min( res, k*h/t );\n        t += max( 0.05, dt );\n    }\n    return clamp( res, 0.0, 1.0 );\n}\n/***********************************************/\nvec3 applyFog( vec3 rgb, float dist, float b ) {\n    float fogAmount = exp( -dist*b );\n    vec3  fogColor  = vec3(0.5,0.6,0.7);\n    return mix( rgb, fogColor, fogAmount );\n}\n/***********************************************/\n#define suncolor vec3(0.8,DAYCHANGE-0.1,0.2)  //vec3(0.8,0.7,0.9)\nvec3 sky(vec3 rd, vec3 sky){\n    float sa=max(dot(rd,sky),0.0);\n    float v=pow(1.0-max(rd.y,0.0),8.0);\n    vec3 s=mix(vec3(0.7,0.8,0.9),vec3(0.9,0.9,0.9),v);\n        s=s+suncolor*sa*sa*0.2;\n        s=s+suncolor*min(pow(sa,550.0)*1.5,0.3);\n    return clamp(s,0.0,1.0);\n}\n/***********************************************/\nvec3 clouds(vec3 ro, vec3 rd, vec3 col) {\n    float v=(250.0-ro.y)/rd.y;\n    rd.xz*=v;\n    rd.xz+=ro.xz;\n    rd.xz*=0.1;\n    float f=noise2(rd.xz*0.05+iTime*0.2)*2.2;\n    col=mix(col,vec3(0.75,0.75,0.73), clamp(f*rd.y,0.0,1.0));\n    return col;\n}\n/***********************************************/\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    vec2 p = -1.0 + 2.0 * fragCoord.xy / iResolution.xy;\n\tvec3 ta = vec3(0.0, 0.0, 0.0);\n\tvec3 ro =vec3(0.0, 1.5, -9.0);\n\n    /* anim camera */\n        vec3 anvec=vec3(\n            sin(iTime*0.3+cos(iTime*0.2)),\n            sin(iTime*0.2)*1.3,\n            iTime*2.3\n            );\n        ro+=anvec;    \n        ta.z=anvec.z;\n    /* anim camera */\n\n\tvec3 lig=normalize(vec3(0.4, 2.0, 2.0));\n\tvec3 sun=normalize(vec3(0.08,DAYCHANGE*0.5-0.25,0.3));\n\n\tvec3 cf = normalize( ta - ro );\n    vec3 cr = normalize( cross(cf,vec3(0.0,1.0,0.0) ) );\n    vec3 cu = normalize( cross(cr,cf));\n\tvec3 rd = normalize( p.x*iResolution.x/iResolution.y*cr + p.y*cu + 2.5*cf );\n\n\tvec3 col=vec3(1.0);\n\t/* trace */\n\tvec3 r=vec3(0.0);\t\n\tfloat f=0.0;\n\tvec3 ww;\n\tfor(int i=0; i<90; i++) {\n\t\tww=ro+rd*f;\n\t\tr=DE(ww);\t\t\n\t\tif( r.x<0.0 ) break;\n\t\tf+=r.x;\n\t}\n\t/* draw */\n\tif( f<90.0 ) {\n\t\tvec3 nor=normal(ww);\n\n\t\tif (r.y==GROUNDMAT) col=vec3(0.3,0.2,0.1);\n\t\tif (r.y==TREESMAT) col=vec3(0.9,0.8,0.4) * texture(iChannel1, ww.xz*0.05).xyz*0.8;\n\t\tif (r.y==GRASSMAT) col=vec3(0.05,0.19,0.08) * texture(iChannel1, ww.xz*0.003).xyz*1.0;\n\t\tif (r.y==GRASS2MAT) {\n                    col=vec3(0.3,0.2,0.1);\n\t\t       vec3 colg=vec3(0.1,0.38,0.16);\n\t\t       col=mix(col,colg,vec3(r.z*0.6-0.5));\n\t\t}\n\t\tif (r.y==WATERMAT) {\n\t\t            col=vec3(0.3,0.4,0.5);\n\t\t       vec3 colg=vec3(0.7,0.7,1.0);\n\t\t       col=mix(col,colg,vec3(r.z*0.3-0.4 ));\n\t\t}\n\t\t\n\t\t\tfloat amb =0.1*ww.y;\n\t\t\tfloat dif =0.7*clamp(dot(lig, nor), 0.0,1.0);\n\t\t\tfloat bac =0.2*clamp(dot(nor,-lig), 0.0,1.0);\n\t\t\tfloat sh=csh(ww, lig, 0.2, 2.0, 16.0);\n\n\t\t    col*=(amb+dif+bac+sh);\n            col=applyFog(col, 1.1/f, r.z*3.75);\n            col=mix( vec3(0.9,0.9,0.9), col, 1.-1./(150./f));\n            col*=1.2;\n\n\t} else {\n            col=sky(rd,sun);\n            col=clouds(ro,rd,col);\n\t}\n\tcol*=DAYCHANGE+0.2;\n\tfragColor = vec4( col, 1.0 );\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4sS3WK","date":"1393229263","viewed":2713,"name":"The forest","username":"avix","description":"It started with forest.. then i wanted to make a hot air Balloon floating over forest and after a while this came out... ofcourse, i FORGOT the balloon...\nwater floods, day/night change..","likes":43,"published":1,"flags":0,"usePreview":0,"tags":["procedural","3d","terrain","raymarch","clouds","sky"],"hasliked":0,"parentid":"","parentname":""}}