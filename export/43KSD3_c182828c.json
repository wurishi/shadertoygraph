{"ver":"0.1","info":{"id":"43KSD3","date":"1720573143","viewed":15,"name":"[ARTS1308] Sierpinski 3D","username":"ARTS1308","description":"Tutorial of ray marching a 3D Sierpinski","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["sierpinski","arts1308"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float sdSierpinski(vec3 p)\n// adapted from iq's code https://www.shadertoy.com/view/4dl3Wl\n{\n    const vec3 va = vec3(  0.0,  0.57735,  0.0 );\n    const vec3 vb = vec3(  0.0, -1.0,  1.15470 );\n    const vec3 vc = vec3(  1.0, -1.0, -0.57735 );\n    const vec3 vd = vec3( -1.0, -1.0, -0.57735 );\n    \n    float scale = 1.0;\n    float dm;\n    for( int i=0; i<15; i++ )\n\t{\n        vec3 v;\n\t    float d, t;\n\t\td = dot(p-va,p-va);            { v=va; dm=d; }\n        d = dot(p-vb,p-vb); if( d<dm ) { v=vb; dm=d; }\n        d = dot(p-vc,p-vc); if( d<dm ) { v=vc; dm=d; }\n        d = dot(p-vd,p-vd); if( d<dm ) { v=vd; dm=d; }\n\t\tp = v + 2.0*(p - v);\n        scale*= 2.0;\n\t}\n\treturn (sqrt(dm)-1.0)/scale;\n}\n\n#define R(a) mat2(cos(a),sin(a),-sin(a),cos(a))\n\nvoid mainImage(out vec4 fragColor, vec2 fragCoord)\n{\n    float color = 0.0;\n    \n    // screen to world\n    vec3 rd = vec3((fragCoord - 0.5 * iResolution.xy) / iResolution.y, 1);\n    rd = normalize(rd);\n    rd.xz *= R(iTime * 0.2);\n    rd.yz *= R(iTime * 0.3);\n    vec3 ro = vec3(0., 0., 0.2*sin(iTime*.2));\n    float l = 0.0;\n    \n    for(float i = 1.0; i < 50.0; i++)\n    {\n        vec3 p = ro + rd * l;\n        float d = sdSierpinski(p);\n        l += clamp(d, 0.0, 0.5);\n\n        if(d < 0.00001) {\n            color += 1./i;\n            //color = 1./l/l/25.; break;\n        }\n    }\n    color = pow(color, 1./2.2);\n    fragColor = vec4(vec3(color), 1.);\n}\n","name":"Image","description":"","type":"image"}]}