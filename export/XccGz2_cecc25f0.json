{"ver":"0.1","info":{"id":"XccGz2","date":"1711884098","viewed":365,"name":"Once upon a time in a DataCenter","username":"iapafoto","description":"A short allegory on singularity\n\nMy very first entry to Revision2024\n","likes":33,"published":1,"flags":0,"usePreview":1,"tags":["4k","revision","2024"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n//-----------------------------------------------------\n// Created by sebastien durand - 2024\n// Released at Revision2024\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n//-----------------------------------------------------\n\n// ------------------------------------------\n// [Flyguy] Revision logo - https://www.shadertoy.com/view/ttsGR4\n// [iq]     Synth FM      - https://www.shadertoy.com/view/XsjSzV\n// ------------------------------------------\n\n// ------------------------------------------\n// ... Will add some comments soon...\n// ------------------------------------------\n\nfloat kr=0.;\nvec3 ph=vec3(0);\nint sh=0;\n\nfloat sdBox(vec3 p,vec3 b,float e) {\n  b=abs(p)-b;\n  return min(max(b.x,max(b.y,b.z)),0.)+length(max(b,0.))-kr*e;\n}\n\nvoid min2(inout vec2 a,vec2 b) {\n  a=a.x<b.x?a:b;\n}\n\nvec2 hash22( vec2 p) {\n\treturn fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);\n}\n\nfloat n2D(vec2 p)\n{\n  vec2 i=floor(p);\n  p-=i;\n  p*=p*p*(p*p*6.-p*15.+10.);\n  return dot(mat2(fract(sin(mod(vec4(0,1,113,114)+dot(i,vec2(1,113)),6.2832))*43758.5))*vec2(1.-p.y,p.y),vec2(1.-p.x,p));\n}\n\nfloat fbm(vec2 p) {\n  return n2D(p)*.533+n2D(p*2.)*.267+n2D(p*4.)*.133+n2D(p*8.)*.067;\n}\n\nfloat tex3D(vec3 p,vec3 n,int i) {\n  if(i<3)p[i]-=.001;\n  n=max(n*n,.001);\n  n/=n.x+n.y+n.z;\n  return fbm(p.yz)*n.x+fbm(p.zx)*n.y+fbm(p.xy)*n.z;\n}\n\nvoid doBumpMap(inout vec3 n,vec3 p)\n{\n  p=(vec3(tex3D(p,n,0),tex3D(p,n,1),tex3D(p,n,2))-tex3D(p,n,3))/.002;\n  n=normalize(n+(p-n*dot(n,p))*.2);\n}\n\nmat2 rot(float a) {\n  return mat2(cos(a-vec4(0,1.57,11,0)));\n}\n\n// golfed from a Shane comment that I could not find again\nvec3 txWood2(vec3 p0,int i) {\n  p0[i]*=.1;\n  vec3 p=sin(p0*4.3+cos(p0.yzx*6.7));\n  float n=dot(p+sin(p*13.)*.03,vec3(3)),g=1.-abs(dot(sin(p0*120.5+n*6.283+sin(p0.zxy*121.3)),vec3(.333)));\n  n=fract(n+fract(n*4.)*.1);\n  n=min(min(n,n*(1.-n)*6.)*.85+g*.2,1.);\n  return.3+.7*sqrt(mix(vec3(.5,.15,.025),vec3(1.5,.6,.2),n*.75+.25))*(n*.6+.4);\n}\n\nvec3 txWood(vec3 p) \n{\n  vec2 size=vec2(6,.8),k;\n  p.x+=mod(round(p.z/.8),2.)*3.;\n  k=size*round(p.xz/size);\n  float r=hash22(k*80.+9600.).x;\n  p.xz-=k;\n  return txWood2((p+r)*.7,0)*(.1+.9*smoothstep(0.,-.02,sdBox(vec3(p.xz,0),vec3(size.xy*.5,49),0.)))*(.5+.5*r);\n}\n\nfloat txInvader(vec2 v)\n{\n  ivec2 m=ivec2(v*80.),x=m;\n  m.y=(86-m.y)%8+1;\n  return abs(x.x)<33&&abs(x.y+2)<53&&(219*(m.y>4?\n    614081:\n    4840434)&1<<abs((m.x+86)%13-7)-m.y*8)>0?\n    1.:\n    1.5;\n}\n\nvoid sdBezier(inout vec2 r,vec3 p,vec3 b0,vec3 b1,vec3 b2) {\n  b0-=p; b1-=p; b2-=p;\n  vec3 b01=cross(b0,b1),b12=cross(b1,b2),b20=cross(b2,b0),n=b01+b12+b20;\n  float a=dot(b20,n),b=-dot(b01,n),d=-dot(b12,n);\n  p=(d-b)*b1+(b-a*.5)*b2-(d-a*.5)*b0;\n  a=clamp((b-.5*(a*a*.25-b*d)*dot(p,b0-2.*b1+b2)/dot(p,p)-a*.5)/-dot(n,n),0.,1.);\n  min2(r,vec2(length(mix(mix(b0,b1,a),mix(b1,b2,a),a))-.08,cos(60.*a)>.6?\n    50:\n    25));\n}\n\nvec2 sdRobot(vec3 p0,float b)\n{\n  float d=length(p0),\n      k2=smoothstep(101.,110.,iTime),k=smoothstep(78.,82.,iTime);\n  if(d>3.1&&sh==0)\n    return vec2(d-3.,10);\n  vec3 p=p0,p00=p0,pm;\n  d=sdBox(p,vec3(.3,.6,.2),.1+.1*p.y);\n  vec2 d2=vec2(999);\n  sdBezier(d2,p,vec3(0,.6,0),vec3(0,1.1,-.4),vec3(0,1.6,.2));\n  p.x=abs(p.x);\n  p.zx*=rot(.2);\n  d=min(d,sdBox(p-vec3(.4,-1.8,1.3),vec3(.2,.12,.4),0.));\n  sdBezier(d2,p,vec3(.2,-.6,0),vec3(.6,-.3,1.5),vec3(.4,-1.8,1));\n  sdBezier(d2,p,vec3(.3+.2*kr,.6,0),vec3(1.-.2*b,-.8,-.2),vec3(.95-.95*b,-.07-.1*b,1.3));\n  p=p0-vec3(0,1.9,.5);\n  p.xy*=rot(.4*k2-.2);\n  p.zy*=rot(k-.5-.5*k2);\n  p.zx*=rot(1.6*k2);\n  ph=p;\n  min2(d2,vec2(sdBox(p,vec3(.9,.6,.5),0.),4));\n  p.x=abs(p.x)-.75;\n  min2(d2,vec2(length(p)-.3,25));\n  min2(d2,vec2(length(p-vec3(-.45,-.05,.25))-.3,-1.-b) // changment de la couleur des yeux\n      );\n  p0.z-=1.4;\n  p0.zy*=rot(.7);\n  p0.x=abs(p0.x);\n  p=p0;\n  p.yx*=rot(1.26);\n  pm=p-vec3(.2,1.19-b,-.18);\n  pm.yx*=rot(.5);\n  d=min(d,sdBox(pm,vec3(.15,.05,.1),.05));\n  d=min(d,sdBox(pm-vec3(-.09,.03,.25),vec3(.07,.03,.16),.02));\n  pm.yz*=rot(.5);\n  d=min(d,sdBox(pm-vec3(.1,.08,.2),vec3(.07,.03,.16),.02));\n  pm.xy*=rot(.3);\n  pm.xz*=rot(1.);\n  d=min(d,sdBox(pm-vec3(-.16,.05,.2),vec3(.06,.04,.12),.02));\n  min2(d2,vec2(d,5));\n  if(iTime<77.&&sh==0) {\n      k2=sdBox(p0-vec3(0,-.1-.03*cos(9.*p0.x),0),vec3(.2,.018,.8),.01);\n      if(p00.y<.8)\n        ph=p;\n      k2=min(k2,sdBox(p-vec3(.12,.5+p.x*1.256,0),vec3(0,.5,.8),.018));\n      p.y-=.5+p.x*1.256;\n      min2(d2,vec2(k2,48));\n      min2(d2,vec2(.8*sdBox(p-vec3(.01+sin(p.y*6.9+5.7)*.027/(1.+p.y),0,0),vec3(.06,.48,.78),0.),7));\n  }\n  return d2;\n}\n\nvoid sdBook(inout vec2 r,vec3 p,float w,float h,float c) {\n    p-=vec3(-w*.5,h+.07,0);\n    w=w*.5-.015;\n    p.x=abs(p.x);\n    float d=sdBox(p-vec3(w,0,0),vec3(0,h,h*.7),.01);\n    p.z-=kr*.04*cos(p.x/w)-.004;\n    min2(r,vec2(sdBox(p,vec3(w,h*.95+.002*cos(6e2*p.x),h*.65),0.),15));\n    p.z -=h*.7-.011-.02*cos(2.*max(.9,cos(14.*p.y/h)));\n    min2(r,vec2(min(d,sdBox(p,vec3(w-.015,h,0),.015)), c*c*c*c)); \n}\n\nvec2 sdMap(vec3 p0) {\n  vec3 pl=p0,p=p0-vec3(-20,19.65,3);\n  p.xz*=rot(.4);\n  float c,hall=sdBox(p0-vec3(5,31,5),vec3(15,30,5),0.),\n      x=max(0.,iTime-90.),\n      dr=length(p-vec3(0,2,0))-smoothstep(0.,18.,x)/.1-5.1*max(0.,x-19.),\n      b=clamp((90.-iTime)/15.,0.,1.);\n  b=pow(9.,-15.*b)*cos(b*30.);\n  pl.y=mod(pl.y+10.,17.5)-10.;\n  vec2 h,\n      res0=vec2(max(-hall,sdBox(pl-vec3(0,.1,0),vec3(999,.1,999),0.)),3),\n      res=sdRobot(p,b);\n  kr=smoothstep(-1.,1.,dr);\n  p=p0-vec3(6.7,0,5);\n  p.xy*=rot(.785);\n  p.z=abs(p.z);\n  p.y-=clamp(round(p.y),0.,24.);\n  p.yx*=rot(.785);\n  min2(res0,vec2(min(sdBox(p,vec3(.45,.5,3),.05),max(-hall,sdBox(pl-vec3(3.*round(pl.x/3.),-.5,0),vec3(.17,.45,999),0.))),2.3));\n  p=p0-vec3(82,0,-2.6);\n  p.zy*=rot(-.2);\n  p.x=abs(p.x);\n  min2(res0,vec2(min(sdBox(p-vec3(0,clamp(round(p.y),0.,8.),0),vec3(.75,0,0),.04),\n  sdBox(p-vec3(.75,4.6,0),vec3(.05,4.4,.1),0.)),.3));\n  hall=sdBox(p0-vec3(0,15.25,0),vec3(999,2.2,999),0.);\n\n  pl=p0;\n  pl.y=pl.y/.25+1.;pl=round(pl*.1);\n  p0.z-=pl.z/.1;\n  p=p0;\n  h=kr*(.2+.1*cos(2.*p.xy)+.2*cos(.3*p.xy));\n  min2(res,vec2(sdBox(p-vec3(0,15.8,0),vec3(999,.85-h.x,.65-h.x),h.x),.99));\n  p.z=abs(p.z)-1.1;\n  p.x=mod(p.x+6.,12.)-6.;\n  min2(res,vec2(sdBox(p,vec3(.5),.2-.2*p.y),9));\n  min2(res,vec2(sdBox(p,vec3(.5-h.y,100,.5-h.y),h.y),1));\n  min2(res,vec2(sdBox(p-vec3(0,16.8,0),vec3(.45,.45,1e3),.2),2));\n  min2(res0,vec2(sdBox(p-vec3(0,14.7,0),vec3(.6,0,0),.05),1.5));\n  min2(res0,vec2(sdBox(p-vec3(0,14.7,-.5),vec3(.2,.27,.6),.05),2));\n  p-=vec3(0,15.5,1.7);\n \n  p.yz*=rot(-.72);\n  min2(res0,vec2(sdBox(p,vec3(.17,.2,2.5),.1),1));\n  p.z=abs(p.z)-2.;\n  min2(res0,vec2(sdBox(p,vec3(.7,0,0),.05),1.5));\n  \n  p=p0;\n  p.z-=2.5;\n  p.x=mod(p.x+30.,48.)-11.;\n  p.y=mod(p.y+13.,17.5)-13.;\n  min2(res,vec2(sdBox(p-vec3(0,1.4,0),vec3(2.4,.04,.8),.06),.1));\n  p.xz=abs(p.xz);\n  p.xy*=rot(.1);\n  min2(res0,vec2(sdBox(p-vec3(1.6,.6,.6),vec3(0,.7,0),.1),8));\n  res0.x=max(res0.x,-dr);\n  min2(res,res0);\n  hall=min(hall,sdBox(p0-vec3(18.+72.*round(p0.x/72.),0,0),vec3(6.01,999,999),0.)); // couloir en travers\n  \n  p=p0;\n  p.y=mod(p.y+.27,2.5)-1.25;\n  min2(res,vec2(max(-hall,sdBox(p,vec3(1e3,.07,.7),0.)),.99));\n  p.y=mod(p0.y-1.,2.5);\n  c=floor(p.x);\n  if(kr<.5||iTime<95.){\n      res0=vec2(sh==0?\n          sdBox(p-vec3(c+(p.x-c>.5?11.5:-10.5),.8,0),vec3(10.48,.8,.7),0.):\n        999.,0);\n      p.x-=c;\n      for(x=.02;x<=.97;)\n        {\n          h=vec2(1.-.87*kr,.38)+kr*vec2(.2,.3)*hash22(pl.zy+vec2(x,c));\n          h.x=min(h.x,.98-x);\n          x+=h.x;\n          if(h.x>.12+.5*kr*b)\n            sdBook(res0,p-vec3(x,0,0),h.x,h.y,2.+hash22(h+c).x);\n        }\n      res0.x=max(max(res0.x,-hall),kr<.5?dr+.5:0.);\n      min2(res,res0);\n    }\n  return res;\n}\n\nvec3 render(inout vec3 ro,inout vec3 rd,inout float md) {\n      sh=0;\n  float sha=1.,edge,m,t=.1,tt=.01;\n  vec2 res=vec2(999);\n  for(int i=0;++i<200&&res.x>t/1e4&&t<md;) {\n      res=sdMap(ro+rd*t);\n      t+=.9*res.x;\n    }\n  m=res.y;\n  if(m<.0) {\n  rd*=0.;\n    return vec3(.7,.9,1)*(m<-1.2&&m>-2.?hash22(ro.xy+m).x-.5:1.);\n  }\n  \n  ro+=t*rd;\n  vec3 ref=vec3(0,max(1e-4*t,.05-kr*.04),0),\n      lig=vec3(sdMap(ro-ref.yxx).x,sdMap(ro-ref).x,sdMap(ro-ref.xxy)),\n      col=vec3(sdMap(ro+ref.yxx).x,sdMap(ro+ref).x,sdMap(ro+ref.xxy)),\n      nor=col-lig+.001;\n  nor=normalize(nor-max(.001,dot(nor,rd))*rd);\n  col=4.*abs(res.x-col-lig);\n  edge=min(1.,col.x+col.y+col.z);\n  col=.5+.3*sin(vec3(.05,.08,.1)*(m-1.));\n\n  ph=m==4.||m==7.?\n    ph:\n    ro;\n  col=m<3.?\n    fract(m+.99)*txWood2(ro,int(m)):\n    m==3.?\n      .2+txWood(ro).x*vec3(.4):\n      m==4.||m==5.?\n        mix(vec3(.01,.3,1),vec3(.6,.3,.1),smoothstep(.6,.7,tex3D(ph*2.,nor,3))):\n        m==7.?\n          vec3(txInvader(ph.yz-vec2(.46,.05))):\n          col;\n  ref=reflect(rd,nor);\n \n  if(kr>0.)\n    doBumpMap(nor,30.*ph);\n   \n  lig=vec3(.27,.6,.58);\n  sh=1;\n  for(int i=0;++i<28&&m>.001&&tt<2.5;)\n    m=sdMap(ro+lig*tt).x,sha=min(sha,2.*m/tt),tt+=clamp(m,.02,.1);\n    \n  tt=1.05;\n  m=1.; // became ao\n  for(float x=.02;x<.32;x+=.06)\n    m-=(x-sdMap(ro+nor*x).x)*(tt*=.95);\n  lig=.1+min(m,1.)*dot(nor,lig)*max(sha,0.)*vec3(1.3,1,.6)\n      +pow(max(dot(ref,lig),0.),12.)+.25*pow(clamp(1.+dot(nor,rd),0.,1.),2.)\n      + .12*vec3(.2,1,2)*max(0.,dot(rd,reflect(vec3(.97,0,.24),nor)));\n  \n  rd = res.y==3.||res.y==.1?ref:ref-ref;\n  return mix(\n            mix(vec3(1.5,.9,.75),vec3(.15,.2,.3),kr),\n            mix(.2+edge*(2.+cos(3.*iTime))*vec3(.1,1,2),col,kr)*lig,\n            md=smoothstep(md,md/5.,t));\n}\n\n\nvoid mainImage(out vec4 cl,vec2 glFragCoord) {\n  \n  int[18] an =int[18](0,15,    15,30,   30,45,     30,50,    30,57,    40,65,  65,75,    102,109,    109,140);\n  int[30] aro=int[30](95,8,80, 95,5,-7, 110,10,-5, 92,16,-8, 94,17,2,  8,5,8,  -10,24,4, -23,24,9, -4,25,7,  140,4,4),\n          ata=int[30](80,6,28, 91,5,-5, 113,9,-12, 90,15,-2, 92,17,8,  0,6,5, -16,22,5, -20,21,5,  -10,23,7, 135,3,9);\n \n    float t,t2=8.;\n  vec2 R=iResolution.xy,q=glFragCoord.xy,\n      p=(q+q-R)/R.y;\n  q/=R;\n  vec3 a,col,ro=vec3(aro[0],aro[1],aro[2]),rd=vec3(ata[0],ata[1],ata[2]);\n  for(int i=0;++i<10;)\n    t=smoothstep(float(an[i*2-2]),float(an[i*2-1]),iTime),\n    ro=mix(ro,vec3(aro[i*3],aro[i*3+1],aro[i*3+2]),t),\n    rd=mix(rd,vec3(ata[i*3],ata[i*3+1],ata[i*3+2]),t);\n  t=.5*cos(.2*iTime);\n  a=normalize(rd-ro);\n  rd=normalize(cross(a,vec3(sin(t),cos(t),0)));\n  rd=mat3(rd,normalize(cross(rd,a)),a)*normalize(vec3(p+(iTime>109.?\n    .01*hash22(p-p+iTime).x:\n    0.),2));\n  \n  t=50.;\n  col = render(ro,rd,t);\n  if (rd.x!=0.) {\n      col += t*.1*render(ro,rd,t2);\n  }\n  t=smoothstep(0.,7.,iTime-135.);\n  cl=iTime==0.?\n  // Revision Logo: Flyguy (golfed by Flyguy, FabriceNeyret2, Xor, and me)\n  vec4(1&int[](0,~0,124,3236969472,4160487169,~0,0,2199966623,~0,2031632,0)[min(int(length(p*20.)),10)]>>int(5.*atan(p.y,p.x))):\n  vec4(pow(clamp(mix(col,vec3(.1,.5,1),smoothstep(1.,1.3,fbm(2.5*p)+t))*(1.-t),0.,1.),vec3(.7))*4.*sqrt(q.x*q.y*(1.-q.x)*(1.-q.y)),1);\n}","name":"Image","description":"","type":"image"}]}