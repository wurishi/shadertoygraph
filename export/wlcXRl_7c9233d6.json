{"ver":"0.1","info":{"id":"wlcXRl","date":"1581516841","viewed":572,"name":"turbulent landscape","username":"unnick","description":"experimenting a bit with video feedback\nadvection -> sharpening -> color rotation -> noise -> normalization -> centered scaling and rotation","likes":22,"published":3,"flags":32,"usePreview":0,"tags":["2d","feedback","infinite","multipass","buffers"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//parameters in the common tab\nvoid mainImage(out vec4 col, in vec2 pos) {\n    //col.xy = fetch(ivec2(pos)).xy * .5 + .5;\n    col.xyz = vec3(fetch(ivec2(pos)).xy, 1) * colormat;\n}\n","name":"Image","description":"","type":"image"},{"inputs":[{"id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","previewfilepath":"/media/ap/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","type":"texture","channel":3,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void mainImage(out vec4 col, in vec2 pos) {\n    ivec2 ipos = ivec2(pos);\n    //advection\n    vec2 dir = fetch(ipos).xy;\n    dir = tex(dir*advection + pos).xy;\n    \n    //sharpening\n    dir -= ( fetch(ipos+ivec2(1,0)).xy\n           + fetch(ipos+ivec2(0,1)).xy\n           + fetch(ipos-ivec2(1,0)).xy\n           + fetch(ipos-ivec2(0,1)).xy) * sharpening;\n    \n    //rotation\n    dir *= rotmat(dirrot);\n    \n    //noise\n    dir += (texelFetch(iChannel3, (ivec2(pos)+iFrame*ivec2(158,83)) & 255, 0).xy * 2. - 1.) * noise;\n    \n    col.xy = dot(dir,dir) < .00001 ? vec2(1,0) : normalize(dir);\n}\n","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"//supported interpolation methods: linear, cubic, lanczos3\n#define interpolation_cubic\n\n//parameters\n//replace .02 with .06 for linear interpolation\n#define sharpening .02\n#define advection 2.\n#define dirrot .1\n#define zoom .98\n#define screenrot .03\n#define noise .01\n\n//color transform\n#define colormat mat3(.5,0,.5, -.25,sqrt(3.)/4.,.5, -.25,-sqrt(3.)/4.,.5)\n//#define colormat mat3(.5,0,.5, 0,.5,.5, 0,0,0)\n\n#define res iResolution.xy\n#define tau 6.283185\n#define htau (tau*.5)\n#define fetch(p) texelFetch(iChannel0, p, 0)\n\n#ifdef interpolation_linear\n#define tex(p) texture(iChannel0, (p) / res)\n#endif\n#ifdef interpolation_cubic\n#define tex(p) cubic_tex(iChannel0, p)\n#endif\n#ifdef interpolation_lanczos3\n#define tex(p) lanczos3_tex(iChannel0, p)\n#endif\n\nvec4 cubic_tex(sampler2D ch, vec2 p) {\n    ivec2 ires = textureSize(ch, 0);\n    p -= .5;\n    \n    ivec2 ip = ivec2(floor(p));\n    vec2 fp = fract(p);\n    \n    vec2 w0 = -fp*(1.-fp)*(1.-fp)*.5;\n    vec2 w1 = fp*fp*(1.5*fp-2.5)+1.;\n    vec2 w2 = (.5+2.*fp-1.5*fp*fp)*fp;\n    vec2 w3 = -.5*(1.-fp)*fp*fp;\n    \n    #define tmpfetch(p) texelFetch(ch, (((p)%ires)+ires)%ires, 0)\n    vec4 p00 = tmpfetch(ip+ivec2(0,0)-1);\n    vec4 p10 = tmpfetch(ip+ivec2(1,0)-1);\n    vec4 p20 = tmpfetch(ip+ivec2(2,0)-1);\n    vec4 p30 = tmpfetch(ip+ivec2(3,0)-1);\n    vec4 p01 = tmpfetch(ip+ivec2(0,1)-1);\n    vec4 p11 = tmpfetch(ip+ivec2(1,1)-1);\n    vec4 p21 = tmpfetch(ip+ivec2(2,1)-1);\n    vec4 p31 = tmpfetch(ip+ivec2(3,1)-1);\n    vec4 p02 = tmpfetch(ip+ivec2(0,2)-1);\n    vec4 p12 = tmpfetch(ip+ivec2(1,2)-1);\n    vec4 p22 = tmpfetch(ip+ivec2(2,2)-1);\n    vec4 p32 = tmpfetch(ip+ivec2(3,2)-1);\n    vec4 p03 = tmpfetch(ip+ivec2(0,3)-1);\n    vec4 p13 = tmpfetch(ip+ivec2(1,3)-1);\n    vec4 p23 = tmpfetch(ip+ivec2(2,3)-1);\n    vec4 p33 = tmpfetch(ip+ivec2(3,3)-1);\n    #undef tmpfetch\n    \n    return p00*w0.x*w0.y + p10*w1.x*w0.y + p20*w2.x*w0.y + p30*w3.x*w0.y\n         + p01*w0.x*w1.y + p11*w1.x*w1.y + p21*w2.x*w1.y + p31*w3.x*w1.y\n         + p02*w0.x*w2.y + p12*w1.x*w2.y + p22*w2.x*w2.y + p32*w3.x*w2.y\n         + p03*w0.x*w3.y + p13*w1.x*w3.y + p23*w2.x*w3.y + p33*w3.x*w3.y;\n    \n    /*\n    cleaner but slower version of the code above:\n\n    vec4 wx = vec4(w0.x,w1.x,w2.x,w3.x);\n    vec4 wy = vec4(w0.y,w1.y,w2.y,w3.y);\n    vec4 sum = vec4(0);\n    for(int y = 0; y < 4; y++)\n    for(int x = 0; x < 4; x++) {\n        sum += tmpfetch(ip+ivec2(x,y)-1) * wx[x] * wy[y];\n    }\n    */\n}\n\n//#define sinc(x) mix(sin((x)*tau) / ((x)*tau), vec2(1.), lessThan(abs(x),vec2(.01)))\nvec4 lanczos3_tex(sampler2D ch, vec2 p) {\n    ivec2 ires = textureSize(ch, 0);\n    p -= .5;\n    \n    ivec2 ip = ivec2(floor(p));\n    vec2 fp = fract(p);\n    \n    vec2 w[6];\n    \n    for(int i = 0; i < 6; i++) {\n        vec2 x = vec2(i) - 2. - fp;\n        vec2 tmp = 3. * sin(x*htau) * sin(x*htau/3.) / (htau*htau*x*x);\n        w[i] = mix(tmp, vec2(1.), lessThan(abs(x), vec2(.1)));\n        \n    }\n    \n    #define tmpfetch(p) texelFetch(ch, (((p)%ires)+ires)%ires, 0)\n    vec4 sum = vec4(0);\n    for(int y = 0; y < 6; y++)\n    for(int x = 0; x < 6; x++) {\n        sum += tmpfetch(ip+ivec2(x,y)-2) * w[x].x * w[y].y;\n    }\n    #undef tmpfetch\n    return sum;\n}\n\nmat2 rotmat(float a) {\n    float c = cos(a);\n    float s = sin(a);\n    return mat2(c,-s,s,c);\n}\n","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"void mainImage(out vec4 col, in vec2 pos) {\n    //centered scaling and rotation\n    col.xy = normalize(tex(((pos-res*.5) * zoom * rotmat(screenrot))+res*.5).xy);\n}\n","name":"Buffer B","description":"","type":"buffer"}]}