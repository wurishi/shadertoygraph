{"ver":"0.1","info":{"id":"ldlyzH","date":"1487113228","viewed":191,"name":"Circle ray intersection test","username":"SalikSyed","description":"just trying to get ray circle intersection working","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["raytracing"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nvec3 intersectCircle(vec2 target, vec2 origin, vec2 sphereCenter, float r) {\n    vec2 d = target - origin;\n\n    float a = dot(d, d);\n    float b = 2.0 * dot(d, origin - sphereCenter);\n    float c = dot(sphereCenter, sphereCenter) + dot(origin, origin) - 2.0 * dot(sphereCenter, origin) - r*r;\n    float test = b*b - 4.0*a*c;\n\n    bool behind = length(origin - target) < length(origin - sphereCenter);\n    \n\tif (test >= 0.0 && !behind) {\n  \t\tfloat u = (-b - sqrt(test)) / (2.0 * a);\n  \t    vec2 hitp = origin + u * (target - origin);\n        \n        if (length(hitp.xy - target) > length(target - origin)) {\n            return vec3(-1.0,0.0,.0); \n        }\n        return vec3(1.0, hitp);\n    } else {\n        return vec3(-1.0,0.0,.0);   \n    }\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float aspectRatio = iResolution.x/iResolution.y;\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    uv.x *= aspectRatio;\n    vec2 sphereCenter = vec2(0.5 * aspectRatio, 0.5);\n    float sphereRadius = 0.3;\n    float orbitRadius = 0.5;\n    \n    vec2 lightPos = sphereCenter + vec2(orbitRadius * sin(iTime), orbitRadius * cos(iTime));\n    float lightRadius = 0.02;\n    \n    if (length(uv-sphereCenter) < sphereRadius) {\n        fragColor = vec4(uv,0.5+0.5*sin(iTime),1.0);\n    } else if (length(uv-lightPos) < lightRadius) {\n        fragColor = vec4(1.0, 1.0, 0.0,1.0);\n    } else {\n        vec3 hit = intersectCircle(lightPos, uv, sphereCenter, sphereRadius);\n        if (hit.x >= 0.0) {\n            fragColor = vec4(vec3(0.0),1.0);\n        } else {\n            fragColor = vec4(0.8, 0.78, 0.85, 1.0);\n        }\n    }\n\n}","name":"Image","description":"","type":"image"}]}