{"ver":"0.1","info":{"id":"ltGyR1","date":"1563202569","viewed":189,"name":"AO from heightmap filter","username":"nnorm","description":"An old test I wrote to try to generate AO from heightmap. It is wrong but at that time it looked alright. Did not test further or tried to fix it. Use the mouse to see the comparaison.","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["filter","heightmap","ao"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4sfGRn","filepath":"/media/a/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg","previewfilepath":"/media/ap/fb918796edc3d2221218db0811e240e72e340350008338b0c07a52bd353666a6.jpg","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define TAU 6.28318530718\n#define AO_POWER 4.0\n#define AO_INTENSITY 1.0\n\nfloat gaussian_avg(in vec2 p, in float s)\n{\n    float px2 = (p.x*p.x);\n    float py2 = (p.y*p.y);\n    float s2 = (s*s);\n    \n    float a = 1.0 / TAU * s2;\n    float b = -(px2 + py2) / 2.0 * s2;\n    return a * exp(b);\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n    float aRatio = iResolution.x/iResolution.y;\n    uv.x *= aRatio;\n    \n    vec4 sampleTex = texture(iChannel0, uv);\n    float f0 = sampleTex.x;\n    \n    float ao = 1.0 + gaussian_avg(uv, sampleTex.x) - sampleTex.x;\n    ao *= 1.0 + gaussian_avg(uv, sampleTex.y) - sampleTex.y;\n    ao *= 1.0 + gaussian_avg(uv, sampleTex.z) - sampleTex.z;\n    ao = clamp(ao, -1.0, 1.0);\n   \tao = pow(ao, AO_POWER) * AO_INTENSITY;\n   \n    // Output to screen\n    float xPos = iMouse.x / iResolution.x;\n    xPos *= aRatio;\n    if(uv.x < xPos)\n    \tfragColor = (1.0-vec4(ao));\n    else\n        fragColor = sampleTex;\n    \n    \n}","name":"Image","description":"","type":"image"}]}