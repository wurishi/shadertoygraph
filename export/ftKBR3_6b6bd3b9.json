{"ver":"0.1","info":{"id":"ftKBR3","date":"1664933496","viewed":463,"name":"Future Flash","username":"Kali","description":"6kb intro by Latitude Independent Association (LIA) awarded 1st place in combined PC intro/demo compo at Flashparty 2022\ncode: kali - music: uctumi\nPlease rewind after it starts for proper audio sync\nIt could take forever to compile, sorry!","likes":43,"published":1,"flags":96,"usePreview":1,"tags":["intro","demoscene"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define time iTime\n\nconst float max_rad=.015;\nconst float it=50.;\n\nmat2 rot(float a){\n\tfloat s=sin(a);\n    float c=cos(a);\n    return mat2(c,s,-s,c);\n}\n\nfloat hash(vec2 p)\n{\n    p*=1342.;\n\tvec3 p3  = fract(vec3(p.xyx) * .1031);\n    p3 += dot(p3, p3.yzx + 33.33);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n\tvec2 uv = fragCoord / iResolution.xy;\n\tmat2 spin=rot(2.39996);\n    vec2 p=vec2(0.,1.);\n    vec3 res=vec3(0.);\n    float rad_step=max_rad/it+hash(uv+time)*.00015;\n\tfloat rad=0.;\n    float ti=mod(time,10.);\n    vec4 col=texture(iChannel0,uv);\n    for (float ii=0.;ii<it; ii++) {\n        rad+=rad_step;\n        p*=spin;\n        vec4 col=texture(iChannel0,clamp(uv+p*rad,vec2(0.01),vec2(0.99)));\n        res+=smoothstep(.5,1.,max(col.r,max(col.g,col.b)))*col.rgb*2.;\n    };\n    res/=it;\n\tcol.rgb = length(col.rgb)*vec3(.7);\n    fragColor = vec4(col.rgb*.3+res,1.0)*min(1.,time*.5+1.)*(smoothstep(131.,129.,time)+smoothstep(132.,133.,time)-smoothstep(143.,144.,time)); \n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"Ml2SWz","filepath":"https://soundcloud.com/pablo-andrioli/future-flash-3?si=f0c99fc78b934e8480d604d0a3ef987d&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing","previewfilepath":"https://soundcloud.com/pablo-andrioli/future-flash-3?si=f0c99fc78b934e8480d604d0a3ef987d&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing","type":"musicstream","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":0}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"//#define ti iChannelTime[0]\n#define ti iTime-2.\nfloat time;\n\n#define resolution iResolution\n\nfloat st=.11, maxdist=20.,m,mc;\nfloat td, t, yy;\nfloat z, ed, mo;\nvec3 neoncolor=vec3(1,0,0);\nvec3 lightpos, carpos, advcar;\nvec3 from;\nvec2 pos;\nvec3 cp;\nfloat h;\nfloat siroof = 0.;\nfloat lo;\nfloat det=.003;\nvec2 e = vec2(0, .006);\n\nconst float escena2=48.5;\nconst float escena3=55.;\nconst float escena4=61.5;\nconst float escena5=68.;\nconst float escena6=80.;\nconst float escena7=86.5;\nconst float escena8=105.;\nconst float escena9=111.;\n\n#define f1 int[] (271,195,831,1006,819,799,831,33567,3084,25600,0,2437,3207,3462,3463)\n#define f2 int[] (207,255,524519,463,0,9199,25600,0,41219,831,195,3276,0,0,0)\n#define f3 int[] (24627,243,1006,3276,207,0,9199,25600,0,243,207,3084,243,24627,3276)\nfloat frase;\n\nvec4 text(vec2 U) {\n    U.x+=.67; \n    vec2 pp = U*15., A, D;pp.y-=.5+sin(floor(pp.x/1.4)*2.+time*2.)*.1;\n\tvec4 c = vec4(0), S = vec4(.5,-.5,1,0), V;\n    for (int l, i=min(iFrame*2,0); i<15; i++)  {\n        if (frase==1.) l=f1[i];\n        if (frase==2.) l=f2[i];\n        if (frase==3.) l=f3[i];\n        float v = 1.;\n        vec2 p=pp-.5;\n        p*=1.+dot(p,p);\n        p+=.5;\n        for( int i=0; i<20; i++, l/=2)\n            if (l%2 > 0)\n            {\n                V = vec4[](S.wwwx,S.wxwx,S.wzxw,S.xzxw,S.zxwx,S.zwwx,S.xwxw,S.wwxw,S.wxxw,S.xxxw,S.xwwx,S.xxwx,S.wwxx,S.xxxx,S.wzxy,S.xxxy,S.wxxy,S.xwxx,S.wxxx,S.xzxy)[i],\n                A = p - V.xy, D = V.zw,\n                v = min(v,length(A-D*clamp(dot(A,D)/dot(D,D),.0,1.)));\n            }\n        c += step(v,.12) * (1.+pp.y*.0) * vec4(1.5,0.2,0.3,0);\n        pp.x -= 1.4;\n     }\n     return c;\n}\n\nvec3 path(float t) {\n    t-=smoothstep(escena8+3.,escena8+23.,time)*8.;\n    t-=smoothstep(escena8+13.,escena8+30.,time)*5.;\n    vec3 p=mix(vec3(sin(t*.2)*5.,6.3+cos(t)*.1,t),vec3(0.,-t-3.,0.),smoothstep(-20.,5.,t));\n    p=mix(p,vec3(sin(t*.2)*7.,-16.,t),smoothstep(35.,45.,time));\n    if(time>escena4) p=vec3(sin(t*.3)*19.,-21.,cos(t*.3)*19.);\n    float s=sin(t*.3);\n    if(time>escena6) p=vec3(s*s*s*3.,-20.5,t*5.-115.-escena6);\n    float b=smoothstep(escena8,escena8+4.,time);\n    p.x*=(1.-b);\n    p.y-=b*5.;\n    return p;\n}\n\nmat3 lookat(vec3 dir, vec3 up) {\n\tdir=normalize(dir);vec3 rt=normalize(cross(dir,normalize(up)));\n    return mat3(rt,cross(rt,dir),dir);\n}\n\n\nmat2 rot(float a) {\n\tfloat s=sin(a),c=cos(a);\n    return mat2(c,s,-s,c);\n}\n\nfloat hash(vec2 p)\n{\n\tvec3 p3  = fract(vec3(p.xyx) * .1031);\n    p3 += dot(p3, p3.yzx + 33.33);\n    return fract((p3.x + p3.y) * p3.z);\n}\n\nfloat noise( in vec2 p )\n{\n    vec2 i = floor( p );\n    vec2 f = fract( p );\n\t\n\tvec2 u = f*f*(3.0-2.0*f);\n\n    return mix( mix( hash( i + vec2(0.0,0.0) ), \n                     hash( i + vec2(1.0,0.0) ), u.x),\n                mix( hash( i + vec2(0.0,1.0) ), \n                     hash( i + vec2(1.0,1.0) ), u.x), u.y);\n}\n\n\nvec3 fractal(vec2 p)\n{\n    vec2 pp=p;\n    p = abs(fract(p * .05) - .5);\n    float ot1 = 1000., ot2 = ot1;\n    for (float i = 0.; i < 6.; i++) {\n        p = abs(p) / clamp(abs(p.x * p.y), 0.15, 5.) - vec2(1.5, 1);\n        ot1 = min(ot1, abs(p.x) + step(time,35.)*.08*step(floor(length(p)) * .1 + fract(time * .7 + float(i) * .2), .5 * floor(p.y)))*.8;\n        ot2 = min(ot2, length(p));\n    }\n    ot1 = smoothstep(.1, .05, ot1);\n    vec3 col = vec3(p, 0) * ot2 * ot1 * .3 + ot1 * .3; \n    col.rb*=rot(pp.y*.3);\n    return abs(col);\n}\n\n\nfloat line( vec2 p, vec2 a, vec2 b)\n{\n  vec2 pa = p - a, ba = b - a;\n  float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n  return length( pa - ba*h );\n}\n\nfloat logo(vec2 uv) {\n    uv*=-.17;\n    uv=-uv.yx;\n    uv*=rot(-.35);\n    float c = line(uv, vec2(-.65,.3), vec2(-.65,-.3));    \n\tc = min(c,line(uv, vec2(-.65,-.3), vec2(-.35,-.3)));\n\tc = min(c,line(uv, vec2(-.15,.3), vec2(-.15,-.3)));\n\tc = min(c,line(uv, vec2(.25,.3), vec2(.05,-.3)));\n\tc = min(c,line(uv, vec2(.3,.3), vec2(.50,-.3)));\n\tc = min(c,line(uv, vec2(.5,-.3), vec2(.2,-.3)));\n    return smoothstep(.08,.05,c);\n}\n\n\nfloat obj;\n\nfloat map(vec2 p) {\n    pos = p;\n    vec2 p2=p;\n    h=0.;\n    h-=smoothstep(35.,40.,time)*25.-smoothstep(escena7,escena7+5.,max(0.,time+p.y-75.));\n    if (length(p)<5.&&time<escena6) {\n        h-=exp(-2.*length(p))*100.;\n        return h;\n    }\n    if (time<escena6) p*=rot(.5),p=vec2(atan(p.x,p.y)/3.1416*4.*10., length(p));\n    siroof=0.;\n    obj=0.;\n    h+=(hash(floor(p))*3.+hash(floor(p*2.))*0.)*step(.7,hash(floor(p*.5)));\n    h+=hash(floor(p*2.+123.))*1.;\n    h+=hash(floor(p*8.+223.))*1.;\n    if (hash(floor(p+321.))>.7) siroof = 1.;\n    if(time>30.&&time<escena6) {\n        h=-20.+sin(floor(p.x*2.)*.5+time)+(time<escena3?abs((cos(p.y*.5)*20.)/20.):(cos(p.y*.5)*20.)/20.)*4.;\n        h-=step(fract(p.x*2.), .3)*20.;\n        pos = p;\n    }\n    h=h*(.15+smoothstep(5.,10.,time));\n    if(time<11.) {\n        lo=logo((p2-vec2(9.,-22.)));\n        h=max(lo,h);\n    }\n    float h2=length(min(sin(p),step(.5,hash(floor(p)))))*smoothstep(.0,3.5,abs(p.y-19.5))*3.-23.5+step(3.,abs(p.y-19.5));\n    h2=mix(h2,-25.+hash(floor(p))*2.-smoothstep(5.,10.,carpos.z-p.y)*2.,smoothstep(escena6-4.,escena6-1.,time));\n    if (time<escena6) h = mix(h, h2,smoothstep(escena5,escena5+5.,time));\n    else h=mix(h2,h,smoothstep(escena7,escena7+5.,time+p.y-50.));\n    p.y-=110.+escena8;\n    float l=length(p);\n    if (abs(p.x)<3.&&p.y>-55.) h=-27.;\n    h=max(h,-15.-abs(p.y));\n    if (length(max(vec2(0.),abs(vec2(p.x*.7,yy+27.))-1.15))<.01&&p.y>-55.) h=-100.;\n    return h;\n}\n\nfloat de(vec3 p) {\n    p.z=min(202.,p.z);\n    p-=carpos;\n    p.y+=.3+step(escena5,time)*.9*step(time,escena6)-step(escena7,time)*.05+smoothstep(escena8+10.,escena8+15.,time)*.3;\n    float bound = length(p)-1.;\n    if (bound>0.) return bound+.5;\n    advcar.y=0.;\n    p=lookat(advcar,vec3(0.,1.,0.))*p;\n    p.xy*=rot(-step(escena5,time)*.3*smoothstep(escena6+2.,escena6,time)+.1*sin(time*1.3)+step(escena6,time)*advcar.x+smoothstep(escena8+1.,escena8+3.,time)*3.1416*2.);\n    p.y*=1.7;\n    p.x*=1.;\n    float l=length(p+vec3(0.,-0.05,0.));\n    p.x+=smoothstep(-.0,-.1,p.z)*.025*sign(p.x);\n    p.y-=smoothstep(.02,0.,abs(p.x))*.02;//*sign(p.y-.03);\n    p.y+=smoothstep(.02,0.,abs(p.x)-.05)*.02;\n    p.y*=1.+smoothstep(.05,.0,p.y)*.5;\n    p.z*=1.-smoothstep(.1,.0,p.z)*.15;\n    p.z+=smoothstep(.05,.07,abs(p.x))*.02;\n    float d=length(p)-.12;\n    d=max(d,-p.y+.045+abs(p.x)*.15+max(0.,-p.z*.1));\n    d=max(d,-abs(p.x)+.06-step(0.0,p.z));\n    d=min(d,l-.065);\n    cp=p;\n    return d*.3;\n}\n\n\nvec3 normal2(vec2 p) {\n\tvec2 eps=vec2(0.,.01);\n    return normalize(vec3(map(p+eps.yx)-map(p-eps.yx),2.*eps.y,map(p+eps.xy)-map(p-eps.xy)));\n}\n\n\nfloat edge=0.;\n\nvec3 normal(vec2 p) { \n\tvec2 e = vec2(0.0,.01);\n\tfloat d1=map(p+e.yx),d2=map(p-e.yx);\n\tfloat d3=map(p+e.xy),d4=map(p-e.xy);\n\tfloat d=map(p);\n\tedge=abs(d-0.5*(d1+d2))+abs(d-0.5*(d4+d3));\n\tedge=min(1.,edge*10.);\n\treturn normalize(vec3(d1-d2,2.*e.y,d3-d4));\n}\n\nvec4 hit(vec3 p) {\n    float h = map(p.xz), d = de(p);\n    return vec4(step(p.y,h), step(d,det), h, d);\n}\n\nvec3 bsearch(vec3 p, vec3 dir) {\n    st*=-.5;\n    float h2=1.;\n    for (int i=0; i<20; i++) {\n        p+=dir*st;\n        vec4 hi=hit(p);\n        float h=max(hi.x, hi.y);\n        if (abs(h-h2)>.001) {\n            st*=-.5;\n\t        h2=h;\n        }\n    }\n\treturn p;\n}\n\nvec3 shade(vec3 p, vec3 dir, float h) {\n \tvec3 col = vec3(m*obj*2.);\n    vec3 ldir=normalize(vec3(-.5,-1.,-1.));\n\tvec3 n=normal(p.xz);\n    float amb=pow(max(0.,dot(dir,n)),3.)*.2;\n    float dif=max(0.,dot(ldir,-n))*.0;\n    vec3 ref=reflect(dir,ldir);\n    float spe=pow(max(0.,dot(ref,-n))*.5,3.)*(4.-step(escena8,time));\n    p.y-=(h-10.)*step(38.,time);\n    p.xz=pos;\n    vec3 fr=fractal(p.xy*1.5)*abs(n.z);\n    fr+=fractal(p.yz*1.5)*abs(n.x);\n    fr+=fractal(p.xz)*abs(n.y);\n    fr*=.6-step(escena5,time)*.2;\n    edge*=step(-floor(p.x)*.1,time-5.)-step(escena5,time)*.5;\n    vec3 c=col+amb+dif+edge*siroof*step(h-.05, p.y)*neoncolor+fr*smoothstep(12.,12.5,time+p.x*.2);\n    vec3 fin=mix(c,(step(.95,fract(pos.x*2.+.5))+step(.9,fract(pos.y*5.+.1)))*(.3+fr*1.5),smoothstep(70.,75.,time));\n    fin+=c*.5*smoothstep(escena5,escena5+1.,time);\n    return fin+spe+lo*.4;\n}\n\n\nvec3 march(vec3 from, vec3 dir) {\n\tvec3 p, pd, col=vec3(0.);\n    td=2.+hash(dir.xy*100.)*.3+step(time,8.)*5.;\n    float td2=-hash(dir.xy*100.)*.1;\n    float k=0.;\n    float h=0.;\n    float l=0.;\n    float d=0.;\n   \tfor (int i=0; i<200; i++) {\n        st+=.001;\n        p=from+dir*td;\n    \tpd=from+dir*td2;\n        z=p.z-from.z;\n        yy=p.y;\n        d=de(pd);\n        if (p.y<5.-20.*step(escena5,time)) h=map(p.xz); \n        if (h > p.y || d<det || td>maxdist) break;\n        if (p.z>3.) {\n            vec3 p2=p;\n            p2*=5.;\n            p2.x+=time*sign(sin(p.z));\n            vec2 id=floor(p2.xz);\n            float hh=hash(id*100.);\n            p2.xz=fract(p2.xz)-.5;\n            p2.y-=hh*100.-80.;\n            l=max(l,step(length(p2),.15)*step(.98,hh));\n        }\n        td+=st;\n        td2+=d;\n    }\n    float f=pow(td/maxdist,1.);\n    if (h > p.y) {\n        p=bsearch(p, dir);\n    \tcol=shade(p,dir,h);\n    } \n    if (d<det) {\n        p-=det*dir;\n        pd=bsearch(pd, dir);\n        vec3 n=normalize(vec3(de(pd + e.yxx), de(pd + e.xyx), de(pd + e.xxy)) - de(pd));\n        vec2 p2=cp.xy*3.;\n        float ot=1000.;\n        for (int i=0; i<6; i++)\n        {\n            p2=abs(p2)/clamp(abs(p2.x*p2.y),.25,1.)-2.;\n            ot=min(ot,abs(p2.y));\n            \n        }\n        ot=smoothstep(.3,.2,ot);\n        col=vec3(.75-ot*.3);\n        vec3 ldir=normalize(vec3(-.5,-1.,-1.));\n        col*=.6+max(0.,dot(ldir,-n))*(.5-step(escena8-2.,time)*.2);\n        col+=fractal(cp.xy*10.)*.5;\n        float l=length(cp.xz);\n        cp.x=abs(cp.x);\n        cp.x-=.025;\n        cp.y-=.05;\n        col*=.3+.7*max(step(.012,abs(cp.y)),step(.025,cp.x));\n        col+=step(abs(cp.x)-.009,.012)*step(abs(cp.y),.006)*vec3(1.,.2,.1);\n        col*=.5+.5*step(.05,l);\n        col+=step(abs(l-.05),.003)*vec3(0.,0.,1.);\n    }\n\tneoncolor.rb*=rot(-p.y*.15);\n\tneoncolor*=exp(-.03*p.y);\n    if (time>30.) neoncolor+=.3,neoncolor*=.9;\n    p.y+=25.47;\n    p.x*=-1.;\n    float r=max(step(.25,abs(p.y-.24)),step(2.73,abs(p.x)));\n    frase=1.;\n    if (time>escena9) col=col*r+(1.-r)*.3,col+=text(p.xy*.27).rgb*1.3;\n    col=mix(col,neoncolor*.8,f)*(step(escena4,time)+smoothstep(escena4,escena4-.5,time));\n    return col+l;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    time = ti;\n    if (ti>129.) time = ti-129.+48.;\n    vec2 uv = (fragCoord-resolution.xy*.5)/resolution.y;\n\tt=-35.+time;\n    from=path(t);\n    from.x-=cos(time*.3)*.1;\n    uv.x+=smoothstep(escena7+5.,escena7,time)*1.5*step(escena7,time);\n    if (time>escena4) from=path(t+.6),from.x+=.2,from.y+=.2;\n    if (time>escena5) from=path(t+.35), from.y-=1., from.x+=sin(time)*.1;\n    if (time>escena6) {\n        from=path(t+.6);\n        from.y-=-.2+smoothstep(escena6,escena6+3.,time)*.3;\n        from.x-=.2;\n    }\n    if (time>escena7) from=path(t+.3),from.x-=.0,from.z+=.2;\n    if (time>escena8-2.&&time<escena9) from=path(t+.6),from.x+=.2,from.y+=.5;\n    float tilt=.5*step(time,escena5);\n    if (time>17.&&time<23.25) from=vec3(0.,5.,-3.), tilt=0.;\n    carpos=path(t+.5);\n    carpos.y-=smoothstep(12.,0.,time)*5.;\n    advcar=normalize(carpos-path(t+1.5));\n    vec3 dir=normalize(vec3(uv,1.));\n    vec3 adv=from-path(t-1.);\n    if ((time>escena4&&time<escena5)||(time>escena6&&time<escena7)||(time>escena8-2.&&time<escena9)) adv=carpos-from;\n    if (time>escena2&&time<escena4) {\n        from=vec3(-10.);\n        adv=vec3(0.,-25.,0.);\n    }\n    if (time>escena3&&time<escena4) {\n        from=vec3(0,-17.,10.);\n        adv=vec3(0.,-30.,-8.);\n        from.xz*=rot(time*.1);\n    }\n    from.z-=smoothstep(88.+escena8,102.+escena8,from.z)*3.;\n    from.z=min(94.+escena8,from.z)+max(0.,time-escena8-7.5)*.2;\n    dir=lookat(adv+vec3(0.,-.5,0.),vec3(adv.x*tilt,1.,.1))*dir;\n    dir.yz*=rot(-.1-step(escena7,time)*.2+smoothstep(escena8,escena8+5.,time)*.3-step(escena7+7.,time)*1.+step(escena7+12.3,time)*1.);\n    vec3 col=vec3(0.);\n    col=march(from, dir);\n    if (ti>129.) frase=2.;\n    if (ti>136.) frase=3.;\n    if (ti>129.) col=col*.7+text(uv).rgb;\n    fragColor = vec4(max(vec3(0.),col),1.);\n}\n\n","name":"Buffer A","description":"","type":"buffer"}]}