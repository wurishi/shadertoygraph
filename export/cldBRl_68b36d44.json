{"ver":"0.1","info":{"id":"cldBRl","date":"1701473376","viewed":101,"name":"20231202_inercia jams","username":"0b5vr","description":"Live coded in the In√©rcia 2023 Shader Royale Jams\nCoded in 60min (+ some post-jam tweak)\n\nDefinitely inspired by Owen Gildersleeve\n\nhttps://2023.inercia.pt/","likes":7,"published":1,"flags":0,"usePreview":0,"tags":["noise","pathtracing","livecoding"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define repeat(i,n) for(int i=0;i<n;i++)\n\nconst float FAR=100.;\nconst float PI=acos(-1.);\nconst float TAU=PI*2.;\n\nuvec3 hash3u(uvec3 s){\n  s=s*1145141919u+1919810u;\n  s.x+=s.y*s.z;\n  s.y+=s.z*s.x;\n  s.z+=s.x*s.y;\n  s=s^s>>16u;\n  s.x+=s.y*s.z;\n  s.y+=s.z*s.x;\n  s.z+=s.x*s.y;\n  return s;\n}\n\nvec3 hash3(vec3 s){\n  uvec3 r=floatBitsToUint(s);\n  return vec3(hash3u(r))/float(-1u);\n}\n\nuvec3 seed;\n\nuvec3 random3u(){\n  seed=hash3u(seed);\n  return seed;\n}\n\nvec3 random3(){\n  return vec3(random3u())/float(-1u);\n}\n\nvec2 cis(float t){\n  return vec2(cos(t),sin(t));\n}\n\nvec4 isectplane(vec3 ro,vec3 rd,vec3 n){\n  float t=-dot(ro,n)/dot(rd,n);\n  return vec4(sign(-dot(rd,n))*n,t>0.?t:FAR);\n}\n\nmat3 orthbas(vec3 z){\n  z=normalize(z);\n  vec3 up=abs(z.y)>.99?vec3(0,0,1):vec3(0,1,0);\n  vec3 x=normalize(cross(up,z));\n  return mat3(x,cross(z,x),z);\n}\n\nvec3 cyclic(vec3 p,float pump){\n  mat3 m=orthbas(vec3(-5,2,-1));\n  vec4 sum=vec4(0);\n  repeat(i,5){\n    p*=m;\n    p+=sin(p.yzx);\n    sum+=vec4(cross(cos(p),sin(p.zxy)),1);\n    p*=2.;\n    sum*=pump;\n  }\n  return sum.xyz/sum.w;\n}\n\nvec3 samplelambert(vec3 n){\n  vec3 xi=random3();\n  float p=TAU*xi.x;\n  float ct=sqrt(xi.y);\n  float st=sqrt(1.-ct*ct);\n  return orthbas(n)*vec3(cis(p)*st,ct);\n}\n\nconst int SAMPLES=16;\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n  seed=uvec3(gl_FragCoord.xy,60.0*iTime);\n\n\tvec2 uv = vec2(fragCoord.x / iResolution.x, fragCoord.y / iResolution.y);\n  vec2 p=uv*2.-1.;\n  p.x*=iResolution.x/iResolution.y;\n\n  vec3 sum=vec3(0);\n  \n  repeat(iS,SAMPLES){\n    vec2 pt=p;\n    pt+=2.*(random3().xy-.5)/iResolution.y;\n    vec3 ro=vec3(0,0,5);\n    vec3 rd=normalize(vec3(pt,-2));\n    \n    vec3 col=vec3(0);\n    vec3 colr=vec3(1);\n    \n    repeat(iP,3){\n      vec3 bc=vec3(0);\n      vec3 em=vec3(0);\n      \n      vec4 isect=vec4(FAR);\n      vec4 isect2;\n\n      repeat(iL,10){\n        float prog=float(iL)/9.;\n        float z=mix(-.9,0.,prog);\n        isect2=isectplane(ro-vec3(0,0,z),rd,vec3(0,0,1));\n        vec3 rp=ro+rd*isect2.w;\n        vec2 co=rp.xy;\n        co+=mix(0.,1.,prog)*cyclic(.04*(rp+vec3(10,10,iTime)),1.).xy;\n        float d=length(co)-mix(1.,2.,prog);\n        if(isect2.w<isect.w&&d>0.){\n          isect=isect2;\n          bc=mix(\n            pow(.5+.5*sin(1.+2.*prog+vec3(0,2,4)),vec3(2.)),\n            vec3(.04),\n            prog\n          );\n          em=vec3(0);\n        }\n      }\n    \n      isect2=isectplane(ro-vec3(0,0,-1.),rd,normalize(vec3(0,0,1)));\n      if(isect2.w<isect.w){\n        isect=isect2;\n        vec3 rp=ro+rd*isect2.w;\n        bc=vec3(.6);\n        em=vec3(0);\n      }\n    \n      isect2=isectplane(ro-vec3(0,0,50),rd,normalize(vec3(0,-1,-1)));\n      if(isect2.w<isect.w){\n        isect=isect2;\n        vec3 rp=ro+rd*isect2.w;\n        bc=vec3(0);\n        em=vec3(2);\n      }\n      \n      if(isect.w>=FAR){\n        //col+=.1*colr;\n        break;\n      }\n      \n      col+=colr*em;\n      ro=ro+rd*isect.w;\n      ro+=0.001*isect.w;\n      rd=samplelambert(isect.xyz);//reflect(rd,isect.xyz);\n      colr*=bc;\n      \n      if(dot(colr,vec3(1.))<.01){\n        break;\n      }\n    }\n    \n    sum+=col;\n  }\n  \n  vec3 col=sum/float(SAMPLES);\n  col=pow(col,vec3(.4545));\n  col*=1.-.5*length(p);\n  col=smoothstep(vec3(0,-.04,-.08),vec3(1,1.01,1.04),col);\n  \n  fragColor=vec4(col,1);\n}\n","name":"Image","description":"","type":"image"}]}