{"ver":"0.1","info":{"id":"4tBBzm","date":"1514989506","viewed":286,"name":"Knot Ray","username":"gaz","description":"like billbord","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["3d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"mat3 lookat(vec3 d, vec3 up)\n{\n\tvec3 w = normalize(d),u = normalize(cross(w,up));\n    return (mat3(u,cross(u,w),w));\n}\n\nmat2 rotate(float a)\n{\n\treturn mat2(cos(a), sin(a), -sin(a), cos(a));\t\n}\n\nvec2 planeUv(vec3 ro, vec3 rd, vec3 pos, vec3 nor, vec3 up)\n{\n\tfloat z = dot(pos-ro,nor)/dot(rd,nor);\n    vec3 p=ro+rd*z, a=p-pos, u=normalize(cross(nor,up)), v=normalize(cross(u,nor));\n    return vec2(dot(a,u),dot(a,v));\n}\n\nvec3 hsv(float h, float s, float v)\n{\n    return mix(vec3(1),clamp((abs(fract(h+vec3(3,2,1)/3.)*6.-3.)-1.),0.,1.),s)*v;\n}\n\nvec3 knot(float t)\n{\n    t *= radians(360.);\n    return vec3(sin(t)+2.*sin(2.*t),cos(t)-2.*cos(2.*t),-sin(3.*t));\n}\n\nfloat de(vec2 p)\n{\n    return min(\n        abs(abs(p.x)+abs(p.y)-0.6),\n        mix(\n            max(abs(p.x)-0.6,abs(p.y)),\n            abs(p.y),\n            step(0.9,sin(iTime+sin(iTime*3.)))\n        )\n    );\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 p = (fragCoord*2.-iResolution.xy)/iResolution.y;\n    vec3 ro = vec3(0,0,7);\n    ro.xz *= rotate(iTime*0.3);\n    ro.xy *= rotate(iTime*1.5);\n    vec3 rd = lookat(-ro,vec3(0,1,0))*normalize(vec3(p,2));\t\n    vec3 col = vec3(0.3,0.3,0.5)*length(p*0.25);\n    float s = 100.;\n    for(float i=0.;i<s;i++)\n    {\n        float t = iTime*0.05+i/s;\n        vec3 d = normalize(knot(t-0.001)-knot(t+0.001));\n        vec3 q=knot(t);\n        vec2 b = planeUv(ro,rd,q,d,cross(q,d));\n        col = mix(col,hsv(i/s,0.7,1.0),smoothstep(0.07,0.0,de(b)));\n    }\n    fragColor = vec4(col, 1.0);\n}","name":"Image","description":"","type":"image"}]}