{"ver":"0.1","info":{"id":"7sGfWK","date":"1658860443","viewed":168,"name":"Ray X RoundedRect intersection","username":"MrShoor","description":"Example of ray vs rounded rectangle intersection","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["2d","math","raycast"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float sdRoundRect( vec2 p, vec2 b, float r )\n{\n  vec2 q = abs(p) - b;\n  return length(max(q,0.0)) + min(max(q.x,q.y),0.0) - r;\n}\n\nfloat int_Ray_Circle(vec2 ro, vec2 rd, float r) {\n    float A = dot(rd, rd);\n    float B = 2.0*dot(ro, rd);\n    float C = dot(ro, ro)-r*r;\n    float D = B*B-4.0*A*C;\n    if (D < 0.0) return -1.0;\n    D = sqrt(D);\n    A *= 2.0;\n    return (-B-D)/A;\n}\n\nfloat cross2d(vec2 v1, vec2 v2) {\n    return v1.x * v2.y - v1.y * v2.x;\n}\n\nfloat int_Ray_RoundRect(vec2 ro, vec2 rd, vec2 rct_half_size, float r) {\n  vec2 aro = ro;\n  if (rd.x < 0.0) aro.x = -aro.x;\n  if (rd.y < 0.0) aro.y = -aro.y;\n  vec2 ard = abs(rd);\n  \n  float c_side = cross2d(ard, aro + rct_half_size);\n  vec2 rsize = rct_half_size;\n  if (c_side > 0.0) {\n      aro = aro.yx;\n      ard = ard.yx;\n      rsize = rsize.yx;\n  }\n  vec2 aro2 = aro + rsize + vec2(r);\n  float t = -aro2.y / ard.y;\n  float x = aro.x + ard.x * t;\n  if (x > rsize.x) {\n      t = int_Ray_Circle(aro + vec2(-rsize.x, rsize.y), ard, r);\n  } \n  else if (x < -rsize.x) {\n      t = int_Ray_Circle(aro + rsize, ard, r);\n  }\n  return t;\n}\n\nvec2 pix2space(vec2 p) {\n  return p - iResolution.xy*0.5;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 ro = pix2space(fragCoord);\n    vec2 rd = -pix2space(iMouse.xy);\n    \n    vec2 box_half_size = vec2(10.0, 50.0);\n    float r = 30.0;\n    \n    float t = int_Ray_RoundRect(ro, rd, box_half_size, r);\n\n    vec3 col = vec3(t, t, t);\n    if (sdRoundRect(ro, box_half_size, r) < 0.0) {\n       col.b = 1.0;\n    }\n        \n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}