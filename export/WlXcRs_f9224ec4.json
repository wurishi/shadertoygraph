{"ver":"0.1","info":{"id":"WlXcRs","date":"1592738666","viewed":293,"name":"if(false)texture performance bug","username":"ffcr","description":"A glsl running on NVIDIA may have a lower frame rate than on integrated graphics and mobile phones","likes":2,"published":3,"flags":32,"usePreview":0,"tags":["bug"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"/*\nWhen TEST is set to 0, the NVIDIA will occupy a very high rate, \nwhich will cause the frame rate to drop or even make NVIDIA stop running.\nBut when TEST is set to 1 or 2, replace 'if' with 'do' loop,\nthe graphics card occupancy will be normal. \nWhen TEST is set to 3, use \"texelfetch\" instead of \"texture\",\nno bug even with \"if\" statement\nIf it is running in the browser of mobile phone or integrated graphics card,\nsetting TEST to 0 will not increase performance consumption.\n*/\n#define TEST 0\n#define EXECUTE false\n#define IF(a) do{if(!(a))break;\n#define ENDIF }while(false);\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n\n    // Time varying pixel color\n    vec3 col = 0.5 + 0.5*cos(iTime+uv.xyx+vec3(0,2,4));\n    \n    bool b=iTime<0.0;//always false\n                                    if(EXECUTE)b=!b;\n    #if TEST==0\n    if(b){\n    \tfor(float a=0.;a<2000.;a++){\n            col+=texture(iChannel0,uv+a).xyz;\n        }\n    }\n    #elif TEST==1\n    do{\n        if(!b)break;\n        for(float a=0.;a<2000.;a++){\n            col+=texture(iChannel0,uv+a).xyz;\n        }\n    }while(false);\n    #elif TEST==2\n    IF(b)\n        for(float a=0.;a<2000.;a++){\n            col+=texture(iChannel0,uv+a).xyz;\n        }\n    ENDIF\n\t#else\n\tif(b){\n        for(float a=0.;a<2000.;a++){\n        \tcol+=texelFetch(iChannel0,ivec2(fragCoord+a),0).xyz;\n        }\n    }\n    #endif\n    \n    \n    // Output to screen\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[{"id":"4dXGR8","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor = vec4(0.0,0.0,1.0,1.0);\n}","name":"Buffer A","description":"","type":"buffer"}]}