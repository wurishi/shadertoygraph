{"ver":"0.1","info":{"id":"4ttXDN","date":"1479697373","viewed":133,"name":"Foggy Target Spheres","username":"VoidChicken","description":"You know those spheres outside Target stores? Well, this is a whole scene of them rolling around. With fog.","likes":1,"published":1,"flags":32,"usePreview":0,"tags":["3d","raymarch","blur","spheres","fog","target","multipass"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec4 col = texture(iChannel0,uv);\n    \n    vec4 clt = texture(iChannel1,uv);\n    col=mix(col,clt,pow(col.w,10.));\n    col*=1.-col.w;\n    col=1.-exp(-col*.628);//tonemapping\n\tfragColor = pow(col, vec4(1./2.2))*sqrt(1.-length(uv-.5)); //gamma correction\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[{"id":"4dXGR8","channel":0}],"code":"#define min1(a, b) (a.x<b.x?a:b)\n#define R iResolution.xy\nfloat plane ( vec3 p ) {\n\treturn p.y;    \n}\nfloat sphere ( vec3 p ){\n\treturn length(p-vec3(0,1.2,0))-1.2;    \n}\nvec2 map ( vec3 p ) {\n    vec2 f;\n    vec2 rP = vec2(5);\n    \n    vec3 repeat2D = vec3(mod(p.x,rP.x)-(rP.x/2.), p.y, mod(p.z,rP.y)-(rP.y/2.));\n    f=min1(vec2(plane(p), 0),\n           vec2(sphere(repeat2D-sin(floor(p/vec3(rP.x, 1, rP.y))+iTime)*vec3(1,0,1)), 1));\n    return f;\n}\nfloat trace(vec3 o, vec3 d) {\n\tfloat t = 2.;\n    for (int i = 0; i < 64; i++) {\n        float z = map(o+d*t).x;\n        if(t>30.||z<.02) break;\n        t+=z*.85;\n    }\n    return t;\n}\nvec3 normal(vec3 x)\n{\n    vec2 e = vec2( .01, 0.0 );\n    return normalize( vec3( map(x+e.xyy).x - map(x-e.xyy).x,\n                            map(x+e.yxy).x - map(x-e.yxy).x,\n                            map(x+e.yyx).x - map(x-e.yyx).x ) );\n}\nfloat ao(vec3 i) {\n    float f = 0.;\n    \n    for (int j = 0; j < 10; j++) {\n        f=abs(f-map(i+normal(i)).x);\n    }\n    return f;\n}\nvec3 shade( vec3 i, float t ) {\n\tvec2 M = map(i);\n    float mat = M.y;\n    vec3 col = vec3(0);\n    \n    if (mat==0.) {\n   \t\tvec2 c = i.xz/5.;\n        float v = floor(fract(c.x)*2.);\n        float x = floor(fract(c.y)*2.);\n        col=vec3(1.1, 1., 1.2)*(mod(v+x,2.)+.3);\n    } else if (mat==1.) {\n    \tcol=vec3(1, 0, 0);\n    }\n    col*=1.-ao(i)/exp2(3.);\n    \n    return col;\n}\nvec3 render( vec2 u, out float t ) {\n    float AR = R.y/R.x;\n    vec3 d = vec3((u*2.-1.)*vec2(1,AR),1);\n    d=normalize(d);\n    vec3 o = vec3(0, 6, -7.+iTime);\n    t = trace(o,d);\n    vec3 i = o+d*t;\n    vec3 col;\n    if (map(i).x<.02){\n    \tcol=shade(i,t);\n    }\n    \n    return col;\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 u = fragCoord/R;\n    float t = 0.;\n    fragColor = vec4(render(u,t),t/30.);\n}","name":"Buf A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"\nvec4 blur ( sampler2D C, vec2 u ) {\n\tvec2 pxl = (1./iResolution.xy);\n    vec4 asp=vec4(0);\n    for (float x = -5.; x < 5.; x++) {\n        for (float y = -5.; y < 5.; y++) {\n        \tvec2 uv = u+pxl*vec2(x,y);\n            asp+=texture(C, uv);\n    \t}\n    }\n    asp/=100.;\n    return asp;\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor = blur(iChannel0, fragCoord/iResolution.xy);\n}","name":"Buf B","description":"","type":"buffer"}]}