{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[{"channel":0,"type":"texture","id":"XdfGRn","filepath":"/media/a/e6e5631ce1237ae4c05b3563eda686400a401df4548d0f9fad40ecac1659c46c.jpg","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define MAXSTEPS 500\n#define STEP 0.0005\n#define SPEED 0.08\n\nfloat getH (vec3 pos) {\n\tfloat len = length(textureLod (iChannel0, pos.xz,0.0).rgb);\n\tlen = pow(len, 0.2);\n\tfloat fac = 1.;\n\tlen = len * (1.0 + fac) - fac;\n\tlen = clamp (len, 0., 1.);\n\treturn len;\n}\nfloat fogF (float v1, float v2, float len, float powy) {\n\tfloat dist = len;\n\tdist = pow (dist, powy);\n\tdist = dist * 4.0 - 0.4;\n\tdist = clamp (dist, 0., 1.);\n\treturn mix (v1, v2, dist);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec3 camPos = vec3 (0.0, 0.27, iTime * SPEED);\n\tcamPos.y += 0.001 * iMouse.y;\n\tvec2 camBias = vec2 (0.0, -0.5 * STEP);\n\tvec2 view = fragCoord.xy / iResolution.xy * 2. - 1.;\n\tview.x *= iResolution.x / iResolution.y * 0.7;\n\tvec3 viewStep = vec3 (view * STEP, STEP);\n\tviewStep.xy += camBias;\n\tfloat rot = iMouse.x * -0.006;\n\tfloat rs = sin (rot);\n\tfloat rc = cos (rot);\n\tviewStep.xz = vec2 (viewStep.x * rc - viewStep.z * rs,\n\t\t\t\t\t\tviewStep.z * rc + viewStep.x * rs);\n\t\n\tfloat height, heightShift;\n\tvec3 checkPoint = camPos;\n\tvec3 checkPointShift;\n\tvec4 c = vec4 (1.0);\n\tbool hit = false;\n\tif (viewStep.y > 0.) checkPoint += viewStep * 9999.;\n\telse {\n\t\tfloat distFromTop = checkPoint.y - 0.2;\n\t\tcheckPoint -= viewStep * (distFromTop / viewStep.y);\n\t\tfor (int i = 0; i < MAXSTEPS; i++) {\n\t\t\tif (hit || viewStep.y > 0.) continue;\n\t\t\tcheckPoint += viewStep;\n\t\t\theight = getH (checkPoint) * 0.2;\n\t\t\tif (checkPoint.y < height) {\n\t\t\t\tc.rgb = texture (iChannel0, checkPoint.xz).rgb * 2.;\n\t\t\t\tc.rgb += vec3(0., 0.2, 1.) * (0.3 - height);;\n\t\t\t\thit = true;\n\t\t\t}\n\t\t}\n\t}\n\t//c = clamp (c, 0., 1.);\n\tvec3 fogColor = vec3 (0.8, 0.87, 0.9);\n\tfogColor -= vec3(0.6, 0.5, 0.)\n\t\t* pow(clamp(view.y + camPos.y*0.7 - 0.3, 0., 1.), 2.);\n\tfloat dist = clamp(distance (checkPoint, camPos)*1.0 - 0.0, 0., 1.);\n\tc.r = fogF (c.r, fogColor.r, dist, 4.0);\n\tc.g = fogF (c.g, fogColor.g, dist, 1.8);\n\tc.b = fogF (c.b, fogColor.b, dist, 1.5);\n\tc.rgb = c.rgb * 1.2 - 0.2;\n\tc = c * pow(1. - 0.45*length (view), 0.5);\n\tfragColor = c;\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"XsX3WH","date":"1368264340","viewed":705,"name":"Peaks and fog","username":"fernozzle","description":"Experimenting with fog.","likes":16,"published":1,"flags":0,"usePreview":1,"tags":["raymarching","terrain","fog"],"hasliked":0,"parentid":"","parentname":""}}