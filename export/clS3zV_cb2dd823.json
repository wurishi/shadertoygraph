{"ver":"0.1","info":{"id":"clS3zV","date":"1673524233","viewed":99,"name":"Spiral Stairs","username":"midorikuma","description":"down or up","likes":5,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"float Cylinder(vec3 p,float r){\n    return length(p.xz)-r;\n}\nfloat Spiral(vec3 p)\n{\n    float qy = p.y*1.5+floor(atan(p.z, p.x)/acos(-1.)*20.0)/100.0;\n    return abs(mod(qy, 0.4)-0.2) - 0.15;\n}\nfloat distFunc(vec3 p){\n    float res = -2.0;\n    res=min(res,Cylinder(p,0.3));\n    res=max(res,-Cylinder(p,0.25));\n    res=max(res,-Spiral(p));\n    //res=min(res,max(Cylinder(p,0.4),-Cylinder(p,0.35)));\n    return res;\n}\n\nvec3 genNormal(vec3 p){\n    float d = 0.0001;\n    return normalize(vec3(\n        distFunc(p + vec3(  d, 0.0, 0.0)) - distFunc(p + vec3( -d, 0.0, 0.0)),\n        distFunc(p + vec3(0.0,   d, 0.0)) - distFunc(p + vec3(0.0,  -d, 0.0)),\n        distFunc(p + vec3(0.0, 0.0,   d)) - distFunc(p + vec3(0.0, 0.0,  -d))\n    ));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n    vec2 p = (gl_FragCoord.xy * 2.0 - iResolution.xy) / min(iResolution.x, iResolution.y);\n    vec3 cPos = vec3(sin(iTime/9.0)*0.08, -mod(iTime*0.1,20.0), sin(iTime/6.0)*0.08);\n    vec3 cDir = vec3(-sin(iTime/9.0)*0.4, -1.0, -sin(iTime/6.0)*0.4);\n    vec3 cUp  = vec3(0.0,  0.0,  0.7);\n    vec3 cSide = cross(cDir, cUp);\n    \n    float tmp, dist;\n    tmp = 0.0;\n    vec3 dPos = cPos;\n    vec3 ray = normalize(cSide * p.x + cUp * p.y + cDir);\n    for(int i = 0; i < 256; i++){\n        dist = distFunc(dPos);\n        tmp += dist;\n        dPos = cPos + tmp * ray;\n    }\n\n    vec3 col = vec3(0.6,0.7,0.6);\n    float depth = length(dPos-cPos);\n    col = clamp(col+depth/5.0,0.6,1.0);\n    vec3 lightDir = vec3(sin(-iTime),  0.9, cos(-iTime));\n    vec3 normal = genNormal(dPos);\n    float ref = dot(lightDir, normal);\n    col *= clamp(ref*0.6, 0.4, 0.6);\n    col /= length(dPos.xz)*depth*5.0;\n\n    fragColor = vec4(col, 1.0);\n}","name":"Image","description":"","type":"image"}]}