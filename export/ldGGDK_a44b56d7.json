{"ver":"0.1","info":{"id":"ldGGDK","date":"1456393019","viewed":193,"name":"Simple SDF tracing","username":"Zelcious","description":"sdf","likes":0,"published":1,"flags":32,"usePreview":0,"tags":["sdf"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    fragColor = texture(iChannel0, fragCoord.xy/iResolution.xy);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"float dist2(vec3 pos)\n{\n    vec3 pos2 = mod(pos,10.0)-5.0;\n    pos2 = pos;\n    float d = 1.0-length(vec3(pos2.x, mod(pos2.y,2.0)-1.0, pos2.z));\n    d = max(d , max(abs(pos2.x), abs(pos2.z)) - 0.65);\n    \n    d = min(d, length(abs(pos2)*vec3(0.5, 0.95, 1.0)-vec3(1.0))-0.5);\n    return min(d, pos.y+5.0);\n}\n\nfloat dist(vec3 pos)\n{\n    float d = 1e9;\n    float s = 1.0;\n    for(int i=0; i<5; i++)\n    {\n        float v = length(pos*vec3(0.75, 1.0, 1.0))-0.5;\n        d = min(d, v*s);\n        pos = abs(pos*2.5)-1.0;\n        s *= 1.0/2.5;\n        \n        v = length(pos*vec3(0.75, 1.0, 1.0))-0.5;\n        if(v > 2.0)\n        {\n            v -= 1.0;\n        \td = min(d, v*s);\n            break;\n        }\n        \n        d = min(d, v*s);\n        pos = abs(pos*2.5)-1.0;\n        s *= 1.0/2.5;\n    }\n    return d;\n}\n\nvec3 normal(vec3 pos, float e)\n{\n    return normalize(vec3(dist(pos+vec3(e,0.0,0.0)), dist(pos+vec3(0.0,e,0.0)), dist(pos+vec3(0.0,0.0,e))));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec2 uv2 = 2.0*(fragCoord.xy-0.5*iResolution.xy)/ min(iResolution.x, iResolution.y);\n\tvec3 dir = normalize(vec3(uv2 + 1.5/iResolution.xy*cos(vec2(784.3,483.1)*iTime), 1.0));\n    vec3 pos = vec3(0.0, 0.0, -1.0*0.8);\n    vec4 prev = texture(iChannel0, uv);\n    \n    float angle = (iTime + cos(iTime))*0.2;\n    vec2 rotX = vec2(cos(angle), sin(angle));\n    vec2 rotY = vec2(-rotX.y, rotX.x);\n    pos.xz = rotX*pos.x + rotY*pos.z;\n    dir.xz = rotX*dir.x + rotY*dir.z;\n    \n    float l = 0.0;\n    vec3 color = vec3(1.0);\n    int iters = 0;\n    for(int j=0; j<5; j++)\n    {\n    \tfor(int i=0; i<200; i++)\n    \t{\n            iters++;\n\t        float d = dist(pos);\n\t        pos += dir*d;\n\t        l += d;\n\t        if(l > 100.0 || d < l*0.00001)\n\t            break;\n        }\n        \n        if(l<100.0)\n        {\n        \tcolor = color*vec3(1.0, 0.75, 0.62)*0.7;\n            vec3 n = normal(pos, l*0.001);\n    \t\tdir = dir - n*dot(n,dir)*2.0;\n            \n            float a = 1.0;\n            for(int i=0; i<8; i++)\n            {\n                float s = l*0.031*exp(float(i)*0.25);\n                //a += min(a, dist(pos + n*s)/s);\n                a += 1.0/8.0*dist(pos + n*s)/s;\n            }\n            color *= mix(0.3, 1.0, a);\n            //break;\n            \n            \n    \t\tpos += dir*0.01;\n        }\n        else\n        {\n            color = color*vec3(vec2(1.0-dir.y*dir.y), 1.0);\n            break;\n        }\n    }\n    \n    vec3 sun = normalize(vec3(1.0, 1.0, 1.0));\n      \n    if(l < 100.0)\n    \t//fragColor = vec4(cos(pos.xyzz*1.0)*0.5+0.5);\n        fragColor = vec4(1.0, 0.5, 0.2, 1.0);\n    else\n        fragColor = vec4(vec2(1.0-dir.y*dir.y*abs(dir.y)), 1.0, 1.0);\n    \n    fragColor.xyz = mix(color + pow(max(0.0, dot(dir,sun)),64.0), prev.xyz, 0.9);\n    if(uv.y < -10.5)\n    \tfragColor.xyz = vec3(float(iters)*0.001);\n    \n}","name":"Buf A","description":"","type":"buffer"}]}