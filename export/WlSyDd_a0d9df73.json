{"ver":"0.1","info":{"id":"WlSyDd","date":"1595661041","viewed":267,"name":"Reflected Box Innards","username":"kstyler","description":"The inside of a ray marched box with reflections.","likes":1,"published":3,"flags":0,"usePreview":0,"tags":["reflection","sdf","box","mirror","crystal"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const int MAX_D=100;\nconst float DELTA=0.01;\nint matID = 0;\nmat2 rot(float a){\n    return mat2(cos(a),-sin(a),sin(a),cos(a));\n}\n\nfloat box( vec3 p, vec3 b ) {\n     vec3 d = abs(p) - b;\n     return min(max(d.x,max(d.y,d.z)),0.0) + length(max(d,0.0));\n}\n\n\nfloat map(vec3 p){\n    return box(p,vec3(sin(iTime)+1.5));\n}\n\nvec3 normal(vec3 p){\n    vec2 e = vec2(0,DELTA);\n    \n    return normalize(vec3(map(p+e.yxx)-map(p-e.yxx),\n                map(p+e.xyx)-map(p-e.xyx),\n                map(p+e.xxy)-map(p-e.xxy))); \n}\n\nvec3 addLight(vec3 lightCol, vec3 lightdir,vec3 rd){\n    vec3 light = vec3(0.);\n    float li = max(dot(lightdir,rd),0.);\n    light+=pow(lightCol,vec3(2))*pow(li,2.);\n    light+=lightCol*pow(li,200.9);\n    return light;\n\n}\nvec3 skyColor(vec3 rd){\n    \n    vec3 outLight = vec3(0.125);\n    outLight+= addLight(vec3(0.7,0.5,0.),normalize(-vec3(0.2,0.05,0.2)),rd);\n    \n    \n    outLight+=addLight(vec3(0.1,0.3,0.7),normalize(-vec3(-0.2,0.05,-0.2)),rd);\n    return outLight;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n    vec2 uv = (fragCoord.xy-0.5*iResolution.xy)/iResolution.x;\n    vec3 ro = vec3(0.,0.,-0.01);\n    vec3 rd = normalize(vec3(uv,1));\n  \n    rd.xz*=rot(iTime/8.);\n    rd.xy*=rot(iTime/8.);\n   \n    vec3 color = vec3(0); \n    vec3 accum = vec3(0); \n    float tot = 0.;\n    for(int i = 0; i<50;i++){\n        vec3 p = ro+rd*tot;\n        float dst = map(p);\n        tot+=dst;\n      \n        vec3 n = normal(p);\n      \n        if(dst>0.01){\n         color = skyColor(rd);\n        }\n       \n        else{\n            \n            color += skyColor(reflect(rd,n));\n            ro=p;\n            rd = reflect(rd,n);\n            \n        }\n        \n        accum+=0.02*color;\n    }\n \n    fragColor = vec4((accum),1.0);\n}","name":"Image","description":"","type":"image"}]}