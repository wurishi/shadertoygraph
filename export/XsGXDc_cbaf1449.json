{"ver":"0.1","info":{"id":"XsGXDc","date":"1466939302","viewed":390,"name":"2D Normal Sphere","username":"Nimajamin","description":"Creating a 2D spherical normal map for use with envrironment map generation.","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["2d","tutorial","envmap","vector"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xdf3zn","filepath":"/media/a/85a6d68622b36995ccb98a89bbb119edf167c914660e4450d313de049320005c.png","previewfilepath":"/media/ap/85a6d68622b36995ccb98a89bbb119edf167c914660e4450d313de049320005c.png","type":"texture","channel":0,"sampler":{"filter":"nearest","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"//\n// 2D Normal Sphere\n//\n// Creating a 2D spherical normal map for use with envrironment map generation.\n//\n// Nimajamin 14/09/2008 - 2016\n//\n\nvec3 sphereNormal( in vec2 coord )\n{\n    float dy  = -( coord.y - 0.5 ) * 2.0;\n    float dy2 =  (dy * dy);\n    float dx  =  ( coord.x - 0.5 ) * 2.0;\n    float dist_sqr = (dx * dx) + dy2;\n         \n    vec3 vNormal = vec3(dx,dy,0.0);\n    \n    if ( dist_sqr <= 1.0 )\n       vNormal.z = 1.0 - dist_sqr;\n\n    return vNormal;    \n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n   \n    vec3 vNormal = sphereNormal( uv.xy );\n    \n    const vec3 vCamera = vec3( 0.0, 0.0, -1.0 );\n    \n    vec3 vEye;\n    vEye.x = vCamera.x - vNormal.x;\n    vEye.y = vCamera.y - vNormal.y;\n    vEye.z = vCamera.z - vNormal.z;\n    vEye = normalize( vEye.xyz );\n\n    float fEdotN = dot( vNormal.xyz, vEye.xyz ) * 2.0;\n\n    vec3 vReflect;\n    vReflect.x = vEye.x - (fEdotN * vNormal.x);\n    vReflect.y = vEye.y - (fEdotN * vNormal.y);\n    vReflect.z = vEye.z - (fEdotN * vNormal.z);\n    vReflect = normalize( vReflect );\n\n    if ( uv.y > uv.x )\n\t\tfragColor = vec4( vNormal * 0.5 + 0.5, 1.0 );\n\telse\n    \tfragColor = vec4( pow(abs(vReflect),vec3(32.0)) * 0.5 + 0.5\n                          + texture( iChannel0, vReflect.xy * 0.5 + 0.5 ).xyz * 0.23, 1.0 );\n}","name":"Image","description":"","type":"image"}]}