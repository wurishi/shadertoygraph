{"ver":"0.1","info":{"id":"tdyXDh","date":"1574057874","viewed":233,"name":"Rube Goldberg Machine","username":"rmmcal","description":":-)","likes":22,"published":1,"flags":64,"usePreview":0,"tags":["2d","machine","goldberg","rube"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGzr","filepath":"/media/a/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","previewfilepath":"/media/ap/08b42b43ae9d3c0605da11d0eac86618ea888e62cdd9518ee8b9097488b31560.png","type":"texture","channel":2,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XtX3Dl","filepath":"https://soundcloud.com/sound-experiments/rube-goldberg-machine","previewfilepath":"https://soundcloud.com/sound-experiments/rube-goldberg-machine","type":"musicstream","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":0}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"/////////////////////////////////////////////////////////////\n////         ....  Rube Goldberg Machine   ....          ////\n/////////////////////////////////////////////////////////////\n// Brasil/Amazonas/Manaus  \n// Rube Goldberg Machine\n// Created by Rodrigo Cal (twitter: @rmmcal) - 2019/11\n// - https://www.shadertoy.com/view/tdyXDh\n/////////////////////////////////////////////////////////////\n// -----------------------------------------------------------\n//\n//  Rube Goldberg Machine\n//\n//      ... @rmmcal 2019/11\n//\n//  \n//  \n//  wiki: https://en.wikipedia.org/wiki/Rube_Goldberg_machine\n//\n// -----------------------------------------------------------\n/////////////////////////////////////////////////////////////\n//\n \n////////////////////////////////////////////////////////////\n//========================\n//= Function of Text \n//========================\n//\n\nint shift(int v, int s){\n    if ( s == 0) return v;\n    if ( s == 8) return v/256;\n    if ( s == 16) return v/256/256;\n    if ( s == 24) return (v/256)/256/256;\n    return 0;\n}\n\nint modi(int a, int n){\n\treturn a - (n * int(a/n));\n}\nvec4 char( vec2 p, int v){ \n    vec2 v2 = clamp(p / 16., 0.0, 1./16.) -vec2(0.,1./16.) + vec2(float(modi(v,16))/16., -float(v/16)/16.);\n    return vec4(texture(iChannel2,v2,-1.));                     \n}\n\nint map(ivec4 c, int i) // c[i] // compatibility function\n{\n\tif (i == 0) return c.x;\n\tif (i == 1) return c.y;\n\tif (i == 2) return c.z;\n\tif (i == 3) return c.w;\n    return 0;\n}\n\nvec4 mapText(vec2 p, vec2 tp, float s, ivec4 text) { \n    vec4 chr = vec4(0.);\n    int k = 0;\n    p -= tp;\n    p+=vec2( .5/s );\n    p *= vec2(s);\n    int ip = 0;\n    float len = 0.;\n    for ( int i = 0; i < 20; i++){\n        int chv = map(text,k);\n        if (chv == 0) break; \t\t\t\t\t \t\t\n        if (ip == 4) { k++; ip=0;} \n        else {\n            int ch =  modi((shift(chv, 8*(3-(modi((ip),4))))),256); \n            if (ch == 0) { ip++;}\n            else {\n                chr = max(chr,  char(p, ch).x);           \n                len++; ip++;\n                p-=vec2(float(.5),0.);\t\t\t\t\n            }                \n        }\n    }  \n    return vec4(chr.xyz, len);                   \n}  \n\n///////////\n\n\nconst float e =  2.718281828459045235360287;\nconst float PI = 3.14159265359;\n\n\n//https://iquilezles.org/articles/distfunctions2d\nfloat sdLine( in vec2 p, in vec2 a, in vec2 b )\n{\n    vec2 pa = p-a, ba = b-a;\n    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length( pa - ba*h );\n}\n  \nfloat sdBox( in vec2 p, in vec2 b )\n{\n    vec2 d = abs(p)-b;\n    return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdBox2(vec2 u, vec2 t, vec2 s){\n    s *= .5;\n    return sdBox( u-s-t, s);\n}\n\n\n///////// compatibility ////////////\nfloat modC(float a, float n){ // mod Compatibility\n\treturn n == 0. ? 0. :  a - (n * floor(a/n));\n}\n\nfloat atanC(float x, float y) // tan Compatibility\n{\n    if (x == 0. && y == 0.)\n        return 0.;\n    return atan(x,y);\n}\n\nfloat powC(float x, float y) // pow Compatibilit\n{\n    float m = modC(y,2.);\n    float mi = floor( modC(y,2.) );\n    float NaN = 0.; // - ignore NaN (0./0.)  // - ignore Infinite (1./0.)\n    float r = pow(abs(x), abs(y)) * ( mi == m ? (mi == 0. ?  1. : sign(x) ) :  (x <= 0. ?  NaN: sign(x) ) ) ;\n\treturn y < 0. ? 1. / r : r;\n}\n/////////////////////////////////////\n\nvoid drawGear(inout vec3 c, vec3 cc, float alpha, vec2 p, float t, float ngear, float size, float s1, float s2){\n    float cv = cos(ngear*atanC(p.x,p.y) + t);\n    float gear = ( smoothstep(-.5,.5,-.3*s2+powC((cv) , 1.+s2)) *(1.+s2)) *s1+(1.-s1);\n    c = mix(c, vec3(1), alpha*smoothstep(-0.02,0., (gear*size-length(p)))   );\n    c = mix(c, cc, alpha*smoothstep(-0.02,0., -abs(gear*size-length(p)))   );\n    c = mix(c, cc, alpha*smoothstep(-0.02,0., -abs(size*.7*(1.-s1)-length(p)))   );\n} \n\nvoid drawGear(inout vec3 c, vec3 cc, vec2 p, float t, float ngear, float size, float s1, float s2){\n   drawGear(  c, cc, 1., p,  t,  ngear,  size,  s1,  s2);\n}\n\nvoid drawGear(inout vec3 c, vec2 p, float t, float ngear, float size, float s1, float s2){\n   drawGear(  c, vec3(0), p,  t,  ngear,  size,  s1,  s2);\n}\n\nvoid drawGear(inout vec3 c, vec2 p, float t, float ngear, float size, float s1){\n   drawGear(  c, vec3(0), p,  t,  ngear,  size,  s1,   0.);\n} \n\nvoid drawLine(inout vec3 c, vec2 p, vec2 p1, vec2 p2){\n    c = mix(c, vec3(1), smoothstep(-0.02,0.,     (.05-(sdLine(p, p1, p2))) )  );\n    c = mix(c, vec3(0), smoothstep(-0.02,0.,- abs(.05-(sdLine(p, p1, p2))) )  );\n}\n\nvoid drawLine(inout vec3 c, float s,  vec2 p, vec2 p1, vec2 p2){\n    c = mix(c, vec3(1), smoothstep(-0.02,0.,     (s-(sdLine(p, p1, p2))) )  );\n    c = mix(c, vec3(0), smoothstep(-0.02,0.,- abs(s-(sdLine(p, p1, p2))) )  );\n}\n\nvoid drawLine(inout vec3 c, vec2 p, vec2 p1, vec2 p2, float d){\n    c = mix(c, vec3(1), smoothstep(-0.02,0.,     (.05-max(-d, sdLine(p, p1, p2))) )  );\n    c = mix(c, vec3(0), smoothstep(-0.02,0.,- abs(.05-max(-d, sdLine(p, p1, p2))) )  );\n}\n\nvoid drawSpring(inout vec3 c, vec2 p, float t ){\n\n    float tl1  = powC(abs(cos(t*1. +PI*.4   )),2.0)*.6+1.;\n    float tl1s = powC(abs(cos(t*1. +PI*.4  )),2.0)*.4;\n    float tl2s = powC(abs(cos(t*1. +PI*.3  )),5.0)*.4-.3;\n    \n\tc = mix(c, vec3(0), smoothstep( -0.2, 0., min(-1.+step(0., p.y+1.-tl1s), min(-step(0., p.y-0.), -abs(-(cos(p.y*20.*tl1)-p.x*4. )) )  )  ) );\n    \n    p-=vec2(.0,-1.1+tl1s);\n\tc = mix(c, vec3(1), smoothstep( -0.02, 0., ( \t.1-sdBox(p, vec2(.5,.1)))  ) );\n    c = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( \t.1-sdBox(p, vec2(.5,.1)))  ) );\n    c = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( \t.1-sdBox(p, vec2(.5,.1)))  ) );\n    \n\tdrawLine(c,p,vec2(-0.5,0.), vec2(.2,tl2s));\n}\n\nfloat curve(float vl, float cp) {\n\tfloat cbase = cos(vl*PI+PI);\n    return powC(1.-abs(cbase),cp)/2. * -sign(cbase) + step(0., cbase );\n}\n\nvoid setKeyframePosition(inout mat3 mt, float t, float ts, float td, float cb, vec2 v ) // transform, time, start, duration, position\n{\n    float tf = clamp((t- ts)/td, 0., 1. );\n    //tf = (cos(tf*PI+PI)+1.)/2.;\n    tf = curve(tf,cb);\n    mt = mt * (mat3(vec3(1,0,0), vec3(0,1,0),  vec3( v* tf , 1) ) ) ;\n}\n\nvoid setKeyframeSize(inout mat3 mt, float t, float ts, float td, float cb, float vs, float v ) // transform, time, start, duration, position\n{\n    float tf = clamp((t- ts)/td, 0., 1. );\n    tf = curve(tf,cb);\n    v = vs + v * tf * .5;\n    mt = mt * mat3(v,0,0,0,v,0,0,0,1)    ;\n}\n\nvoid drawGearPart1(inout vec3 c, vec2 p, float t){\n    drawGear(c,p,t*10., 20.,.5,.1);\n    drawGear(c,p-vec2(.96,0.),-t*10.+3., 20.,.5,.1);\n    drawGear(c,p-vec2(.96,0.7),t*5., 5.,.2,.2, 1.0);\n    drawGear(c,p-vec2(1.8,0.9),t*20.+3., 10.,.5,.1);\n    \n    c = mix(c, vec3(0), smoothstep(-0.02,0., -(sdLine(p, vec2(.93,0.81), vec2(1.7,1.2) )))   );\n    c = mix(c, vec3(0), smoothstep(-0.02,0., -(sdLine(p, vec2(.96,0.59), vec2(1.7,.6) )))   );\n}\n\nvoid drawRamp(inout vec3 c, vec2 p, float t){\n    for (float i = 0.; i < 10.;i += 2.)\n    {\n        drawLine(c, p-vec2(14.1,3.7-i*.5),vec2(.0, 0.), vec2(5.,-0.5)  );\n        drawLine(c, p-vec2(14.1,3.2-(i+0.)*.5),vec2(5., 0.), vec2(0.,-0.5)  );\n    }\n}\n\nvoid drawBalance(inout vec3 c, vec2 p, float t){\n\tfloat yb = sin(t*2.)*.2;\n    // bar\n    drawSpring(c,p-vec2(1.0,2.2-yb),t);\n    drawLine(c,p-vec2(3.,2.2),vec2(-1.8,-yb), vec2(1.8,yb) );\n    drawLine(c,p-vec2(3.,2.2),vec2(-.0,0.), vec2(0.0,1.) );\n    \n    // gear bar join\n    drawLine(c,p,vec2(1.8,0.9), vec2(1.8,0.9) -.7*vec2(cos(t*2.), sin(t*2.)));\n    drawLine(c,p-vec2(4.7,0.7),vec2(0.,1.5+yb), vec2(0.,0.0+yb)  - 0.2*vec2(cos(t*2.+PI*.1-.2), 0.));\n}\nvoid drawGearPart2(inout vec3 c, vec2 p, float t)\n{\n\tdrawLine(c,p-vec2(5.,0.7),vec2(-.8, 0.), vec2(1.98,0.)  );\n    drawGear(c,p-vec2(6.3+.4*cos(t*2.-2.),0.7),-t*2.0+PI/1.+1., 1.,.7,.5);\n    drawGear(c,p-vec2(4.7,0.7),-t*2.0+1., 1.,.7,.5);\n    drawLine(c,p,vec2(4.7,0.7), vec2(6.3+.4*cos(t*2.-2.),0.7) -.3*vec2(cos(-t*2.+2.5), sin(-t*2.+2.5)), -.3+length(p-vec2(4.7,0.7)));\n}\n\nvoid drawCannon(inout vec3 c, vec2 p, float t){\n\n\tfloat v = (1.-max(0., cos(t*2.-2.)));\n    c = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( -.5 +length(vec2(p.x + v, p.y + v*.5-.5 )-vec2(8.5,0.5)) )) );\n    c = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( -.15+length(vec2(p.x + v, p.y + v*.5-.5 )-vec2(8.5,0.5)) )) );\n \tdrawLine(c,p-vec2(7.5,0.5),vec2(.0, 0.), vec2(1.,0.5)  );\n \n    \n    float v2 = powC( (1.-abs(v))*1.60,3.);\n    float v3 = step(0., cos(t*2.+2.7));\n    float v4 = cos(t*2.+2.5);\n    \n    c = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( -.4+length(p-vec2(9.1,3.7)) )) );\n    c = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( -.45+length(p-vec2(9.1,3.75)) )) );\n \n    c = mix(c, vec3(1), smoothstep( -0.02, 0., -   ( -.4+length(vec2(p.x +v2*v3+(-4.*v3), p.y + v2*.5-3.2 )-vec2(9.1,0.5)) )) );\n    c = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( -.4+length(vec2(p.x +v2*v3+(-4.*v3), p.y + v2*.5-3.2 )-vec2(9.1,0.5)) )) );\n \n    c = mix(c, vec3(0), v4*smoothstep( -0.02, 0., -abs( v3*fract(t*5.)*-.4+length(p-vec2(8.8,1.4)) )) );\n \n \tdrawLine(c,.5, p-vec2(13.1,3.7),vec2(.0, 0.), vec2(1.,0.5)  );\n  \tc = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( -.42+length(p-vec2(14.1,4.2) ))) );\n}\n\nvoid drawRampBall(inout vec3 c, vec2 p, float t){\n\tfloat v5 = powC(fract(t*.2),1.5);\n    c = mix(c, vec3(1), smoothstep( -0.02, 0., -( -.4+length(p - vec2(5.-abs(fract(v5*5.)*2.-1.)*5. ,-v5*5. )-vec2(14.1,4.2)) )) );\n\tc = mix(c, vec3(0), smoothstep( -0.02, 0., -abs( -.4+length(p - vec2(5.-abs(fract(v5*5.)*2.-1.)*5. ,-v5*5. )-vec2(14.1,4.2)) )) );\n}\n\nvoid drawGrind(inout vec3 c, vec2 p, float t){\n    vec2 pc = (p -  (vec2(14.1,-1.)));\n    c = mix(c, vec3(0), smoothstep( -0.02, 0., -abs(.05-abs( (fract(atanC(pc.x,pc.y)-t*15.))*-.4+length(pc)) ) ));\n\n    float fsize = (fract(t));\n    float fade = fract(t*3.);\n\n    for (float k = 0.; k < 2.; k++)\n    {\n        pc = (p - vec2(vec2(14.1,-1.)));\n        pc += vec2(cos(t*k),sin(t*k))*.2*fsize;\n        pc.x+=-.4;\n        float gear = powC((abs(fract((2.5)/PI*atanC(pc.x,pc.y) + t*8. )*2.-1.) ),2.)*.5+(1.-.5);\n        c = mix(c, vec3(0), (1.-fade)*smoothstep(-0.02,0., (fade*gear*.2-length(pc)))   );\n    }\n    \n    fade = smoothstep(0.95,1., fract((t-.13)*.2));\n    pc = (p - vec2(vec2(14.1,-1.)));\n    pc += vec2(cos(t),sin(t))*.2*fsize;\n    pc.x+=-.4;\n    float gear = powC((abs(fract((2.5)/PI*atanC(pc.x,pc.y) + t*8. )*2.-1.) ),2.)*.5+(1.-.5);\n    c = mix(c, vec3(1), (1.-fade)*smoothstep(-0.02,0., (fade*gear*2.2-length(pc)))   );\n    c = mix(c, vec3(0), (1.-fade)*smoothstep(-0.02,0., -abs(fade*gear*2.2-length(pc)))   );\n}\n\n    \nvoid drawDust(inout vec3 c, vec2 p, float t) {\n    float d = (.5-length(p-vec2(13.5,-1.-1.*4.*fract(t*.2))));\n    d = -max(-d, (.07-length(fract(p*20.+vec2( t*1., t*10.))*.1 -.05)));\n\td = -max(-d, step(cos(p.x*10.+t)*.01+3.8 , -p.y+ (( t*2.-100.)/20.)));\n    c = mix(c, vec3(0), (1.)*smoothstep(-0.02,0., d ) );\n}\n\nvoid drawTankLike(inout vec3 c, vec2 p, float t){\n\tdrawLine(c,p-vec2(12.8,-1.),vec2(0), vec2(0,-4) );\n    drawLine(c,p-vec2(14.9,-3.),vec2(0), vec2(0,-2) );\n   \tdrawLine(c,p-vec2(12.8,-4.96),vec2(0), vec2(2.1,0) );\n\n    p -= vec2(13.1,-3.8);\n    float dt = 1.;\n    dt = min(dt,-step(.0, sdBox(  p-vec2(.75,-.1), vec2(1.) )) );\n    dt = min(dt, -mapText(p, vec2(0.,-0.05),1.5, ivec4(0x4c696b65, 0x3f, 0, 0)).x);\n    dt = min(dt, (cos(p.x*10.+t*10.)*.02 -p.y+ (( t*2.-100.)/20.)));\n    c = mix(c, vec3(0.3), smoothstep(-0.01,.0,dt));\n}\n\n\nvoid drawBackgroundSigned(inout vec3 c, vec2 p, float t){\n    float bgAlpha = clamp(t-1.3,0.,1.);\n    float sig = sign(fract(p.x*1.5)-.5)* sign(fract(p.y*1.5)-.5);\n\tc = mix(c, vec3(0.3), (1.-bgAlpha)*mapText(p, vec2(-0.0075,0.),300., ivec4(0x62792040, 0x726d6d63, 0x616c, 0)).x); \n    drawGear(c,vec3(0.8), 1.-bgAlpha, fract(p*40.)-.5,t*10. * sig+(3.*(sig+1.)/2.), 20.,.5,.1,0.);\n}\n\nvoid mapKeyframes(inout mat3 mt, float t){\n\n    mt *=2.;\n    \n    setKeyframePosition(mt, t, 3., 5., 2.,  vec2( .7,  .5));\n    setKeyframeSize    (mt, t, 0., 5., 4., 0.01, 1.6);\n   \n    setKeyframePosition(mt, t, 12., 5., 2.,  vec2( 1.0,  .0));\n    setKeyframeSize    (mt, t, 8., 4., 1., 1., 2.);\n   \n    setKeyframePosition(mt, t, 15., 5., 2.,  vec2( 0.75,  -.1));\n    setKeyframeSize    (mt, t, 15., 4., 1., 1., -.95);\n   \n    setKeyframePosition(mt, t, 20., 5., 2.,  vec2( 1.8,  .8));\n    setKeyframeSize    (mt, t, 20., 4., 1., 1., 3.95);\n\n    setKeyframePosition(mt, t, 25., 5., 2.,  vec2( 0.0,  .0));\n    setKeyframeSize    (mt, t, 25., 4., 1., 1., .3);\n\n    setKeyframePosition(mt, t, 30., 5., 2.,  vec2( 1.4,  .5));\n    setKeyframeSize    (mt, t, 30., 4., 1., 1., -.3);\n    \n    setKeyframePosition(mt, t, 35., 5., 2.,  vec2( 0.0,  -1.0));\n    setKeyframeSize    (mt, t, 35., 4., 1., 1., -.5);\n\n    setKeyframePosition(mt, t, 39., 1., 4.,  vec2( -0.8,  -0.3));\n    setKeyframeSize    (mt, t, 38., 2., 1., 1., -.5);\n\n    \n    setKeyframePosition(mt, t, 41., 1., 4.,  vec2( -0.0,  -0.3));\n    setKeyframeSize    (mt, t, 38., 2., 1., 1., .5);\n\n    setKeyframePosition(mt, t, 42., 1., 4.,  vec2( -0.0,  -0.3));\n    setKeyframeSize    (mt, t, 41., 2., 1., 1., -0.5);\n\n    setKeyframePosition(mt, t, 43., 1., 4.,  vec2( -0.0,  -0.3));\n\n}\n\nvoid applyTransform(inout vec2 p, mat3 mt){\n\tp = (mt*vec3(p,1)).xy;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n\n    vec2 r = iResolution.xy;\n    vec2 a = vec2(r.x/r.y, 1.);\n    vec2 p = (uv-.5) * a;\n\n    float tTotal = fract(iTime/110.)*110.;\n    \n    float t = tTotal*.5;\n    float tl = abs(fract(t*.5)*2.-1.);;\n        \n    mat3 mt = mat3(1,0,0,0,1,0,0,0,1);    \n    \n    mapKeyframes(mt, t);\n    applyTransform(p, mt);\n    \n    vec3 c = vec3(1.);\n\tdrawGearPart1(c, p, t);\n \tdrawGearPart2(c, p, t);\n\tdrawBalance(c, p, t);\n    drawCannon(c, p, t);\n\tdrawRamp(c,p,t);\n    drawRampBall(c, p, t);\n    drawGrind(c,p,t);\n    drawDust(c,p,t);\n    drawTankLike(c,p,t);\n    drawBackgroundSigned(c,p,t);\n\n    c = mix(c, vec3(0), (1.)*smoothstep(0.0,1.5, length(uv-.5) ));\n\n    fragColor = vec4(c,1.0);\n}","name":"Image","description":"","type":"image"}]}