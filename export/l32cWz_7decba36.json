{"ver":"0.1","info":{"id":"l32cWz","date":"1727184946","viewed":30,"name":"utils: buffering keyboard events","username":"FabriceNeyret2","description":"buffering events during every - 1/2 seconds actions \npress left/right arrow\nhere I only store 1bit events. could store larger chunks.\n\n improving keyboard control for https://shadertoy.com/view/43ByRW and https://www.shadertoy.com/view/XXSyz1\n   ","likes":4,"published":3,"flags":48,"usePreview":0,"tags":["test","keyboard"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// variant of https://shadertoy.com/view/MX2cRm\n// testing keyboard control of https://shadertoy.com/view/43ByRW and https://www.shadertoy.com/view/XXSyz1\n            \nvoid mainImage(out vec4 O, vec2 U) {    \n    O = T(U);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define T(U)    texelFetch(iChannel0, ivec2(U), 0)\n#define R       iResolution.xy","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"#define key(a) (texelFetch(iChannel3,ivec2(a,1),0).x > 0.)      // LEFT:37  UP:38  RIGHT:39  DOWN:40 \n\nvoid mainImage( out vec4 O, vec2 U )\n{\n    U -= .5;\n    O = T(U);  if ( iFrame < 1 ) O = vec4(0);\n    \n    float c; \n    if ( U == vec2(0) ) iFrame < 1 ? O-=O, O.w = 5. : c,        // init\n                        c = key(37) ? 1. : key(39) ? 0. : -1.,  // push events\n                        c >= 0. ? O.y++, O.x = float(int(c + 2.*O.x) & 0xfff) : c, // O.x bits = FIFO, O.y = next slot\n                        O.z += iTimeDelta;                      // timer\n    else                    \n    if ( U.x > 0. ) O = T(U-vec2(1,0));                         // display\n    else            O = vec4 ( floor( 10.*U/R ).y == T(0).w ) \n                    ; // O.r += mod(T(0).x,3.)/3., O.g += float(key(37)), O.b += float(key(39)); // debug\n\n    if (T(0).z < .5 ) return;                                   // slow game : 2 events / sec\n    \n    if ( U == vec2(0) ) {\n        O.z = 0.;                                               // reset delay timer\n        if ( O.y > 0. )                                        \n            O.w = mod( O.w + ( ((int(O.x)>>int(--O.y))&1) > 0 ? 1. : -1. ), 10. ); // action, and eat used event\n     }\n     else if ( U.x < 1. ) O.b++;\n}","name":"Buffer A","description":"","type":"buffer"}]}