{"ver":"0.1","info":{"id":"XlsXD2","date":"1439870635","viewed":176,"name":"Carbon Tissue","username":"kynd","description":"not optimized","likes":3,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[],"code":"\n\nvec3 cpos = vec3(0,0,5);\nmat3 cam;\nvec3 light = normalize(vec3(.6, .6, 1));\n\n#define K .21\n#define smoothen(d1,d2)  -log( exp(-K*(d1)) + exp(-K*(d2)) ) / K\n\nmat3 rotMatrix(float angle, vec3 a){\n    a = normalize(a);\n    float s= sin(angle), c= cos(angle);\n\n    return   mat3(a.x*a, a.y*a, a.z*a) * (1.-c)\n           + mat3(     c, a.z*s, -a.y*s,\n                  -a.z*s,     c,  a.x*s,\n                   a.y*s, -a.x*s,     c  );\n}\n\nfloat dist(vec3 p){\n    float  t = iTime/60.;\n    mat3 rm0 = rotMatrix(    t*6.3 + p.x*.005, vec3(1,0,0) );\n    mat3 rm1 = rotMatrix( 2.*t*6.3 + p.y*.006, vec3(0,1,0) );\n    mat3 rm2 = rotMatrix( 3.*t*6.3 + p.z*.007, vec3(0,0,1) );\n    p = rm0 * rm1 * rm2 * p;\n    p = mod(p, 48.) - 24.;\n    float d0 = length(p.xy) - 1.;\n    float d1 = 100.;\n    float d2 = length(p.zx) - 2.;\n\n    return smoothen(d0, smoothen(d1, d2));\n}\n\n#define EPS vec2(.001, 0)\n#define norm(p) normalize(dist(p) - vec3(dist(p-EPS.xyy), dist(p-EPS.yxy), dist(p-EPS.yyx)));\n\n\nvec4 phong(vec3 p, vec3 ray) {\n    vec3 n = norm(p);\n    return   vec4(.1) * .5 \n           + vec4(.3) * clamp(dot(light, n) * .5, .0, 1.)\n\t\t   + pow(clamp(dot(normalize(light-ray), n), .0, 1.), 128.);\n}\n\nvoid mainImage(out vec4 o, vec2 uv )\n{\n\tvec2 R = iResolution.xy,\n         p = (uv * 2. - R) / min(R.x, R.y);\n    cam[0] = -normalize(cpos),\n    cam[1] = vec3(1,0,0),\n    cam[2] = cross(cam[1], cam[0]);\n\tvec3 ray = normalize(cam*vec3(2,p));\n\n\tfloat len = 0., di;\n\tvec3 rhead = cpos;\n\tfor(int i = 0; i < 128; i++){\n\t\tdi = dist(rhead);\n        if (abs(di) < .001) break;\n\t\tlen += di;\n\t\trhead = cpos + len * ray;\n\t}\n\n\to = abs(di)<.001 ? phong(rhead, ray) : vec4(0);\n}","name":"Image","description":"","type":"image"}]}