{"ver":"0.1","info":{"id":"tdScDc","date":"1588200078","viewed":91,"name":"First Ray Marching ******","username":"Chico","description":"First ray marching","likes":0,"published":1,"flags":0,"usePreview":0,"tags":["raymarching"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define ITERATIONS 128\n#define MAX_DIST 200.\n#define SURF_DIST .01\n\n\nfloat GetDist(vec3 p){\n    \n    vec3 sphere = vec3(0, 2, 0);\n    float sphereDist = length(p - sphere.xyz) - 1.5; //radius\n    float planeDist = p.y;\n    \n    float d = min(sphereDist, planeDist); //add the floor\n    return d;\n\n}\n\nfloat RayMarch(vec3 ro, vec3 rd) {\n    float dO = 0.;\n   \n    for(int i=0; i<ITERATIONS;i++){\n    \tvec3 p = ro + rd*dO;\n        float DS = GetDist(p);\n        dO += DS;\n    \tif (dO>MAX_DIST || DS< SURF_DIST)break;\n    }\n    \n    return dO;\n}\n\nvec3 GetNormal(vec3 p) {\n\tfloat d = GetDist(p);\n    vec2 e = vec2(.01, 0);\n    \n    vec3 n = d - vec3(\n        GetDist(p-e.xyy),\n        GetDist(p-e.yxy),\n        GetDist(p-e.yyx));\n    \n    return normalize(n);\n}\n\nfloat GetLight(vec3 p) {\n    vec3 lightPos = vec3(2, 5, -2);\n    vec3 l = normalize(lightPos-p);\n    vec3 n = GetNormal(p);\n    \n    float dif = clamp(dot(n, l), 0., 1.);\n    float d = RayMarch(p+n*SURF_DIST*2., l);\n    if(d<length(lightPos-p)) dif *= .1;\n    \n    return dif;\n}\n\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{    \n    vec2 uv = fragCoord/iResolution.xy;\n    uv -= .5;\n    uv.x *= iResolution.x/iResolution.y; //normalize with uv(0,0) at the center screen\n    \n    \n    vec3 ro = vec3(0, 2, -6); // ro = ray origin (camera) coordinates\n    \n    vec3 rd = normalize(vec3(uv.x, uv.y, 1)); //rd = ray direction (will scan through)\n\n    \n    float d = RayMarch(ro, rd);\n    \n    vec3 p = ro + rd * d;\n    \n    float diff = GetLight(p); //diffuse light\n    \n    fragColor = vec4(vec3(diff),1.0);\n}","name":"Image","description":"","type":"image"}]}