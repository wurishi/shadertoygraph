{"ver":"0.1","info":{"id":"DlfSD7","date":"1675014869","viewed":202,"name":"2D Equirectangular Projection","username":"romanus","description":"Equirectangular Projection with mouse control","likes":6,"published":1,"flags":0,"usePreview":0,"tags":["2d","equirectangular"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsfGzn","filepath":"/media/a/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","previewfilepath":"/media/ap/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","type":"cubemap","channel":0,"sampler":{"filter":"mipmap","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float PI = 3.14159265358979323846264338327;\nconst float PI2 = 6.28318530718;\n\nconst vec3 boxColor = vec3(0.5, 1.0, 0.5);\n\nmat3 lookAt(vec3 origin, vec3 target, vec3 up) {\n  vec3 z = normalize(origin - target);\n  vec3 x = normalize(cross(up, z));\n  vec3 y = cross(z, x);\n  return mat3(x, y, z);\n}\n\nvec3 toSpherical(vec2 uv) {\n  float theta = uv.y * PI;\n  float phi = uv.x * 2.0 * PI;\n\n  float x = sin(phi) * sin(theta) * -1.0;\n  float y = cos(theta);\n  float z = cos(phi) * sin(theta) * -1.0;\n\n  return vec3(x,y,z);\n}\n\nfloat sdBox( vec3 p, vec3 b ) {\n  vec3 d = abs(p) - b;\n  return min(max(d.x,max(d.y,d.z)), 0.0) + length(max(d, 0.0));\n}\n\nvec3 render(vec3 p){\n  vec4 d = vec4(1.0);\n  vec2 mouse = (iMouse.xy / iResolution.xy);\n  vec3 color = texture(iChannel0, -p).rgb;\n  \n  vec3 pos = toSpherical(mouse);\n  \n  pos.y *= -1.0;\n  pos = (p + pos) * lookAt(pos, vec3(0.0), vec3(0.0, 1.0, 0.0));\n\n  float depth = sdBox(pos, vec3(0.25));\n  color = mix(color, boxColor, smoothstep(1.0/iResolution.x, 0.0, depth));\n\n  return color;\n}\n\nvoid mainImage(out vec4 fragColor,vec2 fragCoord){  \n  vec2 s = fragCoord.xy / iResolution.xy * vec2(PI2, PI);\n  vec3 rd = vec3(sin(s.y) * sin(s.x), cos(s.y), sin(s.y) * cos(s.x));\n  \n  fragColor = vec4(render(rd), 1.0);\n}\n","name":"Image","description":"","type":"image"}]}