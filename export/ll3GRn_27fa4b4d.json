{"ver":"0.1","info":{"id":"ll3GRn","date":"1467597460","viewed":218,"name":"SH16A flockaroo","username":"flockaroo","description":"also work in progress. not quite as small as reinders, but still potential for optimization.\n","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["sh16a"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","previewfilepath":"/media/ap/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","type":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define U(x) normalize(x)\n\nvec2 M( vec3 p )\n{\n    vec2 v = vec2( p.y, 13.);\n\n    for(int i=0;i<25;i++)\n    {\n        float r=.4-.15*float(i-i/2*2);\n        float d=length(p-vec3(i/5-2,r,i-i/5*5-2))-r;\n        if(d<v.x) v=vec2(d,i/2);\n    }\n\n    return v;\n}\n\nvec3 T( vec3 p, vec3 d )\n{ \n    vec2 v = vec2(0);\n    for( int i=0; i<64; i++ )\n    {\n        vec2 w = M( p+d*v.x );\n        if( w.x<.0 || v.x>20. ) break;\n        v.x += w.x;\n        v.y = w.y;\n    }\n    if( v.x>20. ) v.y=-1.;\n\n    p += v.x*d;\n    \n    // normal\n#define D(e) M(p+e).x-M(p-e).x\n    vec3 e = vec3( .001, 0, 0 );\n    vec3 n = U(vec3(D(e),D(e.yxy),D(e.yyx)));\n    \n    vec3  r = reflect( d, n );\n\n    vec3 c = vec3(.4);\n    //if( mod( mod(floor(p.x),2.) + mod(floor(p.z),2.), 2. ) >= .5 )\n    if( mod(floor(p.x)+p.z,2.) > .999 )\n        c *= 1.25 *texture( iChannel0, (floor(25.6*p.xz + vec2(37,17))+.5)/256.,-100. ).y;\n\n    if( max( abs(p.x), abs(p.z)) < 1.5 )\n        c *= smoothstep( 0., .5, length(fract(p.xz+.5)-.5) );\n\n    if(v.y<13.) c = vec3(-8,3,6)*v.y*.01+vec3(1,0,0);\n\n    // lighting\n    vec3 l = U( vec3(-6,7,-5) );\n    \n    // shadow\n    float s = 0.;\n\tfloat t = 0.01;       \n    for( int i=0; i<64; i++ )\n    {\n        vec2 w = M( p+l*t );\n        if( w.x<.0 || t>2.5 ) break;\n        t += w.x;\n    }\n    if( t>2.5 ) s=1.;\n\n    vec3 ads = vec3(.5+.5*n.y,\n                    max(dot( n, l ),0.)*s,\n                    pow(max( dot(U(r), l ), 0.),16.)\n                   );\n\n    return c*( ads.y*vec3(1.2,1.02,.66) + ads.x*vec3(.25,.35,.5) ) + ads.z*ads.y;\n}\n\nvoid mainImage( out vec4 o, in vec2 c )\n{\n#define R iResolution\n    vec2 p = 2.*c/R.y-vec2(R.x/R.y,1);\n\n    vec3 q=2.*vec3( 1.5*cos(5.), 1, 1.5*sin(5.) );\n\n    vec3 r = U(vec3( 0, -.2, 0 )-q);\n    vec3 s = U( vec3(-r.z,0,r.x) );\n    mat3 m = mat3( s, cross(s,r), r );\n\n    // render\n    o=vec4( pow( T( q, m * U(vec3(p.xy,2.)) ), vec3(.5) ), 1. );\n}\n","name":"Image","description":"","type":"image"}]}