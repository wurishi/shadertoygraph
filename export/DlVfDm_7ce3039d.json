{"ver":"0.1","info":{"id":"DlVfDm","date":"1702159713","viewed":22,"name":"Lottes Tonemap","username":"lowellcamp","description":"Based on the GDC 2005 presentation","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["tonemap"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float h = floor(1.0+18.0*fragCoord.y/iResolution.y)/18.0 * 3.141592 * 2.;\n    float L = floor(fragCoord.x*24.0/iResolution.y)/(24.0/iResolution.y)/iResolution.x - 0.4;\n    \n    \n    vec3 color = cos(h + vec3(0.0,1.0,2.0)* 3.141592*2.0/3.0);\n    float maxRGB = max(color.r, max(color.g, color.b));\n    float minRGB = min(color.r, min(color.g, color.b));\n    \n    color = exp(10.0*L)*(color-minRGB)/(maxRGB-minRGB);\n    \n    color = tonemap(color);\n    \n    fragColor = vec4(color, 1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"const float contrast = 1.0;\nconst float shoulder = 1.0;\n\nconst float midIn = 0.5;\nconst float midOut = 0.75;\nconst float hdrMax = exp2(5.0);\n\nconst float hueShift = 0.25;\nconst float vibrance = 1.0;\n\n\nconst float crossSaturation = exp2(hueShift);\nconst float crosstalk = 8.0 * vibrance / crossSaturation;\n\nconst float b = (-pow(midIn, contrast) + pow(hdrMax, contrast) * midOut) / ((pow(pow(hdrMax, contrast), shoulder) - pow(pow(midIn, contrast), shoulder)) * midOut);\nconst float c = (pow(pow(hdrMax, contrast), shoulder) * pow(midIn, contrast) - pow(hdrMax, contrast) * pow(pow(midIn, contrast), shoulder) * midOut) / ((pow(pow(hdrMax, contrast), shoulder) - pow(pow(midIn, contrast), shoulder)) * midOut);\n\nfloat _tonemap(float x) {\n    float z = pow(x, contrast);\n    return z / (pow(z, shoulder) * b + c);\n}\n\nvec3 tonemap(vec3 rgb) {\n    float peak = max(rgb.r, max(rgb.g, rgb.b));\n    vec3 ratio = rgb / peak;\n    float peak_t = _tonemap(peak);\n    ratio = pow(ratio, vec3(1.0 / crossSaturation));\n    ratio = mix(ratio, vec3(1.0), pow(peak_t, crosstalk));\n    ratio = pow(ratio, vec3(crossSaturation));\n    return peak_t * ratio;\n}","name":"Common","description":"","type":"common"}]}