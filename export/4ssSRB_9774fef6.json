{"ver":"0.1","renderpass":[{"outputs":[],"inputs":[{"channel":0,"type":"cubemap","id":"XsfGzn","filepath":"/media/a/585f9546c092f53ded45332b343144396c0b2d70d9965f585ebc172080d8aa58.jpg","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}},{"channel":1,"type":"cubemap","id":"4sfGzn","filepath":"/media/a/793a105653fbdadabdc1325ca08675e1ce48ae5f12e37973829c87bea4be3232.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}},{"channel":3,"type":"texture","id":"Xsf3zn","filepath":"/media/a/f735bee5b64ef98879dc618b016ecf7939a5756040c2cde21ccb15e69a6e1cfb.png","sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"code":"#define PI \t\t\t3.14159265359\n\n#define FOV \t\t60.0\n#define EPSILON\t\t0.001\n#define MAX_STEPS\t1000\n#define MAX_DIST\t1000.0\n\n#define PLANE\t\tvec4 (0.0, 1.0, 0.0, 1.0)\n#define BOTTOM\t\tvec4 (0.0, 1.0, 0.0, 4.0)\n#define FR0\t\t\tvec3 (0.0, 1.5, 5.0)\n\nvec4 texture3D (sampler2D tex, vec3 pt, vec3 pn, float scale) {\n\treturn \n\t\ttexture (tex, pt.xy/scale) * abs (pn.z) +\n\t\ttexture (tex, pt.xz/scale) * abs (pn.y) +\n\t\ttexture (tex, pt.zy/scale) * abs (pn.x);\n}\n\nmat3 rotate_x (float fi) {\n\tfloat cfi = cos (fi);\n\tfloat sfi = sin (fi);\n\treturn mat3 (\n\t\t1.0, 0.0, 0.0,\n\t\t0.0, cfi, -sfi,\n\t\t0.0, sfi, cfi);\n}\n\nmat3 rotate_y (float fi) {\n\tfloat cfi = cos (fi);\n\tfloat sfi = sin (fi);\n\treturn mat3 (\n\t\tcfi, 0.0, sfi,\n\t\t0.0, 1.0, 0.0,\n\t\t-sfi, 0.0, cfi);\n}\n\nmat3 rotate_z (float fi) {\n\tfloat cfi = cos (fi);\n\tfloat sfi = sin (fi);\n\treturn mat3 (\n\t\tcfi, -sfi, 0.0,\n\t\tsfi, cfi, 0.0,\n\t\t0.0, 0.0, 1.0);\n}\n\nvec4 noise3v (vec2 p) {\n\treturn texture (iChannel3, p);\n}\n\nvec4 fbm3v (vec2 p) {\n\tvec4 f = vec4 (0.0);\n\tf += noise3v (p)/pow (2.0, 1.0); p *= 2.01;\n\tf += noise3v (p)/pow (2.0, 2.0); p *= 2.02;\n\tf += noise3v (p)/pow (2.0, 3.0); p *= 2.03;\n\tf += noise3v (p)/pow (2.0, 4.0); p *= 2.04;\n\tf += noise3v (p)/pow (2.0, 5.0); p *= 2.05;\n\tf /= 0.9375;\n\treturn f;\n}\n\nfloat dplane (vec3 pt, vec4 pl) {\n\treturn dot (pl.xyz, pt) + pl.w;\n}\t\n\nfloat map (vec3 pt) {\n\treturn dplane (pt, PLANE);\n}\n\n\nfloat march (vec3 ro, vec3 rd) {\n\tfloat t = 0.0;\n\tfloat d = 0.0;\n\tvec3 pt = vec3 (0.0);\n\tfor (int i = 0; i < MAX_STEPS; ++i) {\n\t\tpt = ro + rd * t;\n\t\td = map (pt); \n\t\tif (d < EPSILON || t + d >= MAX_DIST) {\t\t\t\n\t\t\tbreak;\n\t\t}\n\t\tt += d;\n\t}\n\t\n\treturn d <= EPSILON ? t : MAX_DIST;\n}\n\nfloat fresnel_step (vec3 I, vec3 N, vec3 f) {\n\treturn clamp (f.x + f.y * pow (1.0 + dot (I, N), f.z), 0.0, 1.0);\n}\n\nfloat avg (vec3 v) {\n\treturn (v.x + v.y + v.z)/3.0;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tvec2 uv = (2.0*fragCoord.xy - iResolution.xy)/min (iResolution.x, iResolution.y) * tan (radians (FOV)/2.0);\n\tvec2 mo = PI * iMouse.xy / iResolution.xy;\n\t\n\tvec3 up = vec3 (0.0, 1.0, 0.0); \t\t\t// up \n\tvec3 fw = vec3 (0.0, 0.0, 1.0) * \t\t\t// forward\n\t\trotate_y (mo.x * PI); \t\t\t\t\n\tvec3 lf = cross (up, fw); \t\t\t\t\t// left\n\t\n\tvec3 ro = -fw * 5.0 + vec3 (0.0, 5.0, 0.0); // ray origin\n\tvec3 rd = normalize (uv.x * lf + uv.y * up + fw) ; \t\t// ray direction\n\t\t\n\tfloat t = march (ro, rd);\n\tvec4 cm = texture (iChannel0, rd);\n\tif (t >= MAX_DIST) {\n\t\tfragColor = cm;\n\t}\n\telse {\n\t\tvec3 pt = rd*t + ro;\n\t\tvec4 dv = fbm3v (pt.xz/pow (2.0, 10.0)) - vec4 (0.5);\n\t\t//rd += 0.0625*dv.xyz;\n\t\tvec3 pn = normalize (PLANE.xyz + 0.0625*dv.xyz) ;\t\t\n\t\tvec3 rf = reflect (rd, pn);\n\t\tvec3 rr = refract (rd, pn, 1.01);\n\t\tvec4 c0 = texture (iChannel0, rf);\n\t\tvec4 c1 = texture (iChannel1, rr);\t\t\n\t\tfloat fs = 1.0-fresnel_step (rd, pn, FR0);\n\t\tfragColor = mix (\n\t\t\tmix (mix (c1,c0,1.0 - fs), vec4 (1.0), clamp (avg (dv.xyz+0.3), 0.0, 1.0)),\n\t\t\tcm, smoothstep (60.0, 150.0, t));\n\t}\n}\t\t","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"4ssSRB","date":"1403377527","viewed":423,"name":"Cheap ice surface","username":"Coldberg","description":"cheap ice effect","likes":4,"published":1,"flags":0,"usePreview":0,"tags":["cheapiceeffect"],"hasliked":0,"parentid":"","parentname":""}}