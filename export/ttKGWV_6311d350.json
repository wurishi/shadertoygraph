{"ver":"0.1","info":{"id":"ttKGWV","date":"1579961069","viewed":87,"name":"KIFS experiments 4","username":"rodgzilla","description":"kifs experiments","likes":2,"published":1,"flags":0,"usePreview":0,"tags":["kifs"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define time iTime\n#define SPEED 20.\n\nfloat PI = acos(-1.);\n\nvec3 palette(float x) {\n//  float wave = sin(3. * time) * 0.5 + 0.5;\n  vec3 p = vec3(1, .5, 1);\n  vec3 q = vec3(.7, .6, 1);\n  vec3 r = vec3(.3, .6, .3);\n  vec3 s = vec3(.9, .5, .3);\n/*\n  vec3 p = vec3(1, 1, 1);\n  vec3 q = vec3(.3, .6, 1);\n  vec3 r = vec3(.3, .6, .3);\n  vec3 s = vec3(.9, .5, .3);\n*/\n  return p + q * sin(2. * PI * (x * r + s));\n}\n\nmat2 rot2d(float a) {\n  float c = cos(a), s = sin(a);\n\n  return mat2(c, s, -s, c);\n}\n\nvec3 kifs(vec3 p, float d, float s, float tf) {\n  float t = tf * time;\n\n  for (float i = 0.; i < d; i += 1.) {\n    p.xy *= rot2d(t + i);\n    p.xz *= rot2d(t * 0.6 - i);\n    p.xy *= rot2d(PI / 2.);\n\tp = abs(p);\n    p -= s;\n    s *= 0.8;\n  }\n\n  return p;\n}\n\nfloat map(vec3 p) {\n  p.xy *= rot2d(time * .1);\n  p.yz *= rot2d(time * .25);\n  float wave = .5 * sin(time) + .5;\n  float d = 10000.;\n  vec3 p1 = kifs(p, 2., 1., .3);\n  vec3 p2 = kifs(p, 5., .5 + 3. * (.5 * sin(time / 4.) + .5), .8);\n//  vec3 p2 = kifs(p, 5., 2.5, .8);\n  float mix_param = .2 + .8 * wave;\n  p = mix(p1, p2, mix_param);\n//  p = mix(p1, p2, .5 + .5 * sin(2. * time));\n  d = min(d, length(p) - 1.);\n  return d;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n  vec2 uv = vec2(fragCoord.x / iResolution.x, fragCoord.y / iResolution.y);\n  uv -= 0.5;\n  uv /= vec2(iResolution.y / iResolution.x, 1);\n\n  vec3 ro = vec3(0, 0, -30.);\n  vec3 rd = normalize(vec3(uv, 1));\n\n  float d = 0.;\n  int i;\n  for (i = 0; i < 100; i++) {\n    vec3 p = ro + d * rd;\n    float ds = map(p);\n\n    if (ds < 0.01 || ds > 100.) {\n      break;\n    }\n\n    d += ds / 2.;\n  }\n  vec3 p = ro + d * rd;\n  vec2 e = vec2(0.01, 0);\n  vec3 n = normalize(map(p) - vec3(map(p - e.xyy), map(p - e.yxy), map(p - e.yyx)));\n  vec3 l = vec3(0, 0, -30.);\n  float dif = dot(n, normalize(l - p));\n\n  vec3 col = vec3(dif * palette(p.z / 5.));\n//  vec3 col = vec3(dif);\n  fragColor = vec4(col, 1.);\n}\n","name":"Image","description":"","type":"image"}]}