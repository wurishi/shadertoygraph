{"ver":"0.1","info":{"id":"l3fSDr","date":"1709372283","viewed":3417,"name":"tm gyroids","username":"tubeman","description":"a","likes":67,"published":1,"flags":0,"usePreview":0,"tags":["gyroids"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// based on https://iquilezles.org/articles/palettes/\nvec3 pal(float t) {\n    vec3 b = vec3(.45);\n    vec3 c = vec3(.35);\n    return b + c*cos(6.28318*(t*vec3(1)+vec3(.7,.39, .2)));\n}\n\n// see https://www.youtube.com/watch?v=-adHIyjIYgk\nfloat gyroid(vec3 p, float scale) {\n    p *= scale;\n    float bias = mix(1.1, 2.65, sin(iTime*.4 + p.x/3. + p.z/4.)*.5+.5);\n    float g = abs(dot(sin(p*1.01), cos(p.zxy*1.61)) - bias)/(scale*1.5)-.1;\n    return g;\n}\n\nfloat scene(vec3 p) {\n    float g1 = .7*gyroid(p, 4.);\n    return g1;\n}\n\n// from @blackle\nvec3 norm(vec3 p) {\n    mat3 k = mat3(p,p,p) - mat3(0.01);\n    return normalize(scene(p) - vec3(scene(k[0]),scene(k[1]),scene(k[2])));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    vec2 uv = (fragCoord-.5*iResolution.xy)/iResolution.y;\n    vec3 init = vec3(iTime*.25,1.5,.3);\n    vec3 cam = normalize(vec3(1., uv ));\n\n    // basic raymarcher from @blackle\n    vec3 p = init;\n    bool hit = false;\n    for ( int i = 0; i < 100 && !hit; i++) {\n        if (distance(p,init) > 8.) break;\n        float d = scene(p);\n        if (d*d < 0.00001) hit = true;\n        p += cam*d;\n    }\n    vec3 n = norm(p);\n\n    float ao = 1.-smoothstep(-.3,.75,scene(p+n*.4))\n             * smoothstep(-3.,3.,scene(p+n*1.));\n    \n    float fres = -max(0., pow(.8-abs(dot(cam,n)), 3.));\n    vec3 vign = smoothstep(0.,1.,vec3(1.-(length(uv*.8)-.1)));\n    vec3 col = pal(.1-iTime*.01 + p.x*.28 + p.y*.2 + p.z*.2);\n    col = (vec3(fres)+col)*ao;\n    col = mix(col, vec3(0.), !hit ? 1. : smoothstep(0.,8.,distance(p,init)));\n    col = mix(vec3(0),col, vign+.1);\n    col = smoothstep(0.,1.+.3*sin(iTime+p.x*4.+p.z*4.),col);\n    fragColor.xyz = col;\n    fragColor.xyz = sqrt(fragColor.xyz);\n}","name":"Image","description":"","type":"image"}]}