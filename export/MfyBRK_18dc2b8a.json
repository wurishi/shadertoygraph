{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[{"channel":0,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":1,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":2,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":3,"type":"buffer","id":"XdfGR8","filepath":"/media/previz/buffer03.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main {\n   R = iResolution.xy;\n   Q = (.7+.2*vec4(1,2,3,4))*(.5+.5*A(U).w)*D(U);\n }","name":"Image","description":"","type":"image"},{"outputs":[],"inputs":[],"code":"vec2 R;\n#define Main void mainImage(out vec4 Q, in vec2 U)\n\n#define A(U) texelFetch(iChannel0,ivec2(U),0)\n#define B(U) texelFetch(iChannel1,ivec2(U),0)\n#define C(U) texture(iChannel2,(U)/R)\n#define D(U) texture(iChannel3,(U)/R)\n\n#define vel(v) (v)*inversesqrt(1.+dot(v,v))\n\n#define inside(v) ((v).x>=0.&&(v).y>=0.&&(v).x<R.x&&(v).y<R.y)\n\nfloat ln (vec3 p, vec3 a, vec3 b) { \n    return length(p-a-(b-a)*(dot(p-a,b-a)/dot(b-a,b-a)));\n}\n\nbool scene (vec2 U) {\n    if (U.x<1.||R.x-U.x<1.||U.y<1.) return false;\n   \n   U += 1.*sin(vec2(U.y,U.x)*.5);\n   U += 10.*sin(vec2(U.y,U.x)*.06);\n   U += 20.*sin(vec2(U.y,U.x)*.01);\n   return abs(U.y-.7*R.y)>.1*max(.4*R.x-U.x,0.)&&\n       abs(U.y-.5*R.y)>.1*max(U.x-.3*R.x,0.)&&\n       abs(U.y-.3*R.y)>.1*max(.4*R.x-U.x,0.);\n    \n}\nvec4 hash(vec4 p4)\n{\n\tp4 = fract(p4  * vec4(.1031, .1030, .0973, .1099));\n    p4 += dot(p4, p4.wzxy+33.33);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}","name":"Common","description":"","type":"common"},{"outputs":[{"channel":0,"id":"4dXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main {\n    R = iResolution.xy;\n    Q = A(U);\n    for (int x = -1; x <= 1; x++)\n    for (int y = -1; y <= 1; y++)\n    if (x*x+y*y<=4)\n    if (x!=0||y!=0) {\n        vec2 v = vec2(x,y);\n        vec4 q = A(U+v);\n        if (inside(U+v))\n        Q.xy += .008*q.w*(1.-q.w)*v/dot(v,v);\n    }\n    Q.y -= .25/R.y;\n    if (length(Q.xy)>1.) Q.xy = normalize(Q.xy);\n    if (Q.w>5.||Q.w<0.) Q.w = 5.;\n    if (iFrame < 1) Q = vec4(0);\n    if (U.y > .8*R.y && U.x < 20.) Q = vec4(.15,0,0,.8);\n    if (iMouse.z>0.&&length(U-iMouse.xy)< 10.) Q.w = 1.,Q.x = .5,Q.z=.8;\n}","name":"Buffer A","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"XsXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main {\n\n    R = iResolution.xy;\nQ = A(U);\nvec4 dQ = vec4(0);\n#define K (1./8.)\nfor (int x = -1; x <= 1; x++)\nfor (int y = -1; y <= 1; y++)\nif (x!=0||y!=0) {\n    vec2 v = vec2(x,y);\n    vec2 W = U+v;\n    vec4 q = A(W);\n\n    vec2 a = vel(Q.xy),\n         b = vel(q.xy)+v;\n    float ab = dot(v,b-a);\n    if (scene(W)) {\n        float i = dot(v,(0.5*v-a))/ab;\n        float j = .5+.2*clamp(Q.w-q.w,0.05,1.);\n        float k = .5+.2*clamp(q.w-Q.w,0.05,1.);\n        float wa = K*Q.w*min(i,j)/j;\n        float wb = K*q.w*max(k+i-1.,0.)/k;\n        dQ += vec4(Q.xyz,1)*wa+vec4(q.xyz,1)*wb;\n    } else {\n        dQ += K*Q.w*vec4(Q.xyz,1);\n    }\n\n}\nif (dQ.w>0.) dQ.xyz /= dQ.w;\nQ = dQ;\n}","name":"Buffer B","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"4sXGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4dXGR8","filepath":"/media/previz/buffer00.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":1,"type":"buffer","id":"XsXGR8","filepath":"/media/previz/buffer01.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main {\n    R = iResolution.xy;\n    Q = A(U);\n    vec4 n = A(U+vec2(0,1));\n    vec4 e = A(U+vec2(1,0));\n    vec4 s = A(U-vec2(0,1));\n    vec4 w = A(U-vec2(1,0));\n    Q.w = A(U).w;\n    Q.xy = vec2(e.w-w.w,n.w-s.w);\n\n}","name":"Buffer C","description":"","type":"buffer"},{"outputs":[{"channel":0,"id":"XdfGR8"}],"inputs":[{"channel":0,"type":"buffer","id":"4sXGR8","filepath":"/media/previz/buffer02.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}},{"channel":3,"type":"buffer","id":"XdfGR8","filepath":"/media/previz/buffer03.png","sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"code":"Main {\n    R = iResolution.xy;\n    Q = .98*D(U);\n    for (float k = 0.;k < 1.; k++){ \n        vec4 h = hash(vec4(U,iFrame,k));\n        float a = 0.5*3.14159+.3*(h.x*2.-1.);\n        vec2 d = vec2(cos(a),sin(a));\n        vec2 p = U;\n        for (float i = 0.; i < 150.; i++) {\n            vec4 a = A(p);\n            d = normalize(d - .1*a.xy);\n            p += 3.*d;\n            Q += .0005*exp(-20.*length(d-vec2(0,1)));\n        }\n    \n    }\n}\n","name":"Buffer D","description":"","type":"buffer"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":true,"mFlagMusicStream":false},"info":{"id":"MfyBRK","date":"1734185264","viewed":174,"name":"Sunlit Cave Falls","username":"wyatt","description":"...","likes":14,"published":3,"flags":32,"usePreview":0,"tags":["fluid"],"hasliked":0,"parentid":"","parentname":""}}