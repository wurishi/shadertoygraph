{"ver":"0.1","info":{"id":"fsXBzN","date":"1644529462","viewed":165,"name":"mobius gears","username":"nexor","description":".","likes":24,"published":1,"flags":0,"usePreview":0,"tags":["raymarch"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"const float pi = atan(-1.);\n\nmat2 rot(float a)\n{\n  float c=cos(a),s=sin(a);\n  return mat2(c,-s,s,c);\n}\n\nvec2 fan(vec2 p, int n)\n{\n  float N=float(n);\n  \n  float a = atan(p.y,p.x);\n  a=mod(a,pi*2./N)-pi/N;\n  return length(p)*vec2(cos(a),sin(a));\n\n}\n\nfloat box(vec3 p, vec3 s)\n{\n  vec3 d = abs(p)-s;\n  return min(max(d.x,max(d.y,d.z)),0.)+length(max(d,0.));\n}\n\nfloat map(vec3 p)\n{\n    float t = float(iFrame)/60.;\n    //p*=.2;\n    p.xz*=rot(-1.8);\n    \n    t*=30.;\n    float d = 1e3;\n    \n    \n    float k = .5;\n    float kk = .0625;\n    float n = -.075;\n    \n    float gears = 40.;\n    float gearheight=.015;\n    float height =.05;\n    vec3 q=p;\n    {\n    p.y-=k+kk;\n    p.x-=n;\n    p=p.yxz;\n    float a = atan(p.z,p.x);\n    float b = a;\n    \n    \n    //p.\n    //p.yz*=rot(-pi/4.);\n    p.xz*=rot(pi/2.);\n    p.yz*=rot(-pi/2.);\n    p.xz=fan(p.xz,300)-vec2(k,.0);\n    p.xy*=rot(a/2.);\n    \n    d=box(p,vec3(.1,height-(sin(b*gears+gears/(pi*2.)+t))*gearheight,5.));\n    \n    }\n    \n    \n    {\n    q=-q;\n    q.y-=k+kk;\n    q.x-=n;\n    q=q.yxz;\n    float a = atan(q.z,q.x);\n    \n    //p.\n    //p.yz*=rot(-pi/4.);\n    \n    q.xz*=rot(pi/2.);\n    q.yz*=rot(-pi/2.);\n    q.xz=fan(q.xz,300)-vec2(k,.0);\n    q.xy*=rot(a/2.);\n    \n    d=min(d,\n    box(q,vec3(.1,height-(sin(a*gears-t))*gearheight,5.)\n    ))\n    ;\n    \n    }\n    \n    return d*.7;\n}\n\nvec3 normal(vec3 p)\n{\n  vec2 e = vec2(1,0)*.0025;\n  return normalize(vec3(\n  map(p+e.xyy)-map(p-e.xyy),\n  map(p+e.yxy)-map(p-e.yxy),\n  map(p+e.yyx)-map(p-e.yyx)\n  ));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = (2.*fragCoord-iResolution.xy)/iResolution.y;\n\n    vec3 col = vec3(0);\n    \n    \n    float t= 0.;\n    vec3 ro = vec3(0,0,-5);\n    vec3 rd = normalize(vec3(uv,2.5));\n    bool hit= false;\n    \n    for(int i =0;i<128;++i)\n    {\n      float h = map(ro+rd*t);\n      \n      if(h < .01)\n      {hit=true;break;}\n      if(t>15.)break;\n      t += h;\n    }\n    \n    if(hit)\n    {\n      vec3 p = ro+rd*t;\n      vec3 n = normal(p);\n      vec3 l = normalize(vec3(3,4,-5));\n      float dif=max(0.,dot(l,n));\n      col += .05+dif;\n    }\n    \n    \n\n    fragColor = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"}]}