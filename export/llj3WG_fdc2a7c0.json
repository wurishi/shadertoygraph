{"ver":"0.1","info":{"id":"llj3WG","date":"1432121712","viewed":173,"name":"Fl0w","username":"luutifa","description":"Saw this in a dream and had to make it real.","likes":6,"published":1,"flags":0,"usePreview":0,"tags":["raymarch","fog","rubber","blenk"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#ifdef GL_ES\n    precision highp float;\n#endif\n\nfloat t;\n\n#define PI 3.14159265\n#define E 0.001\n#define MD 60.0\n#define I 40\n#define MS 11.0\n#define B 0.6\n\nvec3 cam;\nvec3 nm;\n\nvec3 saturate(vec3 c) {\n    return clamp(c, 0., 1.);\n}\n\nfloat saturate(float f) {\n    return clamp(f, 0., 1.);\n}\n\n//---------------------------------------------------------------\n\nmat3 getXRotMat(float a) {\n    return mat3(\n         1.0,  0.0,     0.0,\n         0.0,  cos(a), -sin(a),\n         0.0,  sin(a),  cos(a)\n    );\n}\n\nmat3 getYRotMat(float a) {\n    return mat3(\n         cos(a),  0.0,  sin(a),\n         0.0,     1.0,  0.0,\n        -sin(a),  0.0,  cos(a)\n    );\n}\n\nmat3 getZRotMat(float a) {\n    return mat3(\n         cos(a), -sin(a),  0.0,\n         sin(a),  cos(a),  0.0,\n         0.0,     0.0,     1.0\n    );\n}\n\nvoid repX(inout vec3 p, float s) {\n    vec3 r = p;\n    r.x = mod(p.x, s)-(s*0.5);\n    p=r;\n}\n\nvoid repXY(inout vec3 p, float s) {\n    vec3 r = p;\n    r.x = mod(p.x, s)-(s*0.5);\n    r.y = mod(p.y, s)-(s*0.5);\n    p=r;\n}\n\nvoid repXYZ(inout vec3 p, float s) {\n    vec3 r = p;\n    r.x = mod(p.x, s)-(s*0.5);\n    r.y = mod(p.y, s)-(s*0.5);\n    r.z = mod(p.z, s)-(s*0.5);\n    p=r;\n}\n\n//--------------------------------------------------------------------\n\nfloat tube(vec3 p) {\n    vec2 d = abs(p.yz) - vec2(1.0);\n    return min(max(d.x,d.y),0.0) + length(max(d,0.0));\n}\n\nfloat f(vec3 p) {\n    vec3 tp = p;\n    tp.z=clamp(tp.z, 10.0, 20.0);\n    tp.y*=sin(tp.x*0.1+iTime*0.8)*0.4+1.0;\n    repXY(tp.yzx, 8.0);\n    tp.y+=sin(tp.x*.4+iTime*2.0+tp.z*0.3)*.7;\n    tp=getXRotMat(tp.x*.1+iTime*0.8+tp.y*0.07)*tp;\n    return tube(tp);\n}\n\nvec3 grad(vec3 p) {\n    vec2 e = vec2(E, 0.0);\n    return (vec3(f(p+e.xyy), f(p+e.yxy), f(p+e.yyx)) - f(p)) / e.x;\n}\n\nvec3 m(vec3 o, vec3 v) {\n    float d;\n    float t=MS;\n    for (int i=0;i<I;i++) {\n        d=f(o+v*t);\n        t+=d*B;\n        if (d<E||t>MD)\n            break;\n    }\n    return o+v*t;\n}\n\nvec3 applyFog(vec3 p, float i, vec3 ci, vec3 fc) {\n    return mix(ci, fc, i*p.z);\n}\n\nvec3 c(vec2 sp) {\n    vec3 p=m(cam, getXRotMat(sin(iTime*0.3)*0.3)*getYRotMat(sin(iTime*0.7)*0.2)*getZRotMat(sin(iTime*0.1)*0.4)*normalize(vec3(sp, 1.0)));\n    nm=normalize(grad(p));\n    float diff = max(dot(normalize(p-cam), -nm), 0.0);\n    vec3 c = vec3(1.0, 0.1, 0.05)*(1./length(p-cam))*diff*max(pow(diff, 5.0)*23.0, 1.0)*13.0; //PLACEHOLDER LIGHTING\n    vec3 fc1=vec3(1.0, 0.05, 0.1)*0.6;\n    vec3 fc2=vec3(0.1, 0.05, 1.0)*0.6;\n    float fp = sin(iTime*0.4)*0.5+0.5;\n    c=applyFog(p, 0.01, c, fc1*fp+(fc2*(1.0-fp)));\n    return c;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    t = iTime;\n    cam = vec3(sin(iTime*0.3)*0.2, cos(iTime)*6.0, sin(iTime*0.6)*0.4);\n    \n    vec2 sp = (2.*fragCoord.xy-iResolution.xy)/iResolution.y;\n    fragColor = vec4(pow(saturate(c(sp)), vec3(1./2.2)),1.); // Apply sRGB gamma correction because webgl\n}","name":"Image","description":"","type":"image"}]}