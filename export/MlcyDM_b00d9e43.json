{"ver":"0.1","info":{"id":"MlcyDM","date":"1532838189","viewed":274,"name":"eletron's diffraction experiment","username":"archibate","description":"alternate version of [url]https://www.shadertoy.com/view/lsKGRW[/url].\nsimulates the eletron's diffraction experiment.\ncheck 'Common' for more scenes.","likes":17,"published":1,"flags":32,"usePreview":0,"tags":["2d","wave","physics","quantum","multipass","schrodinger"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nfloat message(vec2 p) {  // the alert function to add to your shader\n    int x = int(p.x+1.)-1, y=int(p.y)-10,  i;\n    if (x<1||x>32||y<0||y>2) return -1.; \n    i = ( y==2? i=  757737252: y==1? i= 1869043565: y==0? 623593060: 0 )/ int(exp2(float(32-x)));\n \treturn i==2*(i/2) ? 1. : 0.;\n}\n\n//#if 1\n\n#define PI 3.141592653589793\n#define hue2rgb(h) clamp(abs(mod(6.*(h)+vec3(0,4,2),6.)-3.)-1.,0.,1.)\nvoid mainImage(out vec4 o, in vec2 p) {\n    vec2 v = psi(p);\n    o = vec4(1.5 * length(v) * hue2rgb(atan(v.y,v.x)/(2.*PI)) +\n             0.25*potential(p), 1);\n    \n    if (iFrame != 0)\n        return;\n    float m = message(p/10.);\n    if (m == 0.)\n    \to = vec4(0,0,0,0);\n    else if (m == 1.)\n    \to = vec4(1,0,0,0);\n}\n\n/*#else\n\nfloat f(vec2 u) {\n    return length2(psi(u));\n}\n\n#define STEPS 600\n\nvoid mainImage(out vec4 o, in vec2 w) {\n    w = w / iResolution.xy - .5;\n    w.x *= iResolution.x / iResolution.y;\n    vec3 p = vec3(w, 1);\n    vec3 d = .01 * vec3(0, 2, -1);\n    \n    o = vec4(1);\n    for (int i = 0; i < STEPS; i++) {\n        if (f(p.xy) >= p.z) {\n            float t = float(i) / float(STEPS);\n            o = vec4(t);\n            break;\n        }\n        p += d;\n    }\n}\n\n#endif*/","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[],"code":"#define psi(p) texture(iChannel0,(p)/iResolution.xy).xy\n#define k1(p)  texture(iChannel1,(p)/iResolution.xy).xy\n#define k2(p)  texture(iChannel2,(p)/iResolution.xy).xy\n#define k3(p)  texture(iChannel3,(p)/iResolution.xy).xy\n\n#define potential(p)  potentialIR(iResolution.xy, p)\n#define psi0(p)  psi0IR(iResolution.xy, p)\n\n#define cis(theta) vec2(cos(theta),sin(theta))\n#define length2(p) dot(p,p)\n\n#define REFLECTION 1\n#define DIFFRACTION 2\n#define GAUSSIAN 3\n/* scene selector, here!!! */\n#define SCENE DIFFRACTION\n\n#if SCENE == REFLECTION\nfloat potentialIR(vec2 iResolution, vec2 p) {\n    return float(p.y < 5. || p.y > iResolution.y - 5. ||\n        (p.x < iResolution.x/2. && int(p.y) == int(iResolution.y/2.)));\n}\nvec2 psi0IR(vec2 iResolution, vec2 p) {\n    p = p / iResolution.xy;\n    p.x *= iResolution.x / iResolution.y;\n    return exp(-70.*length2(p+vec2(0.675,0.225))) * cis(250.*(p.x+p.y));\n}\n#elif SCENE == DIFFRACTION\n#define WSIZ 34.\n#define MSIZ 17.\nfloat potentialIR(vec2 iResolution, vec2 p) {\n    float aa = abs(p.x - iResolution.x/2.);\n    return float(p.y < 5. || p.y > iResolution.y - 5. ||\n        ((!(aa < WSIZ) || (aa < MSIZ)) && abs(p.y - iResolution.y/2.) < 5.));\n}\nvec2 psi0IR(vec2 iResolution, vec2 p) {\n    p = p / iResolution.xy;\n    p.x *= iResolution.x / iResolution.y;\n    return exp(-70.*length2(p+vec2(0.,0.225))) * cis(250.*(p.y));\n}\n#elif SCENE == GAUSSIAN\n#define K 5.\n#define EQ0 .0\nfloat potentialIR(vec2 iResolution, vec2 p) {\n    p = p / iResolution.xy - .5;\n    p.x *= iResolution.x / iResolution.y;\n    return .5 * K * dot(p,p) + EQ0 * p.x;\n}\nvec2 psi0IR(vec2 iResolution, vec2 p) {\n    p = p / iResolution.xy;\n    p.x *= iResolution.x / iResolution.y;\n    return .5 * exp(-300.*length2(p)) * vec2(1., 0.);\n}\n#endif\n\nvec2 divi(vec2 c) { /* divide by sqrt(-1), ie. rotate 270 deg */\n    return vec2(c.y, -c.x);\n}\n\n#define DEFK \\\nvec2 k(vec2 p) { \\\n    vec2 c = y(p); \\\n    vec2 n = y(p + vec2(0,1)); \\\n    vec2 e = y(p + vec2(1,0)); \\\n    vec2 s = y(p - vec2(0,1)); \\\n    vec2 w = y(p - vec2(1,0)); \\\n    vec2 laplacian = n + e + s + w - 4.*c; \\\n    return divi(-laplacian + potential(p) * c); \\\n}\n\n#define dt 0.25","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XdfGR8","filepath":"/media/previz/buffer03.png","previewfilepath":"/media/previz/buffer03.png","type":"buffer","channel":3,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dXGR8","channel":0}],"code":"\n#define y(p) (psi(p) + dt*k3(p))\n\nDEFK\n\n#define rk4(p) (psi(p) + dt * (k1(p) + 2.*k2(p) + 2.*k3(p) + k(p))/6.)\n\n#define mainImage(o,p) o.xy = (iFrame < 10) ? psi0(p - iResolution.xy * .5) : iMouse.w > 0. ? psi0(p - iMouse.xy) : rk4(p)","name":"Buf A","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"\n#define y(p) (psi(p))\n\nDEFK\n\n#define mainImage(o,p) o.xy = k(p)","name":"Buf B","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4sXGR8","channel":0}],"code":"\n#define y(p) (psi(p) + 0.5*dt*k1(p))\n\nDEFK\n\n#define mainImage(o,p) o.xy = k(p)","name":"Buf C","description":"","type":"buffer"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4sXGR8","filepath":"/media/previz/buffer02.png","previewfilepath":"/media/previz/buffer02.png","type":"buffer","channel":2,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XdfGR8","channel":0}],"code":"\n#define y(p) (psi(p) + 0.5*dt*k2(p))\n\nDEFK\n\n#define mainImage(o,p) o.xy = k(p)","name":"Buf D","description":"","type":"buffer"}]}