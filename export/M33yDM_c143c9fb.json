{"ver":"0.1","renderpass":[{"outputs":[{"channel":0,"id":"4dfGRr"}],"inputs":[{"channel":0,"type":"texture","id":"XsBSR3","filepath":"/media/a/cb49c003b454385aa9975733aff4571c62182ccdda480aaba9a8d250014f00ec.png","sampler":{"filter":"linear","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"}}],"code":"/* \n Adaptation of \"Disco Godrays\" by @kishimisu (2023):\n https://www.shadertoy.com/view/Dt33RS\n \n Also, using code from IQ & Gest\n*/\n\n#define PI 3.1415926\n#define PI_2 1.5707963\n#define PI_5 0.6283185\n#define PI_6 0.5235987\n#define PI_10 0.31415926\n\n#define ZERO (min(iFrame,0))\n\n#define ro(a) mat2(cos(a + vec4(0,33,11,0)))\n#define r(p) ro(round((atan(p.y,p.x)+k)/f)*f-k)\n\n//------------------------------------------------------------------\n\n// https://iquilezles.org/articles/distfunctions/\nfloat sdStar2D(in vec2 p, in float r, in float rf)\n{\n    const vec2 k1 = vec2(0.809016994375, -0.587785252292);\n    const vec2 k2 = vec2(-k1.x,k1.y);\n    p.x = abs(p.x);\n    p -= 2.0*max(dot(k1,p),0.0)*k1;\n    p -= 2.0*max(dot(k2,p),0.0)*k2;\n    p.x = abs(p.x);\n    p.y -= r;\n    vec2 ba = rf*vec2(-k1.y,k1.x) - vec2(0,1);\n    float h = clamp( dot(p,ba)/dot(ba,ba), 0.0, r );\n    return length(p-ba*h) * sign(p.y*ba.x-p.x*ba.y);\n}\n\n\nfloat sdCone(vec3 p, float a, float h) {\n    return max(dot(vec2(sin(a), cos(a)),vec2(length(p.xz),p.y)),-h-p.y);\n}\n\nfloat sdBox( vec3 p, vec3 b )\n{\n  vec3 q = abs(p) - b;\n  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n}\n\nvec3 opElongate( in vec3 p, in vec3 h )\n{\n    return p - clamp( p, -h, h );\n}\n\nfloat opRepeat( in float p, in float s, in float l)\n{\n    return p - s*clamp(round(p/s),-l,l);\n}\n\n//------------------------------------------------------------------\n\n// Adapted Gest's star: \n// https://www.shadertoy.com/view/cdtyzB\nfloat star3D(vec3 p) {\n    float f = 2. * PI / 5., k = 0.;\n    p.xz *= ro(iTime * PI_6);\n    p.z *= 1.5;\n    \n    p.yx *= ro(PI_10);\n    p.yx *= r(p.xy);\n    \n    p.yz *= ro(PI/4.);\n    return sdBox(p, vec3(1, vec2(0.1 - 0.3*p.x)));\n}\n\n//------------------------------------------------------------------\n\nvoid mainImage(out vec4 fragColor, vec2 fragCoord) {\n    float f = PI_6, d = f, k = iTime*f, t, ch = 3., ca = 1.2, cy = 1.5, s = ch/10., glow = 0., sr = .03;\n    vec2 textSamp =  fragCoord/1024.;\n    vec4 p, a = fragColor *= t = 0.,\n    rd = normalize(vec4((2.*fragCoord-iResolution.xy)/iResolution.y, 1, 0));\n    \n    for (int i=ZERO;i<60;i++) {\n        if(d <= .01) break;\n        p = t*rd;\n        p.z -= 2.;\n        \n        float cone = sdCone(p.xyz - vec3(0, cy, 0), ca, ch);\n        float star = star3D(p.xyz - vec3(0, cy+.1, 0));\n        \n        p.y += 1.;\n        //p.zx *= ro(mod(round(p.y/s),2.)*f/2.); //TODO: f/2 offset for alternate rows\n        p.zx *= r(p.xz);\n        p.yx *= ro(PI_2 - ca);\n\n        p.y = opRepeat(p.y, s, 6.);\n\n        vec3 q = opElongate(p.xyz, vec3(ch, 0, 0));\n        float ray = sdStar2D(q.yz * ro(PI_10), sr, .5);\n        \n        a += smoothstep(.02, .0, ray) *\n             smoothstep( 1., .0, length(p) - 1.3)*\n             (1. + cos(2.2*k + t+t + vec4(0,1,2,0)));\n        float noise = texture(iChannel0, textSamp).r;\n        d = min(max(cone, -ray), .1 + noise *.06);\n        d = min(d, star);\n        glow += .03/pow(star,1.1);\n        t += d;\n    }\n                 \n    fragColor = .5*mix(fragColor+.3, a, exp(-t*.1));\n    fragColor += 0.045* glow * (1. + cos(k+k + vec4(0,1,2,0)));\n}","name":"Image","description":"","type":"image"}],"flags":{"mFlagVR":false,"mFlagWebcam":false,"mFlagSoundInput":false,"mFlagSoundOutput":false,"mFlagKeyboard":false,"mFlagMultipass":false,"mFlagMusicStream":false},"info":{"id":"M33yDM","date":"1735150458","viewed":248,"name":"Xmas tree + kishimisu's Godrays","username":"pba","description":"Hello World!\nMerry Christmas!","likes":21,"published":3,"flags":0,"usePreview":1,"tags":["raymarching","christmas","ray","rays","fog","rotation","god","neon","short","density"],"hasliked":0,"parentid":"Dt33RS","parentname":"Disco Godrays [411 chars]"}}