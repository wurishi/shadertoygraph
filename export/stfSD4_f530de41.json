{"ver":"0.1","info":{"id":"stfSD4","date":"1625685217","viewed":137,"name":"chroma barrel","username":"netro","description":"chroma barrel","likes":8,"published":1,"flags":0,"usePreview":0,"tags":["chroma"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"Xdf3Rn","filepath":"/media/a/e81e818ac76a8983d746784b423178ee9f6cdcdf7f8e8d719341a6fe2d2ab303.webm","previewfilepath":"/media/ap/e81e818ac76a8983d746784b423178ee9f6cdcdf7f8e8d719341a6fe2d2ab303.webm","type":"video","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"\nvec2 barrelDistortion(vec2 coord, float amt) \n{\n\tvec2 cc = coord - 0.5;\n\tfloat dist = dot(cc, cc);\n\t//return coord + cc * (dist*dist)  * amt;\n\treturn coord + cc * dist * amt;\n}\n\nfloat sat( float t )\n{\n\treturn clamp( t, 0.0, 1.0 );\n}\n\nfloat linterp( float t ) {\n\treturn sat( 1.0 - abs( 2.0*t - 1.0 ) );\n}\n\nfloat remap( float t, float a, float b ) {\n\treturn sat( (t - a) / (b - a) );\n}\n\nvec4 spectrum_offset( float t ) {\n\tvec4 ret;\n\tfloat lo = step(t,0.5);\n\tfloat hi = 1.0-lo;\n\tfloat w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );\n\tret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);\n\n\treturn pow( ret, vec4(1.0/2.2) );\n}\n\nconst float max_distort = 0.6;\nconst int num_iter = 6;\nconst float reci_num_iter_f = 1.0 / float(num_iter);\nconst float distro = 5.0;\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n\tvec4 sumcol = vec4(0.0);\n\tvec4 sumw = vec4(0.0);\n\tfor ( int i=0; i<num_iter;++i )\n\t{\n\t\tfloat t = float(i) * reci_num_iter_f;\n\t\tvec4 w = spectrum_offset( t );\n\t\tsumw += w;\n\t\tsumcol += w * texture( iChannel0, barrelDistortion(uv, .9 * distro*t ) );\n\t}\n\tfragColor = sumcol / sumw;\n}","name":"Image","description":"","type":"image"}]}