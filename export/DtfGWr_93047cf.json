{"ver":"0.1","info":{"id":"DtfGWr","date":"1671820482","viewed":167,"name":"Pixel Rays","username":"kastorp","description":"....","likes":14,"published":1,"flags":32,"usePreview":0,"tags":["rays"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"XsXGR8","filepath":"/media/previz/buffer01.png","previewfilepath":"/media/previz/buffer01.png","type":"buffer","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Pixel Rays by Kasorp\n//-------------------------------\n\nvec4 getIntersection(vec2 ro, vec2 rd, int j){\n   vec2 c= texelFetch(iChannel0,ivec2(j/100,j%100),0).xy;\n   return iBox2(ro-c,  rd, s);\n}\n\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    vec2 uv = (I -R*.5)/R.y*12.;\n\n    vec2 rd=normalize(uv-ro);\n    float st=R.x, a=atan(rd.y,rd.x); a=floor(a/PI*st +.5)/st*PI+PI;\n    \n    vec3 col = .2+.2*cos(vec3(0,2,4)+a);\n    float d=length(uv-ro);\n\n    int c=0;   \n    for(int i=0;i< 1+ N/128 ;i++){\n        uvec4 m = floatBitsToUint(texelFetch(iChannel1,ivec2(mod(a,PI)*st/PI,i+1),0));\n        if(all(equal(m,uvec4(0u))) )continue;\n        for(int k=0;k<4;k++){\n            if(m[k]==0u) continue;\n            for(int j=0;j< 32;j++){\n                int  id=(j+i*128+k*32);\n\n                if(id<N && (m[k] & (1u<<j))>0u)  {\n\n                    vec4 t2=getIntersection(ro,  rd,id);\n                    if( d<t2.y && t2.y<1e5) col+=.05;\n                    c++;\n                    if(d>t2.x && d<t2.y  ) col=.5+.5*cos(vec3(0,2,4)+float(id)/float(N)*PI);\n                }\n            }\n        }\n    }\n\n    \n#ifdef DEBUG\n    vec4 mt=texelFetch(iChannel1,ivec2(mod(a,PI)*st/PI,0),0);\n    if(float(c)>50.) col=vec3(1,1,0);\n    if(float(c)!=mt.z) col=vec3(1,0,0);\n#endif\n    \n   \n    O = vec4(col,1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[],"outputs":[{"id":"4dXGR8","channel":0}],"code":"//pixel position\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    float j = mod(I.x,100.)*100.+I.y;\n    float t = iTime + j*11.2;\n    vec2 c=vec2(cos(t),sin(t))*2.+ (hash(uvec3(j,j+1.,j+2.)).xy*10.-5.)*R/R.y;\n    O=vec4(c,0,0);\n}","name":"Buffer A","description":"","type":"buffer"},{"inputs":[],"outputs":[],"code":"#define R iResolution.xy\n#define N 1000 // increase if powerful GPU  \n\n//#define DEBUG\nvec2 ro=vec2(0), s=vec2(.05);\nconst float PI=6.2830;\n\n//----------------------\n//Iq https://www.shadertoy.com/view/XlXcW4\nvec3 hash( uvec3 x )\n{\n    const uint k = 1103515245U;  // GLIB C\n    x = ((x>>8U)^x.yzx)*k;\n    x = ((x>>8U)^x.yzx)*k;\n    x = ((x>>8U)^x.yzx)*k;\n    \n    return vec3(x)*(1.0/float(0xffffffffU));\n}\nvec4 iBox2(vec2 ro, vec2 rd,vec2 s){\n    //Iq:  intersect  box\n    vec2  m  = -1.0 / rd;\n    vec2  n  = m * ro;\n    vec2  k  = abs(m) * s;\n    vec2  t1 = n - k;\n    vec2  t2 = n + k;\n    float tn = max(t1.x, t1.y);\n    float tf = min(t2.x, t2.y);\n    if( tn>tf ) return vec4(1e5);\n    vec2 on= step(tn,t1);\n    return vec4(tn,tf,on);\n}\n\n\n\n\n\n","name":"Common","description":"","type":"common"},{"inputs":[{"id":"4dXGR8","filepath":"/media/previz/buffer00.png","previewfilepath":"/media/previz/buffer00.png","type":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"XsXGR8","channel":0}],"code":"//Ray/particle interception\n//x= ray angle, y= particles (128 each row)\n\n\nvec4 getIntersection(vec2 ro, vec2 rd, int j){\n    vec2 c= texelFetch(iChannel0,ivec2(j/100,j%100),0).xy;\n    float sm=length(ro-c)/R.x*PI/2.;\n   return iBox2(ro-c,  rd, s+sm);\n}\n\nvoid mainImage( out vec4 O, in vec2 I )\n{\n    if(I.y>2.+float(N)/128.) discard;\n\n    float a=I.x/iResolution.x*PI;\n    vec2 rd=vec2(cos(a),sin(a));\n    if(I.y<1.){\n#ifndef DEBUG        \n        discard;\n#else\n        vec3 mt=vec3(1e5,0.,0.);\n        for(int j=0;j<min(int(N),1000);j++){\n            vec4 t2=getIntersection(ro,  rd, j);\n            if(t2.y>0. && mt.x>t2.x) mt.x=t2.x;\n            if(t2.x<1e5 && t2.y>mt.y )mt.y=t2.y;\n            if(t2.x<1e5)mt.z++;\n\n        } \n        O=vec4(mt,0);\n#endif        \n    }\n    else{\n         uvec4 m=uvec4(0u); \n         for(int i=0;i<128;i++){\n             int j =i + 128 * int(I.y-1.);\n             vec4 t2=getIntersection(ro,  rd, j);\n              if(t2.x<1e5)  m[i/32] |=(1u<<(i&31));\n         }\n         O=uintBitsToFloat(m);\n    }\n}","name":"Buffer B","description":"","type":"buffer"}]}