{"ver":"0.1","info":{"id":"lstyD4","date":"1518999258","viewed":383,"name":"Keyboard Synthesizer","username":"zeletochoy","description":"Can't get the keyboard input to work in the sound buffer...","likes":1,"published":1,"flags":24,"usePreview":0,"tags":["keyboard","synthesizer"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[{"id":"XsfGRn","filepath":"/media/a/1f7dca9c22f324751f2a5a59c9b181dfe3b5564a04b724c657732d0bf09c99db.jpg","previewfilepath":"/media/ap/1f7dca9c22f324751f2a5a59c9b181dfe3b5564a04b724c657732d0bf09c99db.jpg","type":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"true","srgb":"false","internal":"byte"},"published":1},{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[{"id":"4dfGRr","channel":0}],"code":"#define KEYS 10.\n#define OFFSET 0.\n\nconst int wcodes[10] = int[10](81, 83, 68, 70, 71, 72, 74, 75, 76, 77);\nconst int bcodes[10] = int[10](65, 90, 69, 82, 84, 89, 85, 73, 79, 80);\n\nfloat dist_to_unit(float x)\n{\n    float f = fract(x);\n    return min(f, 1. - f);\n}\n\nfloat keydown(int code)\n{\n    return texelFetch(iChannel0, ivec2(code, 0),  0).x;\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = fragCoord/iResolution.xy;\n    \n    vec3 col = texture(iChannel1, uv).rgb;\n    col *= smoothstep(0., 0.03, uv.y - 0.6);\n    \n    if (uv.y <= 0.6)\n    {\n        col = vec3(smoothstep(0., 0.03, dist_to_unit(uv.x * KEYS)));\n        int widx = int(uv.x * KEYS);\n        col *= 1. - 0.2 * keydown(wcodes[widx]);\n        col *= smoothstep(0., 0.005, uv.y);\n        float key_idx = mod(round(uv.x * KEYS), 7.);\n        if (uv.y >= 0.2 && key_idx != 0. + OFFSET && key_idx != 3. + OFFSET)\n        {\n            col *= smoothstep(0.3, 0.33, dist_to_unit(uv.x * KEYS));\n        \tint bidx = int(uv.x * KEYS + 0.5);\n            col = vec3(max(col.x, 0.2 * keydown(bcodes[bidx])));\n        }\n    }\n    \n    // Output to screen\n    fragColor = vec4(col, 1.0);\n}","name":"Image","description":"","type":"image"},{"inputs":[{"id":"4dXGRr","filepath":"/presets/tex00.jpg","previewfilepath":"/presets/tex00.jpg","type":"keyboard","channel":0,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"},"published":1}],"outputs":[],"code":"#define tau 6.2831853071\n#define freqcoef 1.059463094359\n\nconst int keycodes[17] = int[17]\n    (81, 90, 83, 69, 68, 70, 84, 71, 89, 72, 85, 74, 75, 79, 76, 80, 77);\n\nbool keydown(int code)\n{\n    return texelFetch(iChannel0, ivec2(code, 0),  0).x > 0.;\n}\n\nfloat notefreq(float n)\n{\n    return 440. * pow(freqcoef, n);\n}\n\nfloat sinwave(float note, float time)\n{\n    return 0.5 + 0.5 * sin(tau * time * notefreq(note));\n}\n\nvec2 mainSound( in int samp,float time)\n{\n    float vol = 0.;\n    if (keydown(keycodes[0]))\n        vol = sinwave(0., time);\n    return vec2(vol);\n}","name":"Sound","description":"","type":"sound"}]}