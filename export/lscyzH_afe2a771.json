{"ver":"0.1","info":{"id":"lscyzH","date":"1517927350","viewed":123,"name":"dg2","username":"hclarke","description":"grinding some gears","likes":1,"published":1,"flags":0,"usePreview":0,"tags":["2d"],"hasliked":0,"parentid":"","parentname":""},"renderpass":[{"inputs":[],"outputs":[{"id":"4dfGRr","channel":0}],"code":"// Fork of \"diamond gears\" by hclarke. https://shadertoy.com/view/Md2fWD\n// 2018-02-06 04:20:47\n\nvec2 sd_line(vec2 pos, vec2 a, vec2 b) {\n    pos -= a;\n    vec2 d = b-a;\n    float l = length(d);\n    d /= l;\n    \n    float t = dot(d,pos);\n    vec2 p = d*clamp(t,0.0,l);\n    vec2 perp = vec2(d.y,-d.x);\n    \n    return vec2(length(pos-p), dot(pos,perp));\n}\n\nfloat abs_min(float a, float b) {\n \treturn abs(a) < abs(b) ? a : b;   \n}\n\n\nvec2 lmin(vec2 a, vec2 b) {\n    if(abs(a.x-b.x) < 0.0001) {\n      return a.y > b.y ? a : b;\n    }\n    \n    return a.x < b.x ? a : b;\n}\n\nfloat to_sd(vec2 x) {\n \treturn x.x * sign(x.y);   \n}\n\nfloat sd_diamond(vec2 pos, vec2 tail, vec2 tip, float width, float mid) {\n\tvec2 d = tip-tail;\n    vec2 p = vec2(d.y,-d.x) * width * 0.5;\n    vec2 m = d*mid+tail;\n    \n    vec2 la = sd_line(pos,tail,m+p);\n    vec2 lb = sd_line(pos,m+p,tip);\n   \tvec2 lc = sd_line(pos,tip,m-p);\n    vec2 ld = sd_line(pos,m-p,tail);\n    \n    \n    return to_sd(lmin(lmin(la,lb),lmin(lc,ld)));\n}\n\nvec2 to_polar(vec2 x) {\n\treturn vec2(length(x), atan(-x.y, -x.x) + 3.14159);\n}\n\nvec2 from_polar(vec2 x) {\n \treturn vec2(cos(x.y),sin(x.y)) * x.x;   \n}\n\nvec2 radial_repeat(vec2 pos, float count) {\n    float offset = 0.5/count;\n    pos = to_polar(pos);\n    pos.y /= 2.0*3.14195;\n    pos.y += offset;\n   \tpos.y *= count;\n   \tpos.y = fract(pos.y);\n   \tpos.y /= count;\n    pos.y -= offset;\n    pos.y *= 2.0*3.14195;\n    pos = from_polar(pos);\n    return pos;\n}\n\nvec2 rotate(vec2 pos, float turns) {\n \tpos = to_polar(pos);\n    pos.y += turns * 2.0 * 3.14195;\n    return from_polar(pos);\n}\n\nfloat gear(vec2 uv, float teeth, float turns) {\n    uv = rotate(uv,turns);\n    uv = radial_repeat(uv, teeth);\n    \n    \n   \t\n    float d = 0.05;\n    return sd_diamond(uv, vec2(0.0+d,0.0), vec2(1.0,0.0), 4.0/teeth, 0.8);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 uv = (fragCoord.xy-iResolution.xy*0.5) / min(iResolution.x, iResolution.y) * 1.3;\n\tuv.x -= 0.05;\n    \n    float t = iTime;\n    \n    t = floor(t) + pow(fract(t), 8.0);\n    float g0 = gear(uv*2.0,18.0,t/18.0);\n    float g1 = gear(uv*4.0-vec2(2.85,0.0),9.0,-t/9.0);\n    float g3 = gear(uv*3.0+vec2(2.35,0.0),12.0,-t/12.0 +0.125);\n    float sd = min(min(g0,g1),g3);\n    float val = smoothstep(-0.5, 0.5,sd/fwidth(sd));\n    \n    \n\tfragColor = vec4(vec3(1.0)*val,1.0);\n}","name":"Image","description":"","type":"image"}]}